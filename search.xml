<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>企业级Kubernetes离线部署指南</title>
      <link href="/2025/03/14/%E4%BC%81%E4%B8%9A%E7%BA%A7Kubernetes%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/"/>
      <url>/2025/03/14/%E4%BC%81%E4%B8%9A%E7%BA%A7Kubernetes%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<h2 id="问题场景与需求分析"><a href="#问题场景与需求分析" class="headerlink" title="问题场景与需求分析"></a>问题场景与需求分析</h2><h3 id="1-1-核心挑战"><a href="#1-1-核心挑战" class="headerlink" title="1.1 核心挑战"></a>1.1 核心挑战</h3><p>在隔离网络环境下构建企业级Kubernetes集群时面临三大挑战：</p><ul><li><strong>资源隔离</strong>：无法直接访问DockerHub、GitHub等公共资源库</li><li><strong>安全合规</strong>：需通过私有镜像仓库（Harbor）实现镜像生命周期管理</li><li><strong>生产级要求</strong>：需满足高可用架构、持久化存储、网络策略等企业特性</li></ul><h3 id="1-2-解决方案要点"><a href="#1-2-解决方案要点" class="headerlink" title="1.2 解决方案要点"></a>1.2 解决方案要点</h3><ul><li><strong>跳板机设计</strong>：通过双网卡笔记本实现：<ul><li>外网侧：下载RKE2二进制文件、Harbor安装包、依赖镜像</li><li>内网侧：搭建HTTP文件服务器同步资源</li></ul></li><li><strong>离线资源池</strong>：<ul><li>RKE2 v1.26.5+ 离线包</li><li>Harbor v2.7.0+ 离线安装包</li><li>预下载Kubernetes组件镜像（约300个）</li></ul></li><li><strong>网络规划</strong>：</li></ul><img src="/images/k8s/deploy-network.svg" /><hr><h2 id="架构设计与组件分布"><a href="#架构设计与组件分布" class="headerlink" title="架构设计与组件分布"></a>架构设计与组件分布</h2><h3 id="2-1-逻辑架构图"><a href="#2-1-逻辑架构图" class="headerlink" title="2.1 逻辑架构图"></a>2.1 逻辑架构图</h3><img src="/images/k8s/deploy-logic.svg" /><h3 id="2-2-节点规格建议"><a href="#2-2-节点规格建议" class="headerlink" title="2.2 节点规格建议"></a>2.2 节点规格建议</h3><table><thead><tr><th>角色类型</th><th>CPU</th><th>内存</th><th>磁盘</th><th>数量</th><th>网络要求</th></tr></thead><tbody><tr><td>Server</td><td>4+</td><td>8G+</td><td>100GB+ x3</td><td>3</td><td>1Gbps 内网</td></tr><tr><td>Agent</td><td>8+</td><td>16G+</td><td>200GB+</td><td>N</td><td>10Gbps 内网</td></tr><tr><td>Harbor</td><td>4</td><td>8G</td><td>1TB</td><td>1</td><td>独立存储网络</td></tr></tbody></table><hr><h2 id="关键配置与问题排查"><a href="#关键配置与问题排查" class="headerlink" title="关键配置与问题排查"></a>关键配置与问题排查</h2><h3 id="3-1-RKE2数据目录迁移"><a href="#3-1-RKE2数据目录迁移" class="headerlink" title="3.1 RKE2数据目录迁移"></a>3.1 RKE2数据目录迁移</h3><p>修改<code>/etc/rancher/rke2/config.yaml</code>指定数据目录到数据盘：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data-dir:</span> <span class="string">/data/rke2</span></span><br></pre></td></tr></table></figure><h3 id="3-2-指定Ingress节点"><a href="#3-2-指定Ingress节点" class="headerlink" title="3.2 指定Ingress节点"></a>3.2 指定Ingress节点</h3><ol><li>给目标节点打标签：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl label node node01 role=server</span><br></pre></td></tr></table></figure></li><li>部署定制化Ingress, 创建<code>/data/rke2/server/manifests/rke2-ingress-nginx-config.yaml</code>：<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">helm.cattle.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">HelmChartConfig</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">rke2-ingress-nginx</span></span><br><span class="line"><span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">valuesContent:</span> <span class="string">|-</span></span><br><span class="line"><span class="attr">controller:</span></span><br><span class="line">  <span class="attr">nodeSelector:</span></span><br><span class="line">    <span class="attr">role:</span> <span class="string">server</span></span><br></pre></td></tr></table></figure></li><li>重启<code>rke2-server</code>服务</li></ol><h3 id="3-3-NFS-StorageClass配置"><a href="#3-3-NFS-StorageClass配置" class="headerlink" title="3.3 NFS StorageClass配置"></a>3.3 NFS StorageClass配置</h3><ol><li><p>在K8S所有节点上安装nfs客户端工具：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install nfs-common</span><br></pre></td></tr></table></figure></li><li><p>获取并安装Helm Chart</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ helm repo add nfs-subdir-external-provisioner https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner/</span><br><span class="line">$ helm install nfs-subdir-external-provisioner \</span><br><span class="line">  -n storage \</span><br><span class="line">  --create-namespace \</span><br><span class="line">  --<span class="built_in">set</span> nfs.server=NFS_SERVER_IP \</span><br><span class="line">  --<span class="built_in">set</span> nfs.path=/data/exports/k8s \</span><br><span class="line">  --<span class="built_in">set</span> storageClass.name=nfs \</span><br><span class="line">  --<span class="built_in">set</span> storageClass.defaultClass=<span class="literal">true</span> \</span><br><span class="line">  nfs-subdir-external-provisioner/nfs-subdir-external-provisioner</span><br></pre></td></tr></table></figure></li><li><p>验证是否成功</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pvc.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-pvc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">nfs</span></span><br><span class="line">  <span class="attr">accessModes:</span> [<span class="string">ReadWriteMany</span>]</span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">1Gi</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f pvc.yaml</span><br><span class="line">$ ssh root@nfs-server ls /data/exports/k8s</span><br><span class="line">default-test-pvc-pvc-e4c14e5b-e820-4ca0-8bc0-f08d40e333ae</span><br><span class="line">$ kubectl delete -f pvc.yaml</span><br></pre></td></tr></table></figure></li></ol><hr><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol><li><a href="https://docs.rke2.io/install/airgap">RKE2离线安装官方文档</a></li><li><a href="https://goharbor.io/docs/2.7.0/install-config/">Harbor离线部署指南</a></li><li><a href="https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner">NFS Subdir Provisioner项目</a></li><li><a href="https://kubernetes.io/docs/setup/production-environment/">Kubernetes生产检查清单</a></li></ol><blockquote><p>注：所有操作建议先在预发布环境验证，生产部署前做好etcd备份。可通过<code>rke2 etcd-snapshot save</code>创建集群快照。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 云计算 </tag>
            
            <tag> 云原生 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetes复习笔记</title>
      <link href="/2025/03/14/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2025/03/14/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h3 id="Kubernetes要解决什么问题？"><a href="#Kubernetes要解决什么问题？" class="headerlink" title="Kubernetes要解决什么问题？"></a>Kubernetes要解决什么问题？</h3><p>手动部署容器难以维护，使用容器编排技术可以解决如下问题：</p><ul><li>容器崩溃的时候可以自动部署新的容器来代替</li><li>可以自动增加或者减少容器的数量来满足高可用和自动伸缩的需求</li><li>可以使用负载均衡来将流量分配到不同的容器中</li><li>不依赖于云服务提供商的通用配置</li></ul><h3 id="Kubernetes核心概念及架构"><a href="#Kubernetes核心概念及架构" class="headerlink" title="Kubernetes核心概念及架构"></a>Kubernetes核心概念及架构</h3><p>Kubernetes架构图<br><img src="/images/k8s/arch.png" style="display: inline-block" width=500 /></p><p>Work node架构图<br><img src="/images/k8s/worker-node-arch.png" style="display: inline-block" width=500 /></p><p>Master node架构图<br><img src="/images/k8s/master-node-arch.png" style="display: inline-block" width=500 /></p><p>Pod: kubernetes管理的主要对象，可以由一个或者共享资源的一组容器组成<br>kubelet: 管理worker node和master node之间的通信<br>kube-proxy: 运行在work node上，用于管理Node和Pod的网络通信<br>API Server: 提供API服务<br>Scheduler: 选择worker node运行Pod<br>Controller: 监控Pod数量，控制worker node<br>Worker node: 运行Pod的机器或者虚拟机<br>Master node: 运行Control Plane的机器或者虚拟机</p><h3 id="Kubernetes核心对象"><a href="#Kubernetes核心对象" class="headerlink" title="Kubernetes核心对象"></a>Kubernetes核心对象</h3><ol><li>Pod: Kubernetes管理的最小单元</li></ol><ul><li>包含一个或多个容器</li><li>Pod中的容器共享网络及存储等资源</li><li>拥有一个cluster内部IP，Pod中的容器可以通过localhost互相访问</li></ul><ol start="2"><li>Deployment: 控制多个Pod</li></ol><ul><li>用户指定一个状态，Kubernetes负责保持这个状态</li><li>Deployments可以被暂停、删除及回滚</li><li>Deployments可以自动地动态伸缩</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create deployment web-app --image caddy</span><br><span class="line">$ kubectl get deployment web-app</span><br><span class="line">$ kubectl describe deployment web-app</span><br><span class="line">$ kubectl scale --replicas 2 deployment.apps/web-app</span><br><span class="line">$ kubectl <span class="built_in">set</span> image deployment/web-app caddy=nginx</span><br><span class="line">$ kubectl rollout status deployment web-app</span><br><span class="line">$ kubectl rollout undo deployment web-app</span><br><span class="line">$ kubectl rollout <span class="built_in">history</span> deployment web-app</span><br><span class="line">$ kubectl rollout undo deployment web-app --to_revision 1</span><br><span class="line">$ kubectl apply -f deployment.yaml</span><br><span class="line">$ kubectl delete deployments,services -l app=web-app</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">web-app</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span>    </span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">web-app</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">web-app-container</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">          <span class="attr">livenessProbe:</span></span><br><span class="line">            <span class="attr">httpGet:</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">              <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">5</span></span><br></pre></td></tr></table></figure><ol start="3"><li>Service: Exposes Pods to the cluster or externally</li></ol><ul><li>Pod拥有一个内部IP，每次被替换的时候都会改变</li><li>Service可以让一组Pods共享一个IP</li><li>Service可以让Pod可以被外部访问</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl expose deployment web-app --<span class="built_in">type</span>=NodePort --name=web-app-service --port=80</span><br><span class="line">$ kubectl port-forward service/web-app-service 30000:80</span><br><span class="line">$ kubectl apply -f service.yaml</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web-app-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">web-app</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Kubernetes数据管理及存储卷"><a href="#Kubernetes数据管理及存储卷" class="headerlink" title="Kubernetes数据管理及存储卷"></a>Kubernetes数据管理及存储卷</h3><h4 id="普通卷"><a href="#普通卷" class="headerlink" title="普通卷"></a>普通卷</h4><p>Kubernetes中的volume会随着Pod的结束而结束，而container重启并不影响volume.给Pod添加Volume，需要在pod.spec中添加下面的定义</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumes:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">web-app-volume</span></span><br><span class="line">  <span class="attr">emptyDir:</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>如果Pod中的container需要使用这个volume需要在container的配置中添加：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumeMounts:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/usr/share/nginx/html</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">web-app-volume</span></span><br></pre></td></tr></table></figure><ul><li>emptyDir类型的volume会创建一个空的目录，在Pod中的containers中共享，Pod删除后volume也会被永久删除。</li><li>如果想要在多个Pod中共享volume，可以创建hostPath类型的volume，类似于容器中的Bind mount。</li><li>csi(Container Storage Interface)类型可以让同一个厂商的不同类型storage都用这个类型，从而减少了类型的定义。</li><li>更多的volume类型可以参考<a href="https://kubernetes.io/docs/concepts/storage/volumes">这里</a>。</li></ul><h4 id="持久卷"><a href="#持久卷" class="headerlink" title="持久卷"></a>持久卷</h4><p>PV(Persistent volumes)持久卷不依赖于Pod和Node，Pod删除后PV也会保持，而且另外一个node上的pod也可以共享这个持久卷。Pod可以通过定义一个PVC(PV Claim)来使用持久卷。</p><p>PV的定义：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">host-pv</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">4Gi</span></span><br><span class="line">  <span class="attr">volumeMode:</span> <span class="string">Filesystem</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">standard</span></span><br><span class="line">  <span class="attr">hostPath:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/data</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br></pre></td></tr></table></figure><p>PVC的定义：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">host-pvc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">volumeName:</span> <span class="string">host-pv</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">standard</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">1Gi</span></span><br></pre></td></tr></table></figure><h4 id="Stateful-Sets"><a href="#Stateful-Sets" class="headerlink" title="Stateful Sets"></a>Stateful Sets</h4><p>Stateful Set可以让Pod按顺序启动，Pod的名字也是有固定的编号。可以通过如下的定义创建一个stateful set:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span> <span class="comment"># has to match .spec.template.metadata.labels</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">&quot;nginx&quot;</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span> <span class="comment"># by default is 1</span></span><br><span class="line">  <span class="attr">minReadySeconds:</span> <span class="number">10</span> <span class="comment"># by default is 0</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span> <span class="comment"># has to match .spec.selector.matchLabels</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">registry.k8s.io/nginx-slim:0.8</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">web</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">www</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/usr/share/nginx/html</span></span><br><span class="line">  <span class="attr">volumeClaimTemplates:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">www</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">accessModes:</span> [ <span class="string">&quot;ReadWriteOnce&quot;</span> ]</span><br><span class="line">      <span class="attr">storageClassName:</span> <span class="string">&quot;my-storage-class&quot;</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">requests:</span></span><br><span class="line">          <span class="attr">storage:</span> <span class="string">1Gi</span></span><br></pre></td></tr></table></figure><h5 id="Headless-Services"><a href="#Headless-Services" class="headerlink" title="Headless Services"></a>Headless Services</h5><p>Service可以让请求load balance到不同的Pod。其它Pod可以通过service的DNS例如<code>mysql.default.svc.cluster.local</code>来访问服务，但无法访问具体的Pod，因为Pod的DNS是根据IP来的，但每次Pod的销毁和创建IP地址都会变化，例如<code>10-40-2-8.default.pod.cluster.local</code>。如果其它Pod想要直接访问service中的其中一个Pod，例如Mysql的master pod，就需要通过headless service。Headless service可以给Pod赋予固定的DNS<code>podname.headless-svc-name.namespace.svc.cluster-domain.example</code>,如<code>mysql-1.mysql-h-svc.default.svc.cluster.local</code>。创建headless service也很简单，只需要将clusterIP设置为None即可，例如：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br></pre></td></tr></table></figure><p>在stateful set中需要通过serviceName来指定这个headless service.</p><h5 id="stateful-set的存储解决方案"><a href="#stateful-set的存储解决方案" class="headerlink" title="stateful set的存储解决方案"></a>stateful set的存储解决方案</h5><p>如果stateful set中的每个Pod都需要自己的PV和PVC，可以通过在stateful set的spec指定volumeClaimTemplates的方式实现，stateful set会保证每个Pod在重建后依然挂载原先的PVC：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumeClaimTemplates:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">metadata:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">data-volume</span></span><br><span class="line">  <span class="attr">spec:</span></span><br><span class="line">    <span class="attr">accessModes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">    <span class="attr">storageClassName:</span> <span class="string">google-storage</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">requests:</span></span><br><span class="line">        <span class="attr">storage:</span> <span class="string">500Mi</span></span><br></pre></td></tr></table></figure><h3 id="环境变量及配置"><a href="#环境变量及配置" class="headerlink" title="环境变量及配置"></a>环境变量及配置</h3><p>Dockerfile中的Entrypoint可以在Kubernetes中用<code>command: []</code>来设置，而对应的CMD则可以用<code>args: []</code>来设置</p><h4 id="ConfigMap"><a href="#ConfigMap" class="headerlink" title="ConfigMap"></a>ConfigMap</h4><p>可以定义ConfigMap来提供容器运行的环境变量：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web-app-config-map</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">folder:</span> <span class="string">story</span></span><br><span class="line">  <span class="attr">user:</span> <span class="string">user</span></span><br></pre></td></tr></table></figure><p>然后在容器的定义中使用它:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">STORY_FOLDER</span></span><br><span class="line">    <span class="attr">valueFrom:</span></span><br><span class="line">      <span class="attr">configMapKeyRef:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">web-app-config-map</span></span><br><span class="line">        <span class="attr">key:</span> <span class="string">folder</span></span><br></pre></td></tr></table></figure><h4 id="Secret"><a href="#Secret" class="headerlink" title="Secret"></a>Secret</h4><p>可以用如下的YAML定义secret:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web-app-secret</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">cGFzc3dvcmQ=</span></span><br></pre></td></tr></table></figure><p>然后再容器中可以把secrets作为环境变量来使用：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">envFrom:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">secretRef:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">web-app-secret</span></span><br></pre></td></tr></table></figure><p>或者：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">STORY_FOLDER</span></span><br><span class="line">    <span class="attr">valueFrom:</span></span><br><span class="line">      <span class="attr">secretKeyRef:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">web-app-secret</span></span><br><span class="line">        <span class="attr">key:</span> <span class="string">password</span></span><br></pre></td></tr></table></figure><p>在或者把Secret作为存储卷来使用：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumes:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app-secret-volume</span></span><br><span class="line">  <span class="attr">secret:</span></span><br><span class="line">    <span class="attr">secretName:</span> <span class="string">web-app-secret</span></span><br></pre></td></tr></table></figure><ul><li>Secret仅仅编码了，并没有加密</li><li>Secret在ETCD中也没有加密</li><li>Namespace中所有有权限创建pod/deployment的用户都可以访问secret</li></ul><h4 id="security-context"><a href="#security-context" class="headerlink" title="security context"></a>security context</h4><p>可以在Pod spec或者container中定义securityContext来增强容器的安全性，例如：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">securityContext:</span></span><br><span class="line">  <span class="attr">runAsUser:</span> <span class="number">1000</span></span><br><span class="line">  <span class="attr">capabilities:</span></span><br><span class="line">    <span class="attr">add:</span> [<span class="string">&quot;MAC_ADMIN&quot;</span>]</span><br></pre></td></tr></table></figure><h4 id="请求资源"><a href="#请求资源" class="headerlink" title="请求资源"></a>请求资源</h4><p>在容器的定义中可以使用如下yaml来请求CPU和内存资源及设置容器的资源使用限制：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">resources:</span></span><br><span class="line">  <span class="attr">requests:</span></span><br><span class="line">    <span class="attr">memory:</span> <span class="string">&quot;4Gi&quot;</span></span><br><span class="line">    <span class="attr">cpu:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">limits:</span></span><br><span class="line">    <span class="attr">memory:</span> <span class="string">&quot;8Gi&quot;</span></span><br><span class="line">    <span class="attr">cpu:</span> <span class="number">4</span></span><br></pre></td></tr></table></figure><p>可以创建<code>LimitRange</code>对象来设置Pod默认的资源限制：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">Kind:</span> <span class="string">LimitRange</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cpu-constraint</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">limits:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">default:</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="string">500m</span></span><br><span class="line">    <span class="attr">defaultRequest:</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="string">500m</span></span><br><span class="line">    <span class="attr">max:</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">min:</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">Container</span></span><br></pre></td></tr></table></figure><p>可以创建<code>ResourceQuota</code>来指定namespace的资源限制：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">Kind:</span> <span class="string">ResourceQuota</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-resource-quota</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">hard:</span></span><br><span class="line">    <span class="attr">requests.cpu:</span> <span class="number">4</span></span><br><span class="line">    <span class="attr">requests.memory:</span> <span class="string">4Gi</span></span><br><span class="line">    <span class="attr">limits.cpu:</span> <span class="number">10</span></span><br><span class="line">    <span class="attr">limits.memory:</span> <span class="string">10Gi</span></span><br></pre></td></tr></table></figure><h4 id="Taints及Tolerations"><a href="#Taints及Tolerations" class="headerlink" title="Taints及Tolerations"></a>Taints及Tolerations</h4><p>Taint可以给一个Node打一个标签，而toleration则可以让Pod运行于taint标记的Node，没有设置toleration的Pod则不能运行于taint过的node。</p><p>给一个Node打上taint标记：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl taint nodes &#123;node-name&#125; &#123;key=value&#125;:&#123;taint-effect&#125;</span><br></pre></td></tr></table></figure><p>给Pod设置toleration:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tolerations:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">key:</span> <span class="string">&quot;app&quot;</span></span><br><span class="line">  <span class="attr">operator:</span> <span class="string">&quot;Equal&quot;</span></span><br><span class="line">  <span class="attr">value:</span> <span class="string">&quot;blue&quot;</span></span><br><span class="line">  <span class="attr">effect:</span> <span class="string">NoSchedule</span></span><br></pre></td></tr></table></figure><p>taint effect可以是：</p><ul><li>NoSchedule: 没有设置toleration的Pod不能调度到该node</li><li>PreferNoSchedule: 没有设置toleration的Pod不能调度到该node，但不能保证。</li><li>NoExecute: 没有设置toleration的Pod不能调度到该node运行，已经调度的则停止运行。</li></ul><h4 id="Node-Selectors"><a href="#Node-Selectors" class="headerlink" title="Node Selectors"></a>Node Selectors</h4><p>可以用下面的命令来给一个node打标签：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl label nodes &#123;node-name&#125; size=Large</span><br></pre></td></tr></table></figure><p>然后在Pod的定义中，可以使用node selector来选择node:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">nodeSelector:</span></span><br><span class="line">  <span class="attr">size:</span> <span class="string">Large</span></span><br></pre></td></tr></table></figure><h4 id="Node-Affinity"><a href="#Node-Affinity" class="headerlink" title="Node Affinity"></a>Node Affinity</h4><p>通过node selectors选择node功能比较简单，Node Affinity则功能更加丰富。在Pod的定义中，可以使用affinity来选择node：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">affinity:</span></span><br><span class="line">  <span class="attr">nodeAffinity:</span></span><br><span class="line">    <span class="attr">requiredDuringSchedulingIgnoreDuringExecution:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">matchExpression:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">size</span></span><br><span class="line">        <span class="attr">operator:</span> <span class="string">NotIn</span></span><br><span class="line">        <span class="attr">values:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Small</span></span><br></pre></td></tr></table></figure><h4 id="Labels-Selectors以及Annotations"><a href="#Labels-Selectors以及Annotations" class="headerlink" title="Labels, Selectors以及Annotations"></a>Labels, Selectors以及Annotations</h4><p>Labels用于给Kubernetes对象打标签，而Selectors可以根据这些标签来快速过滤出来所要查找的对象。例如，给一个Pod打标签只需要在metadata中定义labels即可。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web-app</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">App1</span></span><br><span class="line">    <span class="attr">function:</span> <span class="string">front-end</span></span><br></pre></td></tr></table></figure><p>通过selector来查找对应的Pod：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$kubectl</span> get pods --selector app=App1</span><br><span class="line">NAME                       READY   STATUS    RESTARTS   AGE</span><br><span class="line">web-app-6cc4887574-pcld4   1/1     Running   0          26s</span><br><span class="line">web-app-6cc4887574-w2mx6   1/1     Running   0          26s</span><br><span class="line">web-app-6cc4887574-xhbkf   1/1     Running   0          26s</span><br></pre></td></tr></table></figure><p>Annotations则用于给Kubernetes对象打上用于集成的一些信息，如:</p><ul><li>build,release,image信息</li><li>开发者的email,phone等信息</li></ul><h4 id="升级策略"><a href="#升级策略" class="headerlink" title="升级策略"></a>升级策略</h4><ol><li>蓝绿升级：先创建一个新的deployment，标记为<code>version:v2</code>，将service的selector从<code>version:v1</code>改成<code>version:v2</code></li><li>金丝雀升级: 创建一个新的deployment, 标记为<code>version:v2</code>，service不变，标记依然为两个版本共有的标记，例如<code>app: web-app</code>，将新的deployment的replica从小到大，直到升级为需要的值。然后删除原来的deployment。</li></ol><h4 id="Jobs及CronJobs"><a href="#Jobs及CronJobs" class="headerlink" title="Jobs及CronJobs"></a>Jobs及CronJobs</h4><p>可以用如下的YAML定义一个Job：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Job</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">add-job</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">completions:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">parallelism:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">math-add</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">ubuntu</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&#x27;expr&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;2&#x27;</span>]</span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Never</span></span><br></pre></td></tr></table></figure><p>可以用如下的YAML定义一个CronJob:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CronJob</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">add-cron-job</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">schedule:</span> <span class="string">&quot;*/1 * * * *&quot;</span></span><br><span class="line">  <span class="attr">jobTemplate:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">completions:</span> <span class="number">3</span></span><br><span class="line">      <span class="attr">parallelism:</span> <span class="number">3</span></span><br><span class="line">      <span class="attr">template:</span></span><br><span class="line">        <span class="attr">spec:</span></span><br><span class="line">          <span class="attr">containers:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">math-add</span></span><br><span class="line">            <span class="attr">image:</span> <span class="string">ubuntu</span></span><br><span class="line">            <span class="attr">command:</span> [<span class="string">&#x27;expr&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;2&#x27;</span>]</span><br><span class="line">          <span class="attr">restartPolicy:</span> <span class="string">Never</span></span><br></pre></td></tr></table></figure><h3 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h3><h4 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h4><ol><li>CluseterIP: 仅提供Cluster内部访问的IP地址</li><li>NodePort: 将container的port映射到Node上的某一个port，外部应用则可以通过node的IP及该port访问服务。</li><li>LoadBalancer: 将流量根据一定的策略引入到不同的Pod中</li></ol><img src="/images/k8s/service-node-port.png" style="display: inline-block" width=500 /><p>环境变量SERVICE_NAME_SERVICE_HOST保存Pod的Cluster IP. 在指定环境变量的时候，value中填写”service_name.default”可以指向service的Cluster IP.</p><h4 id="Ingress"><a href="#Ingress" class="headerlink" title="Ingress"></a>Ingress</h4><p>Ingress可以看做是Kubernetes对反向代理的抽象，例如可以把不同Host不同Path的流量导入到不同的service中。</p><p>可以通过如下的YAML创建一个Ingress</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingress-wildcard-host</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">&quot;foo.bar.com&quot;</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">&quot;/bar&quot;</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">service1</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">&quot;*.foo.com&quot;</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">&quot;/foo&quot;</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">service2</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><h4 id="网络策略"><a href="#网络策略" class="headerlink" title="网络策略"></a>网络策略</h4><p>网络策略(Network Policy)可以用来控制Pod之间的互相访问。例如，我们创建如下的一个Network Policy.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">NetworkPolicy</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-network-policy</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">podSelector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">role:</span> <span class="string">db</span></span><br><span class="line">  <span class="attr">policyTypes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Ingress</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Egress</span></span><br><span class="line">  <span class="attr">ingress:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">from:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">ipBlock:</span></span><br><span class="line">            <span class="attr">cidr:</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.0</span><span class="string">/16</span></span><br><span class="line">            <span class="attr">except:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="number">172.17</span><span class="number">.1</span><span class="number">.0</span><span class="string">/24</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">namespaceSelector:</span></span><br><span class="line">            <span class="attr">matchLabels:</span></span><br><span class="line">              <span class="attr">project:</span> <span class="string">myproject</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">podSelector:</span></span><br><span class="line">            <span class="attr">matchLabels:</span></span><br><span class="line">              <span class="attr">role:</span> <span class="string">frontend</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">          <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">  <span class="attr">egress:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">to:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">ipBlock:</span></span><br><span class="line">            <span class="attr">cidr:</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/24</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">          <span class="attr">port:</span> <span class="number">5978</span></span><br></pre></td></tr></table></figure><h3 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h3><h4 id="Kubernetes中的认证"><a href="#Kubernetes中的认证" class="headerlink" title="Kubernetes中的认证"></a>Kubernetes中的认证</h4><ul><li>Kubernetes认证主体是User(Admin, developer)及程序(ServiceAccount)。</li><li>User在访问kubernetes资源之前，需要通过kube-apiserver进行认证</li><li>Kubernetes不保存用户名、密码，而是通过下列外部资源进行认证：<ul><li>静态密码文件</li><li>静态token文件</li><li>证书</li><li>外部认证服务</li></ul></li></ul><p>在启动Kubernetes API server的时候可以通过<code>--basic-auth-file</code>来指定静态密码文件，例如user-details.csv：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">password1, user1, user_id1, group1</span><br><span class="line">password2, user2, user_id2, group2</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>也可以通过<code>--token-auth-file</code>来指定静态token文件，例如user-tokens.csv</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">token1, user1, user_id1, group1</span><br><span class="line">token2, user2, user_id2, group2</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h4 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h4><ul><li>AlwaysAllow</li><li>AlwaysDeny</li><li>Node</li><li>ABAC</li><li>RBAC</li><li>Webhook</li></ul><img src="/images/k8s/cluster-roles.png" style="display: inline-block" width=800 /><h4 id="service-account"><a href="#service-account" class="headerlink" title="service account"></a>service account</h4><p>service account可以看做Kubernetes内部的程序为主体的账户，例如，我们可以通过下面的定义给Kubernetes dashboard来创建一个SA，以及对应的token.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dashboard-sa</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">demo-role</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;*&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;*&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;create&quot;</span>, <span class="string">&quot;update&quot;</span>, <span class="string">&quot;patch&quot;</span>, <span class="string">&quot;delete&quot;</span>]</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-role-binding</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dashboard-sa</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">demo-role</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure><p>创建sa对应的token:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$kubectl</span> create token dashboard-sa</span><br></pre></td></tr></table></figure><h4 id="KubeConfig"><a href="#KubeConfig" class="headerlink" title="KubeConfig"></a>KubeConfig</h4><img src="/images/k8s/kubeconfig.png" style="display: inline-block" width=800 /><h4 id="API-group"><a href="#API-group" class="headerlink" title="API group"></a>API group</h4><img src="/images/k8s/kube-api.png" style="display: inline-block" width=800 /><img src="/images/k8s/kube-apis.png" style="display: inline-block" width=800 /><h4 id="Admission-Controllers"><a href="#Admission-Controllers" class="headerlink" title="Admission Controllers"></a>Admission Controllers</h4><img src="/images/k8s/admission.png" style="display: inline-block" width=800 /><h4 id="API版本"><a href="#API版本" class="headerlink" title="API版本"></a>API版本</h4><p>/v1alpha1 -&gt; /v1beta1 -&gt; v1<br><img src="/images/k8s/api-version.png" style="display: inline-block" width=800 /></p>]]></content>
      
      
      <categories>
          
          <category> 云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kubernetes </tag>
            
            <tag> cloud native </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>快速排序</title>
      <link href="/2024/12/27/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/"/>
      <url>/2024/12/27/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<p>今天面试快排竟然没有写出来，囧… 再练一遍。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quickSort</span>(<span class="params">arr, left, right</span>):</span></span><br><span class="line">    <span class="keyword">if</span> left &gt;= right:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    pivot = random.randint(left, right)</span><br><span class="line">    arr[pivot], arr[right] = arr[right], arr[pivot]</span><br><span class="line">    q = left</span><br><span class="line">    p = left - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> q &lt; right:</span><br><span class="line">        <span class="keyword">if</span> arr[q] &lt; arr[right]:</span><br><span class="line">            p += <span class="number">1</span></span><br><span class="line">            arr[p], arr[q] = arr[q], arr[p]</span><br><span class="line">        q += <span class="number">1</span></span><br><span class="line">    p += <span class="number">1</span></span><br><span class="line">    arr[p], arr[right] = arr[right], arr[p]</span><br><span class="line">    quickSort(arr, left, p - <span class="number">1</span>)</span><br><span class="line">    quickSort(arr, p + <span class="number">1</span>, right)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sort</span>(<span class="params">arr</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> arr:</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line">    lenArr = <span class="built_in">len</span>(arr)</span><br><span class="line">    quickSort(arr, <span class="number">0</span>, lenArr - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> arr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(sort([<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">4</span>]))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Argo workflow v.s. Tekton</title>
      <link href="/2024/12/13/Argo-v-s-Tekton/"/>
      <url>/2024/12/13/Argo-v-s-Tekton/</url>
      
        <content type="html"><![CDATA[<p>在云原生的世界里，持续集成/持续交付（CI/CD）工具起着至关重要的作用，Argo和Tekton作为两款备受瞩目的工具，各自具有独特的特点和优势。本文将从多个方面对它们进行详细对比，帮助大家更好地理解和选择适合自己项目的 CI/CD 解决方案。</p><h3 id="Argo核心概念"><a href="#Argo核心概念" class="headerlink" title="Argo核心概念"></a>Argo核心概念</h3><img src="/images/argo-concepts.png" width="500px" /><ul><li>Workflow: Workflow是Argo管理和调度的对象，用户可以通过UI和CLI提交一个Workflow让Argo去运行。一个Workflow作为Kubernetes CRD来实现。</li><li>Template：一个Workflow可以定义一个或者多个Template，通常会以Pod的形式来运行。入口template可以通过<code>entrypoint</code>来指定。</li><li>Template tags: 也称为Template variables。它由<code>&#123;&#123;&#125;&#125;</code>来分割并在运行时被替换为具体的值。</li><li>Template有两种类型，一种是Work，另外一种是Orchestrate。</li><li>Work类型的template有以下几种， 它们都会以Pod的形式来运行：<ul><li>container set允许Pod中运行多个容器.</li><li>data template用来从后端存储系统中获取数据。</li><li>resource template可以用来在Kubernetes中创建资源并等待它进入到某一种状态.</li><li>script template可以在容器中运行script。</li></ul></li><li>Orchestrate类型的template有以下几种：<ul><li>DAG有向无循环图，它可以用来指定template之间的依赖关系。</li><li>steps template是一种定义工作流中顺序执行步骤的方式。它是一种线性的任务编排结构，每个步骤（Step）通常是一个容器化的任务，这些任务会按照定义的顺序依次执行</li><li>Suspend template允许用户在工作流执行过程中暂停某个特定任务模板（template）的执行。这提供了一种灵活的机制，用于在需要人工干预、等待外部条件满足或者进行动态调整时，暂停工作流中某个步骤的运行。</li></ul></li><li>类似于ansible，template中也可以通过<code>withItems</code>、<code>withSequence</code>来实现迭代，通过<code>when</code>来实现条件分支。</li></ul><h3 id="Tekton核心概念"><a href="#Tekton核心概念" class="headerlink" title="Tekton核心概念"></a>Tekton核心概念</h3><img src="/images/tekton-arch.jpg" width="500px" /><ul><li>Task: 定义了一系列有序的步骤(step)，并且每个步骤都会针对特定的一组输入调用特定的构建工具，并生成特定的一组输出，这些输出可作为下一步骤的输入使用。</li><li>Pipeline: 支持有向五循环图(DAG)，定义了一系列有序的任务，就如同任务中的步骤一样，Pipeline中的一个任务可以使用先前已执行任务的输出作为其输入。</li><li>TaskRun: 实例化一个特定的任务，使其基于特定的一组输入来执行，并生成特定的一组输出。换句话说，任务告知Tekton要做什么，而TaskRun则告知Tekton针对什么来执行任务，以及关于具体如何执行的任何附加细节，例如构建标志。</li><li>PipelineRun: 实例化一个特定的流水线，使其基于特定的一组输入来执行，并将产生的特定一组输出发送至特定的目标位置。</li><li>通常来说，Step对应一个容器，Task对应一个Pod，Pipeline对应一组Pod</li></ul><h3 id="核心功能对比"><a href="#核心功能对比" class="headerlink" title="核心功能对比"></a>核心功能对比</h3><h4 id="任务定义与复用"><a href="#任务定义与复用" class="headerlink" title="任务定义与复用"></a>任务定义与复用</h4><ul><li>Tekton：在 Tekton 中，任务被定义为一系列有序的步骤，每个步骤都可以调用特定的容器镜像来执行特定的操作。任务可以通过共享任务库的方式进行复用，这使得团队能够在不同的流水线中重复使用已有的任务逻辑，提高了开发效率并减少了代码冗余。例如，一个用于代码编译的任务可以在多个不同的 CI 流水线中被重复引用，只需要根据不同的项目进行简单的参数配置即可。</li><li>Argo Workflow：Argo Workflow 允许用户通过模板来定义任务，这些模板可以是容器模板、资源模板或者脚本模板等。用户可以将常用的任务逻辑封装成模板，并在不同的工作流中进行复用。与 Tekton 不同的是，Argo Workflow 的模板定义更加灵活，支持更多的参数化配置和动态生成任务的方式，这使得它在处理一些复杂的、需要根据运行时状态动态调整任务的场景中具有优势。</li></ul><h4 id="工作流编排灵活性"><a href="#工作流编排灵活性" class="headerlink" title="工作流编排灵活性"></a>工作流编排灵活性</h4><ul><li>Tekton：通过 Pipeline 资源，Tekton 支持将多个任务按照特定的顺序组合成一个完整的工作流。任务之间可以通过定义输入和输出资源来实现数据的传递和依赖关系的管理。这种基于资源的依赖管理方式使得工作流的编排更加清晰和易于理解，同时也方便了对工作流的调试和维护。例如，在一个 CI/CD 流水线中，代码构建任务的输出（如构建后的镜像）可以作为部署任务的输入，Tekton 能够很好地处理这种任务之间的依赖关系，确保工作流按照预期的顺序执行。</li><li>Argo Workflow：借助 DAG 的强大功能，Argo Workflow 能够支持更加复杂的工作流拓扑结构，包括并行分支、条件判断等。用户可以根据业务需求灵活地定义任务之间的执行顺序和依赖关系，实现高度定制化的工作流。例如，在一个数据处理工作流中，可能需要根据数据的不同特征执行不同的处理步骤，Argo Workflow 的 DAG 特性可以轻松地实现这种复杂的逻辑控制，使得工作流能够根据实际情况动态地调整执行路径。</li></ul><h4 id="用户界面与可视化"><a href="#用户界面与可视化" class="headerlink" title="用户界面与可视化"></a>用户界面与可视化</h4><ul><li>Tekton：Tekton 本身并没有提供一个完整的用户界面（UI），但它与许多流行的 Kubernetes 仪表板（如 Kubeflow Pipelines UI）集成良好，通过这些集成，用户可以方便地查看和管理 Tekton 工作流的执行状态、查看任务日志等。这种基于第三方 UI 的方式虽然在一定程度上依赖于其他工具，但也使得 Tekton 能够充分利用现有的成熟可视化解决方案，为用户提供相对友好的操作体验。</li><li>Argo Workflow：Argo Workflow 自带了一个功能丰富的用户界面，用户可以通过该 UI 直观地创建、编辑和监控工作流的执行情况。UI 中提供了详细的工作流拓扑图展示，使得用户能够清晰地了解工作流中各个任务的执行状态和依赖关系。此外，Argo Workflow 的 UI 还支持工作流的暂停、恢复和终止等操作，方便用户在运行时对工作流进行灵活的控制，这对于一些需要人工干预的工作流场景来说非常实用。</li></ul><h4 id="生态系统集成"><a href="#生态系统集成" class="headerlink" title="生态系统集成"></a>生态系统集成</h4><ul><li>Tekton：作为 CNCF 的项目，Tekton 与其他云原生工具和平台具有良好的集成性。它可以与 Kubernetes 生态系统中的各种工具（如 Helm、Istio 等）无缝协作，同时也支持与主流的 CI/CD 工具（如 Jenkins、GitLab CI 等）集成，使得用户可以将 Tekton 融入到现有的开发流程中，充分利用已有的技术栈。例如，通过与 Jenkins 的集成，用户可以在 Jenkins 中触发 Tekton 流水线的执行，实现更加灵活和强大的 CI/CD 解决方案。</li><li>Argo Workflow：Argo Workflow 也积极地与其他工具进行集成，它与 Kubernetes 的各种资源对象紧密结合，能够方便地调用和管理其他 Kubernetes 资源，如 ConfigMap、Secret 等。此外，Argo Workflow 还支持与一些数据处理和机器学习框架（如 Spark、TensorFlow 等）集成，为数据科学家和工程师提供了一个强大的工作流编排平台，用于构建和运行复杂的数据处理和机器学习流水线。</li></ul><h3 id="适用场景对比"><a href="#适用场景对比" class="headerlink" title="适用场景对比"></a>适用场景对比</h3><ul><li>Tekton：在大型企业的 CI/CD 场景中，Tekton 表现出色。例如，一个拥有多个微服务项目的团队，可以使用 Tekton 来构建统一的 CI/CD 平台。通过定义通用的任务（如代码拉取、构建、测试、部署等）并将它们组合成不同的流水线，团队可以快速地为每个微服务项目创建定制化的交付流程，同时保证整个平台的可维护性和扩展性。另外，Tekton 在云原生应用的持续交付过程中，能够与 Kubernetes 的各种资源和工具进行深度集成，实现从代码提交到应用上线的全自动化流程，大大提高了开发效率和交付速度。</li><li>Argo Workflow：对于数据处理和机器学习工作流，Argo Workflow 是一个不错的选择。例如，在一个数据分析团队中，需要定期从多个数据源获取数据，进行清洗、转换和分析，并将结果存储到数据仓库中。Argo Workflow 可以通过其灵活的 DAG 编排能力，定义一个复杂的数据处理流水线，包括数据采集任务、数据清洗任务、数据分析任务以及结果存储任务等，各个任务之间可以根据数据的依赖关系进行并行或顺序执行，确保整个数据处理流程的高效和准确。此外，在机器学习模型训练和部署的场景中，Argo Workflow 也能够很好地管理模型训练的各个阶段，包括数据预处理、模型训练、模型评估以及模型上线等，为机器学习工程师提供了一个强大的工具来构建和管理复杂的机器学习工作流。</li></ul><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>Tekton 和 Argo Workflow 都是优秀的工作流编排工具，它们在架构设计、功能特性、用户界面以及生态系统集成等方面都存在着各自的优势和适用场景。Tekton 凭借其高度模块化和可扩展的设计，以及与 Kubernetes 生态系统的紧密集成，在 CI/CD 领域具有很强的竞争力；而 Argo Workflow 则以其灵活的 DAG 编排能力和丰富的可视化界面，在数据处理和机器学习工作流方面表现出色。</p>]]></content>
      
      
      <categories>
          
          <category> 开发工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> argo </tag>
            
            <tag> tekton </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何给云计算用户提供安全可靠的操作系统镜像</title>
      <link href="/2024/12/04/%E5%A6%82%E4%BD%95%E7%BB%99%E4%BA%91%E8%AE%A1%E7%AE%97%E7%94%A8%E6%88%B7%E6%8F%90%E4%BE%9B%E5%AE%89%E5%85%A8%E5%8F%AF%E9%9D%A0%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/"/>
      <url>/2024/12/04/%E5%A6%82%E4%BD%95%E7%BB%99%E4%BA%91%E8%AE%A1%E7%AE%97%E7%94%A8%E6%88%B7%E6%8F%90%E4%BE%9B%E5%AE%89%E5%85%A8%E5%8F%AF%E9%9D%A0%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/</url>
      
        <content type="html"><![CDATA[<p>在云计算环境中，操作系统镜像作为用户创建云实例的基础模板，其安全性和可靠性直接影响着用户应用和数据的安全。一旦操作系统镜像存在安全漏洞，可能导致大规模的安全事件，如数据泄露、恶意软件传播等。因此，研究如何给云计算用户提供安全可靠的操作系统镜像具有极为重要的现实意义。</p><h3 id="操作系统镜像的分类"><a href="#操作系统镜像的分类" class="headerlink" title="操作系统镜像的分类"></a>操作系统镜像的分类</h3><ul><li>云平台镜像(stock image)：云平台镜像是指云计算平台官方提供的，经过平台定制化、验证过的操作系统镜像。由云平台负责镜像的生命周期管理。</li><li>用户自定义镜像(custom image)：用户自定义的镜像通常保存了用户特定的配置，安装了特定的软件。由用户自己管理镜像的生命周期。</li><li>第三方镜像(catalog image)：第三方镜像是指第三方的供应商提供的操作系统镜像，由第三方供应商负责管理镜像的生命周期，由云平台负责审核与验证。</li></ul><h3 id="操作系统镜像的生命周期"><a href="#操作系统镜像的生命周期" class="headerlink" title="操作系统镜像的生命周期"></a>操作系统镜像的生命周期</h3><ul><li>可用/已验证(Available)：表示镜像可以正常用于创建虚拟机、裸金属实例。</li><li>已弃用(Deprecated)：表示镜像的操作系统版本已经不是最新的稳定版本。</li><li>已淘汰(Obsolete)：表示镜像的操作系统版本已经结束支持。</li></ul><h3 id="如何保证操作系统镜像的安全与可靠"><a href="#如何保证操作系统镜像的安全与可靠" class="headerlink" title="如何保证操作系统镜像的安全与可靠"></a>如何保证操作系统镜像的安全与可靠</h3><p>保证操作系统镜像的安全与可靠需要贯穿其生命周期的每一个环节。</p><h4 id="构建阶段"><a href="#构建阶段" class="headerlink" title="构建阶段"></a>构建阶段</h4><ul><li>选择最新的稳定版本。操作系统供应商们一般都有专门的安全团队，他们会定期的发布安全补丁和更新，能够及时地修复已知的安全漏洞。使用最新的稳定版本可以有效的降低已知安全漏洞带来的隐患。</li><li>构建脚本的开发应该符合职责分离原则(Separation of Duties)，如开发者提交的代码需要其他人的评审才能合进主干等，以避免来自团队内部有意或者无意的安全隐患。</li><li>构建脚本的集成应该符合一定的条件，如单元测试覆盖率大于某个阈值、静态代码扫描没有Code Smell等。</li><li>最小化安装原则。根据用户的需求，之在镜像中包含必要的软件包。这样可以减少不必要软件带来的安全风险，因为每一个额外的软件都可能存在潜在的安全漏洞。</li><li>及时更新构建服务器本身的操作系统版本和软件包。</li><li>建立和维护Devops pipeline，仅允许特定的人可以访问构建服务器，其他开发人员只需要利用Pipeline来开发和构建镜像。</li><li>下载供应商镜像时，需要检验其检验和。既可以保证其合法性，又能利用本地缓存避免重复下载。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [[ <span class="variable">$&#123;downloaded_checksum&#125;</span> == <span class="variable">$&#123;calculated_checksum&#125;</span> ]]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  msg <span class="string">&quot;Valid checksum&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  msg <span class="string">&quot;Downloading iso failed: invalid checksum.&quot;</span></span><br><span class="line">  msg <span class="string">&quot;Removing existing iso: <span class="variable">$&#123;iso_fullpath&#125;</span>...&quot;</span></span><br><span class="line">  rm -rf <span class="variable">$&#123;iso_fullpath&#125;</span></span><br><span class="line">  msg <span class="string">&quot;Existing iso <span class="variable">$&#123;iso_fullpath&#125;</span> removed.&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></li><li>根据操作系统官方给定的安全指南来定制化镜像。如SUSE的安全规范：<a href="https://documentation.suse.com/sles/15-SP2/html/SLES-all/book-security.html">https://documentation.suse.com/sles/15-SP2/html/SLES-all/book-security.html</a></li><li>周期性配合平台做安全与合规评估，如GDPR等。</li></ul><h4 id="测试阶段"><a href="#测试阶段" class="headerlink" title="测试阶段"></a>测试阶段</h4><ul><li>要要完备的测试流程，包括构建代码的单元测试UT，镜像的功能测试FVT，渗透测试(Penetration Test)等</li><li>功能测试用例示例：<ul><li>image_responds_to_ping</li><li>linux_image_allows_ssh</li><li>does_linux_vm_have_a_resolv_conf_file</li><li>linux_ping_by_ip</li><li>linux_ping_by_name</li><li>linux_check_boot_disk_size</li><li>linux_check_distribution</li><li>linux_check_for_required_modules</li><li>linux_check_valid_rhel_license</li><li>linux_check_valid_software_update</li><li>linux_vm_with_two_nics_and_two_volumes</li><li>does_vm_stop_and_start_correctly</li><li>does_vm_reboot_correctly</li><li>linux_check_eth_interfaces_are_up</li><li>linux_check_eth_interface_addresses</li><li>attach_and_detach_volume_to_vsi</li><li>linux_check_anyuser_login_over_ssh</li><li>attach_and_detach_nic_to_vsi</li><li>linux_check_no_swap</li><li>check_kernel_boot_options</li><li>check_cloud_init</li><li>check_source_repos</li><li>check_no_vagrant_account</li><li>check_no_user_account_present</li><li>check_for_lock_files</li><li>check_systemd_service_units</li><li>linux_check_for_no_mail_packages</li><li>…</li></ul></li></ul><h4 id="发布阶段"><a href="#发布阶段" class="headerlink" title="发布阶段"></a>发布阶段</h4><ul><li>开发环境、预发布环境(staging)、产品环境要有严格的访问权限控制，SOD原则同样适用</li><li>产品环境的发布需要相关负责人审批</li><li>提供镜像签名以便用户或者其他云服务检验</li><li>记录完备的镜像生命周期审计日志</li><li>定期发布新的版本以包含最新的安全补丁</li><li>提示用户及时更新软件包</li></ul><p>为云计算用户提供安全可靠的操作系统镜像需要从构建源头到使用过程的全方位考量和精心设计。通过选择安全的基础操作系统、遵循最小化安装原则、在构建过程中进行安全加固、保障镜像存储与分发的安全以及建立使用过程中的安全监控与更新机制等一系列措施，可以有效提高操作系统镜像的安全性和可靠性，为云计算用户提供一个安全稳定的运行环境。</p>]]></content>
      
      
      <categories>
          
          <category> 云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 云计算 </tag>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2024云-AI-计算国际合作论坛要点小结</title>
      <link href="/2024/12/03/2024%E4%BA%91-AI-%E8%AE%A1%E7%AE%97%E5%9B%BD%E9%99%85%E5%90%88%E4%BD%9C%E8%AE%BA%E5%9D%9B%E5%B0%8F%E7%BB%93/"/>
      <url>/2024/12/03/2024%E4%BA%91-AI-%E8%AE%A1%E7%AE%97%E5%9B%BD%E9%99%85%E5%90%88%E4%BD%9C%E8%AE%BA%E5%9D%9B%E5%B0%8F%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<ul><li>坚持开放、兼容与自主创新来应对技术封锁</li><li>推进算力国产化，2030年国产化算力占比要达到90%以上</li><li>互联网+ 正在转变为AI+</li><li>人工智能从单模态向多模态发展</li><li>系统软件是制约我国AI发展的关键因素，智算的10种核心基础软件<ul><li>并行系统：DeepSpeed, Megatron-LM, FairScale</li><li>编程框架：PyTorch</li><li>通信库：NCCL</li><li>AI编译器：tvm</li><li>算子库：cuBLAS, cuDNN</li><li>编程语言：CUDA, oneAPI</li><li>调度器</li><li>内存管理</li><li>容错系统</li><li>存储系统</li></ul></li><li>构建国产万卡集群很重要也很难</li><li>异构卡、异地卡训练效果不好</li><li>与通算中心相比，智算中心功率密度更大，负载波动更大，交付时间更短</li><li>智算云计算架构包括智算基础设施、智算平台层和智算服务层，贯穿安全与稳定性保障</li><li>大模型训练中，电力费用占比65%，缺算到缺电</li><li>云计算从通用计算到混合计算再到异构计算，从CPU池化到GPU、NPU、TPU、DPU池化</li><li>大模型浪潮下，企业更需要私有化部署保护数据主权</li><li>企业落地AI的三大困境<ul><li>资源困境：算力烧钱、投资风险</li><li>模型困境：模型难选、难用</li><li>应用困境：数据缺失、应用效果差</li></ul></li></ul><img src="/images/aicloud/aicloud1.jpg" width="500px" /><img src="/images/aicloud/aicloud2.jpg" width="500px" /><img src="/images/aicloud/aicloud3.jpg" width="500px" /><img src="/images/aicloud/aicloud4.jpg" width="500px" /><img src="/images/aicloud/aicloud5.jpg" width="500px" /><img src="/images/aicloud/aicloud6.jpg" width="500px" /><img src="/images/aicloud/aicloud7.jpg" width="500px" /><img src="/images/aicloud/aicloud8.jpg" width="500px" /><img src="/images/aicloud/aicloud9.jpg" width="500px" /><img src="/images/aicloud/aicloud10.jpg" width="500px" /><img src="/images/aicloud/aicloud11.jpg" width="500px" /><img src="/images/aicloud/aicloud12.jpg" width="500px" /><img src="/images/aicloud/aicloud13.jpg" width="500px" /><img src="/images/aicloud/aicloud14.jpg" width="500px" /><img src="/images/aicloud/aicloud15.jpg" width="500px" /><img src="/images/aicloud/aicloud16.jpg" width="500px" /><img src="/images/aicloud/aicloud17.jpg" width="500px" />]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI </tag>
            
            <tag> 云计算 </tag>
            
            <tag> 云原生 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>再会，蓝色巨人</title>
      <link href="/2024/11/29/%E5%86%8D%E4%BC%9A%EF%BC%8C%E8%93%9D%E8%89%B2%E5%B7%A8%E4%BA%BA/"/>
      <url>/2024/11/29/%E5%86%8D%E4%BC%9A%EF%BC%8C%E8%93%9D%E8%89%B2%E5%B7%A8%E4%BA%BA/</url>
      
        <content type="html"><![CDATA[<p>今天收到了离职补偿金，算是正式和我摸告别了。也算是给我十一年零四个月的青春以及职业生涯上半场画上了句号。相信和大部分IBMer一样，我对公司并没有太多的怨怼之心。作为一个合格的中年人，我已经学会了隐藏自己内心最真实的想法，很少更新朋友圈或者其他的一些社交媒体。今天是个特殊的日子，再任性一次吧。总结总结过去，展望展望未来。</p><h3 id="关于IBM"><a href="#关于IBM" class="headerlink" title="关于IBM"></a>关于IBM</h3><p>很荣幸能够和很多优秀的IBMer及前IBMer们一起共事，虽然没能学到一丝半点，但毕竟是见识到了真正的牛人是什么样子的。</p><ul><li>这里有优秀的职业经理人，记得第一次和老板one-one的时候，被问到“我能为你做些什么？你需要什么资源？”，是他让我明白优秀的管理者其实是服务者，他能协调好各种资源，能够调动员工的积极性，而不是简单地给员工分配任务，甚至PUA员工。</li><li>这里有真正的技术极客。曾经和组内大牛一起啃西瓜喝啤酒的时候，他突然想到了虚拟机热迁移的方案，竟然立马回家写代码去了。</li><li>这里也有擅长写专利的大神，每年可以发表十几个技术专利。</li></ul><p>IBM的工作节奏很慢，我们组做的是从零开始的孵化项目，算是强度比较大的了，但是和互联网比，还是轻松很多。国外的同事就更轻松了，记得之前要重构一个组件，我的估时是我一个人1-3个月可以做完，后来交给德国的同事们做，他们4-5个人，做了一年左右的时间。但不可否认的是，他们做的更加细致，无论是代码、测试、日志、工具链、合规等，都挑不出任何毛病。</p><p>IBM是真正的扁平化，虽然是大厂，也有很多的职级，但是你基本感觉不到上下级的差异，每个人只是分工不同、职能不同而已。职级越高的大佬们反而越是谦逊与随和。</p><p>IBM的年假很多，21 + 3 + 1, 大概25天左右，疫情之后每周可以三天在家办公。上下班不打卡，有事早走或者晚到给组内发一封邮件就可以了。</p><p>关于考核，除了业绩之外，个人技能的提升及创新能力也是重要的考核指标。</p><p>IBM的薪资较低，同级别和互联网大厂相比，薪资只有人家的一半左右。绩效奖励也不明显，绩效好的和绩效差的在薪水上并没有很大的差距。</p><h3 id="关于我自己"><a href="#关于我自己" class="headerlink" title="关于我自己"></a>关于我自己</h3><p>做得好的地方：</p><ul><li>坚持自由、开放、分享的极客精神，能够持续学习新的技术，并没有给自己设限，只要项目需要用到的，我都乐意去研究。技术栈从Linux内核扩展到了UI，时间和精力允许的话可以自己独立折腾出一个产品。</li><li>业余时间写了一些网站、小程序之类应用，虽然流量不大，但是确实能够满足自己的需求。自己开发的，总是最适合自己的，哈哈。</li><li>晋升还算快，6年时间升到Band 8，成为团队技术骨干之一。</li><li>写技术博客的习惯坚持了下来。写博客不仅能加深对知识的理解，也能够在忘记的时候快速的查阅。以后继续保持。</li><li>没有辜负我摸一年一度的诚信和合规教育，没有权限了还力所能及得把工作交接给印度的同事们。</li><li>能够坚持打篮球和跑步</li></ul><p>还有待提高的地方：</p><ul><li>并没有在某一个技术点一直研究下去。</li><li>忘记了初心，只是埋头于自己的项目，没有参与到开源社区中去。</li><li>写博客的频率不是很高，大多是笔记之类的，系统性的总结或者深度思考的很少。</li><li>刷短视频、刷文章、刷剧、玩游戏浪费了大量的时间，以后尽量戒掉。</li><li>作息不规律，经常熬夜</li></ul><h3 id="关于未来"><a href="#关于未来" class="headerlink" title="关于未来"></a>关于未来</h3><ul><li>继续保持折腾精神，学习AI相关的技术</li><li>之前一直想重构云数据库的项目，乘着“退休”时间继续研究研究</li><li>找一个技术点、一个社区深度参与下去</li><li>提高一下博客更新的频率及质量</li></ul><p>最后，用以下几个词勉励一下自己：</p><ul><li>诚信</li><li>勤奋</li><li>自由</li><li>开放</li><li>分享</li></ul>]]></content>
      
      
      <categories>
          
          <category> 非技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 感悟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微前端概要</title>
      <link href="/2024/11/18/%E5%BE%AE%E5%89%8D%E7%AB%AF%E6%A6%82%E8%A6%81/"/>
      <url>/2024/11/18/%E5%BE%AE%E5%89%8D%E7%AB%AF%E6%A6%82%E8%A6%81/</url>
      
        <content type="html"><![CDATA[<h3 id="微前端是什么？"><a href="#微前端是什么？" class="headerlink" title="微前端是什么？"></a>微前端是什么？</h3><p>微前端是一种前端开发的架构风格，它将一个完整的前端应用拆分成多个小型的、独立的功能模块，这些模块被称为微前端。每个微前端都可以有自己的代码库、依赖包、自动化测试套件以及Devops流程。它们中的每一个极有可能由一个单独的前端团队负责，并且与其他功能模块相互独立地进行开发、测试和部署，从而提高了开发流程的效率。微前端在平台产品中应用尤为广泛。例如云计算平台中的各个服务可以通过微前端的方式嵌入到云平台前端控制台中。</p><img src="/images/microfrontend.webp" width="500px" /><h4 id="微前端的优缺点"><a href="#微前端的优缺点" class="headerlink" title="微前端的优缺点"></a>微前端的优缺点</h4><p>优点：</p><ul><li>独立开发和部署：每个微前端可以由不同的团队负责，团队可以自主决定开发进度和发布时间，无需与其他团队过度协调。比如一个专门负责用户个人中心微前端的团队，可以独立进行功能迭代和发布。</li><li>技术栈灵活：不同的微前端可以根据自身需求选择不同的技术栈。例如，一个微前端可以使用 React 框架，另一个可以使用 Vue 框架，这样可以充分利用各种技术的优势。</li><li>可扩展性强：能够根据业务需求，方便地添加、删除或更新微前端模块。当业务需要增加新功能时，只需要开发新的微前端并集成到系统中即可。</li></ul><p>缺点：</p><ul><li>微前端架构本身比单体架构复杂得多。需要设计合理的集成策略来确保各个微前端能够协同工作。</li><li>各个团队可能会过度关注自己负责的微前端，而忽视了整体的用户体验和业务流程。</li><li>每个微前端都有自己的资源，在初始加载时可能会导致页面加载时间变长。不同微前端之间的交互可能会带来一定的性能损耗。</li></ul><p>综合微前端的优缺点可以看出，如果是平台性质的UI或者涉及多个团队合作开发的UI，微前端是比较适合的架构。而对于小型应用与小型团队，单页应用程序可能更加适合。</p><img src="/images/microfrontend-time.webp" width="500px" /><h4 id="微前端的实现方式"><a href="#微前端的实现方式" class="headerlink" title="微前端的实现方式"></a>微前端的实现方式</h4><ul><li>路由加载独立应用：应用基于路由分离，每条路由加载独立应用(微前端)，每个微前端通过API获取外壳页面并渲染到自己的模板中去，从而可以共享外壳所提供的通用功能，如认证、页头、导航栏等。</li><li>基于<code>iframe</code>的微前端：将每个微前端嵌入自己的<code>iframe</code>中，由单页应用(SPA)充当容器，SPA协调<code>iframe</code>间的通信。这是一种较老的方法，虽然分离程度较好，但存在安全、数据共享等诸多问题需要解决。</li><li>Web组件：把每个微前端构建为可独立部署的独立组件(.js文件形式)，应用在布局中的占位符处加载和渲染它们，由Web组件告知浏览器何时何地创建组件。不过这种方式下组件体积大，需要捆绑框架版本，要注意性能跟踪。</li><li>模块联邦(Module Federation)：主要基于一种 “集成契约” 的概念。在构建阶段，各个微前端模块和主应用之间定义好交互的接口和规则，这些就像是它们之间的 “契约”。例如，规定了模块提供哪些公共的函数、变量或者组件，以及主应用如何调用这些内容。这个契约不需要复杂的构建时依赖，只是简单地明确了交互的方式。在运行时，主应用可以根据用户的操作或者业务逻辑，动态地加载不同的微前端模块。</li><li>NPM包方法：每个微前端作为单独的 NPM 包发布，外壳应用列出并整合这些包。其优点是设置简单，缺点是需要单一依赖版本，且微前端发布依赖外壳发布，可能产生跨团队依赖，阻碍更新。</li></ul><p>以下实现的耦合度如下图所示：</p><img src="/images/microfrontend-project.webp" width="500px" /><h3 id="开源微前端框架对比"><a href="#开源微前端框架对比" class="headerlink" title="开源微前端框架对比"></a>开源微前端框架对比</h3><h4 id="Single-SPA"><a href="#Single-SPA" class="headerlink" title="Single-SPA"></a>Single-SPA</h4><p>Github: <a href="https://github.com/single-spa/single-spa">https://github.com/single-spa/single-spa</a></p><p>Single-SPA是一个比较早期的微前端框架，它的核心思想是将多个单页应用组合成一个整体的应用。它提供了一种在浏览器中加载和卸载不同单页应用的机制，使得每个单页应用可以独立开发和部署。</p><p>优点：</p><ul><li>技术栈灵活：允许不同的微前端使用不同的<code>JavaScript</code>框架（如<code>React、Vue、Angular</code>等），每个微前端可以根据自己的需求选择最适合的技术栈。例如，一个微前端可以用 React 实现复杂的用户交互界面，另一个可以用 Vue 构建简单的展示型页面。</li><li>轻量级集成：相对来说比较轻量级，主要通过<code>JavaScript</code>的生命周期钩子（如<code>mount、unmount</code>等）来控制微前端的加载和卸载。这使得它在一些对性能要求较高、资源有限的场景下也能有较好的表现。</li></ul><p>缺点：</p><ul><li>学习曲线较陡：由于它的实现原理涉及到多个单页应用的协调，开发者需要深入理解单页应用的生命周期以及如何在<code>Single-SPA</code>的架构下进行集成。例如，需要处理好不同微前端之间的样式隔离、全局状态共享等复杂问题。</li><li>缺少内置的复杂功能：对于一些高级功能，如动态模块加载的优化、跨微前端的高效通信等，<code>Single-SPA</code>没有提供很完善的内置解决方案，需要开发者自己实现或者借助其他第三方库。</li></ul><h4 id="Module-Federation（Webpack-5）"><a href="#Module-Federation（Webpack-5）" class="headerlink" title="Module Federation（Webpack 5）"></a>Module Federation（Webpack 5）</h4><p>Github: <a href="https://github.com/webpack/webpack">https://github.com/webpack/webpack</a><br>文档：<a href="https://webpack.js.org/concepts/module-federation/">https://webpack.js.org/concepts/module-federation/</a></p><p>随着 Webpack 5 推出的模块联邦是一种更现代化的微前端解决方案。它基于 Webpack 的模块加载机制，允许在运行时动态加载微前端模块，并且可以在不同的构建之间共享模块。</p><p>优点：</p><ul><li>高效的模块共享：能够在多个微前端之间共享代码和模块，避免了重复加载相同的代码，提高了应用的整体性能。例如，多个微前端都使用了相同的UI库，通过模块联邦可以只加载一次。</li><li>动态加载优势：支持在运行时根据用户的操作或者业务逻辑灵活地加载微前端模块，这对于实现个性化的用户体验或者根据不同的场景加载不同的功能非常有用。比如，在一个电商应用中，可以根据用户是否登录动态加载不同的购物车微前端。</li></ul><p>缺点：</p><ul><li>对 Webpack 依赖较强：因为它是基于 Webpack 5 构建的，所以对 Webpack 的依赖比较高。如果项目没有使用 Webpack 或者想要切换到其他构建工具，可能会遇到困难。</li><li>配置相对复杂：为了正确地设置模块联邦，需要对 Webpack 的配置有比较深入的了解，包括如何定义模块的暴露和引入，如何处理不同模块之间的版本兼容性等问题。</li></ul><h4 id="Open-Components"><a href="#Open-Components" class="headerlink" title="Open Components"></a>Open Components</h4><p>Github: <a href="https://opencomponents.github.io/">https://opencomponents.github.io/</a></p><p>Open Components 是一个专注于组件化微前端的开源框架。它强调将微前端作为可复用的组件进行开发和管理，使得这些组件可以在不同的应用场景中轻松集成。</p><p>优点：</p><ul><li>组件化思维：以组件为核心，便于开发人员将功能拆分为独立的组件，并且这些组件可以独立更新和维护。例如，可以将一个复杂的表单组件作为一个微前端，它可以在多个不同的业务流程中使用，并且每个使用场景可以独立地对其进行优化。</li><li>易于共享和复用：组件的设计使得它们在不同的项目或者应用之间的共享和复用变得更加容易。可以通过一个简单的组件仓库来管理和发布这些微前端组件，其他应用可以方便地从仓库中获取并使用。</li></ul><p>缺点：</p><ul><li>应用范围有限：由于它过于强调组件化，对于一些大型的、复杂的应用架构可能不太适用。在这些应用中，可能需要更全面的微前端集成方案，而不仅仅是组件的复用。</li><li>集成深度较浅：在处理一些深层次的微前端集成问题，如跨组件的复杂业务逻辑、不同组件之间的深度交互等方面，Open Components 可能没有提供足够强大的解决方案。</li></ul><h4 id="qiankun（乾坤）"><a href="#qiankun（乾坤）" class="headerlink" title="qiankun（乾坤）"></a>qiankun（乾坤）</h4><p>Github: <a href="https://github.com/umijs/qiankun">https://github.com/umijs/qiankun</a></p><p>优点：</p><ul><li>完善的生态：由蚂蚁金服开源，拥有较为完善的生态和文档支持，对于开发者来说，上手相对容易，遇到问题能够比较方便地从社区或文档中找到解决方案。</li><li>功能丰富：提供了微应用的加载、通信、状态管理等一整套解决方案。它可以很好地管理多个微前端应用的生命周期，确保子应用的正确加载、卸载和切换，使得微前端的实现更加便捷。</li><li>兼容性较好：对于不同技术栈的兼容性较好，可以支持多种前端框架，如 React、Vue 等，这对于企业中存在多种技术选型的项目来说非常实用，可以降低技术整合的难度。</li></ul><p>缺点：</p><ul><li>体积稍大：相对于一些轻量级的微前端框架，qiankun 的体积可能会稍大一些，这可能会在一定程度上影响应用的加载性能，特别是对于网络环境较差或对性能要求较高的场景，需要额外关注。</li><li>定制化程度：由于它提供了较为完整的解决方案，对于一些有特殊需求的项目，可能需要进行一定的定制化开发，以满足项目的特定要求，这可能会增加开发的工作量和复杂度。</li></ul><h4 id="wujie（无界）"><a href="#wujie（无界）" class="headerlink" title="wujie（无界）"></a>wujie（无界）</h4><p>Github: <a href="https://github.com/Tencent/wujie">https://github.com/Tencent/wujie</a></p><p>优点：</p><ul><li>原生隔离性好：是一款基于 <code>Web Components + iframe</code> 微前端框架，Web Components 可以有效隔离元素之间的样式，iframe 可以给子应用提供一个原生隔离的运行环境，相比自行构造的沙箱，能更好地和外部解耦，在隔离性方面表现出色。</li><li>功能强大：支持子应用保活、子应用嵌套、多应用激活、应用共享、去中心化通信、生命周期钩子、插件系统等功能，能够满足复杂业务场景下的需求。</li><li>支持多种框架：对于不同的前端框架也有较好的支持，开发者可以根据项目需求选择合适的技术栈进行开发。</li></ul><p>缺点：</p><ul><li>学习成本较高：由于其实现原理涉及到 Web Components 和 iframe 等技术的结合，对于开发者来说，需要对这些技术有一定的了解和掌握，学习成本相对较高。</li><li>性能优化难度大：虽然在隔离性方面有优势，但 iframe 的使用可能会在一定程度上影响性能，需要开发者进行针对性的性能优化，这对于开发者的技术水平要求较高。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 应用开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 微前端 </tag>
            
            <tag> Kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python中常用的数据结构</title>
      <link href="/2024/10/05/Python%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
      <url>/2024/10/05/Python%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<h3 id="用deque实现队列"><a href="#用deque实现队列" class="headerlink" title="用deque实现队列"></a>用deque实现队列</h3><p>主要特点和优势：</p><ul><li>高效的两端插入和删除操作：与列表相比，在队列的两端进行添加或删除元素的操作效率更高。时间复杂度为O(1)，而在列表的开头进行插入或删除操作的时间复杂度通常为O(n)，其中是列表的长度。</li><li>支持线程安全的追加和弹出：在多线程环境中，可以使用 deque 的 append 和 pop 方法，并且它们是线程安全的（需要适当的同步机制确保整体操作的线程安全）。</li><li>可设置最大长度：可以创建一个具有固定最大长度的 deque，当添加新元素超过最大长度时，会自动从另一端删除旧元素。</li></ul><p>常用方法：</p><ul><li>初始化：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d = collections.deque()  <span class="comment"># 创建一个空的双向队列。</span></span><br><span class="line">d = collections.deque([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])  <span class="comment"># 用初始元素创建双向队列。</span></span><br></pre></td></tr></table></figure></li><li>添加元素：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d.append(item)  <span class="comment"># 在队列右端添加一个元素。</span></span><br><span class="line">d.appendleft(item)  <span class="comment"># 在队列左端添加一个元素。</span></span><br></pre></td></tr></table></figure></li><li>删除元素：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d.pop()  <span class="comment"># 删除并返回队列右端的元素。</span></span><br><span class="line">d.popleft()  <span class="comment"># 删除并返回队列左端的元素。</span></span><br></pre></td></tr></table></figure></li><li>扩展队列：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d.extend(iterable)  <span class="comment"># 在队列右端扩展多个元素。</span></span><br><span class="line">d.extendleft(iterable)  <span class="comment"># 在队列左端逆序扩展多个元素。</span></span><br></pre></td></tr></table></figure></li><li>旋转：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d.rotate(n)  <span class="comment"># 将队列中的元素向右旋转 n 步（如果 n 是负数，则向左旋转）。</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="用deque实现栈"><a href="#用deque实现栈" class="headerlink" title="用deque实现栈"></a>用deque实现栈</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line">stack = deque()</span><br><span class="line"></span><br><span class="line">stack.append(<span class="number">1</span>)  <span class="comment"># 入栈</span></span><br><span class="line">stack.append(<span class="number">2</span>)</span><br><span class="line">stack.append(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Stack: <span class="subst">&#123;stack&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">popped_item = stack.pop()  <span class="comment"># 出栈</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Popped item: <span class="subst">&#123;popped_item&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Stack after pop: <span class="subst">&#123;stack&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> stack:  <span class="comment"># 获取栈顶元素</span></span><br><span class="line">    top_item = stack[-<span class="number">1</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Top item: <span class="subst">&#123;top_item&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Stack is empty.&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="有序字典-OrderedDict"><a href="#有序字典-OrderedDict" class="headerlink" title="有序字典(OrderedDict)"></a>有序字典(OrderedDict)</h3><h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ul><li>顺序保持：与普通字典不同，OrderedDict 会按照元素插入的顺序来存储和遍历键值对。这在需要保留元素顺序的场景中非常有用，比如在处理配置文件、实现有序的计数器等方面。</li><li>可迭代性：可以像普通字典一样进行迭代操作，但迭代顺序与插入顺序一致。</li></ul><h4 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h4><ul><li>初始化：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span>  <span class="comment"># OrderedDict 首先导入 OrderedDict。</span></span><br><span class="line">od = OrderedDict()  <span class="comment"># 创建一个空的 OrderedDict。</span></span><br><span class="line">od = OrderedDict([(<span class="string">&#x27;key1&#x27;</span>, <span class="string">&#x27;value1&#x27;</span>), (<span class="string">&#x27;key2&#x27;</span>, <span class="string">&#x27;value2&#x27;</span>)])  <span class="comment"># 用初始键值对创建 OrderedDict。</span></span><br></pre></td></tr></table></figure></li><li>插入元素：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">od[<span class="string">&#x27;new_key&#x27;</span>] = <span class="string">&#x27;new_value&#x27;</span> <span class="comment"># 向 OrderedDict 中插入新的键值对。</span></span><br></pre></td></tr></table></figure></li><li>删除元素：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">del</span> od[<span class="string">&#x27;key&#x27;</span>]  <span class="comment"># 删除指定键的键值对。</span></span><br><span class="line">od.pop(<span class="string">&#x27;key&#x27;</span>)  <span class="comment"># 删除指定键的键值对并返回对应的值。</span></span><br></pre></td></tr></table></figure></li><li>移动元素：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">od.move_to_end(<span class="string">&#x27;key&#x27;</span>, last=<span class="literal">True</span>)  <span class="comment"># 将指定键的键值对移动到末尾，如果 last=False 则移动到开头。</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="示例：实现LRU缓存置换算法"><a href="#示例：实现LRU缓存置换算法" class="headerlink" title="示例：实现LRU缓存置换算法"></a>示例：实现LRU缓存置换算法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LRUCache</span>(<span class="params">collections.OrderedDict</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, capacity: <span class="built_in">int</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.capacity = capacity</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, key: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> self:</span><br><span class="line">            self.move_to_end(key)</span><br><span class="line">            <span class="keyword">return</span> self[key]</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, key: <span class="built_in">int</span>, value: <span class="built_in">int</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> self:</span><br><span class="line">            self.move_to_end(key)</span><br><span class="line">        self[key] = value</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(self) &gt; self.capacity:</span><br><span class="line">            self.popitem(last=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><h3 id="用heapq实现最大-小-堆"><a href="#用heapq实现最大-小-堆" class="headerlink" title="用heapq实现最大(小)堆"></a>用heapq实现最大(小)堆</h3><p>在 Python 中，<code>heapq</code>模块提供了对堆数据结构的支持。堆是一种特殊的数据结构，通常是一个完全二叉树，满足特定的堆性质。</p><h4 id="主要特点和用途"><a href="#主要特点和用途" class="headerlink" title="主要特点和用途"></a>主要特点和用途</h4><ul><li>高效的最小（或最大）值查找：堆可以快速地找到并删除最小（或最大）值，时间复杂度为<code>O(logn)</code>，其中n是堆中元素的数量。这使得它在实现优先队列等场景中非常有用。</li><li>动态调整：可以方便地向堆中插入新元素或删除现有元素，同时保持堆的性质。</li><li>空间效率：堆通常使用数组实现，具有较高的空间效率。</li></ul><h4 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h4><ul><li><code>heapify</code>：将一个列表转换为堆</li><li><code>heappush</code>：向堆中插入一个元素</li><li><code>heappop</code>：弹出并返回堆中的最小元素</li><li><code>nlargest</code>和<code>nsmallest</code>：返回列表中最大或最小的n个元素</li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>算法-动态规划</title>
      <link href="/2024/09/27/%E7%AE%97%E6%B3%95-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"/>
      <url>/2024/09/27/%E7%AE%97%E6%B3%95-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/</url>
      
        <content type="html"><![CDATA[<p>动态规划是一种解决多阶段决策过程最优化问题的数学方法。通常需要保存决策路径的问题用回溯法，而只是求最优解的时候选择动态规划。</p><h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><ul><li>定义：动态规划通过把原问题分解为相对简单的子问题，并保存子问题的解，避免重复计算，从而高效地求解复杂问题。它通常适用于具有最优子结构和子问题重叠性质的问题。</li><li>最优子结构：一个问题具有最优子结构意味着问题的最优解可以由子问题的最优解组合而成。例如，在求解最短路径问题中，从起点到终点的最短路径可以由从起点到中间点的最短路径和从中间点到终点的最短路径组成。</li><li>子问题重叠：子问题重叠是指在求解问题的过程中，会多次重复地求解相同的子问题。动态规划通过保存子问题的解，避免了重复计算这些子问题，从而提高了算法的效率。</li></ul><h3 id="解题步骤"><a href="#解题步骤" class="headerlink" title="解题步骤"></a>解题步骤</h3><ul><li>确定问题的状态：状态是描述问题在不同阶段的特征。选择合适的状态表示是动态规划的关键。例如，在背包问题中，可以用背包的剩余容量和已选物品的集合来表示状态。</li><li>定义状态转移方程：状态转移方程描述了如何从一个状态转移到另一个状态。它通常是根据问题的最优子结构性质推导出来的。例如，在背包问题中，状态转移方程可以表示为：dp[i][j] = max(dp[i - 1][j], dp[i - 1][j - w[i]] + v[i])，其中dp[i][j]表示前i个物品放入容量为j的背包中的最大价值，w[i]和v[i]分别表示第i个物品的重量和价值。</li><li>确定初始状态和边界条件：初始状态是问题的最简单情况，边界条件是状态转移方程在特殊情况下的取值。例如，在背包问题中，初始状态可以是dp[0][j] = 0（没有物品时，背包价值为 0），边界条件可以是dp[i][0] = 0（背包容量为 0 时，背包价值为 0）。</li><li>计算最优解：根据状态转移方程和初始状态、边界条件，通过递推或递归的方式计算出问题的最优解。通常可以使用自底向上（递推）或自顶向下（记忆化搜索）的方法进行计算。</li></ul><h3 id="应用举例"><a href="#应用举例" class="headerlink" title="应用举例"></a>应用举例</h3><h4 id="打家劫舍"><a href="#打家劫舍" class="headerlink" title="打家劫舍"></a>打家劫舍</h4><p>链接: <a href="https://leetcode.cn/problems/Gu0c2T/">https://leetcode.cn/problems/Gu0c2T/</a></p><p>一个专业的小偷，计划偷窃沿街的房屋。每间房内都藏有一定的现金，影响小偷偷窃的唯一制约因素就是相邻的房屋装有相互连通的防盗系统，如果两间相邻的房屋在同一晚上被小偷闯入，系统会自动报警。</p><p>给定一个代表每个房屋存放金额的非负整数数组<code>nums</code>，请计算不触动警报装置的情况下 ，一夜之内能够偷窃到的最高金额。</p><p>示例 1：</p><p>  输入：nums = [1,2,3,1]<br>  输出：4<br>  解释：偷窃 1 号房屋 (金额 = 1) ，然后偷窃 3 号房屋 (金额 = 3)。<br>      偷窃到的最高金额 = 1 + 3 = 4 。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rob</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        len_nums = <span class="built_in">len</span>(nums)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 定义边界条件</span></span><br><span class="line">        <span class="keyword">if</span> len_nums == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> len_nums == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> nums[<span class="number">0</span>]</span><br><span class="line">        dp = []</span><br><span class="line">        dp.append(nums[<span class="number">0</span>])</span><br><span class="line">        dp.append(<span class="built_in">max</span>(nums[<span class="number">1</span>], nums[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, len_nums, <span class="number">1</span>):</span><br><span class="line">            dp[idx % <span class="number">2</span>] = <span class="built_in">max</span>(dp[(idx - <span class="number">1</span>) % <span class="number">2</span>], dp[(idx - <span class="number">2</span>) % <span class="number">2</span>] + nums[idx])  <span class="comment"># 只需要用两个值来缓存中间结果</span></span><br><span class="line">        <span class="keyword">return</span> dp[(len_nums - <span class="number">1</span>) % <span class="number">2</span>]</span><br></pre></td></tr></table></figure><h4 id="打家劫舍2"><a href="#打家劫舍2" class="headerlink" title="打家劫舍2"></a>打家劫舍2</h4><p>链接：<a href="https://leetcode.cn/problems/PzWKhm/">https://leetcode.cn/problems/PzWKhm/</a></p><p>环形房屋，即第一个房屋和最后一个房屋也不能同时被打劫。该问题可以看做是求以下两个子问题的最大值：</p><ul><li>房屋0 到 房屋len - 2 (不打劫最后一间房屋)</li><li>房屋1 到 房屋len - 1 (不打劫第一间房屋)</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">helper</span>(<span class="params">nums, start, end</span>):</span></span><br><span class="line">    dp = []</span><br><span class="line">    dp.append(nums[start])</span><br><span class="line">    <span class="keyword">if</span> start &lt; end:</span><br><span class="line">        dp.append(<span class="built_in">max</span>(nums[start], nums[start + <span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(start + <span class="number">2</span>, end + <span class="number">1</span>, <span class="number">1</span>):</span><br><span class="line">        j = i - start</span><br><span class="line">        dp[j % <span class="number">2</span>] = <span class="built_in">max</span>(dp[(j - <span class="number">1</span>) % <span class="number">2</span>], dp[(j - <span class="number">2</span>) % <span class="number">2</span>] + nums[i])</span><br><span class="line">    <span class="keyword">return</span> dp[(end - start) % <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rob</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        len_nums = <span class="built_in">len</span>(nums)</span><br><span class="line">        <span class="keyword">if</span> len_nums == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> len_nums == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> nums[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(helper(nums, <span class="number">0</span>, <span class="built_in">len</span>(nums) - <span class="number">2</span>), helper(nums, <span class="number">1</span>, <span class="built_in">len</span>(nums) - <span class="number">1</span>))</span><br></pre></td></tr></table></figure><h4 id="粉刷房子"><a href="#粉刷房子" class="headerlink" title="粉刷房子"></a>粉刷房子</h4><p>链接：<a href="https://leetcode.cn/problems/JEj789/description/">https://leetcode.cn/problems/JEj789/description/</a></p><p>假如有一排房子，共 n 个，每个房子可以被粉刷成红色、蓝色或者绿色这三种颜色中的一种，你需要粉刷所有的房子并且使其相邻的两个房子颜色不能相同。<br>当然，因为市场上不同颜色油漆的价格不同，所以房子粉刷成不同颜色的花费成本也是不同的。每个房子粉刷成不同颜色的花费是以一个 n x 3 的正整数矩阵 costs 来表示的。<br>例如，costs[0][0] 表示第 0 号房子粉刷成红色的成本花费；costs[1][2] 表示第 1 号房子粉刷成绿色的花费，以此类推。<br>请计算出粉刷完所有房子最少的花费成本。<br>示例 1：<br>  输入: costs = [[17,2,17],[16,16,5],[14,3,19]]<br>  输出: 10<br>  解释: 将 0 号房子粉刷成蓝色，1 号房子粉刷成绿色，2 号房子粉刷成蓝色。<br>      最少花费: 2 + 5 + 3 = 10。</p><p>示例 2：<br>  输入: costs = [[7,6,2]]<br>  输出: 2</p><ul><li>状态转移方程为：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dp[<span class="number">0</span>][i] = <span class="built_in">min</span>(dp[<span class="number">1</span>][i - <span class="number">1</span>], dp[<span class="number">2</span>][i - <span class="number">1</span>]) + cost[i][<span class="number">0</span>]</span><br><span class="line">dp[<span class="number">1</span>][i] = <span class="built_in">min</span>(dp[<span class="number">0</span>][i - <span class="number">1</span>], dp[<span class="number">2</span>][i - <span class="number">1</span>]) + cost[i][<span class="number">1</span>]</span><br><span class="line">dp[<span class="number">2</span>][i] = <span class="built_in">min</span>(dp[<span class="number">1</span>][i - <span class="number">1</span>], dp[<span class="number">0</span>][i - <span class="number">1</span>]) + cost[i][<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">result = <span class="built_in">min</span>(dp[<span class="number">0</span>][last], dp[<span class="number">1</span>][last], dp[<span class="number">2</span>][last])</span><br></pre></td></tr></table></figure><ul><li>初始值：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dp[<span class="number">0</span>][<span class="number">0</span>] = cost[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">dp[<span class="number">1</span>][<span class="number">0</span>] = cost[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">dp[<span class="number">2</span>][<span class="number">0</span>] = cost[<span class="number">0</span>][<span class="number">2</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">minCost</span>(<span class="params">self, costs: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">    len_costs = <span class="built_in">len</span>(costs)</span><br><span class="line">    last = len_costs - <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> len_costs == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    dp = [[<span class="literal">None</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(len_costs)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        dp[i][<span class="number">0</span>] = costs[<span class="number">0</span>][i]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, len_costs):</span><br><span class="line">        dp[<span class="number">0</span>][i] = <span class="built_in">min</span>(dp[<span class="number">1</span>][i - <span class="number">1</span>], dp[<span class="number">2</span>][i - <span class="number">1</span>]) + costs[i][<span class="number">0</span>]</span><br><span class="line">        dp[<span class="number">1</span>][i] = <span class="built_in">min</span>(dp[<span class="number">0</span>][i - <span class="number">1</span>], dp[<span class="number">2</span>][i - <span class="number">1</span>]) + costs[i][<span class="number">1</span>]</span><br><span class="line">        dp[<span class="number">2</span>][i] = <span class="built_in">min</span>(dp[<span class="number">1</span>][i - <span class="number">1</span>], dp[<span class="number">0</span>][i - <span class="number">1</span>]) + costs[i][<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">min</span>(dp[<span class="number">0</span>][last], dp[<span class="number">1</span>][last], dp[<span class="number">2</span>][last])</span><br></pre></td></tr></table></figure><h4 id="翻转字符"><a href="#翻转字符" class="headerlink" title="翻转字符"></a>翻转字符</h4><p>链接： <a href="https://leetcode.cn/problems/cyJERH/description/">https://leetcode.cn/problems/cyJERH/description/</a></p><p>如果一个由 ‘0’ 和 ‘1’ 组成的字符串，是以一些 ‘0’（可能没有 ‘0’）后面跟着一些 ‘1’（也可能没有 ‘1’）的形式组成的，那么该字符串是 单调递增 的。<br>我们给出一个由字符 ‘0’ 和 ‘1’ 组成的字符串 s，我们可以将任何 ‘0’ 翻转为 ‘1’ 或者将 ‘1’ 翻转为 ‘0’。<br>返回使 s 单调递增 的最小翻转次数。</p><p>示例 1：</p><p>  输入：s = “00110”<br>  输出：1<br>  解释：我们翻转最后一位得到 00111.</p><p>示例 2：</p><p>  输入：s = “010110”<br>  输出：2<br>  解释：我们翻转得到 011111，或者是 000111。</p><p>示例 3：</p><p>  输入：s = “00011000”<br>  输出：2<br>  解释：我们翻转得到 00000000。</p><ul><li><p>分析状态转移方程：</p><ul><li>dp_f: 把当前字符翻转成”0”且符合单调递增条件的最小翻转次数</li><li>dp_g: 把当前字符翻转成”1”且符合单调递增条件的最小翻转次数</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dp_f[i] = dp_f[i - <span class="number">1</span>] <span class="keyword">if</span> s[i] == <span class="string">&quot;0&quot;</span> <span class="keyword">else</span> dp_f[i - <span class="number">1</span>] + <span class="number">1</span></span><br><span class="line">dp_g[i] = <span class="built_in">min</span>(dp_f[i - <span class="number">1</span>], dp_g[i - <span class="number">1</span>]) <span class="keyword">if</span> s[i] == <span class="string">&quot;1&quot;</span> <span class="keyword">else</span> <span class="built_in">min</span>(dp_f[i - <span class="number">1</span>], dp_g[i - <span class="number">1</span>]) + <span class="number">1</span></span><br></pre></td></tr></table></figure><ul><li>寻找初始值<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dp_f[<span class="number">0</span>] = <span class="number">0</span> <span class="keyword">if</span> s[<span class="number">0</span>] == <span class="string">&quot;0&quot;</span> <span class="keyword">else</span> <span class="number">1</span></span><br><span class="line">dp_g[<span class="number">0</span>] = <span class="number">0</span> <span class="keyword">if</span> s[<span class="number">0</span>] == <span class="string">&quot;1&quot;</span> <span class="keyword">else</span> <span class="number">1</span></span><br></pre></td></tr></table></figure></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minFlipsMonoIncr</span>(<span class="params">self, s: <span class="built_in">str</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        len_s = <span class="built_in">len</span>(s)</span><br><span class="line">        <span class="keyword">if</span> len_s &lt;= <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        f_cache = <span class="number">0</span> <span class="keyword">if</span> s[<span class="number">0</span>] == <span class="string">&quot;0&quot;</span> <span class="keyword">else</span> <span class="number">1</span></span><br><span class="line">        g_cache = <span class="number">0</span> <span class="keyword">if</span> s[<span class="number">0</span>] == <span class="string">&quot;1&quot;</span> <span class="keyword">else</span> <span class="number">1</span></span><br><span class="line">        dp_f = f_cache</span><br><span class="line">        dp_g = g_cache</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, len_s):</span><br><span class="line">            dp_f = f_cache <span class="keyword">if</span> s[i] == <span class="string">&quot;0&quot;</span> <span class="keyword">else</span> f_cache + <span class="number">1</span></span><br><span class="line">            dp_g = <span class="built_in">min</span>(g_cache, f_cache) <span class="keyword">if</span> s[i] == <span class="string">&quot;1&quot;</span> <span class="keyword">else</span> <span class="built_in">min</span>(g_cache, f_cache) + <span class="number">1</span></span><br><span class="line">            f_cache, g_cache = dp_f, dp_g</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>(dp_f, dp_g)</span><br></pre></td></tr></table></figure><h4 id="最长的斐波那契子序列的长度"><a href="#最长的斐波那契子序列的长度" class="headerlink" title="最长的斐波那契子序列的长度"></a>最长的斐波那契子序列的长度</h4><p>如果序列 X_1, X_2, …, X_n 满足下列条件，就说它是 斐波那契式 的：</p><pre><code>n &gt;= 3对于所有 i + 2 &lt;= n，都有 X_i + X_&#123;i+1&#125; = X_&#123;i+2&#125;</code></pre><p>给定一个严格递增的正整数数组形成序列 arr ，找到 arr 中最长的斐波那契式的子序列的长度。如果一个不存在，返回  0 。（回想一下，子序列是从原序列  arr 中派生出来的，它从 arr 中删掉任意数量的元素（也可以不删），而不改变其余元素的顺序。例如， [3, 5, 8] 是 [3, 4, 5, 6, 7, 8] 的一个子序列）</p><p>示例 1：</p><pre><code>输入: arr = [1,2,3,4,5,6,7,8]输出: 5解释: 最长的斐波那契式子序列为 [1,2,3,5,8] 。</code></pre><p>示例 2：</p><pre><code>输入: arr = [1,3,7,11,12,14,18]输出: 3解释: 最长的斐波那契式子序列有 [1,11,12]、[3,11,14] 以及 [7,11,18] 。</code></pre><p>提示：</p><pre><code>3 &lt;= arr.length &lt;= 10001 &lt;= arr[i] &lt; arr[i + 1] &lt;= 10^9</code></pre><ul><li>状态转移方程为：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="number">0</span> &lt;= arr.find[arr[i] - arr[j]] &lt; j:</span><br><span class="line">    dp[i][j] = dp[j][k] + <span class="number">1</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    dp[i][j] = <span class="number">2</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lenLongestFibSubseq</span>(<span class="params">self, arr: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        len_arr = <span class="built_in">len</span>(arr)</span><br><span class="line">        <span class="keyword">if</span> len_arr &lt;= <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        max_len = <span class="number">0</span></span><br><span class="line">        v_map = &#123;v: i <span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(arr)&#125;</span><br><span class="line">        dp = [[<span class="number">0</span>] * len_arr <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, len_arr)]</span><br><span class="line">        dp[<span class="number">1</span>][<span class="number">0</span>] = <span class="number">2</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, len_arr):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, i):</span><br><span class="line">                d = arr[i] - arr[j]</span><br><span class="line">                <span class="keyword">if</span> d <span class="keyword">in</span> v_map <span class="keyword">and</span> <span class="number">0</span> &lt;= v_map[d] &lt; j:</span><br><span class="line">                    dp[i][j] = dp[j][v_map[d]] + <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    dp[i][j] = <span class="number">2</span></span><br><span class="line">                max_len = <span class="built_in">max</span>(max_len, dp[i][j])</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> <span class="keyword">if</span> max_len &lt; <span class="number">3</span> <span class="keyword">else</span> max_len</span><br></pre></td></tr></table></figure><h4 id="最少回文分隔"><a href="#最少回文分隔" class="headerlink" title="最少回文分隔"></a>最少回文分隔</h4><p>链接：<a href="https://leetcode.cn/problems/omKAoA/">https://leetcode.cn/problems/omKAoA/</a></p><p>给定一个字符串 s，请将 s 分割成一些子串，使每个子串都是回文串。返回符合要求的最少分割次数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minCut</span>(<span class="params">self, s: <span class="built_in">str</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        len_s = <span class="built_in">len</span>(s)</span><br><span class="line">        <span class="keyword">if</span> len_s &lt; <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        valid = [[<span class="literal">False</span>] * len_s <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(len_s)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(len_s):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, i + <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> j == i:</span><br><span class="line">                    valid[i][j] = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    valid[i][j] = (j + <span class="number">1</span> &gt;= i <span class="keyword">or</span> valid[i - <span class="number">1</span>][j + <span class="number">1</span>]) <span class="keyword">and</span> s[i] == s[j]</span><br><span class="line">        dp = [<span class="number">0</span>] * len_s</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, len_s):</span><br><span class="line">            <span class="keyword">if</span> valid[i][<span class="number">0</span>]:</span><br><span class="line">                dp[i] = <span class="number">0</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dp[i] = i</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, i + <span class="number">1</span>):</span><br><span class="line">                    <span class="keyword">if</span> valid[i][j]:</span><br><span class="line">                        dp[i] = <span class="built_in">min</span>(dp[i], dp[j - <span class="number">1</span>] + <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> dp[len_s - <span class="number">1</span>]</span><br></pre></td></tr></table></figure><h4 id="最长公共子序列"><a href="#最长公共子序列" class="headerlink" title="最长公共子序列"></a>最长公共子序列</h4><p>链接: <a href="https://leetcode.cn/problems/qJnOS7/">https://leetcode.cn/problems/qJnOS7/</a></p><p>给定两个字符串 text1 和 text2，返回这两个字符串的最长 公共子序列 的长度。如果不存在 公共子序列 ，返回 0 。<br>一个字符串的 子序列 是指这样一个新的字符串：它是由原字符串在不改变字符的相对顺序的情况下删除某些字符（也可以不删除任何字符）后组成的新字符串。<br>例如，”ace” 是 “abcde” 的子序列，但 “aec” 不是 “abcde” 的子序列。<br>两个字符串的 公共子序列 是这两个字符串所共同拥有的子序列。</p><ul><li>技巧：多创建一个数组项来表示下标为-1的情况，即为空字符创</li><li>状态转移方程：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>] + <span class="number">1</span> <span class="keyword">if</span> text1[i - <span class="number">1</span>] == text2[j - <span class="number">1</span>]</span><br><span class="line">dp[i][j] = <span class="built_in">max</span>(dp[i - <span class="number">1</span>][j], dp[i][j - <span class="number">1</span>]) text1[i - <span class="number">1</span>] ！= text2[j - <span class="number">1</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">longestCommonSubsequence</span>(<span class="params">self, text1: <span class="built_in">str</span>, text2: <span class="built_in">str</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> text1 <span class="keyword">or</span> <span class="keyword">not</span> text2:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        len_1 = <span class="built_in">len</span>(text1)</span><br><span class="line">        len_2 = <span class="built_in">len</span>(text2)</span><br><span class="line">        <span class="keyword">if</span> len_1 == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span> text1[<span class="number">0</span>] <span class="keyword">in</span> text2 <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> len_2 == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span> text2[<span class="number">0</span>] <span class="keyword">in</span> text1 <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">        dp = [[<span class="number">0</span>] * (len_2 + <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(len_1 + <span class="number">1</span>)]</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">1</span>] = <span class="number">0</span></span><br><span class="line">        dp[<span class="number">1</span>][<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, len_1 + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, len_2 + <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> text1[i - <span class="number">1</span>] == text2[j - <span class="number">1</span>]:</span><br><span class="line">                    dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>] + <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    dp[i][j] = <span class="built_in">max</span>(dp[i - <span class="number">1</span>][j], dp[i][j - <span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> dp[len_1][len_2]</span><br></pre></td></tr></table></figure><h4 id="字符串交织"><a href="#字符串交织" class="headerlink" title="字符串交织"></a>字符串交织</h4><p>链接：<a href="https://leetcode.cn/problems/IY6buf/description/">https://leetcode.cn/problems/IY6buf/description/</a></p><p>给定三个字符串 s1、s2、s3，请判断 s3 能不能由 s1 和 s2 交织（交错） 组成。<br>两个字符串 s 和 t 交织 的定义与过程如下，其中每个字符串都会被分割成若干 非空 子字符串：</p><pre><code>s = s1 + s2 + ... + snt = t1 + t2 + ... + tm|n - m| &lt;= 1交织 是 s1 + t1 + s2 + t2 + s3 + t3 + ... 或者 t1 + s1 + t2 + s2 + t3 + s3 + ...</code></pre><p>提示：a + b 意味着字符串 a 和 b 连接。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isInterleave</span>(<span class="params">self, s1: <span class="built_in">str</span>, s2: <span class="built_in">str</span>, s3: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span></span><br><span class="line">        len_s1 = <span class="built_in">len</span>(s1)</span><br><span class="line">        len_s2 = <span class="built_in">len</span>(s2)</span><br><span class="line">        len_s3 = <span class="built_in">len</span>(s3)</span><br><span class="line">        <span class="keyword">if</span> len_s1 + len_s2 != len_s3:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        dp = [[<span class="number">0</span>] * (len_s2 + <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(len_s1 + <span class="number">1</span>)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(len_s1 + <span class="number">1</span>):</span><br><span class="line">            dp[i][<span class="number">0</span>] = <span class="literal">True</span> <span class="keyword">if</span> s1[:i] == s3[:i] <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(len_s2 + <span class="number">1</span>):</span><br><span class="line">            dp[<span class="number">0</span>][i] = <span class="literal">True</span> <span class="keyword">if</span> s2[:i] == s3[:i] <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(len_s1):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(len_s2):</span><br><span class="line">                <span class="keyword">if</span> s1[i] == s3[i + j + <span class="number">1</span>] <span class="keyword">and</span> s3[i + j + <span class="number">1</span>] != s2[j]:</span><br><span class="line">                    dp[i + <span class="number">1</span>][j + <span class="number">1</span>] = dp[i][j + <span class="number">1</span>]</span><br><span class="line">                <span class="keyword">elif</span> s2[j] == s3[i + j + <span class="number">1</span>] <span class="keyword">and</span> s3[i + j + <span class="number">1</span>] != s1[i]:</span><br><span class="line">                    dp[i + <span class="number">1</span>][j + <span class="number">1</span>] = dp[i + <span class="number">1</span>][j]</span><br><span class="line">                <span class="keyword">elif</span> s1[i] == s2[j] == s3[i + j + <span class="number">1</span>]:</span><br><span class="line">                    dp[i + <span class="number">1</span>][j + <span class="number">1</span>] = dp[i][j + <span class="number">1</span>] <span class="keyword">or</span> dp[i + <span class="number">1</span>][j]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    dp[i + <span class="number">1</span>][j + <span class="number">1</span>] = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> dp[len_s1][len_s2]</span><br></pre></td></tr></table></figure><h4 id="子序列的数目"><a href="#子序列的数目" class="headerlink" title="子序列的数目"></a>子序列的数目</h4><p>链接： <a href="https://leetcode.cn/problems/21dk04/">https://leetcode.cn/problems/21dk04/</a></p><p>给定一个字符串 s 和一个字符串 t ，计算在 s 的子序列中 t 出现的个数。<br>字符串的一个 子序列 是指，通过删除一些（也可以不删除）字符且不干扰剩余字符相对位置所组成的新字符串。（例如，”ACE” 是 “ABCDE” 的一个子序列，而 “AEC” 不是）<br>题目数据保证答案符合 32 位带符号整数范围。</p><p>示例 1：</p><pre><code>输入：s = &quot;rabbbit&quot;, t = &quot;rabbit&quot;输出：3解释：如下图所示, 有 3 种可以从 s 中得到 &quot;rabbit&quot; 的方案。rabbbitrabbbitrabbbit</code></pre><p>示例 2：</p><pre><code>输入：s = &quot;babgbag&quot;, t = &quot;bag&quot;输出：5解释：如下图所示, 有 5 种可以从 s 中得到 &quot;bag&quot; 的方案。 babgbagbabgbagbabgbagbabgbagbabgbag</code></pre><ul><li>状态转移方程：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dp[<span class="number">0</span>][*] = <span class="number">0</span>  <span class="comment"># s为空，则s子串的个数为0</span></span><br><span class="line">dp[*][<span class="number">0</span>] = <span class="number">1</span>  <span class="comment"># t为空，则所有s字串的子串为t的个数为1</span></span><br><span class="line">dp[i][j] = <span class="number">0</span> <span class="keyword">if</span> i &lt; j  <span class="comment"># t的长度大于s，则s的子串等于t的个数为0</span></span><br><span class="line">dp[i][j] = <span class="number">1</span> <span class="keyword">if</span> i == j <span class="keyword">and</span> s[:i] == t[:j]  <span class="comment"># 如果s的长度等于t的长度，则子串个数为1，否则为0</span></span><br><span class="line">dp[i][j] = <span class="number">0</span> <span class="keyword">if</span> i == j <span class="keyword">and</span> s[:i] == t[:j]</span><br><span class="line">dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>] + dp[i - <span class="number">1</span>][j]  <span class="keyword">if</span> s[i - <span class="number">1</span>] == s[j - <span class="number">1</span>] <span class="keyword">else</span> dp[i - <span class="number">1</span>][j]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">numDistinct</span>(<span class="params">self, s: <span class="built_in">str</span>, t: <span class="built_in">str</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        lenS = <span class="built_in">len</span>(s)</span><br><span class="line">        lenT = <span class="built_in">len</span>(t)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> lenS:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> lenT:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        dp = [[<span class="literal">None</span>] * (lenT + <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(lenS + <span class="number">1</span>)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(lenT + <span class="number">1</span>):</span><br><span class="line">            dp[<span class="number">0</span>][i] = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(lenS + <span class="number">1</span>):</span><br><span class="line">            dp[i][<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, lenS + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, lenT + <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> j &gt; i:</span><br><span class="line">                    dp[i][j] = <span class="number">0</span></span><br><span class="line">                <span class="keyword">if</span> i == j:</span><br><span class="line">                    dp[i][j] = <span class="number">1</span> <span class="keyword">if</span> s[:i] == t[:j] <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">                <span class="keyword">if</span> j &lt; i:</span><br><span class="line">                    <span class="keyword">if</span> s[i - <span class="number">1</span>] == t[j - <span class="number">1</span>]:</span><br><span class="line">                        dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>] + dp[i - <span class="number">1</span>][j]</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        dp[i][j] = dp[i - <span class="number">1</span>][j]</span><br><span class="line">        <span class="keyword">return</span> dp[lenS][lenT]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> 算法 </tag>
            
            <tag> 动态规划 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python中的位图</title>
      <link href="/2024/09/22/Python%E4%B8%AD%E7%9A%84%E4%BD%8D%E5%9B%BE/"/>
      <url>/2024/09/22/Python%E4%B8%AD%E7%9A%84%E4%BD%8D%E5%9B%BE/</url>
      
        <content type="html"><![CDATA[<p>在 Python 中，位图（Bitmap）是一种用于表示二进制数据的数据结构。它可以高效地存储和操作大量的布尔值（True/False）。</p><h3 id="位图的基本概念"><a href="#位图的基本概念" class="headerlink" title="位图的基本概念"></a>位图的基本概念</h3><p>位图通常由一个字节数组或位序列组成，其中每个位表示一个特定的状态或属性。例如，可以使用位图来表示一组整数是否存在于某个集合中，或者表示某个图形中的像素是否被选中。</p><h3 id="Python-中实现位图的方法"><a href="#Python-中实现位图的方法" class="headerlink" title="Python 中实现位图的方法"></a>Python 中实现位图的方法</h3><ol><li>使用内置的bytearray类型</li></ol><p>bytearray是一个可变的字节序列，可以用来存储位图数据。每个字节可以表示 8 个位，通过位操作可以设置、清除和检查特定的位。<br>例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bitmap = <span class="built_in">bytearray</span>(<span class="number">10</span>)  <span class="comment"># 创建一个可以存储 80 个位的位图</span></span><br><span class="line"><span class="comment"># 设置第 5 个位为 1</span></span><br><span class="line">bitmap[<span class="number">5</span> // <span class="number">8</span>] |= <span class="number">1</span> &lt;&lt; (<span class="number">5</span> % <span class="number">8</span>)</span><br><span class="line"><span class="comment"># 检查第 5 个位是否为 1</span></span><br><span class="line">is_set = (bitmap[<span class="number">5</span> // <span class="number">8</span>] &amp; (<span class="number">1</span> &lt;&lt; (<span class="number">5</span> % <span class="number">8</span>)))!= <span class="number">0</span></span><br></pre></td></tr></table></figure><ol start="2"><li>使用第三方库<br>bitarray库提供了一个更方便的位序列数据结构，可以高效地进行位操作。<br>安装：pip install bitarray<br>例如：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bitarray <span class="keyword">import</span> bitarray</span><br><span class="line"></span><br><span class="line">bitmap = bitarray(<span class="number">100</span>)  <span class="comment"># 创建一个长度为 100 的位序列</span></span><br><span class="line">bitmap[<span class="number">5</span>] = <span class="literal">True</span>  <span class="comment"># 设置第 5 个位为 1</span></span><br><span class="line">is_set = bitmap[<span class="number">5</span>]  <span class="comment"># 检查第 5 个位是否为 1</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="位图的应用场景"><a href="#位图的应用场景" class="headerlink" title="位图的应用场景"></a>位图的应用场景</h3><ul><li>集合操作: 可以用位图来表示集合，进行快速的集合交集、并集和差集等操作。例如，判断两个整数集合是否有交集，可以将两个集合分别表示为位图，然后对两个位图进行按位与操作，如果结果不为 0，则表示有交集。</li><li>内存高效的数据存储: 当需要存储大量的布尔值时，位图可以比使用列表或字典等数据结构更节省内存。</li><li>图形处理: 在图像处理中，位图可以用来表示像素的颜色或透明度等属性。</li><li>数据库索引: 可以使用位图索引来加速数据库查询，特别是对于包含大量布尔属性的数据集。</li></ul><h3 id="举例：打印列表中的重复数字"><a href="#举例：打印列表中的重复数字" class="headerlink" title="举例：打印列表中的重复数字"></a>举例：打印列表中的重复数字</h3><p><a href="https://leetcode.cn/problems/find-all-duplicates-in-an-array/description/">https://leetcode.cn/problems/find-all-duplicates-in-an-array/description/</a></p><p>给你一个长度为 n 的整数数组 nums ，其中 nums 的所有整数都在范围 [1, n] 内，且每个整数出现 一次 或 两次 。请你找出所有出现 两次 的整数，并以数组形式返回。你必须设计并实现一个时间复杂度为 O(n) 且仅使用常量额外空间（不包括存储输出所需的空间）的算法解决此问题。</p><p>示例 1：</p><p>输入：nums = [4,3,2,7,8,2,3,1]<br>输出：[2,3]</p><p>示例 2：</p><p>输入：nums = [1,1,2]<br>输出：[1]</p><p>示例 3：</p><p>输入：nums = [1]<br>输出：[]</p><p>提示：</p><p>n == nums.length<br>1 &lt;= n &lt;= 105<br>1 &lt;= nums[i] &lt;= n<br>nums 中的每个元素出现 一次 或 两次</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setBit</span>(<span class="params">bitMap, num</span>):</span></span><br><span class="line">    idx = num // <span class="number">8</span></span><br><span class="line">    offset = num % <span class="number">8</span></span><br><span class="line">    <span class="keyword">if</span> idx &gt;= <span class="built_in">len</span>(bitMap):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    bitMap[idx] |= <span class="number">1</span> &lt;&lt; offset</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">isSet</span>(<span class="params">bitMap, num</span>):</span></span><br><span class="line">    idx = num // <span class="number">8</span></span><br><span class="line">    offset = num % <span class="number">8</span></span><br><span class="line">    <span class="keyword">if</span> idx &gt;= <span class="built_in">len</span>(bitMap):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> (bitMap[idx] &amp; (<span class="number">1</span> &lt;&lt; offset)) != <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findDuplicates</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span></span><br><span class="line">        lenNums = <span class="built_in">len</span>(nums)</span><br><span class="line">        result = []</span><br><span class="line">        bitMap = <span class="built_in">bytearray</span>(lenNums // <span class="number">8</span> + <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">            <span class="keyword">if</span> isSet(bitMap, num):</span><br><span class="line">                result.append(num)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                setBit(bitMap, num)</span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> 位图 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python中的collections</title>
      <link href="/2024/09/21/Python%E4%B8%AD%E7%9A%84collections/"/>
      <url>/2024/09/21/Python%E4%B8%AD%E7%9A%84collections/</url>
      
        <content type="html"><![CDATA[<p>在 Python 中，collections是一个非常有用的内置模块，它提供了一些高性能的数据类型，可以帮助你更高效地处理数据。</p><h3 id="namedtuple"><a href="#namedtuple" class="headerlink" title="namedtuple"></a>namedtuple</h3><p>命名元组是一种可以为元组中的每个元素指定名称的数据类型。这使得代码更加可读，并且可以像访问对象属性一样访问元组的元素。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"></span><br><span class="line">Point = namedtuple(<span class="string">&#x27;Point&#x27;</span>, [<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>])</span><br><span class="line">p = Point(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(p.x, p.y)</span><br></pre></td></tr></table></figure><h3 id="deque"><a href="#deque" class="headerlink" title="deque"></a>deque</h3><p>双端队列是一种可以在两端进行高效插入和删除操作的数据结构。它比列表更适合用于实现队列和栈。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line">dq = deque([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">dq.append(<span class="number">4</span>)</span><br><span class="line">dq.appendleft(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(dq)</span><br></pre></td></tr></table></figure><h3 id="Counter"><a href="#Counter" class="headerlink" title="Counter"></a>Counter</h3><p>计数器是一种用于统计可哈希对象出现次数的数据类型。它可以方便地统计列表、字符串等数据中的元素出现次数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">c = Counter(<span class="string">&#x27;abracadabra&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br></pre></td></tr></table></figure><h3 id="OrderedDict"><a href="#OrderedDict" class="headerlink" title="OrderedDict"></a>OrderedDict</h3><p>有序字典是一种可以记住插入顺序的字典类型。在 Python 3.7 及以后的版本中，普通字典也已经可以记住插入顺序，但在之前的版本中，OrderedDict非常有用。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"></span><br><span class="line">od = OrderedDict()</span><br><span class="line">od[<span class="string">&#x27;a&#x27;</span>] = <span class="number">1</span></span><br><span class="line">od[<span class="string">&#x27;b&#x27;</span>] = <span class="number">2</span></span><br><span class="line">od[<span class="string">&#x27;c&#x27;</span>] = <span class="number">3</span></span><br><span class="line"><span class="built_in">print</span>(od)</span><br></pre></td></tr></table></figure><h3 id="用OrderedDict实现LRU缓存算法"><a href="#用OrderedDict实现LRU缓存算法" class="headerlink" title="用OrderedDict实现LRU缓存算法"></a>用OrderedDict实现LRU缓存算法</h3><h4 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h4><p>请你设计并实现一个满足  LRU (最近最少使用) 缓存 约束的数据结构。<br>实现 LRUCache 类：</p><ul><li>LRUCache(int capacity) 以 正整数 作为容量 capacity 初始化 LRU 缓存</li><li>int get(int key) 如果关键字 key 存在于缓存中，则返回关键字的值，否则返回 -1 。</li><li>void put(int key, int value) 如果关键字 key 已经存在，则变更其数据值 value ；如果不存在，则向缓存中插入该组 key-value 。如果插入操作导致关键字数量超过 capacity ，则应该 逐出 最久未使用的关键字。</li><li>函数 get 和 put 必须以 O(1) 的平均时间复杂度运行。</li></ul><p>示例：</p><p>输入</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;LRUCache&quot;</span>, <span class="string">&quot;put&quot;</span>, <span class="string">&quot;put&quot;</span>, <span class="string">&quot;get&quot;</span>, <span class="string">&quot;put&quot;</span>, <span class="string">&quot;get&quot;</span>, <span class="string">&quot;put&quot;</span>, <span class="string">&quot;get&quot;</span>, <span class="string">&quot;get&quot;</span>, <span class="string">&quot;get&quot;</span>]</span><br><span class="line">[[<span class="number">2</span>], [<span class="number">1</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">2</span>], [<span class="number">1</span>], [<span class="number">3</span>, <span class="number">3</span>], [<span class="number">2</span>], [<span class="number">4</span>, <span class="number">4</span>], [<span class="number">1</span>], [<span class="number">3</span>], [<span class="number">4</span>]]</span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="number">1</span>, <span class="literal">null</span>, <span class="number">-1</span>, <span class="literal">null</span>, <span class="number">-1</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure><p>解释<br>LRUCache lRUCache = new LRUCache(2);<br>lRUCache.put(1, 1); // 缓存是 {1=1}<br>lRUCache.put(2, 2); // 缓存是 {1=1, 2=2}<br>lRUCache.get(1);    // 返回 1<br>lRUCache.put(3, 3); // 该操作会使得关键字 2 作废，缓存是 {1=1, 3=3}<br>lRUCache.get(2);    // 返回 -1 (未找到)<br>lRUCache.put(4, 4); // 该操作会使得关键字 1 作废，缓存是 {4=4, 3=3}<br>lRUCache.get(1);    // 返回 -1 (未找到)<br>lRUCache.get(3);    // 返回 3<br>lRUCache.get(4);    // 返回 4</p><h4 id="不用OrderedDict实现"><a href="#不用OrderedDict实现" class="headerlink" title="不用OrderedDict实现"></a>不用OrderedDict实现</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.value = <span class="literal">None</span></span><br><span class="line">        self.key = <span class="literal">None</span></span><br><span class="line">        self.<span class="built_in">next</span> = <span class="literal">None</span></span><br><span class="line">        self.prev = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LRUCache</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, capacity: <span class="built_in">int</span></span>):</span></span><br><span class="line">        self.capacity = capacity</span><br><span class="line">        self.head = ListNode()</span><br><span class="line">        self.tail = ListNode()</span><br><span class="line">        self.head.<span class="built_in">next</span> = self.tail</span><br><span class="line">        self.tail.prev = self.head</span><br><span class="line">        self.nodeMap = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_putToHead</span>(<span class="params">self, node</span>):</span></span><br><span class="line">        <span class="keyword">if</span> node.prev <span class="keyword">is</span> self.head:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        node.<span class="built_in">next</span>.prev = node.prev</span><br><span class="line">        node.prev.<span class="built_in">next</span> = node.<span class="built_in">next</span></span><br><span class="line">        self.head.<span class="built_in">next</span>.prev = node</span><br><span class="line">        node.<span class="built_in">next</span> = self.head.<span class="built_in">next</span></span><br><span class="line">        node.prev = self.head</span><br><span class="line">        self.head.<span class="built_in">next</span> = node</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, key: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> self.nodeMap:</span><br><span class="line">            n = self.nodeMap[key]</span><br><span class="line">            self._putToHead(n)</span><br><span class="line">            <span class="keyword">return</span> n.value</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, key: <span class="built_in">int</span>, value: <span class="built_in">int</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> self.nodeMap:</span><br><span class="line">            n = self.nodeMap[key]</span><br><span class="line">            n.value = value</span><br><span class="line">            self._putToHead(n)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        n = ListNode()</span><br><span class="line">        n.value = value</span><br><span class="line">        n.key = key</span><br><span class="line">        self.head.<span class="built_in">next</span>.prev = n</span><br><span class="line">        n.<span class="built_in">next</span> = self.head.<span class="built_in">next</span></span><br><span class="line">        n.prev = self.head</span><br><span class="line">        self.head.<span class="built_in">next</span> = n</span><br><span class="line">        self.nodeMap[key] = n</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(self.nodeMap.keys()) &gt; self.capacity:</span><br><span class="line">            tailNode = self.tail.prev</span><br><span class="line">            self.tail.prev = tailNode.prev</span><br><span class="line">            tailNode.prev.<span class="built_in">next</span> = tailNode.<span class="built_in">next</span></span><br><span class="line">            <span class="keyword">if</span> tailNode.key <span class="keyword">in</span> self.nodeMap:</span><br><span class="line">                <span class="keyword">del</span> self.nodeMap[tailNode.key]</span><br></pre></td></tr></table></figure><h4 id="使用OrderedDict实现"><a href="#使用OrderedDict实现" class="headerlink" title="使用OrderedDict实现"></a>使用OrderedDict实现</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LRUCache</span>(<span class="params">collections.OrderedDict</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, capacity: <span class="built_in">int</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.capacity = capacity</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, key: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> self:</span><br><span class="line">            self.move_to_end(key)</span><br><span class="line">            <span class="keyword">return</span> self[key]</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, key: <span class="built_in">int</span>, value: <span class="built_in">int</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> self:</span><br><span class="line">            self.move_to_end(key)</span><br><span class="line">        self[key] = value</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(self) &gt; self.capacity:</span><br><span class="line">            self.popitem(last=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>用环形缓冲区实现循环日志</title>
      <link href="/2024/09/21/%E7%94%A8%E7%8E%AF%E5%BD%A2%E7%BC%93%E5%86%B2%E5%8C%BA%E5%AE%9E%E7%8E%B0%E5%BE%AA%E7%8E%AF%E6%97%A5%E5%BF%97/"/>
      <url>/2024/09/21/%E7%94%A8%E7%8E%AF%E5%BD%A2%E7%BC%93%E5%86%B2%E5%8C%BA%E5%AE%9E%E7%8E%B0%E5%BE%AA%E7%8E%AF%E6%97%A5%E5%BF%97/</url>
      
        <content type="html"><![CDATA[<p>环形缓冲区在数据结构中是一种特殊的线性数据结构，具有以下特点和优势：</p><h3 id="结构特点"><a href="#结构特点" class="headerlink" title="结构特点"></a>结构特点</h3><ul><li>固定大小：环形缓冲区通常具有固定的容量，一旦创建，其大小就不能改变。这使得在内存使用方面更加可控，避免了动态分配内存带来的开销和不确定性。</li><li>循环利用空间：正因为其环形的特性，当写指针到达缓冲区的末尾时，会自动回绕到开头继续写入数据；读指针在读取完数据后也会相应地移动，实现空间的循环利用。</li></ul><h3 id="操作方式"><a href="#操作方式" class="headerlink" title="操作方式"></a>操作方式</h3><ul><li>写入操作：当向环形缓冲区写入数据时，首先检查缓冲区是否已满。如果未满，则将数据写入写指针所指的位置，然后写指针向前移动一位。如果写指针移动到缓冲区的末尾，它会回绕到开头。</li><li>读取操作：从环形缓冲区读取数据时，先检查缓冲区是否为空。如果不为空，则读取读指针所指位置的数据，然后读指针向前移动一位。同样，当读指针到达缓冲区的末尾时，会回绕到开头。</li></ul><h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ul><li>实时数据处理：在需要对连续产生的实时数据进行处理的场景中，环形缓冲区可以作为数据的暂存区域。例如，音频和视频流的处理，数据采集系统等。</li><li>多生产者 - 多消费者模型：环形缓冲区可以方便地在多个生产者和多个消费者之间共享数据。生产者将数据写入缓冲区，消费者从缓冲区读取数据，通过合理的同步机制，可以实现高效的数据交换。</li><li>缓存数据：可以用作缓存，存储最近使用的数据，以提高数据的访问速度。例如，在数据库查询中，可以将最近查询的结果存储在环形缓冲区中，以便下次相同的查询可以直接从缓冲区中获取结果。</li></ul><h3 id="实现要点"><a href="#实现要点" class="headerlink" title="实现要点"></a>实现要点</h3><ul><li>指针管理：准确地管理写指针和读指针是实现环形缓冲区的关键。需要确保指针的移动正确无误，并且在进行读写操作时不会出现越界的情况。</li><li>同步机制：在多线程环境下使用环形缓冲区时，需要考虑同步问题。可以使用互斥锁、条件变量等同步机制来确保线程安全。</li><li>空满判断：需要有可靠的方法来判断环形缓冲区是为空还是已满。常见的方法有使用计数器、位运算等。</li></ul><h3 id="示例：错误日志记录"><a href="#示例：错误日志记录" class="headerlink" title="示例：错误日志记录"></a>示例：错误日志记录</h3><h4 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h4><p><a href="https://www.nowcoder.com/practice/2baa6aba39214d6ea91a2e03dff3fbeb">https://www.nowcoder.com/practice/2baa6aba39214d6ea91a2e03dff3fbeb</a></p><p>开发一个简单错误记录功能小模块，能够记录出错的代码所在的文件名称和行号。</p><p>处理：</p><ol><li>记录最多8条错误记录，循环记录，最后只用输出最后出现的八条错误记录。对相同的错误记录只记录一条，但是错误计数增加。最后一个斜杠后面的带后缀名的部分（保留最后16位）和行号完全匹配的记录才做算是“相同”的错误记录。</li><li>超过16个字符的文件名称，只记录文件的最后有效16个字符；</li><li>输入的文件可能带路径，记录文件名称不能带路径。也就是说，哪怕不同路径下的文件，如果它们的名字的后16个字符相同，也被视为相同的错误记录</li><li>循环记录时，只以第一次出现的顺序为准，后面重复的不会更新它的出现时间，仍以第一次为准</li></ol><p>数据范围：错误记录数量满足 1≤n≤100 1≤n≤100  ，每条记录长度满足 1≤len≤100 1≤len≤100 </p><p>输入描述：</p><p>每组只包含一个测试用例。一个测试用例包含一行或多行字符串。每行包括带路径文件名称，行号，以空格隔开。</p><p>输出描述：</p><p>将所有的记录统计并将结果输出，格式：文件名 代码行数 数目，一个空格隔开，如：</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line"></span><br><span class="line">D:<span class="symbol">\z</span>wtymj<span class="symbol">\x</span>ccb<span class="symbol">\l</span>jj<span class="symbol">\c</span>qzlyaszjvlsjmkwoqijggmybr 645</span><br><span class="line">E:<span class="symbol">\j</span>e<span class="symbol">\r</span>zuwnjvnuz 633</span><br><span class="line">C:<span class="symbol">\k</span>m<span class="symbol">\t</span>gjwpb<span class="symbol">\g</span>y<span class="symbol">\a</span>tl 637</span><br><span class="line">F:<span class="symbol">\w</span>eioj<span class="symbol">\h</span>add<span class="symbol">\c</span>onnsh<span class="symbol">\r</span>wyfvzsopsuiqjnr 647</span><br><span class="line">E:<span class="symbol">\n</span>s<span class="symbol">\m</span>fwj<span class="symbol">\w</span>qkoki<span class="symbol">\e</span>ez 648</span><br><span class="line">D:<span class="symbol">\c</span>fmwafhhgeyawnool 649</span><br><span class="line">E:<span class="symbol">\c</span>zt<span class="symbol">\o</span>pwip<span class="symbol">\o</span>snll<span class="symbol">\c</span> 637</span><br><span class="line">G:<span class="symbol">\n</span>t<span class="symbol">\f</span> 633</span><br><span class="line">F:<span class="symbol">\f</span>op<span class="symbol">\y</span>wzqaop 631</span><br><span class="line">F:<span class="symbol">\y</span>ay<span class="symbol">\j</span>c<span class="symbol">\y</span>wzqaop 631</span><br><span class="line">D:<span class="symbol">\z</span>wtymj<span class="symbol">\x</span>ccb<span class="symbol">\l</span>jj<span class="symbol">\c</span>qzlyaszjvlsjmkwoqijggmybr 645</span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line"></span><br><span class="line">rzuwnjvnuz 633 1</span><br><span class="line">atl 637 1</span><br><span class="line">rwyfvzsopsuiqjnr 647 1</span><br><span class="line">eez 648 1</span><br><span class="line">fmwafhhgeyawnool 649 1</span><br><span class="line">c 637 1</span><br><span class="line">f 633 1</span><br><span class="line">ywzqaop 631 2</span><br></pre></td></tr></table></figure><h4 id=""><a href="#" class="headerlink" title=""></a></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">SIZE = <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">formatFileName</span>(<span class="params">f, size = <span class="number">16</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(f) &gt; size:</span><br><span class="line">        <span class="keyword">return</span> f[-<span class="number">16</span>:]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> f</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RingBuffer</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, size</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        self.buffer = []</span><br><span class="line">        self.legacy = []</span><br><span class="line">        self.head = <span class="number">0</span></span><br><span class="line">        self.size = size</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="keyword">if</span> item <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:  <span class="comment"># 跳过已经淘汰的日志</span></span><br><span class="line">            <span class="keyword">for</span> l <span class="keyword">in</span> self.legacy:</span><br><span class="line">                <span class="keyword">if</span> l[<span class="string">&quot;file&quot;</span>] == item[<span class="string">&quot;file&quot;</span>] <span class="keyword">and</span> l[<span class="string">&quot;line&quot;</span>] == item[<span class="string">&quot;line&quot;</span>]:</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(self.buffer) &lt; self.size:  <span class="comment"># 缓冲区没有满，追加即可</span></span><br><span class="line">            self.buffer.append(item)</span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># 缓冲区已满，把要添加的元素放到队尾</span></span><br><span class="line">            self.legacy.append(self.buffer[self.head])  <span class="comment"># 记录已经淘汰的日志</span></span><br><span class="line">            self.buffer[self.head] = item</span><br><span class="line">            self.head = (self.head + <span class="number">1</span>) % self.size</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findItem</span>(<span class="params">self, file, line</span>):</span></span><br><span class="line">        <span class="keyword">for</span> idx, i <span class="keyword">in</span> <span class="built_in">enumerate</span>(self.buffer):</span><br><span class="line">            <span class="keyword">if</span> i[<span class="string">&quot;file&quot;</span>] == file <span class="keyword">and</span> i[<span class="string">&quot;line&quot;</span>] == line:  <span class="comment"># 文件名和行号都相同才可以</span></span><br><span class="line">                <span class="keyword">return</span> idx</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">showItem</span>(<span class="params">self, idx</span>):</span></span><br><span class="line">        <span class="keyword">if</span> idx &lt; <span class="built_in">len</span>(self.buffer):</span><br><span class="line">            <span class="keyword">return</span> self.buffer[idx]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">updateItem</span>(<span class="params">self, idx, key, value</span>):</span></span><br><span class="line">        self.buffer[idx][key] = value</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">print</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">len</span>(self.buffer):</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        headNode = self.buffer[self.head]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;headNode.get(<span class="string">&quot;file&quot;</span>)&#125;</span> <span class="subst">&#123;headNode.get(<span class="string">&quot;line&quot;</span>)&#125;</span> <span class="subst">&#123;headNode.get(<span class="string">&quot;count&quot;</span>)&#125;</span>&#x27;</span>)</span><br><span class="line">        h = (self.head + <span class="number">1</span>) % <span class="built_in">len</span>(self.buffer)</span><br><span class="line">        <span class="keyword">while</span> (h != self.head):</span><br><span class="line">            node = self.buffer[h]</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;node.get(<span class="string">&quot;file&quot;</span>)&#125;</span> <span class="subst">&#123;node.get(<span class="string">&quot;line&quot;</span>)&#125;</span> <span class="subst">&#123;node.get(<span class="string">&quot;count&quot;</span>)&#125;</span>&#x27;</span>)</span><br><span class="line">            h = (h + <span class="number">1</span>) % <span class="built_in">len</span>(self.buffer)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">filterLog</span>(<span class="params">log</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> log <span class="keyword">or</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(log, <span class="built_in">str</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line">    [path, line] = log.split()</span><br><span class="line">    <span class="keyword">return</span> path.split(<span class="string">&quot;\\&quot;</span>)[-<span class="number">1</span>], line</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">buffer = RingBuffer(SIZE)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> sys.stdin:</span><br><span class="line">    f, l = filterLog(line.strip())</span><br><span class="line">    <span class="keyword">if</span> f <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> l <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    f = formatFileName(f)  <span class="comment"># 题目出的很奇怪，尾十六位相同的文件竟然被当成同一个文件</span></span><br><span class="line">    idx = buffer.findItem(f, l)</span><br><span class="line">    <span class="keyword">if</span> idx <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        item = buffer.showItem(idx)</span><br><span class="line">        <span class="keyword">if</span> item:</span><br><span class="line">            buffer.updateItem(idx, <span class="string">&quot;count&quot;</span>, item[<span class="string">&quot;count&quot;</span>] + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        buffer.put(&#123;<span class="string">&quot;file&quot;</span>: f, <span class="string">&quot;line&quot;</span>: l, <span class="string">&quot;count&quot;</span>: <span class="number">1</span>&#125;)</span><br><span class="line">buffer.<span class="built_in">print</span>()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> 算法 </tag>
            
            <tag> 环形缓冲区 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据结构-链表</title>
      <link href="/2024/09/17/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E9%93%BE%E8%A1%A8/"/>
      <url>/2024/09/17/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E9%93%BE%E8%A1%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="链表（Linked-List）的基本概念"><a href="#链表（Linked-List）的基本概念" class="headerlink" title="链表（Linked List）的基本概念"></a>链表（Linked List）的基本概念</h3><p>链表是一种常见的数据结构，它由一系列节点（Node）组成。每个节点包含两部分：数据部分和指向下一个节点的指针（Pointer）。链表通过这些指针将节点按顺序连接在一起。</p><p>链表的类型</p><ul><li>单链表（Singly Linked List）：每个节点只有一个指针，指向下一个节点。</li><li>双链表（Doubly Linked List）：每个节点有两个指针，一个指向前一个节点，一个指向下一个节点。</li><li>循环链表（Circular Linked List）：单链表或双链表的最后一个节点的指针又指向了链表的头节点，形成一个环形结构。</li></ul><h3 id="链表的基本操作"><a href="#链表的基本操作" class="headerlink" title="链表的基本操作"></a>链表的基本操作</h3><ul><li>创建链表：首先创建头节点（Head Node），然后逐个添加后续节点。</li><li>插入节点<ul><li>在头部插入：创建新节点，将新节点的指针指向原头节点，然后更新头节点为新节点。</li><li>在中间插入：找到要插入位置的前一个节点，创建新节点，将新节点的指针指向插入位置的节点，然后将前一个节点的指针指向新节点。</li><li>在尾部插入：找到链表的尾节点，创建新节点，将尾节点的指针指向新节点，并将新节点的指针设为 None。</li></ul></li><li>删除节点<ul><li>删除头节点：将头节点指向下一个节点，然后释放原头节点的内存。</li><li>删除中间节点：找到要删除节点的前一个节点，将其指针绕过要删除的节点，直接指向该节点的下一个节点，然后释放要删除节点的内存。</li><li>删除尾节点：找到尾节点的前一个节点，将其指针设为 None，然后释放尾节点的内存。</li></ul></li><li>遍历链表：从链表的头节点开始，通过节点的指针依次访问每个节点，直到到达链表的尾部（指针为 None）。</li></ul><h3 id="链表的应用场景"><a href="#链表的应用场景" class="headerlink" title="链表的应用场景"></a>链表的应用场景</h3><ul><li>动态数据存储：链表在需要频繁进行插入和删除操作的场景中非常有用，例如在实现一个动态大小的集合或者队列时。</li><li>内存管理：操作系统在管理内存分配时会使用链表来记录空闲内存块的信息。</li><li>多项式表示：在数学计算中，可以用链表来表示多项式，每个节点存储多项式中的一项的系数和指数。</li></ul><h3 id="链表的操作技巧"><a href="#链表的操作技巧" class="headerlink" title="链表的操作技巧"></a>链表的操作技巧</h3><ul><li>哨兵节点：可以创建一个新的节点，让其next指向头节点，从而可以简化边界的判断</li><li>双指针：前后双指针和快慢双指针</li></ul><p>删除倒数第k个节点：<a href="https://leetcode.cn/problems/SLwz0R/description/">https://leetcode.cn/problems/SLwz0R/description/</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">removeNthFromEnd</span>(<span class="params">self, head: ListNode, n: <span class="built_in">int</span></span>) -&gt; ListNode:</span></span><br><span class="line">        dummy = ListNode(<span class="number">0</span>)</span><br><span class="line">        dummy.<span class="built_in">next</span> = head</span><br><span class="line">        p1 = dummy</span><br><span class="line">        p2 = head</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            p2 = p2.<span class="built_in">next</span></span><br><span class="line">        <span class="keyword">while</span> p2 <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            p1 = p1.<span class="built_in">next</span></span><br><span class="line">            p2 = p2.<span class="built_in">next</span></span><br><span class="line">        p1.<span class="built_in">next</span> = p1.<span class="built_in">next</span>.<span class="built_in">next</span></span><br><span class="line">        <span class="keyword">return</span> dummy.<span class="built_in">next</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> 算法 </tag>
            
            <tag> 链表 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据结构-哈希表</title>
      <link href="/2024/09/17/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%93%88%E5%B8%8C%E8%A1%A8/"/>
      <url>/2024/09/17/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%93%88%E5%B8%8C%E8%A1%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="哈希表（Hash-Table）的基本概念"><a href="#哈希表（Hash-Table）的基本概念" class="headerlink" title="哈希表（Hash Table）的基本概念"></a>哈希表（Hash Table）的基本概念</h3><p>哈希表是一种数据结构，它可以在平均情况下提供非常快速的插入、删除和查找操作。其基本思想是通过一个哈希函数将键（key）映射到一个特定的索引（index），然后将对应的值（value）存储在该索引位置。</p><h3 id="哈希函数（Hash-Function）"><a href="#哈希函数（Hash-Function）" class="headerlink" title="哈希函数（Hash Function）"></a>哈希函数（Hash Function）</h3><ul><li>哈希函数是哈希表的核心，它将输入的键转换为数组的索引。例如，对于一个简单的整数键的哈希函数可以是hash(key) = key % array_size，这里array_size是存储数据的数组的大小。</li><li>一个好的哈希函数应该尽量减少冲突（Collision），即不同的键被映射到相同的索引位置。常见的哈希函数构造方法包括直接定址法、除留余数法、数字分析法、平方取中法、折叠法、随机数法等。</li></ul><h3 id="处理冲突（Collision-Resolution）"><a href="#处理冲突（Collision-Resolution）" class="headerlink" title="处理冲突（Collision Resolution）"></a>处理冲突（Collision Resolution）</h3><ul><li>链地址法（Chaining）：当发生冲突时，在该索引位置创建一个链表，将新元素添加到链表中。这种方法简单且易于实现，但在最坏情况下，查找时间可能会退化到O(n)，其中n是链表的长度。</li><li>开放定址法（Open Addressing）：当发生冲突时，按照某种规则在哈希表中寻找下一个可用的位置。常见的开放定址法包括线性探测法、二次探测法和双重哈希法等。</li></ul><h3 id="哈希表的操作"><a href="#哈希表的操作" class="headerlink" title="哈希表的操作"></a>哈希表的操作</h3><ul><li>插入（Insertion）：通过哈希函数计算键对应的索引，然后将值存储在该索引位置。如果该位置已经有元素（冲突），则根据冲突处理方法进行处理。</li><li>查找（Search）：根据键通过哈希函数找到对应的索引位置，然后在该位置查找对应的值。如果使用链地址法，可能需要在链表中进行查找；如果使用开放定址法，可能需要按照开放定址的规则进行多次探测。</li><li>删除（Deletion）：删除操作相对复杂一些，因为不能简单地删除元素，否则可能会影响后续的查找操作。在链地址法中，需要在链表中删除对应的节点；在开放定址法中，通常需要将删除的位置标记为已删除，而不是真正删除，以保证后续查找操作的正确性。</li></ul><h3 id="哈希表的应用场景"><a href="#哈希表的应用场景" class="headerlink" title="哈希表的应用场景"></a>哈希表的应用场景</h3><ul><li>数据库索引：哈希表可以用于实现数据库中的索引，提高数据的检索速度。例如，在根据用户 ID 查找用户信息时，可以使用哈希表快速定位到存储用户信息的位置。</li><li>缓存系统：在缓存系统中，哈希表可以快速判断一个请求是否已经在缓存中，如果在，则直接返回缓存的结果，提高系统的响应速度。</li><li>编译器的符号表：在编译器中，哈希表可以用于存储变量名、函数名等符号信息，方便在编译过程中快速查找和管理这些符号。</li></ul><p>CR 030. O(1) 时间插入、删除和获取随机元素: <a href="https://leetcode.cn/problems/FortPu/description/">https://leetcode.cn/problems/FortPu/description/</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RandomizedSet</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Initialize your data structure here.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.data = []</span><br><span class="line">        self.<span class="built_in">map</span> = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span>(<span class="params">self, val: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bool</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Inserts a value to the set. Returns true if the set did not already contain the specified element.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> val <span class="keyword">not</span> <span class="keyword">in</span> self.<span class="built_in">map</span> <span class="keyword">or</span> (val <span class="keyword">in</span> self.<span class="built_in">map</span> <span class="keyword">and</span> self.<span class="built_in">map</span>[val] == <span class="literal">None</span>):</span><br><span class="line">            self.data.append(val)</span><br><span class="line">            self.<span class="built_in">map</span>[val] = self.data.index(val)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">remove</span>(<span class="params">self, val: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bool</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Removes a value from the set. Returns true if the set contained the specified element.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> val <span class="keyword">in</span> self.<span class="built_in">map</span> <span class="keyword">and</span> self.<span class="built_in">map</span>[val] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            self.<span class="built_in">map</span>[val] = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getRandom</span>(<span class="params">self</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Get a random element from the set.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            randomIdx = random.randint(<span class="number">0</span>, <span class="built_in">len</span>(self.data) - <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> self.data[randomIdx] <span class="keyword">in</span> self.<span class="built_in">map</span> <span class="keyword">and</span> self.<span class="built_in">map</span>[self.data[randomIdx]] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">return</span> self.data[randomIdx]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> 算法 </tag>
            
            <tag> 哈希表 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据结构-栈</title>
      <link href="/2024/09/17/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%A0%88/"/>
      <url>/2024/09/17/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%A0%88/</url>
      
        <content type="html"><![CDATA[<h3 id="栈（Stack）的基本概念"><a href="#栈（Stack）的基本概念" class="headerlink" title="栈（Stack）的基本概念"></a>栈（Stack）的基本概念</h3><p>栈是一种重要的数据结构，它具有后进先出（Last In First Out，LIFO）的特点。可以把栈想象成一叠盘子，最后放上去的盘子会最先被拿走。</p><p>栈的基本操作</p><ul><li>入栈（Push）：将元素添加到栈的顶部。</li><li>出栈（Pop）：从栈的顶部移除一个元素。</li><li>查看栈顶元素（Peek 或 Top）：获取栈顶元素的值，但不移除它。</li><li>判断栈是否为空（IsEmpty）：检查栈中是否有元素。</li></ul><h3 id="栈的应用场景"><a href="#栈的应用场景" class="headerlink" title="栈的应用场景"></a>栈的应用场景</h3><ul><li>表达式求值：在算术表达式求值中，栈可以用于处理运算符的优先级和括号的匹配。例如，将中缀表达式转换为后缀表达式，然后利用栈进行求值。</li><li>函数调用栈：在程序执行过程中，当一个函数调用另一个函数时，当前函数的执行状态会被保存到一个栈中（函数调用栈）。当被调用函数执行完毕后，从栈中恢复上一个函数的执行状态继续执行。</li><li>括号匹配：在编译器和文本编辑器中，栈可以用于检查括号是否匹配。例如，在检查一段代码或者一个数学表达式中的括号是否成对出现且匹配正确时。</li><li>撤销（Undo）操作：在许多软件应用中，撤销操作可以通过栈来实现。每次执行一个操作，该操作的信息被压入栈中。当需要撤销时，从栈中弹出最近的操作信息并执行撤销动作。</li></ul><p>后缀表达式： <a href="https://leetcode.cn/problems/8Zf90G/">https://leetcode.cn/problems/8Zf90G/</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">OPS = [<span class="string">&quot;+&quot;</span>, <span class="string">&quot;-&quot;</span>, <span class="string">&quot;*&quot;</span>, <span class="string">&quot;/&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc</span>(<span class="params">arg0, op, arg1</span>):</span></span><br><span class="line">    <span class="keyword">if</span> op == <span class="string">&quot;+&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(arg0) + <span class="built_in">int</span>(arg1)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;-&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(arg0) - <span class="built_in">int</span>(arg1)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;*&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(arg0) * <span class="built_in">int</span>(arg1)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;/&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(<span class="built_in">int</span>(arg0) / <span class="built_in">int</span>(arg1))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">evalRPN</span>(<span class="params">self, tokens: <span class="type">List</span>[<span class="built_in">str</span>]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        stack = []</span><br><span class="line">        <span class="keyword">for</span> token <span class="keyword">in</span> tokens:</span><br><span class="line">            <span class="keyword">if</span> token <span class="keyword">not</span> <span class="keyword">in</span> OPS:</span><br><span class="line">                stack.append(token)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                arg1 = stack.pop()</span><br><span class="line">                arg0 = stack.pop()</span><br><span class="line">                res = calc(arg0, token, arg1)</span><br><span class="line">                stack.append(res)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(stack.pop())</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> 算法 </tag>
            
            <tag> 栈 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据结构-队列</title>
      <link href="/2024/09/17/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E9%98%9F%E5%88%97/"/>
      <url>/2024/09/17/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E9%98%9F%E5%88%97/</url>
      
        <content type="html"><![CDATA[<p>队列（Queue）是一种常见的数据结构，它遵循先进先出（FIFO - First In First Out）的原则。</p><h3 id="队列的基本操作"><a href="#队列的基本操作" class="headerlink" title="队列的基本操作"></a>队列的基本操作</h3><ul><li>入队（Enqueue）：在队列的尾部添加一个元素。</li><li>出队（Dequeue）：从队列的头部移除一个元素。</li><li>查看队首元素（Peek）：获取队列头部的元素，但不移除它。</li><li>判断队列是否为空（IsEmpty）：检查队列中是否有元素。</li></ul><h3 id="队列的应用场景"><a href="#队列的应用场景" class="headerlink" title="队列的应用场景"></a>队列的应用场景</h3><ul><li>广度优先搜索（BFS）：在图的广度优先搜索算法中，队列用于存储待访问的节点。</li><li>任务调度：操作系统中的任务调度，例如按照先来先服务的原则处理进程。</li><li>消息传递系统：在消息队列中间件中，消息按照发送的先后顺序排队等待接收者处理。</li></ul><h3 id="Python中的queue模块"><a href="#Python中的queue模块" class="headerlink" title="Python中的queue模块"></a>Python中的<code>queue</code>模块</h3><p>在 Python 中，queue模块提供了同步的队列类，这些队列类可用于在多线程编程中安全地传递数据。以下是queue模块中主要的队列类及其基本用法：</p><ol><li>Queue类</li></ol><p>Queue类实现了一个基本的先进先出（FIFO）队列。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> queue</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q = queue.Queue()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q.put(<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q.put(<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q.put(<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q.empty()</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q.</span><br><span class="line">q.all_tasks_done   q.full()           q.get_nowait()     q.maxsize          q.not_empty        q.put(             q.qsize()          q.task_done()</span><br><span class="line">q.empty()          q.get(             q.join()           q.mutex            q.not_full         q.put_nowait(      q.queue            q.unfinished_tasks</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q.qsize()</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q.get()</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q.get()</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q.get()</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q.get()</span><br></pre></td></tr></table></figure><p>求滑动窗口的中位数：<a href="https://leetcode.cn/problems/sliding-window-median/">https://leetcode.cn/problems/sliding-window-median/</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">deleteItem</span>(<span class="params">heap, num</span>):</span></span><br><span class="line">    idx = heap.index(num)</span><br><span class="line">    last = heap.pop()</span><br><span class="line">    <span class="keyword">if</span> idx &lt; <span class="built_in">len</span>(heap):</span><br><span class="line">        heap[idx] = last</span><br><span class="line">        heapq._siftup(heap, idx)</span><br><span class="line">        heapq._siftdown(heap, <span class="number">0</span>, idx)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getMiddle</span>(<span class="params">heap, k</span>):</span></span><br><span class="line">    sortedList = heapq.nsmallest(k, heap)</span><br><span class="line">    idx, left = <span class="built_in">divmod</span>(k, <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> left:</span><br><span class="line">        <span class="keyword">if</span> idx &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> (sortedList[idx - <span class="number">1</span>] + sortedList[idx]) / <span class="number">2</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(sortedList[idx])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">medianSlidingWindow</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>], k: <span class="built_in">int</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">float</span>]:</span></span><br><span class="line">        middles = []</span><br><span class="line">        heap = []</span><br><span class="line">        <span class="keyword">for</span> i, num <span class="keyword">in</span> <span class="built_in">enumerate</span>(nums):</span><br><span class="line">            <span class="keyword">if</span> i &lt; k:</span><br><span class="line">                heapq.heappush(heap, num)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                middles.append(getMiddle(heap, k))</span><br><span class="line">                numOut = nums[i - k]</span><br><span class="line">                deleteItem(heap, numOut)</span><br><span class="line">                heapq.heappush(heap, num)</span><br><span class="line">        middles.append(getMiddle(heap, k))</span><br><span class="line">        <span class="keyword">return</span> middles</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> 算法 </tag>
            
            <tag> 队列 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据结构-前缀树</title>
      <link href="/2024/09/16/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%89%8D%E7%BC%80%E6%A0%91/"/>
      <url>/2024/09/16/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%89%8D%E7%BC%80%E6%A0%91/</url>
      
        <content type="html"><![CDATA[<h3 id="前缀树（Trie）简介"><a href="#前缀树（Trie）简介" class="headerlink" title="前缀树（Trie）简介"></a>前缀树（Trie）简介</h3><p>前缀树，也称为字典树，是一种树形数据结构。它的核心思想是利用字符串的公共前缀来减少存储空间和提高查询效率。它由节点组成，每个节点包含多个指向子节点的指针（通常是一个固定大小的数组或者是一个哈希表），以及一个标记位用于表示从根节点到该节点是否构成一个完整的字符串。</p><h3 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h3><ul><li>插入操作<br>  从根节点开始，对于要插入的字符串中的每个字符，检查当前节点是否存在与该字符对应的子节点。<br>  如果不存在，则创建一个新的子节点；如果存在，则沿着对应的子节点继续处理下一个字符。<br>  当处理完字符串的最后一个字符后，将最后到达的节点的标记位置为表示一个完整字符串的结束。</li><li>查询操作<br>  同样从根节点开始，按照待查询字符串的字符顺序依次在树中查找对应的子节点。<br>  如果在某一步找不到对应的子节点，则说明该字符串不存在于树中；如果能顺利找到最后一个字符对应的节点且该节点的标记位表示是一个完整字符串的结束，那么说明该字符串存在于树中。</li><li>删除操作（相对复杂）<br>  首先要找到要删除的字符串对应的节点路径。<br>  如果该节点是其他字符串的中间节点，则不能直接删除，而是要清除该节点上表示字符串结束的标记位。<br>  如果该节点是叶子节点且没有其他字符串共享该节点的前缀部分，则可以从叶子节点开始依次向上删除节点直到遇到一个节点是其他字符串的中间节点或者是根节点。</li></ul><h3 id="主要特点和优势"><a href="#主要特点和优势" class="headerlink" title="主要特点和优势"></a>主要特点和优势</h3><ul><li>高效的字符串存储和检索：对于一组具有公共前缀的字符串，前缀树可以大大减少存储所需的空间，并且查询操作的时间复杂度与字符串的长度成正比，在大量字符串的场景下查询效率高。</li><li>支持前缀搜索：可以很方便地查找具有某一特定前缀的所有字符串，这在自动补全、拼写检查等应用场景中非常有用。</li></ul><h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ul><li>自动补全功能：在搜索引擎、代码编辑器等软件中，当用户输入部分字符时，系统可以根据前缀树快速提供可能的完整字符串，如搜索框自动提示搜索词、代码编辑器自动补全变量名或函数名等。</li><li>拼写检查：通过将字典中的单词构建成前缀树，可以快速检查一个输入的字符串是否是一个有效的单词或者找到最接近的正确拼写。</li><li>IP 路由：在网络中，IP 地址可以看作是由点分隔的数字字符串，利用前缀树可以高效地进行 IP 路由查找，根据 IP 地址的前缀匹配路由规则。</li><li>单词统计和文本分析：统计文本中不同单词的出现次数等相关操作。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TrieNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.children = [<span class="literal">None</span>] * <span class="number">26</span></span><br><span class="line">        self.value = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MapSum</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Initialize your data structure here.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.root = TrieNode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span>(<span class="params">self, key: <span class="built_in">str</span>, val: <span class="built_in">int</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        curNode = self.root</span><br><span class="line">        <span class="keyword">for</span> char <span class="keyword">in</span> key:</span><br><span class="line">            idx = <span class="built_in">ord</span>(char) - <span class="built_in">ord</span>(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> curNode.children[idx]:</span><br><span class="line">                curNode.children[idx] = TrieNode()</span><br><span class="line">            curNode = curNode.children[idx]</span><br><span class="line">        curNode.value = val</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_dfs</span>(<span class="params">self, node</span>):</span></span><br><span class="line">        curNode, res = node, node.value</span><br><span class="line">        <span class="keyword">for</span> child <span class="keyword">in</span> curNode.children:</span><br><span class="line">            <span class="keyword">if</span> child:</span><br><span class="line">                res += self._dfs(child)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sum</span>(<span class="params">self, prefix: <span class="built_in">str</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        curNode = self.root</span><br><span class="line">        <span class="keyword">for</span> char <span class="keyword">in</span> prefix:</span><br><span class="line">            idx = <span class="built_in">ord</span>(char) - <span class="built_in">ord</span>(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> curNode.children[idx]:</span><br><span class="line">                curNode = curNode.children[idx]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> self._dfs(curNode)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> 算法 </tag>
            
            <tag> 前缀树 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据结构-堆</title>
      <link href="/2024/09/15/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%A0%86/"/>
      <url>/2024/09/15/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%A0%86/</url>
      
        <content type="html"><![CDATA[<h3 id="堆的定义"><a href="#堆的定义" class="headerlink" title="堆的定义"></a>堆的定义</h3><p>堆（Heap）是一种特殊的树形数据结构，通常是一个完全二叉树。在堆中，每个节点都满足堆的性质：</p><ul><li>最大堆：父节点的值大于或等于其所有子节点的值。例如，在最大堆中，根节点是整个堆中的最大值。</li><li>最小堆：父节点的值小于或等于其所有子节点的值。在最小堆中，根节点是整个堆中的最小值。</li></ul><h3 id="堆的存储"><a href="#堆的存储" class="headerlink" title="堆的存储"></a>堆的存储</h3><p>堆通常使用数组来实现存储。对于完全二叉树，假设根节点存储在数组索引为 0 的位置，对于任意节点存储在数组索引为 i 的位置：</p><ul><li>它的左子节点存储在数组索引为 <code>2 * i + 1</code> 的位置。</li><li>它的右子节点存储在数组索引为 <code>2 * i + 2</code> 的位置。</li><li>它的父节点存储在数组索引为 <code>(i - 1) // 2</code> 的位置（向下取整）。</li></ul><h3 id="堆的基本操作"><a href="#堆的基本操作" class="headerlink" title="堆的基本操作"></a>堆的基本操作</h3><ol><li>插入元素：</li></ol><ul><li>先将新元素添加到堆的末尾（数组的最后一个位置）。</li><li>然后将新元素与其父节点进行比较，如果不满足堆的性质，则与父节点交换位置。</li><li>重复这个过程，直到新元素满足堆的性质或者到达根节点。</li></ul><ol start="2"><li>删除元素：</li></ol><ul><li>在最大堆中，删除操作通常是删除根节点（最大值）。将根节点与堆的最后一个元素交换位置，然后删除最后一个元素。</li><li>新的根节点可能不满足堆的性质，需要将其与子节点进行比较并交换，直到满足堆的性质。这个过程称为堆化（Heapify）。</li></ul><ol start="3"><li>构建堆：</li></ol><ul><li>可以从一个无序的数组构建堆。从最后一个非叶子节点开始，对每个非叶子节点执行堆化操作，直到整个数组满足堆的性质。</li></ul><h3 id="堆的应用场景"><a href="#堆的应用场景" class="headerlink" title="堆的应用场景"></a>堆的应用场景</h3><ul><li>堆排序：利用堆的性质进行排序。可以在<code>O(nlogn)</code>时间复杂度内对数组进行排序。</li><li>优先队列：堆可以高效地实现优先队列。优先队列是一种数据结构，其中每个元素都有一个优先级，元素按照优先级出队。例如，在操作系统中，任务调度可以使用优先队列，高优先级的任务先执行。</li><li>Dijkstra 算法：用于在图中求单源最短路径，算法中使用最小堆来存储未确定最短路径的节点，每次从堆中取出距离源点最短距离的节点进行松弛操作。</li></ul><ol><li>前K个高频元素</li></ol><p>Link: <a href="https://leetcode.cn/problems/g5c51o/description/">https://leetcode.cn/problems/g5c51o/description/</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">heapAppend</span>(<span class="params">heap, nMap, num</span>):</span></span><br><span class="line">    heap.append(num)</span><br><span class="line">    cur = <span class="built_in">len</span>(heap) - <span class="number">1</span></span><br><span class="line">    parent = (cur - <span class="number">1</span>) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> parent &gt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> nMap[heap[cur]] &lt; nMap[heap[parent]]:</span><br><span class="line">            heap[cur], heap[parent] = heap[parent], heap[cur]</span><br><span class="line">        cur = parent</span><br><span class="line">        parent = (cur - <span class="number">1</span>) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">heapify</span>(<span class="params">heap, nMap, i</span>):</span></span><br><span class="line">    <span class="keyword">if</span> i &gt;= <span class="built_in">len</span>(heap):</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    leftChild = <span class="number">2</span> * i + <span class="number">1</span></span><br><span class="line">    rightChild = <span class="number">2</span> * i + <span class="number">2</span></span><br><span class="line">    minEle = i</span><br><span class="line">    <span class="keyword">if</span> leftChild &lt; <span class="built_in">len</span>(heap) <span class="keyword">and</span> nMap[heap[leftChild]] &lt; nMap[heap[minEle]]:</span><br><span class="line">        minEle = leftChild</span><br><span class="line">    <span class="keyword">if</span> rightChild &lt; <span class="built_in">len</span>(heap) <span class="keyword">and</span> nMap[heap[rightChild]] &lt; nMap[heap[minEle]]:</span><br><span class="line">        minEle = rightChild</span><br><span class="line">    <span class="keyword">if</span> minEle != i:</span><br><span class="line">        heap[minEle], heap[i] = heap[i], heap[minEle]</span><br><span class="line">        heapify(heap, nMap, minEle)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stack</span>(<span class="params">heap, nMap, k</span>):</span></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> nMap.keys():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(heap) &lt; k:</span><br><span class="line">            heapAppend(heap, nMap, num)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> nMap[num] &lt; nMap[heap[<span class="number">0</span>]]:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                heap[<span class="number">0</span>] = num</span><br><span class="line">                heapify(heap, nMap, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">topKFrequent</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>], k: <span class="built_in">int</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span></span><br><span class="line">        nMap = &#123;&#125;</span><br><span class="line">        heap = []</span><br><span class="line">        <span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">            <span class="keyword">if</span> num <span class="keyword">not</span> <span class="keyword">in</span> nMap:</span><br><span class="line">                nMap[num] = <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                nMap[num] += <span class="number">1</span></span><br><span class="line">        stack(heap, nMap, k)</span><br><span class="line">        <span class="keyword">return</span> heap</span><br></pre></td></tr></table></figure><p>用Python的heapq实现：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stack</span>(<span class="params">heap, nMap, k</span>):</span></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> nMap.keys():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(heap) &lt; k:</span><br><span class="line">            heapq.heappush(heap, (nMap[num], num))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> nMap[num] &lt; heap[<span class="number">0</span>][<span class="number">0</span>]:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                heapq.heapreplace(heap, (nMap[num], num))</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">topKFrequent</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>], k: <span class="built_in">int</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span></span><br><span class="line">        nMap = &#123;&#125;</span><br><span class="line">        heap = []</span><br><span class="line">        <span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">            <span class="keyword">if</span> num <span class="keyword">not</span> <span class="keyword">in</span> nMap:</span><br><span class="line">                nMap[num] = <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                nMap[num] += <span class="number">1</span></span><br><span class="line">        stack(heap, nMap, k)</span><br><span class="line">        <span class="keyword">return</span> [x[<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> heap]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> 算法 </tag>
            
            <tag> 堆 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据结构-树</title>
      <link href="/2024/09/15/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%A0%91/"/>
      <url>/2024/09/15/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%A0%91/</url>
      
        <content type="html"><![CDATA[<h3 id="二叉树的遍历"><a href="#二叉树的遍历" class="headerlink" title="二叉树的遍历"></a>二叉树的遍历</h3><ul><li>按照根节点的访问顺序分为前序、中序和后序遍历</li><li>遍历二叉树的时间复杂度为O(n)，空间复杂度为O(h)</li></ul><ol><li>二叉树剪枝：<a href="https://leetcode.cn/problems/pOCWxh/">https://leetcode.cn/problems/pOCWxh/</a></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pruneTree</span>(<span class="params">self, root: TreeNode</span>) -&gt; TreeNode:</span></span><br><span class="line">        <span class="keyword">if</span> root <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        root.left = self.pruneTree(root.left)</span><br><span class="line">        root.right = self.pruneTree(root.right)</span><br><span class="line">        <span class="keyword">if</span> root.left <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">and</span> root.right <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">and</span> root.val == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> root</span><br></pre></td></tr></table></figure><ol start="2"><li>序列化与反序列化二叉树: </li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dfs</span>(<span class="params">s, idx</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> s:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> idx[<span class="number">0</span>] &gt;= <span class="built_in">len</span>(s):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> s[idx[<span class="number">0</span>]] == <span class="string">&quot;#&quot;</span>:</span><br><span class="line">        idx[<span class="number">0</span>] += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    node = TreeNode(s[idx[<span class="number">0</span>]])</span><br><span class="line">    idx[<span class="number">0</span>] += <span class="number">1</span></span><br><span class="line">    node.left = dfs(s, idx)</span><br><span class="line">    node.right = dfs(s, idx)</span><br><span class="line">    <span class="keyword">return</span> node</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Codec</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">serialize</span>(<span class="params">self, root</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;Encodes a tree to a single string.</span></span><br><span class="line"><span class="string">        :type root: TreeNode</span></span><br><span class="line"><span class="string">        :rtype: str</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> root <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;#&quot;</span></span><br><span class="line">        c = <span class="built_in">str</span>(root.val)</span><br><span class="line">        lc = self.serialize(root.left)</span><br><span class="line">        rc = self.serialize(root.right)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;<span class="subst">&#123;c&#125;</span>,<span class="subst">&#123;lc&#125;</span>,<span class="subst">&#123;rc&#125;</span>&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">deserialize</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;Decodes your encoded data to tree.</span></span><br><span class="line"><span class="string">        :type data: str</span></span><br><span class="line"><span class="string">        :rtype: TreeNode</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        s = data.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> dfs(s, [<span class="number">0</span>])</span><br></pre></td></tr></table></figure><h3 id="二叉搜索树"><a href="#二叉搜索树" class="headerlink" title="二叉搜索树"></a>二叉搜索树</h3><ul><li>它是一棵二叉树，其中每个节点都满足以下性质：左子树中的所有节点的值都小于该节点的值，右子树中的所有节点的值都大于该节点的值。</li><li>对于任意节点，其左右子树也都是都是二叉搜索树。</li></ul><ol><li>寻找二叉搜索树中的目标节点</li></ol><p>Link: <a href="https://leetcode.cn/problems/er-cha-sou-suo-shu-de-di-kda-jie-dian-lcof/description/">https://leetcode.cn/problems/er-cha-sou-suo-shu-de-di-kda-jie-dian-lcof/description/</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dfs</span>(<span class="params">node, heap, cnt</span>):</span></span><br><span class="line">    <span class="keyword">if</span> node <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    dfs(node.right, heap, cnt)</span><br><span class="line">    heap.append(node.val)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(heap) == cnt:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    dfs(node.left, heap, cnt)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findTargetNode</span>(<span class="params">self, root: <span class="type">Optional</span>[TreeNode], cnt: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        heap = []</span><br><span class="line">        dfs(root, heap, cnt)</span><br><span class="line">        <span class="keyword">return</span> heap[cnt - <span class="number">1</span>]</span><br></pre></td></tr></table></figure><ol start="2"><li>二叉搜索树中两个节点之和： </li></ol><p>Link: <a href="https://leetcode.cn/problems/opLdQZ/description/">https://leetcode.cn/problems/opLdQZ/description/</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findTarget</span>(<span class="params">self, root: TreeNode, k: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bool</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">dfs</span>(<span class="params">node, m, k</span>):</span></span><br><span class="line">            <span class="keyword">if</span> node <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">if</span> k - node.val <span class="keyword">in</span> m:</span><br><span class="line">                self.res = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            m[node.val] = <span class="literal">True</span></span><br><span class="line">            dfs(node.left, m, k)</span><br><span class="line">            dfs(node.right, m, k)</span><br><span class="line">        m = &#123;&#125;</span><br><span class="line">        self.res = <span class="literal">False</span></span><br><span class="line">        dfs(root, m, k)</span><br><span class="line">        <span class="keyword">return</span> self.res</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> 算法 </tag>
            
            <tag> 树 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>算法-二分搜索</title>
      <link href="/2024/09/14/%E7%AE%97%E6%B3%95-%E4%BA%8C%E5%88%86%E6%90%9C%E7%B4%A2/"/>
      <url>/2024/09/14/%E7%AE%97%E6%B3%95-%E4%BA%8C%E5%88%86%E6%90%9C%E7%B4%A2/</url>
      
        <content type="html"><![CDATA[<p>二分搜索算法的基本思想是：每次比较中间元素与目标元素，如果相等则找到；如果中间元素小于目标元素，则在右半部分继续搜索；如果中间元素大于目标元素，则在左半部分继续搜索。这个过程不断重复，直到找到目标元素或者搜索区间为空。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">biSearch</span>(<span class="params">nums, target, start, end</span>):</span></span><br><span class="line">    <span class="keyword">if</span> start == end:</span><br><span class="line">        <span class="keyword">if</span> target &gt; nums[end]:</span><br><span class="line">            <span class="keyword">return</span> end + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> target &lt; nums[start]:</span><br><span class="line">            <span class="keyword">return</span> start</span><br><span class="line">        <span class="keyword">return</span> start</span><br><span class="line">    <span class="keyword">if</span> start == end - <span class="number">1</span> <span class="keyword">and</span> nums[start] &lt; target &lt; nums[end]:</span><br><span class="line">        <span class="keyword">return</span> end</span><br><span class="line">    middle = (start + end) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> nums[middle] == target:</span><br><span class="line">        <span class="keyword">return</span> middle</span><br><span class="line">    <span class="keyword">elif</span> nums[middle] &lt; target:</span><br><span class="line">        <span class="keyword">return</span> biSearch(nums, target, middle + <span class="number">1</span>, end)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> biSearch(nums, target, start, middle)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">searchInsert</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>], target: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">return</span> biSearch(nums, target, <span class="number">0</span>, <span class="built_in">len</span>(nums) - <span class="number">1</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> 算法 </tag>
            
            <tag> 二分法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>面试复习-算法-排序</title>
      <link href="/2024/09/12/%E9%9D%A2%E8%AF%95%E5%A4%8D%E4%B9%A0-%E7%AE%97%E6%B3%95-%E6%8E%92%E5%BA%8F/"/>
      <url>/2024/09/12/%E9%9D%A2%E8%AF%95%E5%A4%8D%E4%B9%A0-%E7%AE%97%E6%B3%95-%E6%8E%92%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<h3 id="计数法排序"><a href="#计数法排序" class="headerlink" title="计数法排序"></a>计数法排序</h3><ul><li>适用于数值范围比较小的情形</li><li>时间复杂度为O(n + k)</li><li>空间复杂度为O(k)</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sortArray</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span></span><br><span class="line">        minNum = nums[<span class="number">0</span>]</span><br><span class="line">        maxNum = nums[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> nums:</span><br><span class="line">            minNum = <span class="built_in">min</span>(minNum, n)</span><br><span class="line">            maxNum = <span class="built_in">max</span>(maxNum, n)</span><br><span class="line">        count = [<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(maxNum - minNum + <span class="number">1</span>)]</span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> nums:</span><br><span class="line">            count[n - minNum] += <span class="number">1</span></span><br><span class="line">        res = []</span><br><span class="line">        <span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(count):</span><br><span class="line">            <span class="keyword">while</span> c &gt; <span class="number">0</span>:</span><br><span class="line">                res.append(minNum + i)</span><br><span class="line">                c -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h3 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h3><ul><li>快排的时间复杂度为O(nlogn)，但如果中间值都位于数组的头部或者尾部，时间复杂度会退化为O(n**2)</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">swap</span>(<span class="params">nums, a, b</span>):</span></span><br><span class="line">    <span class="keyword">if</span> a == b <span class="keyword">or</span> nums[a] == nums[b]:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    tmp = nums[a]</span><br><span class="line">    nums[a] = nums[b]</span><br><span class="line">    nums[b] = tmp</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">partition</span>(<span class="params">nums, start, end</span>):</span></span><br><span class="line">    p = start - <span class="number">1</span></span><br><span class="line">    q = start</span><br><span class="line">    r = random.randint(start, end)  <span class="comment"># 优化有序数组</span></span><br><span class="line">    swap(nums, r, end)</span><br><span class="line">    <span class="keyword">while</span> q &lt; end:</span><br><span class="line">        <span class="keyword">if</span> nums[q] &lt; nums[end]:</span><br><span class="line">            p += <span class="number">1</span></span><br><span class="line">            swap(nums, p, q)</span><br><span class="line">        q += <span class="number">1</span></span><br><span class="line">    p += <span class="number">1</span></span><br><span class="line">    swap(nums, p, q)</span><br><span class="line">    <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quickSort</span>(<span class="params">nums, start, end</span>):</span></span><br><span class="line">    <span class="keyword">if</span> (start &lt; end):</span><br><span class="line">        i = partition(nums, start, end)</span><br><span class="line">        idx = i - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> start &lt;= idx &lt;= end <span class="keyword">and</span> nums[idx] == nums[i]:  <span class="comment"># 优化多个相同数值相邻的情形</span></span><br><span class="line">            idx -= <span class="number">1</span></span><br><span class="line">        quickSort(nums, start, idx)</span><br><span class="line">        idx = i + <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> start &lt;= idx &lt;= end <span class="keyword">and</span> nums[idx] == nums[i]:</span><br><span class="line">            idx += <span class="number">1</span></span><br><span class="line">        quickSort(nums, idx, end)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sortArray</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span></span><br><span class="line">        quickSort(nums, <span class="number">0</span>, <span class="built_in">len</span>(nums) - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> nums</span><br></pre></td></tr></table></figure><ul><li>寻找第K大的数: <a href="https://leetcode.cn/problems/xx4gT2/">https://leetcode.cn/problems/xx4gT2/</a><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">partition</span>(<span class="params">nums, k, start, end</span>):</span></span><br><span class="line">    r = random.randint(start, end)</span><br><span class="line">    nums[r], nums[end] = nums[end], nums[r]</span><br><span class="line">    p = start - <span class="number">1</span></span><br><span class="line">    q = start</span><br><span class="line">    <span class="keyword">while</span> q &lt; end:</span><br><span class="line">        <span class="keyword">if</span> nums[q] &lt; nums[end]:</span><br><span class="line">            p += <span class="number">1</span></span><br><span class="line">            nums[p], nums[q] = nums[q], nums[p]</span><br><span class="line">        q += <span class="number">1</span></span><br><span class="line">    p += <span class="number">1</span></span><br><span class="line">    nums[p], nums[q] = nums[q], nums[p]</span><br><span class="line">    <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findKthLargest</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>], k: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        n = <span class="built_in">len</span>(nums)</span><br><span class="line">        start = <span class="number">0</span></span><br><span class="line">        end = n - <span class="number">1</span></span><br><span class="line">        i = partition(nums, k, <span class="number">0</span>, end)</span><br><span class="line">        <span class="keyword">while</span> i != n - k:</span><br><span class="line">            i = partition(nums, k, start, end)</span><br><span class="line">            <span class="keyword">if</span> i &lt; n - k:</span><br><span class="line">                start = i + <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                end = i - <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> nums[i]</span><br></pre></td></tr></table></figure></li></ul><h3 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">merge</span>(<span class="params">arrA, arrB</span>):</span></span><br><span class="line">    lenA = <span class="built_in">len</span>(arrA)</span><br><span class="line">    lenB = <span class="built_in">len</span>(arrB)</span><br><span class="line">    res = []</span><br><span class="line">    idxA = <span class="number">0</span></span><br><span class="line">    idxB = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> idxB &lt; lenB <span class="keyword">and</span> idxA &lt; lenA:</span><br><span class="line">        <span class="keyword">if</span> arrA[idxA] &lt; arrB[idxB]:</span><br><span class="line">            res.append(arrA[idxA])</span><br><span class="line">            idxA += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            res.append(arrB[idxB])</span><br><span class="line">            idxB += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> idxA &lt; lenA:</span><br><span class="line">        res.extend(arrA[idxA:])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        res.extend(arrB[idxB:])</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mergeSort</span>(<span class="params">arr, start, end</span>):</span></span><br><span class="line">    <span class="keyword">if</span> start == end:</span><br><span class="line">        <span class="keyword">return</span> [arr[start]]</span><br><span class="line">    middle = (start + end) // <span class="number">2</span></span><br><span class="line">    top = mergeSort(arr, start, middle)</span><br><span class="line">    bottom = mergeSort(arr, middle + <span class="number">1</span>, end)</span><br><span class="line">    <span class="keyword">return</span> merge(top, bottom)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sortArray</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span></span><br><span class="line">        res = mergeSort(nums, <span class="number">0</span>, <span class="built_in">len</span>(nums) - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> 算法 </tag>
            
            <tag> 排序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>面试复习-算法-回溯法</title>
      <link href="/2024/09/07/%E9%9D%A2%E8%AF%95%E5%A4%8D%E4%B9%A0-%E7%AE%97%E6%B3%95-%E5%9B%9E%E6%BA%AF%E6%B3%95/"/>
      <url>/2024/09/07/%E9%9D%A2%E8%AF%95%E5%A4%8D%E4%B9%A0-%E7%AE%97%E6%B3%95-%E5%9B%9E%E6%BA%AF%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h3 id="回溯法"><a href="#回溯法" class="headerlink" title="回溯法"></a>回溯法</h3><p>回溯法是一种搜索算法，常用于解决组合优化问题和枚举问题等。以下是关于回溯法的详细介绍：</p><h4 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h4><ul><li>解空间：回溯法通常用于求解问题的所有可能解，这些解构成一个解空间。解空间可以用树或图的结构来表示，其中每个节点代表一个部分解。</li><li>约束条件条件：在搜索解空间的过程中，需要根据问题的约束条件来判断一个部分解是否有可能扩展为一个完整的可行解。</li><li>递归和回溯：回溯法通常使用递归的方式来遍历解空间树。在递归的过程中，当发现当前的部分解不满足约束条件或者不可能得到更优的解时，就进行回溯，即撤销上一步的选择，尝试其他的选择。</li></ul><h4 id="算法步骤"><a href="#算法步骤" class="headerlink" title="算法步骤"></a>算法步骤</h4><ul><li>定义问题的解空间：确定问题的解可以表示为什么形式，以及所有可能的解构成的空间结构。</li><li>确定状态空间树的结构：根据问题的特点构建状态空间树，树的节点代表问题的部分解，从根节点到叶子节点的路径代表一个完整的解。</li><li>深度优先搜索：从根节点开始，以深度优先的方式搜索状态空间树。在搜索过程中，根据约束条件判断每个节点是否可行，如果可行则继续向下搜索，否则回溯到上一层。</li><li>剪枝操作：在搜索过程中，利用约束条件进行剪枝，即剪掉那些不可能产生可行解或最优解的子树，以提高算法的效率。</li><li>记录解：当搜索到叶子节点时，如果该叶子节点代表的解满足问题的要求，则将其记录下来。</li></ul><h4 id="N皇后问题"><a href="#N皇后问题" class="headerlink" title="N皇后问题"></a>N皇后问题</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">isLineAvailable</span>(<span class="params">arr, i, j, idx, idy</span>):</span></span><br><span class="line">    x, y = i, j</span><br><span class="line">    avail = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">0</span> &lt;= x &lt; <span class="built_in">len</span>(arr[i]) <span class="keyword">and</span> <span class="number">0</span> &lt;= y &lt; <span class="built_in">len</span>(arr[i]):</span><br><span class="line">        <span class="keyword">if</span> x != i <span class="keyword">and</span> y != j <span class="keyword">and</span> arr[x][y] == <span class="string">&quot;Q&quot;</span>:</span><br><span class="line">            avail = <span class="literal">False</span></span><br><span class="line">        x += idx</span><br><span class="line">        y += idy</span><br><span class="line">    <span class="keyword">return</span> avail</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">isNodeAvailable</span>(<span class="params">arr, i, j</span>):</span></span><br><span class="line">    available = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> (idx, item) <span class="keyword">in</span> <span class="built_in">enumerate</span>(arr[i]):</span><br><span class="line">        <span class="keyword">if</span> item == <span class="string">&quot;Q&quot;</span> <span class="keyword">and</span> idx != j:</span><br><span class="line">            available = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(arr[i])):</span><br><span class="line">        <span class="keyword">if</span> idx != i <span class="keyword">and</span> arr[idx][j] == <span class="string">&quot;Q&quot;</span>:</span><br><span class="line">            available = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> idx, idy <span class="keyword">in</span> [(-<span class="number">1</span>, -<span class="number">1</span>), (<span class="number">1</span>, <span class="number">1</span>), (-<span class="number">1</span>, <span class="number">1</span>), (<span class="number">1</span>, -<span class="number">1</span>)]:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isLineAvailable(arr, i, j, idx, idy):</span><br><span class="line">            available = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> available</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">doRecord</span>(<span class="params">arr</span>):</span></span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> arr:</span><br><span class="line">        res.append(<span class="string">&quot;&quot;</span>.join(line))</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">placeQ</span>(<span class="params">arr, i, result</span>):</span></span><br><span class="line">    <span class="keyword">if</span> i == <span class="built_in">len</span>(arr):</span><br><span class="line">        result.append(doRecord(arr))</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(arr)):</span><br><span class="line">        <span class="keyword">if</span> isNodeAvailable(arr, i, j):</span><br><span class="line">            arr[i][j] = <span class="string">&quot;Q&quot;</span></span><br><span class="line">            placeQ(arr, i + <span class="number">1</span>, result)</span><br><span class="line">            arr[i][j] = <span class="string">&quot;.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">solveNQueens</span>(<span class="params">self, n: <span class="built_in">int</span></span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">str</span>]]:</span></span><br><span class="line">        arr = [[<span class="string">&quot;.&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">        result = []</span><br><span class="line">        placeQ(arr, <span class="number">0</span>, result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> 算法 </tag>
            
            <tag> 回溯法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux虚拟化面试题汇总</title>
      <link href="/2024/09/04/Linux%E8%99%9A%E6%8B%9F%E5%8C%96%E9%9D%A2%E8%AF%95%E9%A2%98%E6%B1%87%E6%80%BB/"/>
      <url>/2024/09/04/Linux%E8%99%9A%E6%8B%9F%E5%8C%96%E9%9D%A2%E8%AF%95%E9%A2%98%E6%B1%87%E6%80%BB/</url>
      
        <content type="html"><![CDATA[<h3 id="CPU虚拟化是怎么实现的？"><a href="#CPU虚拟化是怎么实现的？" class="headerlink" title="CPU虚拟化是怎么实现的？"></a>CPU虚拟化是怎么实现的？</h3><p>硬件辅助虚拟化的情况下，CPU提供了根模式和非根模式，VMM 运行在根模式下，拥有最高的特权级别，可以直接访问物理硬件资源。Guest OS 运行在非根模式（VMX）下，当它执行敏感指令时，处理器会自动切换到根模式，由 VMM 进行处理。</p><img src="/images/vcpu.png" width="500px" /><p>QEMU会为每个vcpu创建一个线程，这个线程会通过ioctl给KVM发送<code>KVM_RUN</code>指令让CPU进入VMX模式并切换成VM的上下文。</p><p>VMCB(VM控制块)可以被两种模式(root, vmx)访问，所以可以用来存储：</p><ul><li>HOST CPU上下文</li><li>Guest CPU上下文</li><li>Guest Entry/EXECUTION/EXIT 控制区，KVM可以配置哪些指令和异常能导致VM exit.</li><li>Exit information: VM exit的原因</li></ul><p>敏感指令包括：</p><ul><li>访问或修改控制寄存器（如 CR0、CR3、CR4 等）的指令。这些寄存器控制着处理器的关键运行模式和特性。</li><li>执行输入 / 输出（I/O）指令。例如，直接对硬件设备进行读写操作的指令，因为这些指令可能会影响整个系统的稳定性和安全性。</li><li>启动和停止中断的指令。对中断的控制需要在特权级别下进行，以确保系统的正常运行和响应。</li></ul><p>特权指令包括：</p><ul><li>切换处理器运行模式的指令。例如，从用户模式切换到内核模式或监督模式的指令，这些指令通常只能在特定的特权级别下执行。</li><li>对内存管理单元（MMU）进行设置和控制的指令。包括设置页表、开启或关闭虚拟内存等操作，这些操作对于系统的内存管理至关重要，需要特权才能执行。</li><li>执行系统调用的指令</li></ul><h3 id="内存虚拟化是怎么实现的？"><a href="#内存虚拟化是怎么实现的？" class="headerlink" title="内存虚拟化是怎么实现的？"></a>内存虚拟化是怎么实现的？</h3><ul><li>MTRR(Memory Type Range Register). 物理内存可以被分成几个区域(range)，每个区域对应于如下某一种内存类型：</li></ul><img src="/images/mtrr.png" width="500px" /><ul><li>MMU(Memory Management Unit)内存管理单元实现了：<ul><li>内存区域的访问保护</li><li>虚拟地址到物理地址的转换</li></ul></li><li>VMM可以通过EPT(Extended Page Table)实现：<ul><li>防止虚拟机访问没有权限的页面</li><li>虚拟机物理地址到真实物理地址的转换</li></ul></li><li>TLB(Translation Lookaside Buffer)缓存了虚拟页号到物理页号的映射，如果TLB没有命中，从内存中查找页表的开销会非常大。</li><li>VPID(Virtual Processor ID) TLB中通过VPID来标识缓存项所属的虚拟机，从而避免了每次VM_EXIT带来的TLB缓存失效的问题，极大的提高了效率</li><li>虚拟机在创建时QEMU会给每个虚拟机分配一块内存(mmap), 虚拟机的物理地址空间其实就是这块内存在QEMU中的虚拟地址空间，EPT扩展页维护了虚拟机物理地址到主机物理地址空间的映射，从而使虚拟机可以访问主机的内存。</li><li>虚拟机启动时，KVM 和 QEMU 协同工作，为虚拟机分配物理内存，并创建相应的页表结构。</li><li>当虚拟机中的应用程序访问内存时，KVM 会通过硬件辅助虚拟化技术将客户机虚拟地址转换为物理地址。</li><li>QEMU 负责模拟硬件设备，并将对虚拟设备的内存访问转换为对物理内存的访问。</li><li>如果虚拟机需要更多内存，KVM 和 QEMU 会共同进行内存分配和管理，确保虚拟机有足够的内存可用。</li><li>QEMU 还可以对内存进行优化和共享，以提高性能和减少内存使用量。</li></ul><h3 id="中断的处理"><a href="#中断的处理" class="headerlink" title="中断的处理"></a>中断的处理</h3><ul><li><p>设备生成中断不考虑时钟同步，直接发送给中断控制器和CPU。异常的处理与中断类似，但考虑时钟同步，被称为同步中断</p></li><li><p>CPU收到中断后，内核会调用<code>do_IRQ()</code></p></li><li><p>do_IRQ会获取中断号、保存被中断进程的上下文</p></li><li><p>do_IRQ根据中断号获取对应的中断处理程序</p></li><li><p>当中断处理程序结束后do_IRQ会将保存在内核栈中的进程上下文恢复</p></li><li><p>将程序计数器的值恢复为被中断进程的下一条指令</p></li><li><p>中断上下文不可以睡眠，中断处理程序并不具有自己的栈，它会共享被中断进程的内核栈。或者配置内核，让每个CPU都有一个页用作中断栈</p></li><li><p>中断处理程序分为上下两部分，上半部通常只执行有严格时限的工作，如中断应答、复位硬件、从网卡缓冲区把数据拷贝到内存等。下半部执行比较耗时的工作。</p></li></ul><p>下半部执行的三种方式：</p><ul><li>软中断：需要编译的时候就注册软中断，中断处理程序执行完硬件设备相关的操作后就会调用do_softirq()函数执行被raise_softirq(SOFTIRQ_TYPE)挂起的软中断。类型相同的软中断可以在所有处理器上同时执行。</li><li>tasklet: tasklet其实是用软中断实现的(Hi_SOFTIRQ及TASKLET_IRQ)。它允许驱动程序动态的注册。类型相同的tasklet不能同时执行。</li><li>工作队列：通过在进程上下文中启动一个内核线程去执行，允许睡眠。系统有缺省的workqueue来处理数据，驱动程序也可以创建自己的workqueue来执行下半部的任务。对于一个workqueue，每个CPU上都有一个cpu_workqueue_struct来定义在该CPU上运行的内核线程</li></ul><h3 id="多线程访问一块内存的时候，怎么样优化其性能"><a href="#多线程访问一块内存的时候，怎么样优化其性能" class="headerlink" title="多线程访问一块内存的时候，怎么样优化其性能"></a>多线程访问一块内存的时候，怎么样优化其性能</h3><ul><li>可以将内存池化，可以避免频繁的分配与释放</li><li>使用无锁的结构：原子操作或者利用内存屏障实现无锁的队列</li><li>将数据分区，不同的线程处理不同区域的数据可以避免竞争</li><li>在读多写少的情况下，可以使用读写锁</li><li>使用细粒度锁</li><li>内存对齐</li><li>数据预取：根据线程的访问模式，提前将可能被访问的数据加载到缓存中，减少线程等待数据从内存加载到缓存的时间。</li><li>缓存行对齐：处理器在加载内存数据时通常是按照缓存行（一般为 64 字节）进行加载的，当多线程访问的数据位于不同的缓存行时，可以减少线程之间的缓存竞争。</li></ul><h3 id="介绍一下Virtio"><a href="#介绍一下Virtio" class="headerlink" title="介绍一下Virtio"></a>介绍一下Virtio</h3><p>Virtio 是一种 I/O 半虚拟化解决方案，主要用于提高虚拟机与宿主机之间的 I/O 性能.</p><p>基本架构</p><ul><li>前端驱动（Guest Front - end Driver）<ul><li>存在于虚拟机中：运行在虚拟机操作系统内部，它负责将虚拟机中的 I/O 请求传递到宿主机。例如，当虚拟机中的应用程序发起一个磁盘读写请求或者网络数据包发送 / 接收请求时，前端驱动会将这些请求按照 Virtio 规范进行封装。</li><li>适配 Virtio 规范：遵循 Virtio 的接口标准，将虚拟机的硬件设备抽象为 Virtio 设备，使得虚拟机操作系统可以像操作物理硬件设备一样操作这些虚拟设备。例如，在网络通信方面，前端驱动会将网络数据包按照 Virtio 网络设备的格式进行封装，准备发送给宿主机。</li></ul></li><li>后端驱动（Host Back - end Driver）<ul><li>位于宿主机上：在宿主机操作系统中运行，负责接收来自虚拟机前端驱动的 I/O 请求，并将这些请求转换为对物理硬件设备的实际操作。例如，当后端驱动接收到虚拟机发送的磁盘读写请求时，它会将这些请求转发给物理磁盘控制器进行处理。</li><li>硬件交互与资源管理：与物理硬件设备进行直接交互，管理和分配物理资源以满足虚拟机的 I/O 需求。例如，在内存管理方面，后端驱动需要确保虚拟机的内存与宿主机的物理内存之间的数据传输高效、安全地进行。</li></ul></li></ul><img src="/images/virtio-1.gif" width="500px" /><ul><li>virtio模块给前端驱动提供了操作virtqueue的接口。前端驱动可以根据需求创建一个或者多个virtqueue来与后端进行通信。</li></ul><img src="/images/virtio-2.gif" width="500px" /><ul><li>virtio_driver结构体表示在虚拟机中的virtio前端驱动，在前端驱动模块初始化的时候，需要调用<code>register_virtio_driver</code>来注册。它定义了上层的设备驱动以及所支持的设备ID，设备的feature table，以及一系列的回调函数。</li><li>virtio_device结构体代表了虚拟机中的virtio设备。</li><li>virtio_device引用的virtio_config_ops定义了配置virtio设备的一些操作</li><li>virtqueue结构体中包含了其服务的virtio设备，以及virtqueue_ops</li></ul><p>virtio使用流程：</p><ol><li>前端驱动调用<code>register_virtio_driver</code>来注册virtio驱动</li><li>当有virtio驱动支持设备列表中的设备加入后，会调用virtio_driver中注册的probe函数</li><li>probe函数通常会调用<code>virtio_find_vqs</code>来申请所需要的virtqueue</li><li>当虚拟机需要向Hypervisor发送数据时，调用virtqueue_ops中的<code>add_buffer</code>函数来添加数据，添加完成后调用<code>kick</code>通知Hypervisor</li><li>虚拟机可以轮询<code>get_buffer</code>函数来获取数据，也可以睡眠，等待被callback唤醒</li></ol><h3 id="介绍一下NUMA"><a href="#介绍一下NUMA" class="headerlink" title="介绍一下NUMA"></a>介绍一下NUMA</h3><p>NUMA（Non - Uniform Memory Access，非一致内存访问）是一种计算机内存设计架构，以下是它的相关介绍：</p><p>基本概念</p><ul><li><p>内存节点：在 NUMA 架构中，系统的物理内存被划分为多个节点（Node）。每个节点都有自己的本地内存，并且可以被特定的一组处理器（通常是在物理位置上靠近该内存节点的处理器）更快地访问。例如，在一个具有两个 NUMA 节点的服务器中，节点 0 的内存对于与节点 0 紧密关联的处理器来说是本地内存，而对于节点 1 相关联的处理器来说则是远程内存。</p></li><li><p>处理器与内存的关联：每个处理器都有一个优先访问的本地内存节点，但也可以访问其他节点的内存（称为远程内存访问）。不过，访问远程内存的速度通常比访问本地内存慢，这是因为远程访问需要经过额外的内部互连线路（如 QPI 或 UPI 总线），会带来更高的延迟。</p></li><li><p><code>numactl --membind=0 &lt;command&gt;</code></p></li><li><p><code>numactl --interleave=all &lt;command&gt;</code></p></li><li><p><code>numactl --membind=0 --cpunodebind=0 -p 1234</code></p></li><li><p><code>numactl --interleave=all &lt;command&gt;</code></p></li></ul><h3 id="Kubevirt是怎么实现虚拟机管理的"><a href="#Kubevirt是怎么实现虚拟机管理的" class="headerlink" title="Kubevirt是怎么实现虚拟机管理的"></a>Kubevirt是怎么实现虚拟机管理的</h3><p>自定义资源定义（CRD）</p><ul><li>定义虚拟机资源：Kubevirt 在 Kubernetes 基础上定义了一系列与虚拟机相关的自定义资源，如 VirtualMachine（VM）、VirtualMachineInstance（VMI）等。这些 CRD 允许用户像管理 Kubernetes 原生资源（如 Pod、Deployment 等）一样管理虚拟机。例如，用户可以通过创建一个 VMI 资源的 YAML 文件，描述虚拟机的规格（如 CPU、内存、磁盘等）、网络配置等信息，然后将其提交给 Kubernetes API 服务器进行创建。</li><li>扩展 Kubernetes API：通过 CRD，Kubevirt 扩展了 Kubernetes 的 API，使 Kubernetes 能够理解和处理虚拟机相关的操作。这意味着可以使用 Kubernetes 的命令行工具（如 kubectl）来管理虚拟机的整个生命周期，包括创建、启动、停止、删除等操作。例如，kubectl create -f &lt;vmi - yaml - file&gt;可以根据指定的 VMI YAML 文件创建一个虚拟机实例。</li><li>管理虚拟机生命周期：Kubevirt 利用 Kubernetes 的控制器模式来管理虚拟机的生命周期。它包含了多个控制器，每个控制器负责特定的任务。例如，VirtualMachineController 负责处理 VirtualMachine 资源的创建、更新和删除操作，并将其转换为对 VMI 资源的操作。当用户创建一个 VirtualMachine 资源时，VirtualMachineController 会根据其配置创建相应的 VMI 资源，并确保它们的状态保持一致。</li><li>协调资源状态：控制器会不断监控虚拟机相关资源的状态，并根据需要进行调整和协调。例如，如果一个 VMI 资源的状态变为异常（如虚拟机崩溃或网络故障），相关的控制器会尝试采取恢复措施，如重启虚拟机或重新配置网络。这与 Kubernetes 管理 Pod 等资源的方式类似，通过控制器的协调机制来确保系统的稳定性和可靠性。</li></ul><p>网络管理</p><ul><li>集成 CNI 插件：Kubevirt 集成了容器网络接口（CNI）插件来实现虚拟机的网络连接。CNI 插件负责为虚拟机分配网络地址、配置网络路由以及提供网络服务（如 DHCP、DNS 等）。例如，当一个虚拟机启动时，Kubevirt 会调用相应的 CNI 插件（如 Multus CNI）为其创建网络接口，并根据网络配置将虚拟机连接到指定的网络中。</li><li>支持多种网络模式：除了基本的网络连接，Kubevirt 还支持多种复杂的网络模式。例如，在多租户环境中，可以通过网络策略（Network Policy）来控制虚拟机之间的网络访问权限，实现网络隔离和安全控制。另外，对于需要高性能网络的场景，Kubevirt 可以支持 SR - IOV 等硬件加速技术，提高虚拟机的网络吞吐量和降低网络延迟。</li></ul><p>存储管理</p><ul><li>使用存储卷：Kubevirt 利用 Kubernetes 的存储卷（Volume）概念来管理虚拟机的存储。用户可以在 VMI 资源中定义存储卷的类型（如 PersistentVolumeClaim - PVC、HostPath 等）、大小和挂载点。例如，通过创建一个 PVC 并将其挂载到虚拟机内部的特定目录，虚拟机可以使用持久化存储来保存数据。这使得虚拟机的数据可以独立于虚拟机的生命周期进行管理，即使虚拟机被删除，数据仍然可以保留在存储卷中。</li><li>存储插件支持：Kubevirt 支持多种存储插件，如 Ceph、GlusterFS 等。这些存储插件可以提供高性能、高可靠的存储服务，满足不同场景下虚拟机的存储需求。例如，在大规模集群环境中，可以使用 Ceph 作为存储后端，为虚拟机提供分布式、可扩展的存储资源。同时，存储插件还支持动态存储供应（Dynamic Provisioning），即根据虚拟机的需求自动创建和分配存储资源。</li></ul><h3 id="Linux是如何管理内存的"><a href="#Linux是如何管理内存的" class="headerlink" title="Linux是如何管理内存的"></a>Linux是如何管理内存的</h3><ul><li>page结构体用来表示一个物理页面，其包含引用计数、虚拟地址等信息</li><li>alloc_pages(gfp_mask, order)可以分配2 ** order个连续的物理页，返回第一个页的page结构体</li><li>__get_free_page(gfp_mask, order)返回所分配第一个页的虚拟地址</li><li>内核用slab为内核中用到的数据结构分配空间，slab通常由物理连续的内存页组成，一个slab可以存储多个同类型内核对象</li></ul><h3 id="什么是SR-IOV"><a href="#什么是SR-IOV" class="headerlink" title="什么是SR-IOV"></a>什么是SR-IOV</h3><p>SR - IOV（Single Root I/O Virtualization）即单根 I/O 虚拟化，以下是关于它的详细介绍：</p><p>基本概念</p><p>物理功能（PF）和虚拟功能（VF）</p><ul><li>物理功能（PF）：在 SR - IOV 架构中，物理功能（PF）是指物理设备（如网卡、显卡等）本身所具备的完全功能的接口。它可以像传统的物理设备一样被操作系统识别和配置。例如，在一个支持 SR - IOV 的网卡中，PF 可以进行复杂的网络配置、驱动程序更新等操作，并且拥有对物理设备的完全控制权。</li><li>虚拟功能（VF）：虚拟功能（VF）是从物理功能（PF）中派生出来的轻量级的虚拟接口。VF 与 PF 共享物理设备的硬件资源，但它的功能相对简化，只包含了与数据传输相关的必要功能。例如，一个支持 SR - IOV 的网卡可以创建多个 VF，每个 VF 都可以被分配给一个虚拟机或者容器，使它们能够直接访问物理网络，而无需经过复杂的软件模拟。</li></ul><p>工作原理</p><ul><li>资源分配与共享<ul><li>硬件资源划分：SR - IOV 技术在硬件层面将物理设备的资源（如内存、带宽、中断等）划分为多个部分，分别分配给 PF 和 VF。例如，在一个网卡中，硬件会将一定的缓存空间、数据传输带宽等资源分配给每个 VF，确保 VF 在进行数据传输时能够获得稳定的性能。</li><li>共享物理设备：VF 与 PF 共享物理设备的物理端口、链路层控制器等硬件组件。这样，多个 VF 可以同时利用物理设备的高速数据传输通道，提高了硬件资源的利用率。例如，在一个 10Gb/s 的网卡上，通过 SR - IOV 创建多个 VF 后，这些 VF 可以共同使用网卡的 10Gb/s 带宽进行数据传输。</li></ul></li><li>设备发现与配置<ul><li>BIOS 和硬件初始化：在系统启动过程中，BIOS 和硬件会进行初始化操作，检测和配置 SR - IOV 相关的硬件组件。例如，在服务器主板的 BIOS 设置中，可能会有关于 SR - IOV 的启用选项，当启用该选项后，系统启动时会自动检测支持 SR - IOV 的设备，并进行相应的初始化工作。</li><li>操作系统和驱动程序支持：操作系统和设备驱动程序需要对 SR - IOV 进行支持，才能正确识别和配置 PF 和 VF。例如，在 Linux 操作系统中，内核需要加载支持 SR - IOV 的网络驱动程序，该驱动程序会与硬件进行交互，发现并配置 PF 和 VF。当一个 VF 被分配给一个虚拟机时，虚拟机中的操作系统也需要相应的驱动程序来识别和使用 VF。</li></ul></li></ul><p>技术优势</p><ul><li>提高网络性能<ul><li>降低虚拟化开销：在传统的虚拟化环境中，虚拟机通过软件模拟的方式共享物理网络设备，这会带来一定的性能开销。而 SR - IOV 通过硬件直接分配 VF 给虚拟机，减少了软件模拟的中间环节，从而降低了网络延迟和提高了网络吞吐量。例如，在高性能计算、大数据处理等对网络性能要求较高的场景中，使用 SR - IOV 可以显著提高数据传输效率。</li><li>实现接近物理设备的性能：VF 可以直接访问物理设备的硬件资源，使得虚拟机或者容器在网络性能上能够接近使用物理设备的性能。例如，在一个测试环境中，对比使用传统虚拟网卡和使用 SR - IOV 的 VF 的虚拟机的网络性能，可以发现使用 VF 的虚拟机在网络延迟和吞吐量方面都有明显的提升。</li></ul></li><li>增强资源利用率和灵活性<ul><li>灵活分配资源：SR - IOV 允许根据不同的需求灵活地创建和分配 VF。例如，在一个数据中心中，对于不同的业务应用（如 Web 服务、数据库服务等），可以根据其网络负载特点分配不同数量的 VF，实现资源的优化配置。</li><li>提高硬件资源复用率：通过创建多个 VF，可以在同一物理设备上同时为多个虚拟机或者容器提供服务，提高了硬件资源的复用率。例如，在一个拥有多个虚拟机的云计算环境中，使用 SR - IOV 技术的网卡可以支持更多的虚拟机同时进行网络通信，而无需额外增加物理网卡的数量。</li></ul></li></ul><h3 id="Linux的进程是怎么创建的"><a href="#Linux的进程是怎么创建的" class="headerlink" title="Linux的进程是怎么创建的"></a>Linux的进程是怎么创建的</h3><ul><li>进程是操作系统管理与分配资源的主体，它在Linux中用task_struct来表示，进程描述符包含了打开的文件、挂起的信号、进程的地址空间、进程的状态等信息。</li><li>每个进程都会有一个1页或者2页的内核栈，栈底保存了<code>thread_info</code>结构体，内核可以通过它找到在slab分配器中动态分配的task_struct</li><li>进程有如下的状态<ul><li>TASK_RUNNING：正在执行或者在运行队列等待执行</li><li>TASK_INTERRUPTIBLE：可中断睡眠</li><li>TASK_UNINTERRUPTIBLE: 不可中断睡眠</li><li>__TASK_TRACED</li><li>__TASK_STOPPED</li></ul></li></ul><p>创建过程：</p><ul><li>调用<code>dup_task_struct</code>为子进程创建一个内核栈、thread_info和task_struct，值与当前进程相同</li><li>检查资源是否足够</li><li>子进程设置自己的进程描述符</li><li>子进程的状态被设置为TASK_UNINTERRUPTIBLE</li><li>设置PF_SUPERPRIV、PF_FORKNOEXEC等flag</li><li>分配有效的PID</li><li>根据标志选择是否共享或者拷贝打开的文件、文件系统信息、信号处理函数、进程地址空间、命名空间等信息</li></ul><p>线程的创建通常是通过clone系统调用来做的，和进程的创建过程类似。只不过是标志位设置成了<code>CLONE_VM|CLONE_FS|CLONE_FILES|CLONE_SIGHAND</code>以共享进程的地址空间、文件系统信息、文件描述符、信号处理程序。</p><p>内核线程与普通进程的区别在于没有自己的地址空间，即task_struct中的mm被设置为NULL。</p><p>销毁过程：</p><ul><li>设置标志位PF_EXITING</li><li>删除内核定时器中的任务</li><li>如果mm_struct没有被共享，则释放</li><li>如果进程在等待IPC信号，则从队列中删除</li><li>减少文件系统信息以及文件描述符的引用计数，如果清零就释放</li><li>设置task_struct中的退出状态码</li><li>给子进程找养父进程，线程组中的其他进程或者init进程</li><li>状态设置为<code>TASK_ZOMBIE</code>，仅保留了内核栈、thread_info、task_struct给父进程提供信息</li><li>如果父进程检索到了信息，就将上述剩下的资源释放</li></ul><h3 id="Linux的进程是怎么调度的"><a href="#Linux的进程是怎么调度的" class="headerlink" title="Linux的进程是怎么调度的"></a>Linux的进程是怎么调度的</h3><ul><li>Linux的调度器是通过模块和调度器类实现的，在系统需要调度的时候，会从调度器中选择优先级最高的调度器进行调度</li></ul><table><thead><tr><th>调度类</th><th>调度策略</th><th>调度对象</th></tr></thead><tbody><tr><td>stop_sched_class（停机调度类）</td><td>无</td><td>停机的进程</td></tr><tr><td>dl_sched_class（限期调度类）</td><td>SCHED_DEADLINE</td><td>dl进程</td></tr><tr><td>rt_sched_class（实时调度类）</td><td>SCHED_RR 或者 SCHED_FIFO</td><td>实时进程</td></tr><tr><td>fair_sched_class（公平调度类）</td><td>SCHED_NORMAL 或者 SCHED_BATCH</td><td>普通进程</td></tr><tr><td>idle_sched_class（空闲调度类）</td><td>SCHED_IDLE</td><td>idle进程</td></tr></tbody></table><ul><li>优先级关系：<code>stop_sched_class &gt; dl_sched_class &gt; rt_sched_class &gt; fair_sched_class &gt; idle_shced_class</code></li></ul><img src="/images/cfs.png" width="500px" /><ul><li>CFS（完全公平调度器）是Linux内核2.6.23版本开始采用的进程调度器，它的基本原理是这样的：设定一个调度周期<code>sched_latency_ns</code>，目标是让每个进程在这个周期内至少有机会运行一次，换一种说法就是每个进程等待CPU的时间最长不超过这个调度周期；然后根据进程的数量，大家平分这个调度周期内的CPU使用权，由于进程的优先级即nice值不同，分割调度周期的时候要加权；每个进程的累计运行时间保存在自己的<code>vruntime</code>字段里，哪个进程的<code>vruntime</code>最小就获得本轮运行的权利。</li><li><code>进程的运行时间 = (调度周期时间 * 进程的weight) / CFS运行队列的总weight</code></li><li><code>SCHED_FIFO</code>和<code>SCHED_RR</code>用来调度实时进程，<code>SCHED_FIFO</code>会一直占用CPU直到自己退出或者被优先级更高的实时进程抢占，<code>SCHED_RR</code>是同样优先级的实时进程按照时间片轮转调度</li><li>Linux中的普通进程用的是CFS完全公平调度算法来进行调度，他通过计算虚拟运行时间<code>vruntime</code>，选择<code>vruntime</code>最小的进程进行调度</li><li><code>task_struct</code>中的<code>sched_entity</code>记录了虚拟运行时间<code>vruntime</code>，内核用自平衡二叉搜索树红黑树来组织可运行进程队列</li><li><code>vruntime += 实际运行时间 * (NICE_0_LOAD/NICE_LOAD)</code> NICE_0_LOAD为nice值为0时的权重，NICE_LOAD为当前进程nice值的权重</li><li><code>schedule()</code>会调用<code>context_switch()</code>来：<ul><li><code>switch_mm()</code>：切换新进程的虚拟地址空间</li><li><code>switch_to()</code>：切换新进程的处理器状态</li></ul></li><li>内核会在系统调用、中断处理结束后返回用户空间时，检查<code>need_resched</code>标志，如果被设置则重新调度，抢占用户程序的执行</li><li>进程<code>threed_info</code>中的<code>preempt_count</code>记录了持有锁的数量，如果为<code>0</code>表明可以被抢占</li></ul><h3 id="如果虚拟机出现了故障，可以用哪些Linux命令去解决"><a href="#如果虚拟机出现了故障，可以用哪些Linux命令去解决" class="headerlink" title="如果虚拟机出现了故障，可以用哪些Linux命令去解决"></a>如果虚拟机出现了故障，可以用哪些Linux命令去解决</h3><ul><li><p>top/htop</p><ul><li>作用：实时显示系统中各个进程的资源占用情况，包括 CPU、内存、交换空间等。top是 Linux 系统自带的基本工具，而htop是一个功能更加强大、界面更加友好的进程监控工具。例如，通过top命令可以看到哪些进程占用了大量的 CPU 资源或者内存资源</li></ul></li><li><p>free</p><ul><li>作用：显示系统内存（包括物理内存和交换空间）的使用情况。例如，free -m以 MB 为单位显示内存的总量、已使用量、空闲量、共享内存量以及缓冲和缓存占用量等信息。</li><li>故障场景示例：如果虚拟机出现内存不足相关的错误（如应用程序因内存耗尽而崩溃），可以使用free命令查看内存的使用情况，确定是否需要增加虚拟机的内存分配或者优化内存使用。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">total：表示系统总的可用物理内存大小，计算公式为total = used + free + buff/cache。</span><br><span class="line">used：已被使用的物理内存大小。</span><br><span class="line">free：未被使用的物理内存大小，这部分内存是完全没有被占用的。</span><br><span class="line">shared：多个进程共享的内存大小，通常在某些特殊的进程间通信或者共享内存场景下会有数据。</span><br><span class="line">buff/cache：这是内核缓冲区（buffer）和页面缓存（cache）的大小总和。缓冲区用于存储块设备（如磁盘）的读写缓冲数据；页面缓存用于缓存文件系统中文件的页面数据，以提高文件读写的效率。</span><br><span class="line">available：这是一个估计值，表示新的应用程序还可以使用的物理内存大小。它考虑了系统中未被使用的内存、可回收的缓存等因素，是一个对应用程序可分配内存更准确的评估。</span><br></pre></td></tr></table></figure></li></ul></li><li><p>iostat</p><ul><li>直接在命令行输入iostat，会显示系统整体的 CPU 使用情况以及各个磁盘设备的 I/O 统计信息</li><li>磁盘性能评估：通过iostat可以查看磁盘的读写速度、I/O 操作次数等信息，从而评估磁盘的性能。例如，如果kB_read/s和kB_wrtn/s的值非常低，而%iowait的值较高，可能表示磁盘性能不足或者存在 I/O 瓶颈。</li><li>I/O 瓶颈排查：当系统整体性能出现问题，怀疑是磁盘 I/O 导致时，iostat -x可以提供详细的磁盘 I/O 信息。比如，如果r_await或w_await的值很大，说明磁盘读写操作的等待时间过长，可能存在磁盘故障、磁盘负载过高或者其他影响磁盘性能的因素。</li><li>磁盘负载监控：在一个多用户或者多任务的环境中，使用iostat可以监控各个磁盘设备的负载情况。例如，在一个数据库服务器中，通过定期查看磁盘的tps和%util等指标，可以了解磁盘的繁忙程度，以便及时调整数据库的存储策略或者优化服务器的配置。</li></ul></li><li><p>netstat</p><ul><li>网络连接监控：通过netstat可以查看当前系统与外部主机建立的网络连接情况。例如，在排查网络故障时，查看是否存在异常的网络连接（如未知的远程连接或者过多的连接）。如果发现某个应用程序建立了大量异常的连接，可能存在安全风险或者程序故障。</li><li>服务监听检查：使用netstat -l可以检查系统中哪些网络服务正在监听特定的端口。例如，在配置 Web 服务器后，可以通过该命令确认 Web 服务是否正确地在 80 端口（或者其他指定端口）进行监听。</li><li>网络协议统计分析：netstat -s提供的网络协议统计信息对于分析网络性能和排查网络问题非常有帮助。比如，如果tcp协议的重传数据包数量过多，可能表示网络存在不稳定或者拥塞的情况，需要进一步检查网络设备或者网络配置。</li><li>进程与网络连接关联：结合-p参数可以确定哪些进程在使用网络资源。例如，当系统出现网络带宽异常占用的情况时，通过netstat -p可以找到相关的进程，进而分析该进程是否正常或者是否需要进行优化。</li></ul></li></ul><h3 id="在Openstack环境中，虚拟机初始化的时候是怎么配置ssh-key的"><a href="#在Openstack环境中，虚拟机初始化的时候是怎么配置ssh-key的" class="headerlink" title="在Openstack环境中，虚拟机初始化的时候是怎么配置ssh key的"></a>在Openstack环境中，虚拟机初始化的时候是怎么配置ssh key的</h3><ul><li><p>自动化脚本添加：可以编写脚本在镜像制作过程中自动添加 SSH Key 公钥。例如，使用脚本语言（如 Python）结合相关的镜像操作工具（如guestfish）来操作镜像。脚本可以在镜像中创建/root/.ssh目录（如果不存在），并将公钥写入到authorized_keys文件中。这样制作出来的镜像在每次创建虚拟机实例时，都已经包含了预先配置好的 SSH Key 公钥。</p></li><li><p>使用元数据服务注入公钥</p><ul><li>原理：OpenStack 提供了元数据服务，虚拟机在启动过程中可以通过网络获取元数据信息。在制作镜像时，在镜像中配置一个脚本（如在 Linux 系统中可以是一个cloud - init脚本），该脚本在虚拟机启动时会从元数据服务获取 SSH Key 公钥信息，并将其添加到相应的位置。</li><li>具体操作：在镜像制作过程中，将cloud - init相关的软件包安装到镜像中，并在镜像的启动配置文件（如/etc/rc.local或者/etc/cloud/cloud.cfg）中添加执行获取和配置公钥的脚本命令。例如，脚本可以从元数据服务的特定 URL（如<a href="http://169.254.169.254/openstack/latest/meta_data.json%EF%BC%89%E8%8E%B7%E5%8F%96%E5%8C%85%E5%90%AB">http://169.254.169.254/openstack/latest/meta_data.json）获取包含</a> SSH Key 公钥的元数据信息，然后将公钥写入到/root/.ssh/authorized_keys文件中。</li></ul></li></ul><h3 id="TCP的连接是怎么建立的"><a href="#TCP的连接是怎么建立的" class="headerlink" title="TCP的连接是怎么建立的"></a>TCP的连接是怎么建立的</h3><p>TCP段中的标志位有：</p><ul><li>SYN: 同步标志，用于建立连接</li><li>ACK: 确认标志，表示确认收到请求</li><li>RST: 复位标志，用于复位相应的 TCP 连接</li><li>PSH: 推标志，用于请求立即将数据交付给接收方的应用程序，而不是在缓冲区中等待</li><li>FIN: 结束标志，用于请求关闭连接</li><li>URG: 紧急标志，用于指示数据包中的数据应被优先处理。</li></ul><p>TCP建立连接的步骤如下：</p><ul><li>客户端发送一个标志位SYN为1、序列号为随机数x的数据段给服务器端，并进入SYNC-SENT状态</li><li>服务器端回复一个ACK标志位为1、SYN标志位为1、顺序号为<code>x+1</code>、应答号为随机数y的数据段表示接受连接，并进入SYNC-RCVD状态</li><li>客户端再发送给服务器端一个ACK标志位为1、顺序号为<code>x+1</code>、应答号为<code>y+1</code>的数据段，并进入ESTABLISHED状态</li><li>服务器端收到上述数据段后进入ESTABLISHED状态</li></ul><p>TCP关闭连接的步骤如下：</p><ul><li>客户端发送一个标志位FIN为1的数据段，并进入<code>FIN_WAIT_1</code>状态</li><li>服务器端收到后会发送个客户端一个ACK为1的数据段并进入<code>CLOSE_WAIT</code>状态</li><li>服务器端发送一个FIN 和 ACK 标志位都被设置为 1的数据段，进入<code>LAST_ACK</code>状态</li><li>客户端发送一个ACK为1的报文给服务器端，进入<code>TIME_WAIT</code>状态，服务器收到后进入<code>CLOSED</code>状态</li><li>客户端等待<code>2*MSL</code>的时间后进入<code>CLOSED</code>状态</li></ul><p>TCP 关闭连接时客户端在<code>TIME_WAIT</code>状态下会等待 2 倍的最大报文段生存时间（2MSL），主要原因如下：</p><ul><li><p>确保 ACK 被接收<br>当客户端发送最后一个 ACK 确认报文段以响应服务器的 FIN 报文段后，这个 ACK 报文段可能在传输过程中丢失。如果丢失，服务器将重新发送 FIN 报文段。<br>客户端在 TIME - WAIT 状态等待 2MSL 时间，能够确保它有足够的时间收到服务器重传的 FIN 报文段，并再次发送 ACK 确认报文段。</p></li><li><p>使旧连接的报文段在网络中消失<br>TCP 连接使用 IP 地址和端口号来标识。在网络环境中，可能存在报文段由于网络延迟等原因而延迟到达的情况。<br>当一个新的连接建立时，如果之前旧连接的报文段仍在网络中传播，可能会干扰新连接。等待 2MSL 时间可以保证本次连接中产生的所有报文段都从网络中消失，从而避免旧的连接报文段对下一个 TCP 连接造成干扰。</p></li></ul><h3 id="如何设计一个软件"><a href="#如何设计一个软件" class="headerlink" title="如何设计一个软件"></a>如何设计一个软件</h3><ol><li><p>Linux系统的设计理念”Do one thing, and do it well”，每个Linux命令都只做很小的功能，但通过Shell的组合可以实现更为复杂的功能。这点和函数式编程的风格也比较类似。所以在做架构设计的时候尽量让模块功能明确，可以提高可重用性以及快速的定位和分析问题。</p></li><li><p>在交互设计的时候尽量遵循现有的一些规范，如RESTful API。接口的设计需要明确，尽量不要有重复的、叠加的功能。</p></li><li><p>在数据存储方面，尽量避免多个组件共同直接操作数据库，需要设计一个单独的组件来负责数据的处理。</p></li><li><p>为提升性能，可以考虑设计与实现缓存系统。</p></li><li><p>需要设计和实现日志系统，尽量让日志信息详细、准确以便快速定位和分析问题。</p></li></ol><h3 id="设计一个高性能的存储系统"><a href="#设计一个高性能的存储系统" class="headerlink" title="设计一个高性能的存储系统"></a>设计一个高性能的存储系统</h3><ol><li><p>可以实现一个缓存</p></li><li><p>设备虚拟化可以从半虚拟化下移到硬件辅助虚拟化以提升性能</p></li><li><p>使用异步I/O或者I/O多路复用可以批量处理数据以提升性能</p></li><li><p>可以通过写时复用等技术延后处理极有可能不用处理的数据</p></li><li><p>后台线程如清理程序的设计可以给上层提供较全面的接口，以便上层组件可以根据实际的业务需求去更改配置进行性能优化</p></li></ol><h3 id="重构的时机，重构的代码如何保证，如何和设计模式结合"><a href="#重构的时机，重构的代码如何保证，如何和设计模式结合" class="headerlink" title="重构的时机，重构的代码如何保证，如何和设计模式结合"></a>重构的时机，重构的代码如何保证，如何和设计模式结合</h3><ol><li><p>代码的可扩展性及可重用性太差，实现新功能的代价远大于重构的代价的时候应该进行重构。拿我所做的IaaS镜像自动化的项目举例来说，原先的设计是<br>每个操作系统类型、版本都对应了一套构建脚本以及Devops pipeline，然而，随着支持的操作系统越来越多，版本越来越多，支持新的操作系统或者版本<br>的代价将会变的很大。这个时候就需要进行重构，让多个操作系统、多个版本的构建脚本统一起来。</p></li><li><p>重构软件时，可以利用不同技术的脚手架工具，让项目的内容尽可能的完整。如python或者js的脚手架工具会帮我们生成完整的目录结构。如文档、代码、单元测试、<br>集成测试、E2E测试、脚本工具等。</p></li><li><p>重构的代码应该有完善的Devops管理机制。如CI的时候，需要不同的开发人员来评审代码，PR中的新代码单元测试的代码覆盖率达到80%等。部署的时候需要<br>对不同的环境的权限进行严格的管理，如开发环境、staging、产品环境。</p></li><li><p>设计模块的功能尽量明确和单一，可以保证代码的可重用性，也可以能够尽快的分析出问题。另外可以实现抽象层，抽象层只需要定义一些接口，而具体的<br>功能可以用过下层的驱动或者适配层来完成。</p></li></ol><h3 id="已知有快照等特性，设计存储系统容灾架构、及关键组件"><a href="#已知有快照等特性，设计存储系统容灾架构、及关键组件" class="headerlink" title="已知有快照等特性，设计存储系统容灾架构、及关键组件"></a>已知有快照等特性，设计存储系统容灾架构、及关键组件</h3><ol><li><p>数据采集器：负责从混合云或者其他的数据中心接收或者采集所需要备份的数据和元数据</p></li><li><p>IAM: 负责身份认证、秘钥管理和权限管理等内容</p></li><li><p>元数据管理器：负责将其他组件生成的元数据保存到系统数据库中</p></li><li><p>数据管理器：负责数据的校验、去重等功能，并调用元数据管理器将元数据写入数据库</p></li><li><p>消息队列：负责各个组件的通信</p></li><li><p>后端存储器：将数据落地到跨AZ或者地区的分布式的存储系统</p></li><li><p>API服务器：提供对外的RESTful API访问</p></li><li><p>SDK, CMD tool, library, UI</p></li><li><p>API的分类可以有：数据源的管理，定时策略，备份区域管理，数据备份策略，数据的读写等功能，秘钥管理</p></li></ol><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="当前项目代码行数大概多少"><a href="#当前项目代码行数大概多少" class="headerlink" title="当前项目代码行数大概多少"></a>当前项目代码行数大概多少</h3><p>… …</p>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> kvm </tag>
            
            <tag> virtio </tag>
            
            <tag> qemu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Openstack Trove概要</title>
      <link href="/2024/09/04/OpenstackTrove%E6%A6%82%E8%A6%81/"/>
      <url>/2024/09/04/OpenstackTrove%E6%A6%82%E8%A6%81/</url>
      
        <content type="html"><![CDATA[<h2 id="Trove简介"><a href="#Trove简介" class="headerlink" title="Trove简介"></a>Trove简介</h2><p>Openstack Trove是openstack为用户提供的数据库即服务(DBaaS)。所谓DBaaS，即trove既具有数据库管理的功能，又具有云计算的优势。使用trove，用户可以：</p><ul><li>  “按需”获得数据库服务器</li><li>  配置所获得的数据库服务器或者数据库服务器集群</li><li>  对数据库服务器或者数据库服务器集群进行自动化管理</li><li>  根据数据库的负载让数据库服务器集群动态伸缩</li></ul><p>与openstack的其他组件一样，trove也提供RESTful API，并通过RESTful API和其他组件进行交互。</p><h2 id="Trove架构"><a href="#Trove架构" class="headerlink" title="Trove架构"></a>Trove架构</h2><p>Trove API和用户进行交互，当Trove API接收到用户请求时，trove API首先会调用Keystone的API来对用户进行认证，认证通过后才会去执行相应的操作。Trove API会同步处理操作简单的一些请求，复杂的请求则会通过Message Queue (RabbitMQ)交给Task Manager来处理。Task Manager会监听RabbitMQ的一个topic，收到请求后就会进行处理。这些请求通常是分配数据库实例、管理数据库实例的生命周期、操作数据库等。和openstack的其他组件一样，Trove也有一个Infrastructure Database来存储自己本身的数据，如数据库实例的信息等。Trove conductor的主要功能是接收来自guest agent的状态更新信息，这些信息会被存储在Infrastructure database里面或者作为调用结果返回给其他服务。通常这些状态更新信息包括：guest agent心跳包，数据库备份状态等。Guest Agent运营于数据库服务器中(虚拟机)，给trove其他组件提供了一套内部使用的API，trove的其他组件通过Message Queue来调用这些API，guest agent收到API调用请求后，执行相应的数据库操作。</p><img src="/images/trove.png" width="500px" /><p>Trove的安装部署请参考Openstack官方文档(多坑慎入)：</p><p><a href="https://docs.openstack.org/project-install-guide/database/ocata/">https://docs.openstack.org/project-install-guide/database/ocata/</a></p><h2 id="Trove的基本概念"><a href="#Trove的基本概念" class="headerlink" title="Trove的基本概念"></a>Trove的基本概念</h2><ul><li>  数据库实例（Instance）：包含数据库程序的openstack虚拟机，如果用户创建了一个数据库实例，那么他其实就创建了一台openstack虚拟机，并在该虚拟机上启动了数据库服务。</li><li>  Datastore：用来表示和存储数据库的类型、版本、虚拟机镜像等信息。当用户创建一个数据库实例时需要指定Datastore.</li><li>  配置组(Configuration Group)：数据库参数组成的集合。用户可以将配置组应用到一个或多个数据库实例上，因而避免了大量的重复操作。</li></ul><h2 id="Trove的用法"><a href="#Trove的用法" class="headerlink" title="Trove的用法"></a>Trove的用法</h2><h3 id="０．添加Datastore"><a href="#０．添加Datastore" class="headerlink" title="０．添加Datastore"></a>０．添加Datastore</h3><p>在创建数据库实例时，需要指定Datastore来告诉trove需要用到的镜像、数据库类型及版本信息。所以在创建数据库实例之前需要在系统中创建Datastore.</p><p>由于版权问题，openstack官方并没有提供可供下载的镜像，需要用户自己去build。可参考文档：</p><p><a href="https://docs.openstack.org/developer/trove/dev/building_guest_images.html">https://docs.openstack.org/developer/trove/dev/building_guest_images.html</a></p><p>Build好镜像好需要将其上传到glance服务：</p><pre><code>ad@ltczhp11:~$ glance image-create --name mysql-5.6 --disk-format=qcow2 --container-format=bare --file=./mysql-5.6.qcow2 --visibility public ad@ltczhp11:~$ glance image-list+--------------------------------------+--------------------------+| ID                                   | Name                     |+--------------------------------------+--------------------------+| 31d60001-c2bf-496e-9f21-069bb411bd3b | CouchDB                  || eaf27f1b-3a8a-4efb-827c-697fa065933b | DB2                      || 60ca8bfc-28a7-418a-9422-ec6548f23d54 | DIB-Mongodb              || 51103b44-2618-4c15-8ded-4371bea8973a | DIB-Postgres             || 8bc1a6a2-6ec3-4f37-bb54-91134b903996 | mongodb-lsl              || c4c9a58f-bbe6-4640-8488-0c05b52028df | mysql-5.6                || 5d800163-3660-467a-a433-e1827924a741 | PostgreSQL               || 38291f8f-5af6-4338-82b7-3f18dc355cae | ubuntu16.04-server-s390x |+--------------------------------------+--------------------------+</code></pre><p>使用trove-manage添加Datastore：</p><pre><code>root@ltczhp11:~# trove-manage datastore_update mysql &quot;&quot;　#创建一个datastoreroot@ltczhp11:~# trove-manage datastore_version_update mysql 5.6 mysql c4c9a58f-bbe6-4640-8488-0c05b52028df &quot;&quot; 1 #创建一个dadastore的版本，一个dadastore可以有多个版本root@ltczhp11:~# trove-manage datastore_update mysql 5.6　＃指定默认的datastore版本</code></pre><h3 id="１．基本的数据库实例操作"><a href="#１．基本的数据库实例操作" class="headerlink" title="１．基本的数据库实例操作"></a>１．基本的数据库实例操作</h3><ul><li>列出所有的数据库实例<br>  $ trove list_</li><li>创建一个数据库实例<br>  $ trove create vm1 2 –size 3 –datastore  mysql_</li><li>重启一个数据库实例<br>  $ trove restart vm1_</li><li>删除一个数据库实例<br>  $ trove delete vm1_</li><li>强制删除一个数据库实例<br>  $ trove force-delete vm1_</li><li>调整一个数据库实例的规格<br>  $ trove resize-volume vm1 4_<br>  $ trove resize-instance vm1 3_</li></ul><h3 id="2．管理数据库用户"><a href="#2．管理数据库用户" class="headerlink" title="2．管理数据库用户"></a>2．管理数据库用户</h3><ul><li>列出所有的数据库用户<br>  $ trove user-list_</li><li>创建一个用户<br>  $ trove user-create_</li><li>删除一个用户<br>  $ trove user-delete_</li><li>给一个用户授权访问某个数据库<br>  $ trove user-grant-access_</li><li>吊销用户对于某一个数据库的访问权限<br>  $ trove user-revoke-access_</li><li>显示用户信息<br>  $ trove user-show_</li><li>显示用户的权限<br>  $ trove user-show-access_</li></ul><h3 id="3-数据库管理"><a href="#3-数据库管理" class="headerlink" title="3. 数据库管理"></a>3. 数据库管理</h3><ul><li>在一个数据库实例中创建一个数据库<br>  $ trove database-create_</li><li>列出一个数据库实例中的所有数据库<br>  $ trove database-list_</li><li>删除一个数据库实例中的某个数据库<br>  $ trove database-delete_</li></ul><h3 id="4-副本管理"><a href="#4-副本管理" class="headerlink" title="4. 副本管理"></a>4. 副本管理</h3><ul><li>创建一个副本<br>  $ trove create  –_<em>replica_of</em></li><li>将一个副本从源数据库分离<br>  $ trove detach-replica_</li><li>让一个副本在副本集合中成为源数据库<br>  $ trove promote-to-replica-source_</li><li>删除挂掉的源数据库<br>  $ trove eject-replica-source_</li><li>设置副本亲和性<br>  $ trove create  –<strong>replica_of</strong>  –locality affinity_<br>  $ trove create  –<strong>replica_of</strong>  –locality anti-affinity_</li></ul>]]></content>
      
      
      <categories>
          
          <category> 云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dbaas </tag>
            
            <tag> openstack </tag>
            
            <tag> trove </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>面试复习-项目-HLFS</title>
      <link href="/2024/09/04/%E9%9D%A2%E8%AF%95%E5%A4%8D%E4%B9%A0-%E9%A1%B9%E7%9B%AE-HLFS/"/>
      <url>/2024/09/04/%E9%9D%A2%E8%AF%95%E5%A4%8D%E4%B9%A0-%E9%A1%B9%E7%9B%AE-HLFS/</url>
      
        <content type="html"><![CDATA[<h3 id="HLFS的存储体系结构"><a href="#HLFS的存储体系结构" class="headerlink" title="HLFS的存储体系结构"></a>HLFS的存储体系结构</h3><p>HLFS是开源云计算平台cloudxy的虚拟机镜像存储系统，为cloudxy提供安全、可靠、高效的分布式镜像存储服务。从实现方式上来讲，HLFS由三个逻辑层次组成：接口层、逻辑层、后台存储层。接口层主要以应用函数库的形式给虚拟机监管者（Virtual Machine Monitor）提供存储接口。逻辑层实现了核心功能，包括快照和回滚、文件系统组织等。HDFS（Hadoop分布式文件系统）是Hadoop应用程序的主要存储系统[6]。主要的特点是将数据的多个副本分布地存储于计算机集群的多个节点上，以提供存储的高可靠性。后台存储层借助HDFS实现存储集群管理。图1是HLFS的存储体系结构。</p><img src="/images/hlfs.png" width="500px" /><p>HLFS由三个组件构成：主节点（Name Node）、数据节点（Data Node）、客户端组成，如图2所示。主节点通过处理注册及心跳检测来维护数据节点的机架关系（cluster membership）、处理来自数据节点的报告及数据块的位置、处理文件数据块操作并管理文件数据块的冗余副本。数据节点在本地文件系统上存储HDFS的文件数据块。客户端通过则HLFS动态链接库来使用HLFS所提供的服务。</p><p>HLFS数据传输与控制信息的传输是分开的，这就有效的减少了主节点的负载。客户端在请求数据时，首先会从主节点获取数据块的位置及其他元数据，然后直接和数据节点进行数据传输，而不必有主节点的参与。</p><h3 id="HLFS的数据组织方式"><a href="#HLFS的数据组织方式" class="headerlink" title="HLFS的数据组织方式"></a>HLFS的数据组织方式</h3><p>日志结构文件系统（Log-structured File System）是将文件中的数据和元数据封装成日志（Log），并将日志顺序地追加写入到磁盘的末尾。其实现的最初目的是加速磁盘写入操作及崩溃恢复。HLFS被设计成为一个简化的日志结构文件系统，具有高可用性、高性能、支持随机读写、快速故障恢复、支持数据快照与回滚、支持动态扩容等诸多特点。<br>HLFS并非完全遵循Posix语义，而是仅仅实现了单一文件的基本管理（open,write,read,close等)的块级（block-level)存储系统。从逻辑上讲，该存储系统是由很多个大小一致（最后一个段除外）的段(Segment)组成，每一个段又由数目不定的日志组成，如图所示。</p><img src="/images/hlfs1.png" width="500px" /><p>所有的段都是以分布式文件系统HDFS文件的形式存在，且有相应的编号作为数据的段地址。数据在段文件中的偏移量作为偏移地址。这样，所有的段叠加在一起就构成了一个具有线性地址空间的虚拟磁盘。日志(log)的结构如图4所示，每个log由日志头、数据块、间接块、索引节点(inode)、索引节点映射构成[9]。日志头记录了该日志的大小、生成时间等信息。数据块存放来自用户的数据，间接块和索引节点中存放有这些数据块的线性地址。除此之外，索引节点还保存了文件大小、时间信息以及间接块的线性地址。针对镜像存储的特点，HLFS目前被设计为只支持单一文件。</p><p>所有的log都指向了同一个索引节点。索引节点映射保存了该索引节点的索引结点号以及索引节点的地址。</p><img src="/images/hlfs2.png" width="500px" /><h3 id="缓存子系统设计思想及策略"><a href="#缓存子系统设计思想及策略" class="headerlink" title="缓存子系统设计思想及策略"></a>缓存子系统设计思想及策略</h3><p>由于客户端与后台HDFS集群的数据交互效率低下，频繁的I/O操作将会从很大程度上托慢系统的整体性能。为了解决这个问题，我们在客户端组件上设计并实现了一层缓存（Cache），让客户端的I/O先在缓存中进行，当系统空闲时或缓存充满时，再把缓存的内容刷回后台集群。这样，用户所感知的I/O时间减少，因而也提升了系统的响应速度。<br>在缓存子系统设计时，我们需要考虑以下两个问题：<br>1）缓存的置换策略。缓存失效或者资源被耗尽时，需要将缓存中一些缓存项（item）同步到后台集群。常用的置换策略有随机替换策略、最近最少使用策略（LRU）以及先进先出策略。随机替换策略是在缓存中随机选择一个或多个缓存项，将其同步到后台集群。最近最少使用策略是利用局部性原理将最近最少被访问的缓存项替换出去。先进先出策略是将最早进入缓存的缓存项替换出去。综合比较三种策略，先进先出策略和随机替换策略最容易实现，但效率相较于最近最少使用策略偏低，所以我们选取最近最少使用策略。<br>2）数据一致性。当引入缓存后，后台集群数据和缓存中的数据出现了不一致的情形。常用的缓存写数据同步策略有：写透（write through）式和写回（write back）式。写透式是在将数据写入缓存的同时，也将数据写入后台集群，而写回式则是将数据只写入缓存，待缓存耗尽或系统空闲时，再将数据刷回到后台集群。写透时保证了数据的一致性，但效率并没有写回式高，因而我们选取写回式数据同步策略。</p><img src="/images/hlfs3.png" width="500px" /><h3 id="缓存子系统的实现"><a href="#缓存子系统的实现" class="headerlink" title="缓存子系统的实现"></a>缓存子系统的实现</h3><p>实现缓存(Cache)需要用到两个核心的数据结构：block_t和cache_ctrl。block_t描述了数据块的块号及其在内存中的地址，其定义如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">uint32_t</span> block_no;   <span class="comment">/*文件块号*/</span></span><br><span class="line">    <span class="keyword">char</span> *block;   <span class="comment">/*数据在内存中的地址*/</span></span><br><span class="line">&#125; <span class="keyword">block_t</span>;</span><br></pre></td></tr></table></figure><p>cache_ctrl是cache子系统的全局控制结构，记录了整个子系统所需要的重要信息，其定义如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">cache_ctrl</span> &#123;</span></span><br><span class="line">    GMutex *cache_mutex;   <span class="comment">/*用于保护Cache</span></span><br><span class="line"><span class="comment">操作的互斥锁*/</span></span><br><span class="line">    GTrashStack *block_cache;   </span><br><span class="line">    GQueue *dirty_block;    </span><br><span class="line">    GHashTable *block_map;  </span><br><span class="line">    GThread *flush_worker;  </span><br><span class="line">    <span class="keyword">uint32_t</span> flush_worker_should_exit;</span><br><span class="line">    GCond *flush_waken_cond;</span><br><span class="line">    GCond *writer_waken_cond; </span><br><span class="line">    FLUSH_CB write_callback_func;</span><br><span class="line">    <span class="keyword">void</span> *write_callback_user_param;</span><br><span class="line">    <span class="keyword">uint32_t</span> cache_size;   <span class="comment">/*Cache大小，系统</span></span><br><span class="line"><span class="comment">始化时制定*/</span></span><br><span class="line">    <span class="keyword">uint32_t</span> block_size;    <span class="comment">/*数据块大小*/</span></span><br><span class="line">    <span class="keyword">uint32_t</span> flush_interval;   <span class="comment">/*后台回写线程刷</span></span><br><span class="line"><span class="comment">新数据的时间间隔*/</span></span><br><span class="line">    <span class="keyword">uint32_t</span> flush_trigger_level;   <span class="comment">/*刷新线程</span></span><br><span class="line"><span class="comment">启动的阈值，如果缓存中脏块数超过此阈值，将</span></span><br><span class="line"><span class="comment">启动后台回写线程，进行数据回写*/</span></span><br><span class="line">    <span class="keyword">uint32_t</span> flush_once_size;   <span class="comment">/*一次回写的脏</span></span><br><span class="line"><span class="comment">块数目*/</span>   </span><br><span class="line">    <span class="keyword">uint64_t</span> total_write_count;</span><br><span class="line">    <span class="keyword">uint64_t</span> total_read_count;</span><br><span class="line">    <span class="keyword">uint64_t</span> cache_hit;   <span class="comment">/*记录Cache命中的</span></span><br><span class="line"><span class="comment">次数*/</span></span><br><span class="line">&#125; CACHE_CTRL;</span><br></pre></td></tr></table></figure><p>缓存子系统初始化的时候会为cache_ctrl分配内存，并根据配置文件填充该结构体。之后，缓存子系统所有的控制数据都会从该数据结构中读取，所有的操作函数也会把cache_ctrl作为控制句柄。block_cache是利用glib库中的GTrashStack所做的块容器，系统在初始化的时候会分配固定数量（cache_size）的block_t结构，并存储于容器中。dirty_block是脏块的LRU链表，系统中所有的脏块地址都会按LRU算法存放于此队列中。哈希表block_map维护数据块号与数据块结构block_t的映射关系。write_callback_func是用户传入的回写数据到后台集群的回调函数，而write_callback_user_param则是传递给该函数的参数。</p><p>缓存子系统的实现策略如下：</p><ul><li>   数据结构cache_ctrl中记录了来自用户配置文件的脏快刷新阀值，在写缓存时，如果缓存中的脏块数量未达到该刷新阀值，则数据直接写入缓存。如果已经达到刷新阀值，则唤醒flush后台线程。flush后台线程会异步执行刷新操作。回写线程会检测cache中是否有容纳本次写入的空间，如果有则写入，没有则继续在等待队列上等待被唤醒。</li><li>   flush后台线程将cache中的脏块写回后，释放cache空间，并通知等待队列上的写入线程。</li><li>   flush后台线程执行有两个条件：一个是周期性时间到达，一个是被唤醒。</li><li>   flush后台线程每次写操作写入的脏块不能超过给定数量（每次写入对应一个log）。但会在循环中连续执行写入，直到脏块数低于阀值才停止，再次进入休眠状态。</li><li>   flush写下去的脏块直接归还到cache中。</li><li>   读请求到来之后，首先会从缓存中查询是否有     缓存的块，如果没有再去从后台查询。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 专利 </tag>
            
            <tag> 面试 </tag>
            
            <tag> 数据冗余 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>面试复习-数据结构-图</title>
      <link href="/2024/09/03/%E9%9D%A2%E8%AF%95%E5%A4%8D%E4%B9%A0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%9B%BE/"/>
      <url>/2024/09/03/%E9%9D%A2%E8%AF%95%E5%A4%8D%E4%B9%A0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%9B%BE/</url>
      
        <content type="html"><![CDATA[<ul><li>图可以用邻接表或者邻接矩阵表示</li><li>在无权图中找出两个节点最短距离通常用广度优先算法 - 队列实现</li><li>在无权图中找出符合条件的路径通常用深度优先算法 - 栈或者递归实现</li></ul><h3 id="求最大岛屿面积"><a href="#求最大岛屿面积" class="headerlink" title="求最大岛屿面积"></a>求最大岛屿面积</h3><p>链接： <a href="https://leetcode.cn/problems/max-area-of-island/">https://leetcode.cn/problems/max-area-of-island/</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxAreaOfIsland</span>(<span class="params">self, grid: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        lenRows = <span class="built_in">len</span>(grid)</span><br><span class="line">        lenCols = <span class="built_in">len</span>(grid[<span class="number">0</span>])</span><br><span class="line">        visited = [[<span class="literal">False</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(lenCols)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(lenRows)]</span><br><span class="line">        maxArea = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(lenRows):</span><br><span class="line">            <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(lenCols):</span><br><span class="line">                <span class="keyword">if</span> grid[row][col] == <span class="number">1</span> <span class="keyword">and</span> <span class="keyword">not</span> visited[row][col]:</span><br><span class="line">                    area = self.getArea(grid, visited, row, col)</span><br><span class="line">                    maxArea = <span class="built_in">max</span>(maxArea, area)</span><br><span class="line">        <span class="keyword">return</span> maxArea</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getArea</span>(<span class="params">self, grid, visited, row, col</span>):</span></span><br><span class="line">        lenRows = <span class="built_in">len</span>(grid)</span><br><span class="line">        lenCols = <span class="built_in">len</span>(grid[<span class="number">0</span>])</span><br><span class="line">        area = <span class="number">0</span></span><br><span class="line">        q = queue.Queue()</span><br><span class="line">        q.put((row, col))</span><br><span class="line">        visited[row][col] = <span class="literal">True</span></span><br><span class="line">        directions = [(<span class="number">0</span>, <span class="number">1</span>), (<span class="number">0</span>, -<span class="number">1</span>), (-<span class="number">1</span>, <span class="number">0</span>), (<span class="number">1</span>, <span class="number">0</span>)]</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> q.empty():</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                area += <span class="number">1</span></span><br><span class="line">                curRow, curCol = q.get()</span><br><span class="line">                <span class="keyword">for</span> <span class="built_in">dir</span> <span class="keyword">in</span> directions:</span><br><span class="line">                    nextRow = curRow + <span class="built_in">dir</span>[<span class="number">0</span>]</span><br><span class="line">                    nextCol = curCol + <span class="built_in">dir</span>[<span class="number">1</span>]</span><br><span class="line">                    <span class="keyword">if</span> (</span><br><span class="line">                        <span class="number">0</span> &lt;= nextRow &lt; lenRows</span><br><span class="line">                        <span class="keyword">and</span> <span class="number">0</span> &lt;= nextCol &lt; lenCols</span><br><span class="line">                        <span class="keyword">and</span> grid[nextRow][nextCol] == <span class="number">1</span></span><br><span class="line">                        <span class="keyword">and</span> <span class="keyword">not</span> visited[nextRow][nextCol]</span><br><span class="line">                    ):</span><br><span class="line">                        q.put((nextRow, nextCol))</span><br><span class="line">                        visited[nextRow][nextCol] = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">return</span> area</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> 算法 </tag>
            
            <tag> 图 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>面试复习-专利</title>
      <link href="/2024/09/02/%E9%9D%A2%E8%AF%95%E5%A4%8D%E4%B9%A0-%E4%B8%93%E5%88%A9/"/>
      <url>/2024/09/02/%E9%9D%A2%E8%AF%95%E5%A4%8D%E4%B9%A0-%E4%B8%93%E5%88%A9/</url>
      
        <content type="html"><![CDATA[<h3 id="Heterogenous-replication-in-a-hybrid-cloud-database"><a href="#Heterogenous-replication-in-a-hybrid-cloud-database" class="headerlink" title="Heterogenous replication in a hybrid cloud database"></a>Heterogenous replication in a hybrid cloud database</h3><p>链接：<a href="https://patents.google.com/patent/WO2023040954A1/en">https://patents.google.com/patent/WO2023040954A1/en</a></p><p>该专利旨在解决混合云计算环境中数据冗余的问题，通过将文件拆分为块、计算块签名、比较块签名来识别重复文件，并选择删除候选文件，以减少存储重复数据，提高存储效率。</p><img src="/images/patent_dr.png" width="500px" /><h3 id="Protecting-container-images-and-runtime-data"><a href="#Protecting-container-images-and-runtime-data" class="headerlink" title="Protecting container images and runtime data"></a>Protecting container images and runtime data</h3><p>链接： <a href="https://patents.google.com/patent/WO2024007733A1/en">https://patents.google.com/patent/WO2024007733A1/en</a></p><p>在 Kubernetes 中保护敏感容器镜像对于机密计算至关重要，因为需要保护容器资源免受其他容器和主机访问。目前有一些解决方案，如 Kata 和 gVisor，可以限制 Kubernetes Pod 中的容器隔离，还有一些像 Firecracker 的 Hypervisor 可以增强虚拟化。然而，现有解决方案虽然可以隔离 CPU、内存、存储等资源，但无法保护容器镜像和根文件系统免受主机访问，因为所有容器根文件系统都驻留在主机上的目录下。本专利介绍了一种新系统，使得保护敏感容器镜像和根文件系统免受主机访问成为可能，同时容器镜像可以根据共享策略在 Pod 之间共享</p><img src="/images/patent-2-1.png" width="500px" /><img src="/images/patent-2-2.png" width="500px" /><img src="/images/patent-2-3.png" width="500px" /><img src="/images/patent-2-4.png" width="500px" /><img src="/images/patent-2-5.png" width="500px" />]]></content>
      
      
      <categories>
          
          <category> 云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 专利 </tag>
            
            <tag> 面试 </tag>
            
            <tag> 数据冗余 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>面试复习-Python-面向对象</title>
      <link href="/2024/08/31/%E9%9D%A2%E8%AF%95%E5%A4%8D%E4%B9%A0-Python-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/"/>
      <url>/2024/08/31/%E9%9D%A2%E8%AF%95%E5%A4%8D%E4%B9%A0-Python-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/</url>
      
        <content type="html"><![CDATA[<h3 id="面向对象编程的特点"><a href="#面向对象编程的特点" class="headerlink" title="面向对象编程的特点"></a>面向对象编程的特点</h3><ul><li><p>封装是将数据和操作数据的方法封装在一个类中，对外隐藏内部的实现细节，只提供一些公共的方法来访问和修改数据。这样可以提高代码的安全性和可维护性，避免外部直接访问和修改内部数据，导致程序出现错误。</p></li><li><p>继承允许一个类（子类）继承另一个类（父类）的属性和方法，从而实现代码的复用和扩展。子类可以继承父类的所有公共属性和方法，并可以根据需要添加自己的属性和方法，或者重写父类的方法</p></li><li><p>多态是指同一个方法可以根据调用对象的不同而表现出不同的行为。在 Python 中，多态是通过方法重写和方法重载来实现的。方法重写是指子类重写父类的方法，方法重载是指在同一个类中定义多个同名方法，但参数列表不同。</p></li><li><p>抽象类是一种不能被实例化的类，它只能作为其他类的父类，用于定义一些抽象方法，这些方法没有具体的实现，需要在子类中实现</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shape</span>(<span class="params">ABC</span>):</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">area</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">perimeter</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="Python类的基础知识"><a href="#Python类的基础知识" class="headerlink" title="Python类的基础知识"></a>Python类的基础知识</h3><h4 id="类的定义"><a href="#类的定义" class="headerlink" title="类的定义"></a>类的定义</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"><span class="meta">... </span>  <span class="string">&#x27;student class&#x27;</span></span><br><span class="line"><span class="meta">... </span>  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age</span>):</span></span><br><span class="line"><span class="meta">... </span>    self.name = name</span><br><span class="line"><span class="meta">... </span>    self.age = age</span><br><span class="line"><span class="meta">... </span>  <span class="function"><span class="keyword">def</span> <span class="title">get_name</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> self.name</span><br><span class="line"><span class="meta">... </span>  <span class="function"><span class="keyword">def</span> <span class="title">get_age</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> self.age</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sen = Student(<span class="string">&#x27;sen&#x27;</span>, <span class="number">18</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sen.get_name()</span><br><span class="line"><span class="string">&#x27;sen&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sen.get_age()</span><br></pre></td></tr></table></figure><h4 id="子类的定义："><a href="#子类的定义：" class="headerlink" title="子类的定义："></a>子类的定义：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">BoyStudent</span>(<span class="params">Student</span>):</span></span><br><span class="line"><span class="meta">... </span>  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="built_in">super</span>().__init__(name, age)</span><br><span class="line"><span class="meta">... </span>    self.sex = <span class="string">&#x27;male&#x27;</span></span><br><span class="line"><span class="meta">... </span>  <span class="function"><span class="keyword">def</span> <span class="title">get_sex</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> self.sex</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sen = BoyStudent(<span class="string">&#x27;sen&#x27;</span>, <span class="number">18</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sen.get_sex()</span><br><span class="line"><span class="string">&#x27;male&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="类的特殊属性"><a href="#类的特殊属性" class="headerlink" title="类的特殊属性"></a>类的特殊属性</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>BoyStudent.__doc__</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>BoyStudent.__name__</span><br><span class="line"><span class="string">&#x27;BoyStudent&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>BoyStudent.__bases__</span><br><span class="line">(&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">__main__</span>.<span class="title">Student</span>&#x27;&gt;,)</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">BoyStudent</span>.<span class="title">__dict__</span></span></span><br><span class="line"><span class="class"><span class="title">mappingproxy</span>(<span class="params">&#123;<span class="string">&#x27;__module__&#x27;</span>: <span class="string">&#x27;__main__&#x27;</span>, <span class="string">&#x27;__init__&#x27;</span>: &lt;function BoyStudent.__init__ at <span class="number">0x104681800</span>&gt;, <span class="string">&#x27;get_sex&#x27;</span>: &lt;function BoyStudent.get_sex at <span class="number">0x104681620</span>&gt;, <span class="string">&#x27;__doc__&#x27;</span>: <span class="literal">None</span>&#125;</span>)</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">BoyStudent</span>.<span class="title">__module__</span></span></span><br><span class="line"><span class="class">&#x27;<span class="title">__main__</span>&#x27;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">BoyStudent</span>.<span class="title">__class__</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">type</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">sen</span>.<span class="title">__class__</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">__main__</span>.<span class="title">BoyStudent</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure><h4 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a>静态方法</h4><p>在 Python 中，静态方法是一种不依赖于类实例和类本身的方法。它可以通过类名直接调用，而不需要创建类的实例。使用 @staticmethod 装饰器来定义静态方法。例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>:</span></span><br><span class="line">    version = <span class="string">&#x27;1.0&#x27;</span> <span class="comment"># 静态属性</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">static_method</span>():</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;这是一个静态方法。&quot;</span>)</span><br><span class="line">MyClass.static_method() <span class="comment">#调用静态方法</span></span><br></pre></td></tr></table></figure><h4 id="类方法"><a href="#类方法" class="headerlink" title="类方法"></a>类方法</h4><p>使用 @classmethod 装饰器定义，并且第一个参数通常命名为 cls，代表类本身。</p><p>类方法：</p><p>可以访问类变量，通过 cls 参数可以访问和修改类的属性。不能直接访问实例变量，因为没有实例对象的引用。</p><p>静态方法：</p><p>不能访问类变量和实例变量，它完全独立于类和实例的状态。通常用于与类或实例没有直接关系的通用功能。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>:</span></span><br><span class="line">    class_variable = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, instance_variable</span>):</span></span><br><span class="line">        self.instance_variable = instance_variable</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">class_method</span>(<span class="params">cls</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Class variable: <span class="subst">&#123;cls.class_variable&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">static_method</span>():</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;This is a static method.&quot;</span>)</span><br><span class="line">MyClass.class_method()</span><br><span class="line">MyClass.static_method()</span><br><span class="line"></span><br><span class="line">obj = MyClass(<span class="number">10</span>)</span><br><span class="line">obj.class_method()</span><br><span class="line">obj.static_method()</span><br></pre></td></tr></table></figure><h4 id="其他要点"><a href="#其他要点" class="headerlink" title="其他要点"></a>其他要点</h4><ul><li>组合类似于js中类的聚合，新类直接将旧类的实例包含在自己的属性中，从而达到访问旧类中属性和方法的目的</li><li>Python的多重继承在查找属性和方法是广度优先搜索的</li></ul><h3 id="类相关的内建函数"><a href="#类相关的内建函数" class="headerlink" title="类相关的内建函数"></a>类相关的内建函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">issubclass</span>(BoyStudent, Student)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(sen, BoyStudent)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hasattr</span>(BoyStudent, <span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hasattr</span>(sen, <span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dir</span>(Student)</span><br><span class="line">[<span class="string">&#x27;__class__&#x27;</span>, <span class="string">&#x27;__delattr__&#x27;</span>, <span class="string">&#x27;__dict__&#x27;</span>, <span class="string">&#x27;__dir__&#x27;</span>, <span class="string">&#x27;__doc__&#x27;</span>, <span class="string">&#x27;__eq__&#x27;</span>, <span class="string">&#x27;__format__&#x27;</span>, <span class="string">&#x27;__ge__&#x27;</span>, <span class="string">&#x27;__getattribute__&#x27;</span>, <span class="string">&#x27;__getstate__&#x27;</span>, <span class="string">&#x27;__gt__&#x27;</span>, <span class="string">&#x27;__hash__&#x27;</span>, <span class="string">&#x27;__init__&#x27;</span>, <span class="string">&#x27;__init_subclass__&#x27;</span>, <span class="string">&#x27;__le__&#x27;</span>, <span class="string">&#x27;__lt__&#x27;</span>, <span class="string">&#x27;__module__&#x27;</span>, <span class="string">&#x27;__ne__&#x27;</span>, <span class="string">&#x27;__new__&#x27;</span>, <span class="string">&#x27;__reduce__&#x27;</span>, <span class="string">&#x27;__reduce_ex__&#x27;</span>, <span class="string">&#x27;__repr__&#x27;</span>, <span class="string">&#x27;__setattr__&#x27;</span>, <span class="string">&#x27;__sizeof__&#x27;</span>, <span class="string">&#x27;__str__&#x27;</span>, <span class="string">&#x27;__subclasshook__&#x27;</span>, <span class="string">&#x27;__weakref__&#x27;</span>, <span class="string">&#x27;get_age&#x27;</span>, <span class="string">&#x27;get_name&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hasattr</span>(Student, <span class="string">&#x27;get_name&#x27;</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">getattr</span>(sen, <span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;sen&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">setattr</span>(sen, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;sen001&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">getattr</span>(sen, <span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;sen001&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">delattr</span>(sen, <span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">getattr</span>(sen, <span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">AttributeError: <span class="string">&#x27;BoyStudent&#x27;</span> <span class="built_in">object</span> has no attribute <span class="string">&#x27;name&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">vars</span>(sen)</span><br><span class="line">&#123;<span class="string">&#x27;age&#x27;</span>: <span class="number">18</span>, <span class="string">&#x27;sex&#x27;</span>: <span class="string">&#x27;male&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="类的特殊属性和方法"><a href="#类的特殊属性和方法" class="headerlink" title="类的特殊属性和方法"></a>类的特殊属性和方法</h3><h4 id="slots"><a href="#slots" class="headerlink" title="slots"></a><strong>slots</strong></h4><ul><li>当定义了 <strong>slots</strong> 时，Python 不会为每个实例创建一个 <strong>dict</strong> 属性字典来存储实例的属性。这可以显著减少内存使用，特别是在创建大量实例的情况下。</li><li><strong>slots</strong> 可以明确地指定一个实例可以拥有的属性列表</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">BoyStudent</span>(<span class="params">Student</span>):</span></span><br><span class="line"><span class="meta">... </span>  <span class="string">&#x27;boy student&#x27;</span></span><br><span class="line"><span class="meta">... </span>  __slots__ = [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;sex&#x27;</span>]</span><br><span class="line"><span class="meta">... </span>  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="built_in">super</span>().__init__(name, age)</span><br><span class="line"><span class="meta">... </span>    self.sex = <span class="string">&#x27;male&#x27;</span></span><br><span class="line"><span class="meta">... </span>  <span class="function"><span class="keyword">def</span> <span class="title">get_sex</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> self.sex</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sen = BoyStudent(<span class="string">&#x27;sen&#x27;</span>, <span class="number">18</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sen.phone = <span class="number">123</span> <span class="comment"># 没有限制住，因为父类中没有__slot__，所以父类中存在__dict__</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">vars</span>(sen) <span class="comment"># 新的属性存进了父类的__dict__</span></span><br><span class="line">&#123;<span class="string">&#x27;phone&#x27;</span>: <span class="number">123</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"><span class="meta">... </span>  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age</span>):</span></span><br><span class="line"><span class="meta">... </span>    self.name = name</span><br><span class="line"><span class="meta">... </span>    self.age = age</span><br><span class="line"><span class="meta">... </span>  __slots__ = [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>]</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sen = Student(<span class="string">&#x27;sen&#x27;</span>, <span class="number">18</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sen.phone = <span class="number">123</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">AttributeError: <span class="string">&#x27;Student&#x27;</span> <span class="built_in">object</span> has no attribute <span class="string">&#x27;phone&#x27;</span></span><br><span class="line">AttributeError: <span class="string">&#x27;Student&#x27;</span> <span class="built_in">object</span> has no attribute <span class="string">&#x27;phone&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">vars</span>(sen)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: <span class="built_in">vars</span>() argument must have __dict__ attribute</span><br></pre></td></tr></table></figure><h4 id="描述符方法-get-set-delete"><a href="#描述符方法-get-set-delete" class="headerlink" title="描述符方法 get set delete"></a>描述符方法 <strong>get</strong> <strong>set</strong> <strong>delete</strong></h4><p>在 Python 中，描述符是一种实现了特定协议（<code>__get__</code>、<code>__set__</code>和<code>__delete__</code>方法）的对象，用于控制对另一个对象属性的访问。主要用于自定义<br>实例属性访问时的一些操作。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IntegerValidator</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__set_name__</span>(<span class="params">self, owner, name</span>):</span></span><br><span class="line">    self.name = name</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__set__</span>(<span class="params">self, instance, value</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(value, <span class="built_in">int</span>):</span><br><span class="line">      <span class="keyword">raise</span> ValueError(<span class="string">f&#x27;<span class="subst">&#123;self.name&#125;</span> must be an integer.&#x27;</span>)</span><br><span class="line">    instance.__dict__[self.name] = value</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__get__</span>(<span class="params">self, instance, owner</span>):</span></span><br><span class="line">    <span class="keyword">if</span> instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">      <span class="keyword">return</span> self</span><br><span class="line">    <span class="keyword">return</span> instance.__dict__.get(self.name)</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span>(<span class="params">self, instance</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Deleting <span class="subst">&#123;self.name&#125;</span> from <span class="subst">&#123;instance&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">del</span> instance.__dict__[self.name]</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>:</span></span><br><span class="line">  age = IntegerValidator()</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = Student()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.age = <span class="string">&#x27;28&#x27;</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">6</span>, <span class="keyword">in</span> __set__</span><br><span class="line">ValueError: age must be an integer.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.age = <span class="number">28</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.age</span><br><span class="line"><span class="number">28</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> s.age</span><br><span class="line">Deleting age <span class="keyword">from</span> &lt;__main__.Student <span class="built_in">object</span> at <span class="number">0x1007714f0</span>&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>面试复习-Python-模块</title>
      <link href="/2024/08/31/%E9%9D%A2%E8%AF%95%E5%A4%8D%E4%B9%A0-Python-%E6%A8%A1%E5%9D%97/"/>
      <url>/2024/08/31/%E9%9D%A2%E8%AF%95%E5%A4%8D%E4%B9%A0-Python-%E6%A8%A1%E5%9D%97/</url>
      
        <content type="html"><![CDATA[<h3 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h3><p>模块是一个包含 Python 定义和语句的文件，其作用包括：</p><ul><li>代码组织与复用</li><li>每个模块都有自己的全局作用域，不同模块中的同名变量和函数不会相互干扰</li></ul><p>要点：</p><ul><li>模块的搜索路径存在于PYTHONPATH环境变量中，解释器中可以通过<code>sys.path</code>查看</li><li>命名空间：局部空间 &gt; 全局空间 &gt; 内建空间</li><li>python的对象可以看做一个命名空间，可以通过’.’给其添加属性。</li></ul><h3 id="模块导入"><a href="#模块导入" class="headerlink" title="模块导入"></a>模块导入</h3><ul><li><code>import module_name</code></li><li><code>from module_name import obj1, obj2...</code></li><li><code>from module_name import obj1 as obj</code></li><li><code>import module_name as obj</code></li><li>被导入模块只在第一次导入的时候执行</li><li>被导入的模块或Python对象遵循全局或者局部作用域的原则</li></ul><h3 id="包"><a href="#包" class="headerlink" title="包"></a>包</h3><p>包是一种组织模块的方式，它可以将多个相关的模块放在一个目录下，以便更好地管理和复用代码。一个包实际上是一个包含 <strong>init</strong>.py 文件的目录。这个文件可以是空的，也可以包含一些初始化代码，当包被导入时会自动执行。一个拥有子包的目录结构如下:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">my_package/</span><br><span class="line">    __init__.py</span><br><span class="line">    module1.py</span><br><span class="line">    module2.py</span><br><span class="line">    sub_package/</span><br><span class="line">        __init__.py</span><br><span class="line">        sub_module1.py</span><br><span class="line">        sub_module2.py</span><br></pre></td></tr></table></figure><p>要点：</p><ul><li>默认绝对导入，即从包的根目录开始导入。相对导入指使用被导入模块的相对路径导入。相对导入只支持<code>from...import</code>的语法<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从sub_module2中导入其他模块</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> my_package.sub_package <span class="keyword">import</span> sub_module1 <span class="comment"># 绝对导入</span></span><br><span class="line"><span class="keyword">from</span> .sub_module1 <span class="keyword">import</span> obj1 <span class="comment"># 相对导入</span></span><br><span class="line"><span class="keyword">from</span> ..module1 <span class="keyword">import</span> obj2 <span class="comment"># 相对导入</span></span><br></pre></td></tr></table></figure></li><li>模块中的对象命名如果以<code>_</code>开头在不会被<code>from module import *</code>导入</li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>面试复习-Python-函数</title>
      <link href="/2024/08/30/%E9%9D%A2%E8%AF%95%E5%A4%8D%E4%B9%A0-Python-%E5%87%BD%E6%95%B0/"/>
      <url>/2024/08/30/%E9%9D%A2%E8%AF%95%E5%A4%8D%E4%B9%A0-Python-%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h3 id="函数的参数组"><a href="#函数的参数组" class="headerlink" title="函数的参数组"></a>函数的参数组</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">myfunc</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(args)</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(kwargs)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>myfunc(<span class="number">1</span>, <span class="number">2</span>, name=<span class="string">&quot;sen&quot;</span>)</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;sen&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>myfunc(<span class="number">1</span>, <span class="number">2</span>, name=<span class="string">&quot;sen&quot;</span>, <span class="number">3</span>)</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span></span><br><span class="line">    myfunc(<span class="number">1</span>, <span class="number">2</span>, name=<span class="string">&quot;sen&quot;</span>, <span class="number">3</span>)</span><br><span class="line">                              ^</span><br><span class="line">SyntaxError: positional argument follows keyword argument</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>myfunc(name=<span class="string">&quot;sen&quot;</span>)</span><br><span class="line">()</span><br><span class="line">&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;sen&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="函数的属性"><a href="#函数的属性" class="headerlink" title="函数的属性"></a>函数的属性</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>myfunc.__doc__</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>myfunc.version</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">AttributeError: <span class="string">&#x27;function&#x27;</span> <span class="built_in">object</span> has no attribute <span class="string">&#x27;version&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>myfunc.__</span><br><span class="line">myfunc.__annotations__    myfunc.__hash__()</span><br><span class="line">myfunc.__builtins__       myfunc.__init__(</span><br><span class="line">myfunc.__call__(          myfunc.__init_subclass__(</span><br><span class="line">myfunc.__class__(         myfunc.__kwdefaults__</span><br><span class="line">myfunc.__closure__        myfunc.__le__(</span><br><span class="line">myfunc.__code__           myfunc.__lt__(</span><br><span class="line">myfunc.__defaults__       myfunc.__module__</span><br><span class="line">myfunc.__delattr__(       myfunc.__name__</span><br><span class="line">myfunc.__dict__           myfunc.__ne__(</span><br><span class="line">myfunc.__dir__()          myfunc.__new__(</span><br><span class="line">myfunc.__doc__            myfunc.__qualname__</span><br><span class="line">myfunc.__eq__(            myfunc.__reduce__()</span><br><span class="line">myfunc.__format__(        myfunc.__reduce_ex__(</span><br><span class="line">myfunc.__ge__(            myfunc.__repr__()</span><br><span class="line">myfunc.__get__(           myfunc.__setattr__(</span><br><span class="line">myfunc.__getattribute__(  myfunc.__sizeof__()</span><br><span class="line">myfunc.__getstate__()     myfunc.__str__()</span><br><span class="line">myfunc.__globals__        myfunc.__subclasshook__(</span><br><span class="line">myfunc.__gt__(            myfunc.__type_params__</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>myfunc.__str__()</span><br><span class="line"><span class="string">&#x27;&lt;function myfunc at 0x104ce05e0&gt;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">repeat</span>(<span class="params">n</span>):</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">dec_func</span>(<span class="params">func</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">      <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        result = func(*args, **kwargs)</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line">  <span class="keyword">return</span> dec_func</span><br><span class="line"></span><br><span class="line"><span class="meta">@repeat(<span class="params"><span class="number">3</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say_hello</span>():</span></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line"></span><br><span class="line">say_hello()</span><br></pre></td></tr></table></figure><h3 id="可变长参数"><a href="#可变长参数" class="headerlink" title="可变长参数"></a>可变长参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">my_function</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">for</span> arg <span class="keyword">in</span> args:</span><br><span class="line"><span class="meta">... </span>        <span class="built_in">print</span>(<span class="string">f&quot;Position argument: <span class="subst">&#123;arg&#125;</span>&quot;</span>)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">for</span> key, value <span class="keyword">in</span> kwargs.items():</span><br><span class="line"><span class="meta">... </span>        <span class="built_in">print</span>(<span class="string">f&quot;Keyword argument <span class="subst">&#123;key&#125;</span>: <span class="subst">&#123;value&#125;</span>&quot;</span>)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_function(*(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>), **&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;sen&#x27;</span>&#125;)</span><br><span class="line">Position argument: <span class="number">1</span></span><br><span class="line">Position argument: <span class="number">2</span></span><br><span class="line">Position argument: <span class="number">3</span></span><br><span class="line">Position argument: <span class="number">4</span></span><br><span class="line">Position argument: <span class="number">5</span></span><br><span class="line">Keyword argument name: sen</span><br></pre></td></tr></table></figure><h3 id="函数式编程用到的工具函数"><a href="#函数式编程用到的工具函数" class="headerlink" title="函数式编程用到的工具函数"></a>函数式编程用到的工具函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>l = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">filter</span>(<span class="keyword">lambda</span> x:<span class="literal">True</span> <span class="keyword">if</span> x &gt; <span class="number">5</span> <span class="keyword">else</span> <span class="literal">False</span>, l)</span><br><span class="line">&lt;<span class="built_in">filter</span> <span class="built_in">object</span> at <span class="number">0x102c47370</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(<span class="built_in">filter</span>(<span class="keyword">lambda</span> x:<span class="literal">True</span> <span class="keyword">if</span> x &gt; <span class="number">5</span> <span class="keyword">else</span> <span class="literal">False</span>, l))</span><br><span class="line">[<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x:x**<span class="number">2</span>, l))</span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>, <span class="number">36</span>, <span class="number">49</span>, <span class="number">64</span>, <span class="number">81</span>, <span class="number">100</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>reduce(<span class="keyword">lambda</span> x,y:x+y, l)</span><br><span class="line"><span class="number">55</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 偏函数 与 柯里化</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> operator <span class="keyword">import</span> add, mul</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add1 = partial(add, <span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add1(<span class="number">3</span>)</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mul4 = partial(mul, <span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mul4(<span class="number">5</span>)</span><br><span class="line"><span class="number">20</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>base2 = partial(<span class="built_in">int</span>, base=<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>base2(<span class="string">&#x27;10010111&#x27;</span>)</span><br><span class="line"><span class="number">151</span></span><br></pre></td></tr></table></figure><h3 id="变量作用域"><a href="#变量作用域" class="headerlink" title="变量作用域"></a>变量作用域</h3><p>局部变量通常会覆盖全局变量，可以在函数中通过<code>global</code>关键字引用全局变量</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">say_hello</span>():</span></span><br><span class="line"><span class="meta">... </span>  <span class="keyword">global</span> foo</span><br><span class="line"><span class="meta">... </span>  foo = <span class="number">200</span></span><br><span class="line"><span class="meta">... </span>  <span class="built_in">print</span>(foo)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo = <span class="number">100</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>say_hello()</span><br><span class="line"><span class="number">200</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo</span><br><span class="line"><span class="number">200</span></span><br></pre></td></tr></table></figure><h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><p>在 Python 中，闭包是一种函数，它可以访问其外部函数作用域中的变量，即使外部函数已经返回。</p><p>闭包由以下几个部分组成：</p><ol><li>外部函数：包含一个内部函数，并可能有一些局部变量。</li><li>内部函数：定义在外部函数内部，引用外部函数的局部变量。</li><li>外部函数的返回值：返回内部函数，使得内部函数可以在外部被调用。</li></ol><p>闭包的作用：</p><ul><li><p>数据隐藏和封装：</p><p>  闭包可以将一些数据隐藏在内部函数中，外部无法直接访问这些数据，只能通过闭包提供的接口来操作。<br>  例如，可以使用闭包来创建一个计数器，外部只能通过特定的函数来增加或读取计数器的值，而不能直接修改计数器的内部状态。</p></li><li><p>记忆功能：</p><p>  闭包可以记住外部函数的局部变量的值，即使外部函数已经返回。<br>  这在需要保存状态或实现记忆化等场景非常有用。例如，在计算斐波那契数列时，可以使用闭包来实现记忆化，避免重复计算。</p></li><li><p>实现面向对象编程的某些特性：</p><p>  闭包可以模拟类的属性和方法，通过闭包可以创建具有私有变量和方法的对象。<br>  例如，可以使用闭包来创建一个具有私有变量的对象，外部只能通过特定的方法来访问和修改这个私有变量。</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">fibonacci</span>():</span></span><br><span class="line"><span class="meta">... </span>    a, b = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">inner</span>():</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">nonlocal</span> a, b</span><br><span class="line"><span class="meta">... </span>        result = a</span><br><span class="line"><span class="meta">... </span>        a, b = b, a + b</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> result</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> inner</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fib = fibonacci()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(fib())</span><br><span class="line">...</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">13</span></span><br><span class="line"><span class="number">21</span></span><br><span class="line"><span class="number">34</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fib()</span><br><span class="line"><span class="number">55</span></span><br></pre></td></tr></table></figure><h3 id="生成器"><a href="#生成器" class="headerlink" title="生成器"></a>生成器</h3><p>生成器函数是一种包含yield关键字的函数。当调用生成器函数时，它不会立即执行函数体，而是返回一个生成器对象。每次调用生成器对象的__next__()方法或在循环中使用生成器时，函数会执行到下一个yield语句，暂停并返回一个值。然后，下次调用__next__()方法时，函数会从上次暂停的地方继续执行。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_generator</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line"></span><br><span class="line">gen = my_generator()</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> gen:</span><br><span class="line">    <span class="built_in">print</span>(num)</span><br></pre></td></tr></table></figure><h3 id="协程"><a href="#协程" class="headerlink" title="协程"></a>协程</h3><p>在 Python 中，协程是一种轻量级的并发编程方式，它允许在一个线程内实现多个任务的切换和协作，而不需要使用多线程或多进程。协程可以在等待某个事件发生时暂停执行，然后在事件发生后恢复执行，从而实现高效的并发处理.</p><p>优点：</p><ul><li>高效的并发处理：协程可以在一个线程内实现多个任务的切换和协作，避免了传统线程之间的上下文切换开销，从而提高了并发处理的效率。</li><li>轻量级：协程是一种轻量级的并发编程方式，它不需要操作系统的线程调度和上下文切换，因此占用的资源较少。</li><li>易于编程：协程的编程模型相对简单，程序员可以自己控制执行流程，避免了传统线程之间的竞争和同步问题，从而降低了编程的难度。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">print_received</span>():</span></span><br><span class="line"><span class="meta">... </span>  <span class="built_in">print</span>(<span class="string">&#x27;started&#x27;</span>)</span><br><span class="line"><span class="meta">... </span>  x = <span class="keyword">yield</span></span><br><span class="line"><span class="meta">... </span>  <span class="built_in">print</span>(<span class="string">&#x27;received: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(x))</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = print_received()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.send(<span class="literal">None</span>)</span><br><span class="line">started</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.send(<span class="number">10</span>)</span><br><span class="line">received: <span class="number">10</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">StopIteration</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>面试复习-Python-错误与异常</title>
      <link href="/2024/08/30/%E9%9D%A2%E8%AF%95%E5%A4%8D%E4%B9%A0-Python-%E9%94%99%E8%AF%AF%E4%B8%8E%E5%BC%82%E5%B8%B8/"/>
      <url>/2024/08/30/%E9%9D%A2%E8%AF%95%E5%A4%8D%E4%B9%A0-Python-%E9%94%99%E8%AF%AF%E4%B8%8E%E5%BC%82%E5%B8%B8/</url>
      
        <content type="html"><![CDATA[<h3 id="Python中常见的异常"><a href="#Python中常见的异常" class="headerlink" title="Python中常见的异常"></a>Python中常见的异常</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span></span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span></span><br><span class="line">       ^</span><br><span class="line">SyntaxError: invalid syntax</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">NameError: name <span class="string">&#x27;name&#x27;</span> <span class="keyword">is</span> <span class="keyword">not</span> defined</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">5</span>/<span class="number">0</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">ZeroDivisionError: division by zero</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f[<span class="number">0</span>]</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: <span class="string">&#x27;_io.TextIOWrapper&#x27;</span> <span class="built_in">object</span> <span class="keyword">is</span> <span class="keyword">not</span> subscriptable</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l = [<span class="number">1</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l[<span class="number">2</span>]</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">IndexError: <span class="built_in">list</span> index out of <span class="built_in">range</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Sen&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d.name</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">AttributeError: <span class="string">&#x27;dict&#x27;</span> <span class="built_in">object</span> has no attribute <span class="string">&#x27;name&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line"><span class="string">&#x27;Sen&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = <span class="built_in">open</span>(<span class="string">&quot;exec.txt&quot;</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">FileNotFoundError: [Errno <span class="number">2</span>] No such file <span class="keyword">or</span> directory: <span class="string">&#x27;exec.txt&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="Python的异常处理"><a href="#Python的异常处理" class="headerlink" title="Python的异常处理"></a>Python的异常处理</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">try</span>:</span><br><span class="line"><span class="meta">... </span>    f = <span class="built_in">open</span>(<span class="string">&quot;ex&quot;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line"><span class="meta">... </span><span class="keyword">except</span> IOError <span class="keyword">as</span> e:</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(e)</span><br><span class="line">...</span><br><span class="line">[Errno <span class="number">2</span>] No such file <span class="keyword">or</span> directory: <span class="string">&#x27;ex&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 捕获所有异常</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">try</span>:</span><br><span class="line"><span class="meta">... </span>    f = <span class="built_in">open</span>(<span class="string">&quot;ex&quot;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line"><span class="meta">... </span><span class="keyword">except</span> IOError <span class="keyword">as</span> e:</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(e)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">raise</span></span><br><span class="line"><span class="meta">... </span><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(e)</span><br><span class="line">...</span><br><span class="line">[Errno <span class="number">2</span>] No such file <span class="keyword">or</span> directory: <span class="string">&#x27;ex&#x27;</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">2</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">FileNotFoundError: [Errno <span class="number">2</span>] No such file <span class="keyword">or</span> directory: <span class="string">&#x27;ex&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 忽略所有异常</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">try</span>:</span><br><span class="line"><span class="meta">... </span>    f = <span class="built_in">open</span>(<span class="string">&quot;ex&quot;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line"><span class="meta">... </span><span class="keyword">except</span> Exception:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">try</span>:</span><br><span class="line"><span class="meta">... </span>    f = <span class="built_in">open</span>(<span class="string">&#x27;a.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line"><span class="meta">... </span><span class="keyword">except</span> IOError:</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(<span class="string">&#x27;file not found&#x27;</span>)</span><br><span class="line"><span class="meta">... </span><span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(<span class="string">&#x27;file opened&#x27;</span>)</span><br><span class="line"><span class="meta">... </span><span class="keyword">finally</span>:</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(<span class="string">&#x27;file handled&#x27;</span>)</span><br><span class="line">...</span><br><span class="line">file opened</span><br><span class="line">file handled</span><br></pre></td></tr></table></figure><h3 id="上下文管理协议"><a href="#上下文管理协议" class="headerlink" title="上下文管理协议"></a>上下文管理协议</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;a.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line"><span class="meta">... </span>    f.readlines()</span><br><span class="line">...</span><br><span class="line">[<span class="string">&#x27;foo\n&#x27;</span>, <span class="string">&#x27;bar\n&#x27;</span>]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>面试复习-Python-文件处理</title>
      <link href="/2024/08/29/%E9%9D%A2%E8%AF%95%E5%A4%8D%E4%B9%A0-Python-%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/"/>
      <url>/2024/08/29/%E9%9D%A2%E8%AF%95%E5%A4%8D%E4%B9%A0-Python-%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h3 id="open函数"><a href="#open函数" class="headerlink" title="open函数"></a>open函数</h3><p>在 Python 中，open()函数用于打开文件，并返回一个文件对象，通过这个文件对象可以对文件进行各种操作。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(file, mode=<span class="string">&#x27;r&#x27;</span>, buffering=-<span class="number">1</span>, encoding=<span class="literal">None</span>, errors=<span class="literal">None</span>, newline=<span class="literal">None</span>, closefd=<span class="literal">True</span>, opener=<span class="literal">None</span>)</span><br><span class="line">f.close()   </span><br></pre></td></tr></table></figure><ul><li>file：要打开的文件路径，可以是相对路径或绝对路径。</li><li>mode（可选）：打开文件的模式，默认为’r’（只读模式）。常见的模式有：<ul><li>‘r’：只读模式，文件必须存在。</li><li>‘w’：写入模式，如果文件存在则清空内容，如果文件不存在则创建新文件。</li><li>‘a’：追加模式，在文件末尾追加内容，如果文件不存在则创建新文件。</li><li>‘b’：二进制模式，可以与其他模式结合使用，如’rb’（二进制只读模式）、’wb’（二进制写入模式）。。</li><li>‘t’：文本模式（默认），可以与其他模式结合使用，如’rt’（文本只读模式）、’wt’（文本写入模式）。</li></ul></li><li>buffering（可选）：设置缓冲策略。默认为 - 1，表示使用系统默认的缓冲策略。</li><li>encoding（可选）：指定文件的编码方式，仅在文本模式下使用。例如’utf-8’。</li><li>errors（可选）：指定编码错误处理方式，仅在文本模式下使用。</li><li>newline（可选）：控制换行符的处理方式，仅在文本模式下使用。</li><li>closefd（可选）：如果为True（默认值），则文件描述符会在文件关闭时关闭；如果为False，则文件描述符在文件关闭时不会关闭，这在文件描述符来自于其他地方时很有用。</li><li>opener（可选）：一个自定义的打开文件的函数。</li></ul><h3 id="文件对象的常用属性与方法"><a href="#文件对象的常用属性与方法" class="headerlink" title="文件对象的常用属性与方法"></a>文件对象的常用属性与方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = <span class="built_in">open</span>(<span class="string">&quot;body.json&quot;</span>, <span class="string">&quot;r+&quot;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.read()</span><br><span class="line"><span class="string">&#x27;&#123;\n  &quot;type&quot;: &quot;markdown&quot;,\n  &quot;text&quot;: &quot;Hello &lt;@W7RR1LJ58&gt;&quot;\n&#125;\n&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.fileno()</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.isatty()</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.isatty()</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.readline()</span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.readline()</span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.seek(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.readline()</span><br><span class="line"><span class="string">&#x27;&#123;\n&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.readline()</span><br><span class="line"><span class="string">&#x27;  &quot;type&quot;: &quot;markdown&quot;,\n&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.readlines()</span><br><span class="line">[<span class="string">&#x27;  &quot;text&quot;: &quot;Hello &lt;@W7RR1LJ58&gt;&quot;\n&#x27;</span>, <span class="string">&#x27;&#125;\n&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.tell()</span><br><span class="line"><span class="number">57</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.seek(<span class="number">3</span>, <span class="number">0</span>)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.read()</span><br><span class="line"><span class="string">&#x27; &quot;type&quot;: &quot;markdown&quot;,\n  &quot;text&quot;: &quot;Hello &lt;@W7RR1LJ58&gt;&quot;\n&#125;\n&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.tell()</span><br><span class="line"><span class="number">57</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.seek(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.write(<span class="string">&quot;abcdefg&quot;</span>)</span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.tell()</span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.seek(<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.read(<span class="number">3</span>)</span><br><span class="line"><span class="string">&#x27;abc&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.tell()</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.truncate()</span><br><span class="line"><span class="number">57</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.seek(<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.read()</span><br><span class="line"><span class="string">&#x27;abcdefgpe&quot;: &quot;markdown&quot;,\n  &quot;text&quot;: &quot;Hello &lt;@W7RR1LJ58&gt;&quot;\n&#125;\n&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.closed</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.encoding</span><br><span class="line"><span class="string">&#x27;UTF-8&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.name</span><br><span class="line"><span class="string">&#x27;body.json&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.mode</span><br><span class="line"><span class="string">&#x27;r+&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.newlines</span><br><span class="line"><span class="string">&#x27;\n&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="os模块常用的文件系统操作函数"><a href="#os模块常用的文件系统操作函数" class="headerlink" title="os模块常用的文件系统操作函数"></a><code>os</code>模块常用的文件系统操作函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = <span class="built_in">open</span>(<span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.write(<span class="string">&#x27;foo\n&#x27;</span>)</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.write(<span class="string">&#x27;bar\n&#x27;</span>)</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.close()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cwd=os.getcwd()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.listdir(cwd)</span><br><span class="line">[<span class="string">&#x27;.envrc&#x27;</span>, <span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;.whitesource&#x27;</span>, <span class="string">&#x27;.gitignore&#x27;</span>, <span class="string">&#x27;ai&#x27;</span>, <span class="string">&#x27;vpc-bss-onboarding&#x27;</span>, <span class="string">&#x27;fabric_test&#x27;</span>, <span class="string">&#x27;.git&#x27;</span>, <span class="string">&#x27;.travis.yml&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.rename(<span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;a.txt&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.join(cwd, f.name)</span><br><span class="line"><span class="string">&#x27;/Users/senwang/tmp/test&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>面试复习-Python-流程控制</title>
      <link href="/2024/08/28/%E9%9D%A2%E8%AF%95%E5%A4%8D%E4%B9%A0-Python-%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/"/>
      <url>/2024/08/28/%E9%9D%A2%E8%AF%95%E5%A4%8D%E4%B9%A0-Python-%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<h3 id="分支语句"><a href="#分支语句" class="headerlink" title="分支语句"></a>分支语句</h3><ul><li><code>if-elif-else</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>string = <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>string_len = <span class="built_in">len</span>(string)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">if</span> string_len &gt; <span class="number">10</span>:</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(<span class="string">&quot;too long&quot;</span>)</span><br><span class="line"><span class="meta">... </span><span class="keyword">elif</span> <span class="number">2</span> &lt; string_len &lt; <span class="number">5</span>:</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(<span class="string">&quot;okay&quot;</span>)</span><br><span class="line"><span class="meta">... </span><span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(<span class="string">&quot;too short&quot;</span>)</span><br><span class="line">...</span><br><span class="line">too long</span><br></pre></td></tr></table></figure><ul><li>三目运算 <code>too_long = True if len(string) &gt; 10 else False</code></li></ul><h3 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h3><ul><li><p><code>for-in</code></p></li><li><p><code>while</code></p></li><li><p><code>break</code></p></li><li><p><code>continue</code></p></li><li><p><code>else</code>: 循环语句中的else在循环顺利完成后执行，即没有被<code>break</code></p></li></ul><h3 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h3><p>在 Python 中，迭代器是一种实现了迭代器协议的对象。迭代器协议包括两个方法：<code>__iter__()</code> 和 <code>__next__()</code>。</p><ul><li>工作原理</li></ul><p>可迭代对象（如列表、元组、字符串等）通过 <code>__iter__()</code> 方法返回一个迭代器对象。迭代器对象的 <code>__next__()</code> 方法用于逐个返回可迭代对象中的元素，当没有更多元素可返回时，会抛出 <code>StopIteration</code> 异常。</p><ul><li>优点</li></ul><p>节省内存：迭代器可以在需要的时候逐个生成元素，而不是一次性将所有元素加载到内存中。例如，对于一个非常大的文件或数据集合，使用迭代器可以避免内存溢出。实现懒加载：可以在实际需要的时候才计算和返回结果，提高程序的性能。</p><ul><li><p>顺序类型可以通过<code>iter()</code>返回一个迭代器对象</p></li><li><p>字典可以按照其key来迭代：<code>for eachKey in dict</code></p></li><li><p>文件可以按行来迭代：<code>for eachLine in file</code></p></li><li><p>需要避免在迭代可变类型时修改该类型</p></li><li><p>示例</p></li></ul><p>以下是一个简单的迭代器示例：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyIterator</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        self.data = data</span><br><span class="line">        self.index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> self.index &lt; <span class="built_in">len</span>(self.data):</span><br><span class="line">            result = self.data[self.index]</span><br><span class="line">            self.index += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line"></span><br><span class="line">my_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">my_iterator = MyIterator(my_list)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> my_iterator:</span><br><span class="line">    <span class="built_in">print</span>(item)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="列表解析"><a href="#列表解析" class="headerlink" title="列表解析"></a>列表解析</h3><ul><li><code>[expr for iter_var in iterable]</code></li><li><code>[expr for iter_var in iterable if condition]</code></li><li><code>[(x+1, y+1) for x in range(3) for y in range(5)]</code></li><li><code>[word for line in file for word in line.split()]</code></li></ul><h3 id="生成器表达式"><a href="#生成器表达式" class="headerlink" title="生成器表达式"></a>生成器表达式</h3><p>列表解析会立即生成一个完整的列表，并将其存储在内存中。如果处理的数据量很大，可能会占用大量内存。例如，<code>[x**2 for x in range(1000000)]</code>会创建一个包含一百万个元素的列表，占用较多内存。</p><p>生成器表达式返回一个生成器对象，它是一个可迭代对象，但不会立即生成所有的值，而是在需要的时候逐个生成值。这样可以节省内存，特别是处理大量数据时非常有用。例如，<code>(x**2 for x in range(1000000))</code>返回的生成器对象在迭代时才会逐个计算平方值，不会一次性占用大量内存。</p><ul><li><code>(expr for iter_var in iterable)</code></li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>面试复习-Python-数据类型</title>
      <link href="/2024/08/27/%E9%9D%A2%E8%AF%95%E5%A4%8D%E4%B9%A0-Python-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"/>
      <url>/2024/08/27/%E9%9D%A2%E8%AF%95%E5%A4%8D%E4%B9%A0-Python-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p>Python 是一种高级编程语言，具有丰富的数据类型。了解这些数据类型对于有效地编写 Python 代码至关重要。以下是对 Python 主要数据类型的详细介绍。</p><p>Python使用对象模型来存储数据，一个python对象通常包含ID，Type, Value。 </p><h3 id="Python数据类型的分类"><a href="#Python数据类型的分类" class="headerlink" title="Python数据类型的分类"></a>Python数据类型的分类</h3><p>标准类型：</p><ul><li>数字</li><li>整型</li><li>长整型</li><li>浮点型</li><li>复数</li><li>布尔型</li><li>字符串</li><li>列表 (可变)</li><li>元组</li><li>字典 (可变)</li></ul><p>其他内置数据类型：</p><ul><li>类型</li><li>None</li><li>文件</li><li>集合</li><li>函数</li><li>模块</li><li>类</li></ul><p>布尔值为False的对象： <code>None, False, 0, 0.0, 0L, 0.0+0.0j, &quot;&quot;, [], (), &#123;&#125;</code> (JS中<code>[], &#123;&#125;</code>转换成布尔值后为true)</p><h3 id="标准类型的操作符"><a href="#标准类型的操作符" class="headerlink" title="标准类型的操作符"></a>标准类型的操作符</h3><ol><li>数值比较操作符有： <code>&lt; &gt; &lt;= &gt;= == != &lt;&gt;</code></li><li>ID比较: <code>is</code> 和 <code>is not</code></li><li>逻辑运算: <code>and or not</code></li><li>用于标准类型的内置函数: <code>type(o) repr(o) str(o) isinstance(o, O) id(o)</code></li></ol><h3 id="序列类型操作符"><a href="#序列类型操作符" class="headerlink" title="序列类型操作符"></a>序列类型操作符</h3><p>字符串、元组和列表为序列类型，序列类型的操作符如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>string = <span class="string">&quot;hello world&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>string[<span class="number">2</span>]</span><br><span class="line"><span class="string">&#x27;l&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>string[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line"><span class="string">&#x27;llo&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>string[<span class="number">2</span>:<span class="number">5</span>:<span class="number">2</span>]</span><br><span class="line"><span class="string">&#x27;lo&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>string*<span class="number">2</span></span><br><span class="line"><span class="string">&#x27;hello worldhello world&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>string + string</span><br><span class="line"><span class="string">&#x27;hello worldhello world&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&quot;l&quot;</span> <span class="keyword">in</span> string</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&quot;l&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> string</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure><h3 id="操作序列类型的内建函数"><a href="#操作序列类型的内建函数" class="headerlink" title="操作序列类型的内建函数"></a>操作序列类型的内建函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(string):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(i,v)</span><br><span class="line">...</span><br><span class="line"><span class="number">0</span> h</span><br><span class="line"><span class="number">1</span> e</span><br><span class="line"><span class="number">2</span> l</span><br><span class="line"><span class="number">3</span> l</span><br><span class="line"><span class="number">4</span> o</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">6</span> w</span><br><span class="line"><span class="number">7</span> o</span><br><span class="line"><span class="number">8</span> r</span><br><span class="line"><span class="number">9</span> l</span><br><span class="line"><span class="number">10</span> d</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(string)</span><br><span class="line"><span class="number">11</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">max</span>(string)</span><br><span class="line"><span class="string">&#x27;w&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">min</span>(string)</span><br><span class="line"><span class="string">&#x27; &#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> v <span class="keyword">in</span> <span class="built_in">reversed</span>(string):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(v)</span><br><span class="line">...</span><br><span class="line">d</span><br><span class="line">l</span><br><span class="line">r</span><br><span class="line">o</span><br><span class="line">w</span><br><span class="line"></span><br><span class="line">o</span><br><span class="line">l</span><br><span class="line">l</span><br><span class="line">e</span><br><span class="line">h</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">sorted</span>(string)</span><br><span class="line">[<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;w&#x27;</span>]</span><br><span class="line">ValueError: <span class="keyword">not</span> enough values to unpack (expected <span class="number">2</span>, got <span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> v <span class="keyword">in</span> <span class="built_in">zip</span>(string):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(v)</span><br><span class="line">...</span><br><span class="line">(<span class="string">&#x27;h&#x27;</span>,)</span><br><span class="line">(<span class="string">&#x27;e&#x27;</span>,)</span><br><span class="line">(<span class="string">&#x27;l&#x27;</span>,)</span><br><span class="line">(<span class="string">&#x27;l&#x27;</span>,)</span><br><span class="line">(<span class="string">&#x27;o&#x27;</span>,)</span><br><span class="line">(<span class="string">&#x27; &#x27;</span>,)</span><br><span class="line">(<span class="string">&#x27;w&#x27;</span>,)</span><br><span class="line">(<span class="string">&#x27;o&#x27;</span>,)</span><br><span class="line">(<span class="string">&#x27;r&#x27;</span>,)</span><br><span class="line">(<span class="string">&#x27;l&#x27;</span>,)</span><br><span class="line">(<span class="string">&#x27;d&#x27;</span>,)</span><br></pre></td></tr></table></figure><h3 id="数字"><a href="#数字" class="headerlink" title="数字"></a>数字</h3><ul><li>整型： 最大取值取决于机器字长</li><li>长整型：最大取值取决于虚拟内存的大小</li><li>强制类型转换：整形-&gt;浮点型-&gt;复数-&gt;长整型</li><li>操作符：<code>/ // % **</code></li><li>整型的位运算符：<code>~ &lt;&lt; &gt;&gt; &amp; ^ |</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数字类型的操作函数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">bool</span>(<span class="number">5</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">bool</span>(<span class="number">0</span>)</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="number">5.0</span>)</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="string">&#x27;01101&#x27;</span>, <span class="number">2</span>)</span><br><span class="line"><span class="number">13</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">float</span>(<span class="string">&#x27;5.0&#x27;</span>)</span><br><span class="line"><span class="number">5.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">float</span>(<span class="number">5</span>)</span><br><span class="line"><span class="number">5.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">complex</span>(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">(<span class="number">1</span>+<span class="number">2j</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">complex</span>(<span class="string">&#x27;1+2j&#x27;</span>)</span><br><span class="line">(<span class="number">1</span>+<span class="number">2j</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">pow</span>(<span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">pow</span>(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">pow</span>(<span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">round</span>(<span class="number">5.354</span>, <span class="number">2</span>)</span><br><span class="line"><span class="number">5.35</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">round</span>(<span class="number">5.3</span>)</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">round</span>(<span class="number">5.6</span>)</span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">round</span>(<span class="number">5.254</span>, <span class="number">1</span>)</span><br><span class="line"><span class="number">5.3</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 整型的操作函数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(<span class="number">255</span>)</span><br><span class="line"><span class="string">&#x27;0xff&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">oct</span>(<span class="number">255</span>)</span><br><span class="line"><span class="string">&#x27;0o377&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">chr</span>(<span class="number">46</span>)</span><br><span class="line"><span class="string">&#x27;.&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">ord</span>(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line"><span class="number">46</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0.3</span> == <span class="number">3</span> * <span class="number">0.1</span> <span class="comment">#规避浮点数二进制表示除不尽的问题</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0.3</span> - <span class="number">3</span> * <span class="number">0.1</span> &lt; <span class="number">0.00001</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><h4 id="格式化字符串"><a href="#格式化字符串" class="headerlink" title="格式化字符串"></a>格式化字符串</h4><p>在 Python 中有多种方法格式化字符串，以下是一些主要的方式：</p><ul><li>使用百分号（%）格式化</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name = <span class="string">&quot;Alice&quot;</span></span><br><span class="line">age = <span class="number">25</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;My name is %s and I am %d years old.&quot;</span> % (name, age))</span><br></pre></td></tr></table></figure><p>其中 %s 表示字符串占位符，%d 表示整数占位符。</p><ul><li>使用 .format() 方法</li></ul><p>位置参数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;My name is &#123;&#125; and I am &#123;&#125; years old.&quot;</span>.<span class="built_in">format</span>(name, age))</span><br></pre></td></tr></table></figure><p>关键字参数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;My name is &#123;n&#125; and I am &#123;a&#125; years old.&quot;</span>.<span class="built_in">format</span>(n=name, a=age))</span><br></pre></td></tr></table></figure><p>索引参数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;My name is &#123;0&#125; and I am &#123;1&#125; years old.&quot;</span>.<span class="built_in">format</span>(name, age))</span><br></pre></td></tr></table></figure><ul><li>使用 f-strings（Python 3.6 及以上版本）</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;My name is <span class="subst">&#123;name&#125;</span> and I am <span class="subst">&#123;age&#125;</span> years old.&quot;</span>)</span><br></pre></td></tr></table></figure><p>f-strings 非常直观和简洁，可以在字符串中直接嵌入变量和表达式。<br>此外，还可以在格式化字符串中指定格式规范，例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pi = <span class="number">3.1415926</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Pi is approximately <span class="subst">&#123;pi:<span class="number">.2</span>f&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><p>这里 .2f 表示将 pi 格式化为保留两位小数的浮点数。</p><h4 id="字符串对象常用的方法"><a href="#字符串对象常用的方法" class="headerlink" title="字符串对象常用的方法"></a>字符串对象常用的方法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>string = <span class="string">&quot;hello world!&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>string.find(<span class="string">&quot;ll&quot;</span>, <span class="number">0</span>, <span class="built_in">len</span>(string))</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>string.index(<span class="string">&quot;iam&quot;</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">ValueError: substring <span class="keyword">not</span> found</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>string.find(<span class="string">&quot;iam&quot;</span>)</span><br><span class="line">-<span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&quot;:&quot;</span>.join([<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>])</span><br><span class="line"><span class="string">&#x27;key:value&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&quot; hello &quot;</span>.lstrip()</span><br><span class="line"><span class="string">&#x27;hello &#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&quot; hello &quot;</span>.rstrip()</span><br><span class="line"><span class="string">&#x27; hello&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&quot; hello &quot;</span>.strip()</span><br><span class="line"><span class="string">&#x27;hello&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h3><h4 id="列表对象的常用方法"><a href="#列表对象的常用方法" class="headerlink" title="列表对象的常用方法"></a>列表对象的常用方法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>mylist = []</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mylist.append(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mylist</span><br><span class="line">[<span class="string">&#x27;hello&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mylist.extend([<span class="string">&quot;world&quot;</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mylist</span><br><span class="line">[<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;world&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mylist.insert(<span class="number">1</span>, <span class="literal">True</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mylist</span><br><span class="line">[<span class="string">&#x27;hello&#x27;</span>, <span class="literal">True</span>, <span class="string">&#x27;world&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mylist.pop()</span><br><span class="line"><span class="string">&#x27;world&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mylist</span><br><span class="line">[<span class="string">&#x27;hello&#x27;</span>, <span class="literal">True</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mylist.reverse()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mylist</span><br><span class="line">[<span class="literal">True</span>, <span class="string">&#x27;hello&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mylist.remove(<span class="literal">True</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mylist</span><br><span class="line">[<span class="string">&#x27;hello&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mylist.extend([<span class="string">&quot;world&quot;</span>, <span class="number">1</span>, <span class="number">0</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mylist</span><br><span class="line">[<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;world&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mylist.remove(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mylist.remove(<span class="string">&quot;world&quot;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mylist.sort()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mylist</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>]</span><br></pre></td></tr></table></figure><h3 id="python对象的浅拷贝与深拷贝"><a href="#python对象的浅拷贝与深拷贝" class="headerlink" title="python对象的浅拷贝与深拷贝"></a>python对象的浅拷贝与深拷贝</h3><p>在 Python 中，对象的浅拷贝（shallow copy）和深拷贝（deep copy）是两种不同的复制方式。</p><h4 id="浅拷贝"><a href="#浅拷贝" class="headerlink" title="浅拷贝"></a>浅拷贝</h4><p>创建一个新的对象，但是新对象中的元素是原对象中元素的引用。这意味着如果原对象中的可变对象（如列表、字典等）发生改变，浅拷贝得到的新对象中的对应元素也会改变。使用方法如下：</p><ul><li>使用切片操作进行浅拷贝，例如 new_list = old_list[:]。</li><li>使用 copy 模块的 copy() 函数，例如 import copy，然后 new_list = copy.copy(old_list)。<br>示例：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>mylist = [<span class="number">1</span>, [<span class="number">2</span>, <span class="number">3</span>], <span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>yourlist = mylist[:]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mylist[<span class="number">1</span>][<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mylist</span><br><span class="line">[<span class="number">1</span>, [<span class="number">3</span>, <span class="number">3</span>], <span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>yourlist</span><br><span class="line">[<span class="number">1</span>, [<span class="number">3</span>, <span class="number">3</span>], <span class="number">4</span>]</span><br></pre></td></tr></table></figure></li></ul><h4 id="深拷贝"><a href="#深拷贝" class="headerlink" title="深拷贝"></a>深拷贝</h4><p>创建一个新的对象，并且新对象中的元素与原对象中的元素完全独立，不是引用关系。这意味着无论原对象中的可变对象如何改变，深拷贝得到的新对象都不会受到影响。<br>使用 <code>copy</code> 模块的 <code>deepcopy()</code> 函数，例如 <code>import copy</code>，然后 <code>new_list = copy.deepcopy(old_list)</code><br>示例：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>mylist = [<span class="number">1</span>, [<span class="number">2</span>, <span class="number">3</span>], <span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> copy</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>yourlist = copy.deepcopy(mylist)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mylist[<span class="number">1</span>][<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>yourlist</span><br><span class="line">[<span class="number">1</span>, [<span class="number">2</span>, <span class="number">3</span>], <span class="number">4</span>]</span><br></pre></td></tr></table></figure><h3 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h3><ul><li><code>in, not in</code> 可以查询key是不是在字典中</li></ul><h4 id="字典的常用内建方法"><a href="#字典的常用内建方法" class="headerlink" title="字典的常用内建方法"></a>字典的常用内建方法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>profile = &#123;</span><br><span class="line"><span class="meta">... </span>    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Sen&quot;</span>,</span><br><span class="line"><span class="meta">... </span>    <span class="string">&quot;age&quot;</span>: <span class="number">18</span>,</span><br><span class="line"><span class="meta">... </span>    <span class="string">&quot;sex&quot;</span>: <span class="string">&quot;male&quot;</span></span><br><span class="line"><span class="meta">... </span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>profile.keys()</span><br><span class="line">dict_keys([<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;sex&#x27;</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>profile.values()</span><br><span class="line">dict_values([<span class="string">&#x27;Sen&#x27;</span>, <span class="number">18</span>, <span class="string">&#x27;male&#x27;</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>profile.items()</span><br><span class="line">dict_items([(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;Sen&#x27;</span>), (<span class="string">&#x27;age&#x27;</span>, <span class="number">18</span>), (<span class="string">&#x27;sex&#x27;</span>, <span class="string">&#x27;male&#x27;</span>)])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>profile.get(<span class="string">&#x27;phone&#x27;</span>, <span class="string">&quot;10086&quot;</span>)</span><br><span class="line"><span class="string">&#x27;10086&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>profile.get(<span class="string">&#x27;phone&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>profile[<span class="string">&#x27;phone&#x27;</span>]</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">KeyError: <span class="string">&#x27;phone&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>profile.pop(<span class="string">&quot;age&quot;</span>)</span><br><span class="line"><span class="number">18</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>profile</span><br><span class="line">&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Sen&#x27;</span>, <span class="string">&#x27;sex&#x27;</span>: <span class="string">&#x27;male&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>profile.update(&#123;<span class="string">&quot;age&quot;</span>: <span class="number">18</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>profile</span><br><span class="line">&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Sen&#x27;</span>, <span class="string">&#x27;sex&#x27;</span>: <span class="string">&#x27;male&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">18</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h3><h4 id="集合类型的常用操作符"><a href="#集合类型的常用操作符" class="headerlink" title="集合类型的常用操作符"></a>集合类型的常用操作符</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">all</span> = <span class="built_in">set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd = <span class="built_in">set</span>([<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">9</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>even = <span class="built_in">set</span>([<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">10</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd <span class="keyword">in</span> <span class="built_in">all</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">all</span></span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd</span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">3</span> <span class="keyword">in</span> <span class="built_in">all</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd &lt; <span class="built_in">all</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd &lt;= <span class="built_in">all</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd != <span class="built_in">all</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd &amp; <span class="built_in">all</span></span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd &amp; even</span><br><span class="line"><span class="built_in">set</span>()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd | even == <span class="built_in">all</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd | even</span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">all</span> - odd == even</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd ^ even</span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd ^ odd</span><br><span class="line"><span class="built_in">set</span>()</span><br></pre></td></tr></table></figure><h4 id="集合类型的常用方法"><a href="#集合类型的常用方法" class="headerlink" title="集合类型的常用方法"></a>集合类型的常用方法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd.update(even)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd == <span class="built_in">all</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd = <span class="built_in">all</span> - even</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd</span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd.add(<span class="number">11</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd</span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd.discard(<span class="number">12</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd</span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd.pop()</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd.clear()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd</span><br><span class="line"><span class="built_in">set</span>()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AI-数学基础之线性代数【草稿】</title>
      <link href="/2024/08/23/AI-%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80%E4%B9%8B%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/"/>
      <url>/2024/08/23/AI-%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80%E4%B9%8B%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h3 id="线性方程组"><a href="#线性方程组" class="headerlink" title="线性方程组"></a>线性方程组</h3><p>\begin{cases}<br>c_{11}x_1 + c_{12}x_2 +\cdots + c_{1n}x_n = d_1\\<br>c_{21}x_1 + c_{22}x_2 +\cdots + c_{2n}x_n = d_2\\<br>\vdots\\<br>c_{m1}x_1 + c_{m2}x_2 +\cdots + c_{mn}x_n = d_m<br>\end{cases}</p><h4 id="用矩阵表示线性方程组"><a href="#用矩阵表示线性方程组" class="headerlink" title="用矩阵表示线性方程组"></a>用矩阵表示线性方程组</h4><ul><li>系数矩阵：去掉未知数和常数形成的矩阵<br>\begin{pmatrix}<br>c_{11} &amp; c_{12} &amp;\cdots &amp; c_{1n}\\<br>c_{21} &amp; c_{22} &amp;\cdots &amp; c_{2n}\\<br>\vdots &amp;\vdots &amp;\ddots &amp;\vdots\\<br>c_{m1} &amp; c_{m2} &amp;\cdots &amp; c_{mn}<br>\end{pmatrix}</li><li>增广矩阵：系数矩阵加上常数<br>\begin{pmatrix}<br>c_{11} &amp; c_{12} &amp;\cdots &amp; c_{1n} &amp;\vert&amp; d_1\\<br>c_{21} &amp; c_{22} &amp;\cdots &amp; c_{2n} &amp;\vert&amp; d_2\\<br>\vdots &amp;\vdots &amp;\ddots &amp;\vdots &amp;\vert&amp;\vdots\\<br>c_{m1} &amp; c_{m2} &amp;\cdots &amp; c_{mn} &amp;\vert&amp; d_m<br>\end{pmatrix}</li></ul><h4 id="高斯消元法解线性方程组"><a href="#高斯消元法解线性方程组" class="headerlink" title="高斯消元法解线性方程组"></a>高斯消元法解线性方程组</h4><p>矩阵的初等变换</p><ul><li>互换: 行互换 $R_{ij}$，列互换 $C_{ij}$</li><li>倍乘: 用一个不为0的常数c乘以一个方程。 $cR_{i}$</li><li>倍加: 将第i个方程倍乘后加到第j个方程。 $R_{j} + cR_{i}$</li></ul><p>求解步骤</p><ol><li>利用初等变换将矩阵转化为阶梯矩阵<br>\begin{pmatrix}<br>c_{11} &amp; c_{12} &amp;\cdots &amp; c_{1n} &amp;\vert&amp; d_1\\<br>0 &amp; c_{22} &amp;\cdots &amp; c_{2n} &amp;\vert&amp; d_2\\<br>\vdots &amp;\vdots &amp;\ddots &amp;\vdots &amp;\vert&amp;\vdots\\<br>0 &amp; 0 &amp;\cdots &amp; c_{rr} &amp;\vert&amp; d_r\\<br>0 &amp; 0 &amp;\cdots &amp; 0 &amp;\vert&amp; 0\\<br>\vdots &amp;\vdots &amp;\ddots &amp;\vdots &amp;\vert&amp;\vdots\\<br>0 &amp; 0 &amp;\cdots &amp; 0 &amp;\vert&amp; 0<br>\end{pmatrix}</li></ol><p>r为矩阵的秩</p><ul><li>r = n, 则线性方程组有唯一解</li><li>r &lt; n, 则线性方程组有无数个解</li><li>$d_{r+1}$ != 0, 则线性方程组没有解</li></ul><ol start="2"><li>利用初等变换将阶梯头变成1，然后令没有阶梯头的未知数等于$t_{1…}$， $t_{i}为任意数，通过移项则可得出所有未知数的解</li></ol><p>举个例子：</p><p>对于线性方程组  ：</p><p>\begin{cases}<br>x_1 + 2x_2 + 3x_3 + 4x_4 + 5x_5 = 8 \\<br>2x_1 + 4x_2 + 6x_3 + 8x_4 + 10x_5 = 16 \\<br>3x_1 + 6x_2 + 9x_3 + 12x_4 + 15x_5 = 24 \\<br>x_1 + x_2 + x_3 + x_4 + x_5 = 3 \\<br>2x_1 + 3x_2 + 4x_3 + 5x_4 + 6x_5 = 11<br>\end{cases}</p><p>对应的增广矩阵为：</p><p>\begin{pmatrix}<br>1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp;\vert&amp; 8\\<br>2 &amp; 4 &amp; 6 &amp; 8 &amp; 10 &amp;\vert&amp; 16\\<br>3 &amp; 6 &amp; 9 &amp; 12 &amp; 15 &amp;\vert&amp; 24\\<br>1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp;\vert&amp; 3\\<br>2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 &amp;\vert&amp; 11<br>\end{pmatrix}</p><p>第一步：$R_{2}-2R_{1}$, $R_{3}-3R_{1}$, $R_{4}-R_{1}$, $R_{5}-2R_{1}$</p><p>\begin{pmatrix}<br>1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp;\vert&amp; 8\\<br>0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp;\vert&amp; 0\\<br>0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp;\vert&amp; 0\\<br>0 &amp; -1 &amp; -2 &amp; -3 &amp; -4 &amp;\vert&amp; -5\\<br>0 &amp; -1 &amp; -2 &amp; -3 &amp; -4 &amp;\vert&amp; -5<br>\end{pmatrix}</p><p>第二步：$R_{5}-R_{4}$</p><p>\begin{pmatrix}<br>1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp;\vert&amp; 8\\<br>0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp;\vert&amp; 0\\<br>0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp;\vert&amp; 0\\<br>0 &amp; -1 &amp; -2 &amp; -3 &amp; -4 &amp;\vert&amp; -5\\<br>0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp;\vert&amp; 0<br>\end{pmatrix}</p><p>第三步：${R_{24}}$</p><p>\begin{pmatrix}<br>1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp;\vert&amp; 8\\<br>0 &amp; -1 &amp; -2 &amp; -3 &amp; -4 &amp;\vert&amp; -5\\<br>0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp;\vert&amp; 0\\<br>0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp;\vert&amp; 0\\<br>0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp;\vert&amp; 0<br>\end{pmatrix}</p><p>矩阵的秩为2 &lt; 5, 且$d_{3}$ = 0, 所以矩阵有无数个解。</p><p>第四步，$-{R_{2}}$, $R_1-2R_2$</p><p>\begin{pmatrix}<br>1 &amp; 0 &amp; -1 &amp; -2 &amp; -3 &amp;\vert&amp; -2\\<br>0 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp;\vert&amp; 5\\<br>0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp;\vert&amp; 0\\<br>0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp;\vert&amp; 0\\<br>0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp;\vert&amp; 0<br>\end{pmatrix}</p><p>第五步，另$x_3$ = $t_1$, $x_4$ = $t_2$, $x_5$ = $t_3$, t为任意数，则可以得到方程的解为<br>\begin{pmatrix}<br>x_1=-2+t_1+2t_2+3t_3 \\<br>x_2=5-2t_1-3t_2-4t_3 \\<br>x_3=t_1 \\<br>x_4=t_2 \\<br>x_5=t_3 \\<br>\end{pmatrix}</p>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AI: 发展历程、现状与基本概念</title>
      <link href="/2024/06/18/AI-%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E3%80%81%E7%8E%B0%E7%8A%B6%E4%B8%8E%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/"/>
      <url>/2024/06/18/AI-%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E3%80%81%E7%8E%B0%E7%8A%B6%E4%B8%8E%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/</url>
      
        <content type="html"><![CDATA[<h3 id="AI是什么？"><a href="#AI是什么？" class="headerlink" title="AI是什么？"></a>AI是什么？</h3><p>AI（人工智能）是一门研究、开发用于模拟、延伸和扩展人的智能的技术科学。</p><p>它具有以下几个关键特点：</p><ul><li>学习能力：能够从大量的数据中自动学习模式、规律和知识。通过机器学习算法，AI 可以对数据进行分析和理解，不断提升自身的性能和能力。</li><li>智能表现：可以展现出类似人类智能的某些方面，比如感知、认知、决策、推理等。例如，图像识别、语音识别、自然语言处理等都是 AI 智能表现的具体体现。</li><li>适应性：能够根据不同的环境和任务进行调整和适应。它可以在新的情境中运用已学到的知识和技能，以更好地完成任务。</li><li>自主性：在一定程度上可以自主地进行操作和决策，而无需持续的人类干预。</li><li>广泛的应用领域：涵盖了医疗、交通、金融、教育、制造业等众多行业。比如在医疗领域辅助疾病诊断，在交通领域实现自动驾驶等。</li></ul><p>从实现方式来看，AI 包含多种技术，如机器学习（包括监督学习、无监督学习等）、深度学习（利用深度神经网络）、自然语言处理、计算机视觉、智能机器人技术等。</p><p>AI 的目标是创造出能够像人类一样思考、学习和行动的智能系统，以帮助人类解决各种复杂的问题，提高工作效率和生活质量。然而，随着 AI 的发展，也带来了一些挑战和问题，如伦理道德、数据隐私、就业结构变化等，这些都需要我们在发展和应用 AI 的过程中认真思考和应对。</p><h3 id="AI的发展历程"><a href="#AI的发展历程" class="headerlink" title="AI的发展历程"></a>AI的发展历程</h3><p>人工智能的发展历程可以追溯到上世纪50年代，以下是其发展的主要阶段：</p><ul><li>起步发展期（1956年-20世纪60年代初）：<strong>1956年夏</strong>，麦卡锡、明斯基等科学家在美国<strong>达特茅斯学院</strong>开会研讨“如何用机器模拟人的智能”，首次提出“人工智能（Artificial Intelligence，简称AI）”这一概念，<strong>标志着人工智能学科的诞生</strong>。在这一阶段，人工智能取得了一些令人瞩目的研究成果，如机器定理证明、跳棋程序等，掀起了人工智能发展的第一个高潮。</li><li>反思发展期（20世纪60年代-70年代初）：在人工智能发展的初期，人们对其期望过高，提出了一些不切实际的研发目标。然而，由于技术限制和实际应用中的困难，这些目标未能实现，导致人工智能的发展走入低谷。</li><li>应用发展期（20世纪70年代初-80年代中）：20世纪70年代出现的专家系统模拟人类专家的知识和经验解决特定领域的问题，实现了人工智能从理论研究走向实际应用、从一般推理策略探讨转向运用专门知识的重大突破。专家系统在医疗、化学、地质等领域取得成功，推动人工智能走入应用发展的新高潮。</li><li>低迷发展期（20世纪80年代中-90年代中）：随着人工智能应用规模的不断扩大，专家系统存在的应用领域狭窄、缺乏常识性知识、知识获取困难、推理方法单一、缺乏分布式功能、难以与现有数据库兼容等问题逐渐暴露出来。</li><li>稳步发展期（20世纪90年代中-2010年）：由于网络技术特别是互联网技术的发展，加速了人工智能的创新研究，促使人工智能技术进一步走向实用化。1997年国际商业机器公司（简称IBM）深蓝超级计算机战胜了国际象棋世界冠军卡斯帕罗夫，2008年IBM提出“智慧地球”的概念，这些都是这一时期的标志性事件。</li><li>蓬勃发展期（2011年至今）：随着大数据、云计算、互联网、物联网等信息技术的发展，泛在感知数据和图形处理器等计算平台推动以深度神经网络为代表的人工智能技术飞速发展，大幅跨越了科学与应用之间的“技术鸿沟”，诸如图像分类、语音识别、知识问答、人机对弈、无人驾驶等人工智能技术实现了从“不能用、不好用”到“可以用”的技术突破，迎来爆发式增长的新高潮。</li></ul><p>当前，人工智能的发展现状如下：</p><ul><li>专用人工智能取得重要突破：面向特定任务的专用人工智能系统由于任务单一、需求明确、应用边界清晰、领域知识丰富、建模相对简单，形成了人工智能领域的单点突破，在局部智能水平的单项测试中可以超越人类智能。</li><li>通用人工智能尚处于起步阶段：真正意义上完备的人工智能系统应该是一个通用的智能系统，能举一反三、融会贯通，可处理视觉、听觉、判断、推理、学习、思考、规划、设计等各类问题。目前，虽然专用人工智能领域已取得突破性进展，但是通用人工智能领域的研究与应用仍然任重而道远，人工智能总体发展水平仍处于起步阶段。</li></ul><h3 id="AI发展的重大事件"><a href="#AI发展的重大事件" class="headerlink" title="AI发展的重大事件"></a>AI发展的重大事件</h3><ul><li>1943年：沃伦·麦卡洛克(Warren McCulloch) 和 沃尔特·皮茨(Walter Pitts) 提出了神经网络的概念及MCP模型，为人工智能的发展奠定了基础。</li><li>1955年：<strong>人工智能之父约翰·麦卡锡(John McCarthy)</strong> 等人提交了一份提案，第一次提出了“人工智能”的概念。</li><li>1956年：达特茅斯会议召开，标志着人工智能的正式诞生。</li><li>1969年：反向传播算法（BACKPROP）出现，这是一种重要的神经网络训练算法。</li><li>1986年：德国联邦国防军大学的研究人员在一辆面包车上安装了摄像头和智能传感器，实现了自动驾驶。</li><li>1997年：IBM 的“深蓝”超级计算机战胜国际象棋冠军 Garry Kasparov，展示了人工智能在复杂游戏中的能力。</li><li>2011年：IBM 的人工智能“沃森”在智力竞赛节目“Jeopardy”中击败了人类对手，证明了人工智能在知识问答方面的能力。</li><li>2012年：谷歌研究人员通过深度学习算法训练的神经网络能够识别猫科动物，展示了人工智能在图像识别领域的突破。</li><li>2016年：谷歌的 AlphaGo 战胜了围棋世界冠军李世石，引起了全球对人工智能的关注。</li></ul><h3 id="AI的基本概念"><a href="#AI的基本概念" class="headerlink" title="AI的基本概念"></a>AI的基本概念</h3><h4 id="人工神经网络-Artificial-Neuron-Network"><a href="#人工神经网络-Artificial-Neuron-Network" class="headerlink" title="人工神经网络(Artificial Neuron Network)"></a>人工神经网络(Artificial Neuron Network)</h4><p>人工神经网络是一种模仿生物神经网络的结构和功能的数学模型或计算模型。通俗来讲，ANN是一个计算机系统，通过模拟生物神经网络的决策过程，把输入转化为输出。</p><p>单个神经元的决策过程：</p><p>$\hat{y}$ = $\phi$($\sum_{i=1}^{n} x_i w_i$ + b)</p><p>$x_i$ 为输入数据，而 $w_i$ 则是其对应的权重(weight)。求和之后函数为一个连续函数，激活函数(activation function) $\phi$ 则是用来对求和之后的结果做出决策。</p><img src="/images/ann.png" width="500px" /><p>在多层模型中，上一层的输出将作为下一层的输入传入下一层中。</p><h4 id="机器学习、深度学习、基础模型及大语言模型"><a href="#机器学习、深度学习、基础模型及大语言模型" class="headerlink" title="机器学习、深度学习、基础模型及大语言模型"></a>机器学习、深度学习、基础模型及大语言模型</h4><img src="/images/ai_relation.png" width="500px" /><p>机器学习是一个广泛的领域，旨在让计算机通过数据学习和获取知识、模式以及进行预测和决策等。深度学习是机器学习的一个重要分支和延伸。深度学习则特别强调使用多层神经网络结构来进行学习。它利用大量的数据和强大的计算能力，通过自动学习特征表示来处理复杂任务。</p><p>具体关系可以从以下几点来看：</p><ul><li>深度学习是机器学习的一种先进技术，继承了机器学习的基本理念和方法。</li><li>机器学习包含了多种不同的算法和技术，而深度学习在处理图像、语音、自然语言等复杂数据方面表现出强大的能力，是机器学习在这些领域的重要拓展。</li><li>深度学习的发展进一步推动了机器学习的进步，拓展了其应用范围和效果。</li></ul><p>例如，在图像识别任务中，传统机器学习可能需要人工设计特征，而深度学习可以自动从大量图像数据中学习到有效的特征表示，从而实现更准确的识别。</p><p>在基础模型出现之前，通常是一个模型只完成一种特定的任务，而基础模型则可以训练多种类型的数据，根据需求来完成各种各样的任务。</p><img src="/images/fundation_model.png" width="500px" /><p>大语言模型是一种基于深度学习技术的大型语言处理模型，是基础模型的一种。</p><p>它具有以下特点：</p><ul><li>大规模数据训练：通过在海量的文本数据上进行训练，从而学习到丰富的语言知识、语义理解和语法规则。</li><li>高参数量：通常包含大量的参数，这使其具有强大的表示能力和学习能力。</li><li>通用语言处理能力：能够处理多种自然语言任务，如文本生成、知识问答、推理计算、阅读理解等。</li><li>深度理解和生成：可以深入理解输入的文本，并生成连贯、有逻辑的自然语言文本响应。</li></ul>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GraphQL概要</title>
      <link href="/2023/10/19/GraphQL%E6%A6%82%E8%A6%81/"/>
      <url>/2023/10/19/GraphQL%E6%A6%82%E8%A6%81/</url>
      
        <content type="html"><![CDATA[<h1 id="GraphQL概要"><a href="#GraphQL概要" class="headerlink" title="GraphQL概要"></a>GraphQL概要</h1><ol><li>GraphQL是什么</li></ol><ul><li>API标准，可以作为REST API的备选方案</li><li>由Facebook开发并开源发布</li><li>用于API的查询语言</li></ul><ol start="2"><li>GraphQL诞生的原因</li></ol><ul><li>在网速较慢的设备上，移动端应用需要更快速的加载数据。GraphQL只需要传输前端需要的数据，而REST API则传世请求资源的所有数据。</li><li>前端框架和平台多种多样，GraphQL可以让它们可以精确地访问需要的数据。</li><li>持续集成导致API改动频率增加，而GraphQL则能减少这样的改动。</li></ul><ol start="3"><li>GraphQL相对于REST的优势</li></ol><ul><li>减少了要传输的数据</li><li>减少了发送请求的数量</li><li>避免了由于API设计变化导致的endpoint结构的调整</li><li>更理解客户端对数据的需求</li><li>Schema和强类型可以让前后端独立开发</li></ul><ol start="4"><li>GraphQL的核心概念</li></ol><ul><li>Schema Definition Language (SDL)</li></ul><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="type">Person</span> &#123;</span><br><span class="line">  name: <span class="type">String</span>!</span><br><span class="line">  age: <span class="type">Int</span>!</span><br><span class="line">  posts: [<span class="type">Post</span>!]!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="type">Post</span> &#123;</span><br><span class="line">  title: <span class="type">String</span>!</span><br><span class="line">  author: <span class="type">Person</span>!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>发送请求</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">request:</span><br><span class="line">&#123;</span><br><span class="line">  allPersons(<span class="keyword">last</span>: <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="built_in">name</span></span><br><span class="line">    age</span><br><span class="line">    posts &#123;</span><br><span class="line">      title</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>请求改变数据</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mutation &#123;</span><br><span class="line">  createPerson(<span class="built_in">name</span>: <span class="string">&quot;Bob&quot;</span>, age: <span class="number">36</span>) &#123;</span><br><span class="line">    <span class="built_in">name</span></span><br><span class="line">    age</span><br><span class="line">    <span class="built_in">id</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>订阅数据的更新</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">subscription</span> &#123;</span><br><span class="line">  <span class="section">newPerson</span> &#123;</span><br><span class="line">    <span class="attribute">name</span></span><br><span class="line">    age</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Schema例子</p></li></ul><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="type">Query</span> &#123;</span><br><span class="line">  allPersons(last: <span class="type">Int</span>): [<span class="type">Person</span>!]!</span><br><span class="line">  allPosts(last: <span class="type">Int</span>): [<span class="type">Post</span>!]!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="type">Mutation</span> &#123;</span><br><span class="line">  createPerson(name: <span class="type">String</span>!, age: <span class="type">Int</span>!): <span class="type">Person</span>!</span><br><span class="line">  updatePerson(id: <span class="type">ID</span>!, name: <span class="type">String</span>!, age: <span class="type">String</span>!): <span class="type">Person</span>!</span><br><span class="line">  deletePerson(id: <span class="type">ID</span>!): <span class="type">Person</span>!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="type">Subscription</span> &#123;</span><br><span class="line">  newPerson: <span class="type">Person</span>!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="type">Person</span> &#123;</span><br><span class="line">  id: <span class="type">ID</span>!</span><br><span class="line">  name: <span class="type">String</span>!</span><br><span class="line">  age: <span class="type">Int</span>!</span><br><span class="line">  posts: [<span class="type">Post</span>!]!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="type">Post</span> &#123;</span><br><span class="line">  title: <span class="type">String</span>!</span><br><span class="line">  author: <span class="type">Person</span>!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Resolvers</li></ul><p>服务端获取每个字段的函数称之为resolver。</p><ul><li>Fragments</li></ul><p>Fragment可以简化查询语句，例如可以针对如下的User类型定义一个Fragment，然后查询语句就可以得到简化。</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="keyword">User</span> <span class="title">&#123;</span></span><br><span class="line"><span class="title">  name</span>: <span class="keyword">String</span>!</span><br><span class="line">  age: Int!</span><br><span class="line">  email: <span class="keyword">String</span>!</span><br><span class="line">  street: <span class="keyword">String</span>!</span><br><span class="line">  zipcode: <span class="keyword">String</span>!</span><br><span class="line">  city: <span class="keyword">String</span>!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fragment addressDetails on <span class="keyword">User</span> <span class="title">&#123;</span></span><br><span class="line"><span class="title">  name</span></span><br><span class="line">  street</span><br><span class="line">  zipcode</span><br><span class="line">  city</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  allUsers &#123;</span><br><span class="line">    ... addressDetails</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>参数定义</li></ul><p>在类型定义中，每个字段可以定义参数和参数的默认值，例如：</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="type">Query</span> &#123;</span><br><span class="line">  allUsers(olderThan: <span class="type">Int</span> = -1): [<span class="type">User</span>!]!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>别名</li></ul><p>Query语句中可以为返回结果指定别名，例如：</p><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  first: User(<span class="name">id:</span> <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">    name</span><br><span class="line">  &#125;</span><br><span class="line">  second: User(<span class="name">id:</span> <span class="string">&quot;2&quot;</span>) &#123;</span><br><span class="line">    name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;first&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Alice&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;second&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Sarah&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>类型</li></ul><p>GraphQL中的类型可分为标量类型(Scalar type)和对象类型(Object type)。</p><ul><li>标量类型有5种： String, Int, Float, Boolean, ID</li><li>对象类型可以自定义，如上述的User类型</li></ul><p>枚举类型的定义：</p><figure class="highlight capnproto"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Weekday</span> </span>&#123;</span><br><span class="line">  MONDAY</span><br><span class="line">  TUESDAY</span><br><span class="line">  WEDNESDAY</span><br><span class="line">  THURSDAY</span><br><span class="line">  FRIDAY</span><br><span class="line">  SATURDAY</span><br><span class="line">  SUNDAY</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>联合类型的定义：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">union</span> Person = Adult | Child</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="section">allPersons</span> &#123;</span><br><span class="line">    <span class="attribute">name</span> <span class="comment"># works for `Adult` and `Child`</span></span><br><span class="line">    ... <span class="literal">on</span> Child &#123;</span><br><span class="line">      <span class="attribute">school</span></span><br><span class="line">    &#125;</span><br><span class="line">    ... <span class="literal">on</span> Adult &#123;</span><br><span class="line">       <span class="attribute">work</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接口的定义：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="keyword">Node</span> <span class="title">&#123;</span></span><br><span class="line"><span class="title">  id</span>: ID!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="keyword">User</span> <span class="title">implements</span> <span class="keyword">Node</span> <span class="title">&#123;</span></span><br><span class="line"><span class="title">  id</span>: ID!</span><br><span class="line">  name: <span class="keyword">String</span>!</span><br><span class="line">  age: Int!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>GraphQL客户端的职责</li></ol><ul><li>让开发者用声明式的方式请求数据，而不用关心底层的网络任务。</li><li>集成视图层可以让UI自动更新</li><li>缓存查询结果</li><li>构建时检查及优化schema</li></ul><ol start="6"><li>服务端执行流程</li></ol><p>服务端会按照广度优先来解析查询语句，并逐个调用每个field的resolver。例如：</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">query:</span> <span class="class">Query </span>&#123;</span><br><span class="line">  author(id: <span class="string">&quot;abc&quot;</span>): <span class="class">Author </span>&#123;</span><br><span class="line"><span class="symbol">    posts:</span> [Post] &#123;</span><br><span class="line"><span class="symbol">      title:</span> String</span><br><span class="line"><span class="symbol">      content:</span> String</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其获取数据的流程类似于：</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Query.author<span class="function"><span class="params">(root, &#123; id: <span class="string">&#x27;abc&#x27;</span> &#125;, context)</span> -&gt;</span> author</span><br><span class="line">Author.posts<span class="function"><span class="params">(author, <span class="literal">null</span>, context)</span> -&gt;</span> posts</span><br><span class="line"><span class="keyword">for</span> each post <span class="keyword">in</span> posts</span><br><span class="line">  Post.title<span class="function"><span class="params">(post, <span class="literal">null</span>, context)</span> -&gt;</span> title</span><br><span class="line">  Post.content<span class="function"><span class="params">(post, <span class="literal">null</span>, context)</span> -&gt;</span> content</span><br></pre></td></tr></table></figure><p>为了避免重复地请求同一个数据，可以使用loader来解析查询语句，到解析完之后再请求数据。</p>]]></content>
      
      
      <categories>
          
          <category> 应用开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> graphql </tag>
            
            <tag> api </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker笔记</title>
      <link href="/2023/09/28/Docker%E7%AC%94%E8%AE%B0/"/>
      <url>/2023/09/28/Docker%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h3 id="存储卷-Volumes"><a href="#存储卷-Volumes" class="headerlink" title="存储卷(Volumes)"></a>存储卷(Volumes)</h3><ul><li>匿名卷：可以在Dockerfile中使用<code>VOLUME [ &quot;/path&quot; ]</code>创建匿名卷，也可以在启动容器的时候用<code>-v /path</code>来创建。匿名卷在container被删掉之后会被自动删除。</li><li>命名卷：可以在启动容器的时候用<code>-v volume_name:/path</code>来创建命名卷。命名卷在容器被删除时不会被自动删除。</li><li>绑定挂载(Bind Mount)：在启动容器时使用<code>-v host_path:/container_path</code>将主机上的目录映射到容器中。这样主机上文件的改动就能直接反映在容器里，无需重新构建容器镜像。</li></ul><h3 id="容器网络"><a href="#容器网络" class="headerlink" title="容器网络"></a>容器网络</h3><ul><li>容器中可以使用<code>host.docker.internal</code>作为主机名来访问主机网络。</li><li>多个容器可以通过<code>--network &#123;network_name&#125;</code>加入同一网络，同一网络中的容器可以通过容器名互相访问。</li><li>Docker网络有<code>bridge, host, none, overlay, macvlan, third-party plugin</code>等类型，在创建网络是通过<code>--driver</code>来指定。</li></ul><h3 id="CMD-or-ENTRYPOINT"><a href="#CMD-or-ENTRYPOINT" class="headerlink" title="CMD or ENTRYPOINT"></a>CMD or ENTRYPOINT</h3><p> 使用命令行运行docker容器时，命令行提供的命令将会替代docker file中CMD，但是会追加在ENTRYPOINT中。</p>]]></content>
      
      
      <categories>
          
          <category> 云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 云计算 </tag>
            
            <tag> 云原生 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go语言的过程式编程</title>
      <link href="/2023/03/08/Go%E8%AF%AD%E8%A8%80%E7%9A%84%E8%BF%87%E7%A8%8B%E5%BC%8F%E7%BC%96%E7%A8%8B/"/>
      <url>/2023/03/08/Go%E8%AF%AD%E8%A8%80%E7%9A%84%E8%BF%87%E7%A8%8B%E5%BC%8F%E7%BC%96%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h3 id="Go语言中常用的内置函数"><a href="#Go语言中常用的内置函数" class="headerlink" title="Go语言中常用的内置函数"></a>Go语言中常用的内置函数</h3><table><thead><tr><th>函数</th><th>用法</th></tr></thead><tbody><tr><td>append(s, …)</td><td>将s后面的所有参数追加到切片s中，如果容量不够，则新建一个切片</td></tr><tr><td>cap(x)</td><td>返回切片或者通道的容量，数组的长度</td></tr><tr><td>len(x)</td><td>返回切片、数组或者通道的长度</td></tr><tr><td>close(ch)</td><td>关闭通道，即不可以再往通道中写入值，但还可以读取</td></tr><tr><td>complex(r, i)</td><td>生成一个复数</td></tr><tr><td>copy(dist, src)</td><td>将切片src中的项复制到切片dist中，或者讲字符串src复制到[]byte类型的切片dist中</td></tr><tr><td>delete(m, k)</td><td>从映射m中删除键值为k的项</td></tr><tr><td>real(cx)</td><td>返回复数cx的实部</td></tr><tr><td>imag(cx)</td><td>返回复数cx的虚部</td></tr><tr><td>make(T, l, c)</td><td>创建一个切片、通道或者映射</td></tr><tr><td>new(T)</td><td>一个指向类型为T的值的指针</td></tr><tr><td>panic(x)</td><td>抛出一个运行时异常，其值为x</td></tr><tr><td>recover()</td><td>捕获一个运行时异常</td></tr></tbody></table><h3 id="Go语言赋值"><a href="#Go语言赋值" class="headerlink" title="Go语言赋值"></a>Go语言赋值</h3><ol><li>Go语言中的自增自减运算符都是后置的，且没有返回值。</li><li>可以使用<code>=</code>来给变量赋值，如果前面没有加<code>var</code>，那么变量必须是已经存在的。</li><li>可以使用逗号同时给多个变量赋值。<code>a, b, c = 2, 3, 4</code>。</li><li>可以使用<code>_</code>来忽略赋值，它与任意类型兼容。</li><li>可以使用<code>:=</code>来同时声明和赋值一个变量。</li><li>当使用逗号和<code>:=</code>来给多个变量赋值时，要求其中至少有一个变量是新建的。</li><li>如果函数声明了返回值变量的名字，那么它在刚开始的时候会被初始化为其类型的零值。</li><li>函数在返回的时候如果没有明确的指定变量名，那么它将返回函数声明中的变量。</li></ol><h3 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h3><ul><li>Go语言使用<code>result := Type(expr)</code>来进行类型转换。</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">runeSlice := []<span class="keyword">rune</span>&#123;<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>&#125;</span><br><span class="line">str := <span class="keyword">string</span>(runeSlice)</span><br><span class="line">fmt.Println(runeSlice)  <span class="comment">// [97 98 99]</span></span><br><span class="line">fmt.Println(str) <span class="comment">// abc</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>interface&#123;&#125;</code>类型用于表示空接口，它可以表示任意类型的值。</li><li><code>expr.(Type)</code>用于判断expr是不是类型Type。安全类型的成功判断返回expr的值和true，安全类型的失败判断返回该类型的零值和false。非安全类型的成功判断返回expr的值，失败触发panic。</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> i <span class="keyword">interface</span>&#123;&#125; = <span class="number">99</span></span><br><span class="line"><span class="keyword">var</span> s <span class="keyword">interface</span>&#123;&#125; = []<span class="keyword">string</span>&#123;<span class="string">&quot;left&quot;</span>, <span class="string">&quot;right&quot;</span>&#125;</span><br><span class="line">j := i.(<span class="keyword">int</span>)</span><br><span class="line">fmt.Printf(<span class="string">&quot;%T -&gt; %d\n&quot;</span>, i, j)  <span class="comment">// int -&gt; 99</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%T -&gt; %q\n&quot;</span>, s, s)  <span class="comment">// []string -&gt; [&quot;left&quot; &quot;right&quot;]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h3><ul><li><code>if</code>语句可以有可选的声明语句，在该语句中定义的变量其作用域限制在if语句之类。</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> optionalStatement; booleanExpression &#123;</span><br><span class="line">block</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> optionalStatement1; booleanExpression1 &#123;</span><br><span class="line">block1</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">block2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>switch</code>语句默认不会向下贯穿，需要使用<code>fallthrough</code>语句。</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> optionalStatement; optionalExpression &#123;</span><br><span class="line"><span class="keyword">case</span> expressionList1: block1</span><br><span class="line">...</span><br><span class="line"><span class="keyword">default</span>: blockN</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>例如:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> Suffix(file) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;.gz&quot;</span>:</span><br><span class="line">  <span class="keyword">return</span> GzipFileList(file)</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;.tar&quot;</span>, <span class="string">&quot;.tar.gz&quot;</span>, <span class="string">&quot;.tgz&quot;</span>:</span><br><span class="line">  <span class="keyword">return</span> TarFileList(file)</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;.zip&quot;</span>:</span><br><span class="line">  <span class="keyword">return</span> ZipFileList(file)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>switch</code>语句也可以用作类型开关，例如：</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> x.(<span class="keyword">type</span>) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">bool</span>: block0</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">int</span>, <span class="keyword">int8</span>, <span class="keyword">int16</span>: block1</span><br><span class="line"><span class="keyword">default</span>: blockN</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="for循环语句"><a href="#for循环语句" class="headerlink" title="for循环语句"></a>for循环语句</h3><ul><li>无限循环</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> &#123; block &#125;</span><br></pre></td></tr></table></figure><ul><li>普通循环</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> optionalPrestatement; booleanExpress; optionalPoststatement &#123; block &#125;</span><br></pre></td></tr></table></figure><ul><li>遍历字符串</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> idx, char := <span class="keyword">range</span> aString &#123; block &#125;</span><br><span class="line"><span class="keyword">for</span> idx := <span class="keyword">range</span> aString &#123; block &#125;</span><br></pre></td></tr></table></figure><ul><li>遍历数组或切片</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> idx, item := <span class="keyword">range</span> anArrayOrSlice &#123; block &#125;</span><br><span class="line"><span class="keyword">for</span> idx := <span class="keyword">range</span> anArrayOrSlice &#123; block &#125;</span><br></pre></td></tr></table></figure><ul><li>遍历映射</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> key, value := <span class="keyword">range</span> aMap &#123; block &#125;</span><br><span class="line"><span class="keyword">for</span> key := <span class="keyword">range</span> aMap &#123; block &#125;</span><br></pre></td></tr></table></figure><ul><li>遍历通道</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> item := <span class="keyword">range</span> aChannel &#123; block &#125;</span><br></pre></td></tr></table></figure><h3 id="select语句"><a href="#select语句" class="headerlink" title="select语句"></a>select语句</h3><p>select语句用来从多个通道中接收或发送数据。其语法如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> sendOrReceive1: block1</span><br><span class="line">...</span><br><span class="line"><span class="keyword">case</span> sendOrReceive2: block2</span><br><span class="line"><span class="keyword">default</span>: blockD</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果没有default语句，那么select语句是阻塞的，直到其中的一个channel可以执行。如果有default语句，那么select语句是非阻塞的，如果没有channel满足条件则会执行默认语句。</p><h3 id="defer语句"><a href="#defer语句" class="headerlink" title="defer语句"></a>defer语句</h3><p>defer语句的执行时机是：</p><ul><li>所在函数返回之前，返回值计算完成之后执行。</li><li>多个defer语句以LIFO(Last In First Out)的方式执行。</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(add1(<span class="number">1</span>)) <span class="comment">// 10</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add1</span><span class="params">(a <span class="keyword">int</span>)</span> <span class="params">(result <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> <span class="function"><span class="keyword">func</span> <span class="params">()</span></span> &#123; result = <span class="number">10</span> &#125;()</span><br><span class="line">  <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span> <span class="params">()</span></span> &#123; result = <span class="number">20</span> &#125;()</span><br><span class="line">result = a + <span class="number">1</span></span><br><span class="line"><span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="panic和recover函数"><a href="#panic和recover函数" class="headerlink" title="panic和recover函数"></a>panic和recover函数</h3><p>不同于错误，异常是指不可能发生的情况发生了，通常是程序本身的问题，我们希望尽早发现问题所以通过调用panic函数抛出异常。panic被调用后，调用函数会中止执行，然后所有延迟执行的语句会执行，最后返回到上一层调用函数重复这样的过程直到main函数终止程序。<br>recover函数可以捕获异常并终止panic函数的冒泡。</p><p>例如：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ConvertInt64ToInt</span><span class="params">(x <span class="keyword">int64</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> math.MinInt32 &lt;= x &amp;&amp; x &lt;= math.MaxInt32 &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">int</span>(x)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">panic</span>(fmt.Sprintf(<span class="string">&quot;%d is out of the int32 range&quot;</span>, x))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IntFromInt64</span><span class="params">(x <span class="keyword">int64</span>)</span> <span class="params">(i <span class="keyword">int</span>, err error)</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span> e:= <span class="built_in">recover</span>(); e != <span class="literal">nil</span> &#123;</span><br><span class="line">err = fmt.Errorf(<span class="string">&quot;%v&quot;</span>, e)</span><br><span class="line">&#125;</span><br><span class="line">&#125;()</span><br><span class="line">i = ConvertInt64ToInt(x)</span><br><span class="line"><span class="keyword">return</span> i, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="自定义函数"><a href="#自定义函数" class="headerlink" title="自定义函数"></a>自定义函数</h3><ul><li>Go语言可以在参数列表里的最后一个参数类型前面使用…实现可变参数</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">test(<span class="number">3</span>, <span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(n <span class="keyword">int</span>, strs ...<span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">fmt.Println(strs) <span class="comment">// [hello world]</span></span><br><span class="line">fmt.Println(n) <span class="comment">// 3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Go语言不支持可选参数，但可以通过结构体来实现</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Options <span class="keyword">struct</span> &#123;</span><br><span class="line">n   <span class="keyword">int</span></span><br><span class="line">str <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">test(Options&#123;n: <span class="number">15</span>, str: <span class="string">&quot;hello world&quot;</span>&#125;)</span><br><span class="line">test(Options&#123;n: <span class="number">16</span>&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(options Options)</span></span> &#123;</span><br><span class="line">fmt.Println(options.n)</span><br><span class="line">fmt.Println(options.str)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>init和main函数不接受任何参数也不返回任何值，init在main函数调用之前执行</li><li>闭包是指捕获了和它在同一作用域常量或者变量的函数</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">addjpg := MakeAddSuffix(<span class="string">&quot;.jpg&quot;</span>)</span><br><span class="line">addpng := MakeAddSuffix(<span class="string">&quot;.png&quot;</span>)</span><br><span class="line">fmt.Println(addjpg(<span class="string">&quot;hello&quot;</span>))  <span class="comment">// hello.jpg</span></span><br><span class="line">fmt.Println(addpng(<span class="string">&quot;hello.png&quot;</span>))  <span class="comment">// hello.png</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">MakeAddSuffix</span><span class="params">(suffix <span class="keyword">string</span>)</span> <span class="title">func</span><span class="params">(<span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(name <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> !strings.HasSuffix(name, suffix) &#123;</span><br><span class="line"><span class="keyword">return</span> name + suffix</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> name</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
            <tag> regexp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go语言中的集合类型</title>
      <link href="/2022/12/27/Go%E8%AF%AD%E8%A8%80%E4%B8%AD%E7%9A%84%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B/"/>
      <url>/2022/12/27/Go%E8%AF%AD%E8%A8%80%E4%B8%AD%E7%9A%84%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h3 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h3><ul><li>Go语言中只有值传递。</li><li>切片、映射、通道、函数等引用类型也是值传递，只不过它们的值是指针，所以对形参的改变也会反映到实参本身。</li><li>指针是指保存了另一个变量内存地址的变量。通过指针可以让参数传递的成本最低且内容可修改，而且可以让变量的生命周期独立于作用域。</li></ul><h3 id="数组和切片"><a href="#数组和切片" class="headerlink" title="数组和切片"></a>数组和切片</h3><ul><li>使用如下语法创建数组。<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[length]Type</span><br><span class="line">[N]Type&#123;value1, value2, ..., valueN&#125;</span><br><span class="line">[...]Type&#123;value1, value2, ..., valueN&#125;</span><br></pre></td></tr></table></figure></li><li>数组的长度是固定的，不可以修改。</li><li>数组的容量<code>cap()</code>和长度<code>len()</code>都等于数组的长度。</li><li>数组按值传递，及传递给函数的是数组的副本，而切片是引用类型，传递的是指针。</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">changeArray</span><span class="params">(a [3]<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">a[<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">myarray := [<span class="number">3</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">changeArray(myarray)</span><br><span class="line">fmt.Println(myarray) <span class="comment">// 因为myarray是数组，所以打印结果为 [1 2 3]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">changeArray</span><span class="params">(a []<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">a[<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">myarray := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">changeArray(myarray)</span><br><span class="line">fmt.Println(myarray) <span class="comment">// 因为myarray是切片，所以打印结果为 [3 2 3]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>可以使用下面的方法创建切片。<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">make</span>([]Type, length, capacity)</span><br><span class="line"><span class="built_in">make</span>([]Type, length)</span><br><span class="line">[]Type</span><br><span class="line">[]Type(value1, value2, ..., valueN)</span><br></pre></td></tr></table></figure></li><li>多个切片如果共享一个底层数组，那么对其中一个切片数值的改变，也会影响其他切片。</li><li>可以使用<code>for index, item := range s &#123;&#125;</code>来遍历切片s。</li><li>可以使用<code>s = append(s, &quot;a&quot;, &quot;b&quot;, &quot;c&quot;)</code>或者<code>s = append(s, t...)</code>来将元素a, b, c和切片t追加到切片s中。</li><li>可以使用<code>nr = copy(s, t)</code>将t切片中的内容拷贝到s中。</li><li>可以使用标准库中的<code>sort</code>包来对排序和搜索切片。<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;sort&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">myarray := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>&#125;</span><br><span class="line">files := []<span class="keyword">string</span>&#123;<span class="string">&quot;Test.conf&quot;</span>, <span class="string">&quot;utils.go&quot;</span>, <span class="string">&quot;Makefile&quot;</span>&#125;</span><br><span class="line">target := <span class="string">&quot;Makefile&quot;</span></span><br><span class="line">fmt.Println(sort.IntsAreSorted(myarray))  <span class="comment">// false</span></span><br><span class="line">sort.Ints(myarray)</span><br><span class="line">fmt.Println(myarray) <span class="comment">//[1 2 3]</span></span><br><span class="line"></span><br><span class="line">sort.Strings(files)</span><br><span class="line">fmt.Printf(<span class="string">&quot;%q\n&quot;</span>, files) <span class="comment">// [&quot;Makefile&quot; &quot;Test.conf&quot; &quot;utils.go&quot;]</span></span><br><span class="line">i := sort.Search(<span class="built_in">len</span>(files),</span><br><span class="line"><span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123; <span class="keyword">return</span> files[i] &gt;= target &#125;)</span><br><span class="line"><span class="keyword">if</span> i &lt; <span class="built_in">len</span>(files) &amp;&amp; files[i] == target &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;found \&quot;%s\&quot; at files[%d]\n&quot;</span>, target, i) <span class="comment">// found &quot;Makefile&quot; at files[0]</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射</h3><ul><li>创建映射的方式<ul><li><code>make(map[KeyType]ValueType, initialCapacity)</code></li><li><code>make(map[KeyType]ValueType</code></li><li><code>map[KeyType]ValueType&#123;&#125;</code></li><li><code>map[KeyType]ValueType&#123;key1: value1, ..., keyN: valueN&#125;</code></li></ul></li><li>映射的操作<ul><li><code>m[k] = v</code>: 赋值v给映射的键值k</li><li><code>delete(m, k)</code>: 删除map中的k</li><li><code>v := m[k]</code>: 将map中k对应的值赋值给v</li><li><code>v, found := m[k]</code>: 如果k值不存在，将v赋值为0，found设为false</li><li><code>len(m)</code>: 返回map中的键值对数目</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
            <tag> regexp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ansible概要</title>
      <link href="/2022/11/09/Ansible%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2022/11/09/Ansible%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h3 id="Ansible是什么？"><a href="#Ansible是什么？" class="headerlink" title="Ansible是什么？"></a>Ansible是什么？</h3><p>Ansible是一个自动化管理远程系统的工具，它主要有两个功能：</p><ul><li>自动化管理远程节点</li><li>控制远程节点，让它们满足预期的状态</li></ul><p>主要由3个组件构成：</p><ol><li>控制节点： 用于安装和运行ansible。</li><li>被控制节点： ansible管理的节点。</li><li>清单(Inventory)：按逻辑组织的被控制节点列表，它描述了ansible管理的对象。</li></ol><img src=/images/ansible-overview.png width=400/><p>Ansible的安装配置步骤：</p><ol><li><p>使用Homebrew安装: <code>brew install ansible</code></p></li><li><p>创建被管理节点的清单hosts.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">all:</span></span><br><span class="line">  <span class="attr">children:</span></span><br><span class="line">    <span class="attr">master:</span></span><br><span class="line">      <span class="attr">hosts:</span></span><br><span class="line">        <span class="attr">master-node:</span></span><br><span class="line">          <span class="attr">ansible_host:</span> <span class="number">52.118</span><span class="number">.108</span><span class="number">.104</span></span><br><span class="line">          <span class="attr">ansible_user:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">nodes:</span></span><br><span class="line">      <span class="attr">hosts:</span></span><br><span class="line">        <span class="attr">node-1:</span></span><br><span class="line">          <span class="attr">ansible_host:</span> <span class="number">150.238</span><span class="number">.65</span><span class="number">.205</span></span><br><span class="line">          <span class="attr">ansible_user:</span> <span class="string">root</span></span><br></pre></td></tr></table></figure></li><li><p>检验清单是否正确。-i用于指定清单文件，all和master是被管理节点的模式(pattern)。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ansible -i hosts.yaml all --list-host</span><br><span class="line">  hosts (2):</span><br><span class="line">    master-node</span><br><span class="line">    node-1</span><br><span class="line">$ ansible -i hosts.yaml master --list-host</span><br><span class="line">  hosts (1):</span><br><span class="line">    master-node</span><br></pre></td></tr></table></figure></li><li><p>配置SSH免密码登录，让控制节点可以远程连接到被管理节点。</p></li><li><p>检验SSH是否配置正确</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ansible</span> -i hosts.yaml all -m ping</span><br><span class="line">master-node | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python3&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">node-1 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="如何写一个Ansible清单"><a href="#如何写一个Ansible清单" class="headerlink" title="如何写一个Ansible清单?"></a>如何写一个Ansible清单?</h3><ul><li>Inventory支持多种文件格式，最常用的两种是INI和YAML。</li><li>可以对清单中的节点分组(group)，系统有两个默认分组 <code>all</code>和<code>ungrouped</code>。</li><li>可以使用children来嵌套分组。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">all:</span></span><br><span class="line">  <span class="attr">children:</span></span><br><span class="line">    <span class="attr">master:</span></span><br><span class="line">      <span class="attr">hosts:</span></span><br><span class="line">        <span class="attr">master-node:</span></span><br><span class="line">          <span class="attr">ansible_host:</span> <span class="number">52.118</span><span class="number">.108</span><span class="number">.104</span></span><br><span class="line">          <span class="attr">ansible_user:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">nodes:</span></span><br><span class="line">      <span class="attr">hosts:</span></span><br><span class="line">        <span class="attr">node-1:</span></span><br><span class="line">          <span class="attr">ansible_host:</span> <span class="number">150.238</span><span class="number">.65</span><span class="number">.205</span></span><br><span class="line">          <span class="attr">ansible_user:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">prod:</span></span><br><span class="line">      <span class="attr">children:</span></span><br><span class="line">        <span class="attr">master:</span></span><br><span class="line">        <span class="attr">nodes:</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ansible -i hosts.yaml prod --list-hosts</span><br><span class="line">  hosts (2):</span><br><span class="line">    master-node</span><br><span class="line">    node-1</span><br></pre></td></tr></table></figure></li><li>可以使用类似于python切片的语法来指定被控制节点的范围<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pod1:</span></span><br><span class="line">  <span class="attr">hosts:</span></span><br><span class="line">    <span class="number">9.1</span><span class="number">.1</span><span class="string">.[1:10:2]</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ansible -i range.yaml pod1 --list-hosts</span><br><span class="line">  hosts (5):</span><br><span class="line">    9.1.1.1</span><br><span class="line">    9.1.1.3</span><br><span class="line">    9.1.1.5</span><br><span class="line">    9.1.1.7</span><br><span class="line">    9.1.1.9</span><br></pre></td></tr></table></figure></li></ul><h3 id="如何使用变量？"><a href="#如何使用变量？" class="headerlink" title="如何使用变量？"></a>如何使用变量？</h3><ul><li>变量名和python的命名规则相同，由字母数字下划线组成且不能以数字开头，不能是python或者ansible的关键字。</li><li>使用yaml风格定义变量</li><li>变量作用范围为global,play,host</li><li>可以在task中使用register将输出赋值给变量</li></ul><h3 id="如何在清单中添加变量？"><a href="#如何在清单中添加变量？" class="headerlink" title="如何在清单中添加变量？"></a>如何在清单中添加变量？</h3><ol><li>给一个节点添加变量，可以直接在节点下添加键值对，如上述hosts.yaml中的<code>ansible_host</code>和<code>ansible_user</code>。</li><li>给一个group添加变量，可以在group下面添加vars字段。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">all:</span></span><br><span class="line">  <span class="attr">children:</span></span><br><span class="line">    <span class="attr">master:</span></span><br><span class="line">      <span class="attr">hosts:</span></span><br><span class="line">        <span class="attr">master-node:</span></span><br><span class="line">          <span class="attr">ansible_host:</span> <span class="number">52.118</span><span class="number">.108</span><span class="number">.104</span></span><br><span class="line">          <span class="attr">ansible_user:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">nodes:</span></span><br><span class="line">      <span class="attr">hosts:</span></span><br><span class="line">        <span class="attr">node-1:</span></span><br><span class="line">          <span class="attr">ansible_host:</span> <span class="number">150.238</span><span class="number">.65</span><span class="number">.205</span></span><br><span class="line">          <span class="attr">ansible_user:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">vars:</span></span><br><span class="line">        <span class="attr">ntp_server:</span> <span class="number">9.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">prod:</span></span><br><span class="line">      <span class="attr">children:</span></span><br><span class="line">        <span class="attr">master:</span></span><br><span class="line">        <span class="attr">nodes:</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ansible -i hosts.yaml master -a <span class="string">&quot;echo &#123;&#123; ntp_server &#125;&#125;&quot;</span></span><br><span class="line">master-node | FAILED | rc=-1 &gt;&gt;</span><br><span class="line">The task includes an option with an undefined variable. The error was: <span class="string">&#x27;ntp_server&#x27;</span> is undefined. <span class="string">&#x27;ntp_server&#x27;</span> is undefined</span><br><span class="line">$ ansible -i hosts.yaml nodes -a <span class="string">&quot;echo &#123;&#123; ntp_server &#125;&#125;&quot;</span></span><br><span class="line">node-1 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">9.1.1.1</span><br></pre></td></tr></table></figure></li><li>也可以在清单文件同目录下创建<code>group_vars/&#123;&#123;group_name&#125;&#125;</code>文件来给group定义变量。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ cat group_vars/master</span><br><span class="line">---</span><br><span class="line">ftp_server: 9.1.1.1</span><br><span class="line">$ ansible -i hosts.yaml master -a <span class="string">&quot;echo &#123;&#123; ftp_server &#125;&#125;&quot;</span></span><br><span class="line">master-node | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">9.1.1.1</span><br></pre></td></tr></table></figure></li></ol><h3 id="如何使用模式来匹配目标主机？"><a href="#如何使用模式来匹配目标主机？" class="headerlink" title="如何使用模式来匹配目标主机？"></a>如何使用模式来匹配目标主机？</h3><p>模式(Pattern)可以通过通配符或者正则表达式来指定一个主机、IP、或者清单组(group)。</p><ul><li><code>all</code>或者<code>*</code>匹配所有主机</li><li>主机或者group名匹配一个主机或者一个group</li><li>可以用<code>:</code>或者<code>,</code>指定多个主机或group</li><li><code>group1:!group2</code> 匹配在group1中且不在group2中的主机</li><li><code>group1:&amp;group2</code> 匹配既在group1又在group2中的主机</li></ul><h3 id="如何如何执行临时命令？"><a href="#如何如何执行临时命令？" class="headerlink" title="如何如何执行临时命令？"></a>如何如何执行临时命令？</h3><p>可以使用下面的命令来执行临时命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible [pattern] -m [module] -a <span class="string">&quot;[module options]&quot;</span></span><br></pre></td></tr></table></figure><p>如果不指定<code>-m [module]</code>，ansible会使用默认的<code>command</code>模块，module options就是要执行的命令。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ansible -i hosts.yaml master -a <span class="string">&#x27;ls $HOME&#x27;</span></span><br><span class="line">master-node | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">snap</span><br></pre></td></tr></table></figure><p>使用<code>file</code>模块来创建一个目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ ansible -i hosts.yaml master -m ansible.builtin.file -a <span class="string">&quot;dest=/root/projects mode=755 owner=root group=root state=directory&quot;</span></span><br><span class="line">master-node | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python3&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;gid&quot;</span>: 0,</span><br><span class="line">    <span class="string">&quot;group&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">    <span class="string">&quot;mode&quot;</span>: <span class="string">&quot;0755&quot;</span>,</span><br><span class="line">    <span class="string">&quot;owner&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">    <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/root/projects&quot;</span>,</span><br><span class="line">    <span class="string">&quot;size&quot;</span>: 4096,</span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;directory&quot;</span>,</span><br><span class="line">    <span class="string">&quot;uid&quot;</span>: 0</span><br><span class="line">&#125;</span><br><span class="line">$ ansible -i hosts.yaml master -a <span class="string">&#x27;ls $HOME&#x27;</span> -u root</span><br><span class="line">master-node | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">projects</span><br><span class="line">snap</span><br></pre></td></tr></table></figure><h3 id="jinja2是什么？"><a href="#jinja2是什么？" class="headerlink" title="jinja2是什么？"></a>jinja2是什么？</h3><p><a href="https://jinja.palletsprojects.com/en/3.1.x/templates/#synopsis">jinja2</a>是一种模板语言，通常用于web后端渲染HTML页面，但它可以处理所有格式的文本文件。</p><p>Template + data = HTML</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>My Webpage<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;navigation&quot;</span>&gt;</span></span><br><span class="line">    &#123;% for item in navigation %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; item.href &#125;&#125;&quot;</span>&gt;</span>&#123;&#123; item.caption &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>My Webpage<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    &#123;&#123; a_variable &#125;&#125;</span><br><span class="line"></span><br><span class="line">    &#123;# a comment #&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>jinja的三种语句：</p><ul><li><code>&#123;% ... %&#125;</code> for Statements</li><li><code>&#123;&#123; ... &#125;&#125;</code> for Expressions to print to the template output</li><li><code>&#123;# ... #&#125;</code> for Comments not included in the template output</li></ul><p>jinja的过滤器filters:</p><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-variable">&#123;&#123; name|<span class="name">striptags</span>|<span class="name">title</span> &#125;&#125;</span></span><br></pre></td></tr></table></figure><p>过滤器相当于一个把变量name当做参数的纯函数组合，上述过滤器就相当于函数调用<code>title(striptags(name))</code>。</p><h3 id="Ansible-playbooks是什么？"><a href="#Ansible-playbooks是什么？" class="headerlink" title="Ansible playbooks是什么？"></a>Ansible playbooks是什么？</h3><p>前面介绍的临时命令并不能满足复杂的部署任务，利用可重复使用、配置简单的ansible playbook就可以实现复杂的多机部署任务。利用playbook，用户可以：</p><ul><li>声明配置。</li><li>编排在多机上执行的任务的步骤及顺序。</li><li>同步或者异步地执行这些任务。</li></ul><img src=/images/ansible-playbooks.png /><p>Ansible playbook由一个或者多个play组成，并按照从上到下的顺序执行，每个play至少包含两个部分：</p><ul><li>用pattern来指定被管理的机器。</li><li>要执行的任务(task)。</li></ul><p>Ansible playbook有如下特点：</p><ul><li>在匹配的主机上，默认按顺序执行定义的任务，一次执行一个。</li><li>每个任务用指定的参数来执行一个ansible模块(module)。</li><li>如果任务在某个主机上失败，ansible则不会在该主机上执行接下来的所有任务。</li><li>大多数的ansible模块会检查机器的状态是否已经满足了module定义的状态，如果已经满足，则退出任务的执行。所以ansible模块的执行是幂等的。</li><li>task可以用block组织起来，然后利用<code>rescue</code>和<code>always</code>做异常处理。类似于<code>try...except...finally</code>。</li></ul><p>Ansible playbook的相关命令：</p><ul><li><code>$ ansible-playbook playbook.yaml -f 10</code>: Fork出10个子进程来执行playbook中定义的任务。</li><li><code>$ ansible-lint playbook.yaml</code>: 检查playbook的定义。</li></ul><p>例如，用ansible playbook来列出主机上家目录下的文件：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### playbook.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">List</span> <span class="string">files</span> <span class="string">of</span> <span class="string">master</span> <span class="string">nodes</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">master</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">List</span> <span class="string">files</span></span><br><span class="line">     <span class="attr">ansible.builtin.find:</span></span><br><span class="line">       <span class="attr">paths:</span> <span class="string">/root</span></span><br><span class="line">     <span class="attr">register:</span> <span class="string">out</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Print</span> <span class="string">the</span> <span class="string">List</span></span><br><span class="line">     <span class="attr">ansible.builtin.debug:</span></span><br><span class="line">       <span class="attr">var:</span> <span class="string">out</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">List</span> <span class="string">files</span> <span class="string">of</span> <span class="string">nodes</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">nodes</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">List</span> <span class="string">files</span></span><br><span class="line">     <span class="attr">ansible.builtin.find:</span></span><br><span class="line">       <span class="attr">paths:</span> <span class="string">/root</span></span><br><span class="line">     <span class="attr">register:</span> <span class="string">out</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Print</span> <span class="string">the</span> <span class="string">List</span></span><br><span class="line">     <span class="attr">ansible.builtin.debug:</span></span><br><span class="line">       <span class="attr">var:</span> <span class="string">out</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">$ ansible-playbook -i hosts.yaml playbook.yaml -f 10</span><br><span class="line"></span><br><span class="line">PLAY [List files of master nodes]</span><br><span class="line"></span><br><span class="line">TASK [Gathering Facts]</span><br><span class="line">ok: [master-node]</span><br><span class="line"></span><br><span class="line">TASK [List files]</span><br><span class="line">ok: [master-node]</span><br><span class="line"></span><br><span class="line">TASK [Print the List]</span><br><span class="line">ok: [master-node] =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;out&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;examined&quot;</span>: 9,</span><br><span class="line">        <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;files&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;atime&quot;</span>: 1668424993.3145647,</span><br><span class="line">                <span class="string">&quot;ctime&quot;</span>: 1668424993.3145647,</span><br><span class="line">                <span class="string">&quot;dev&quot;</span>: 64513,</span><br><span class="line">                <span class="string">&quot;gid&quot;</span>: 0,</span><br><span class="line">                <span class="string">&quot;gr_name&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">                <span class="string">&quot;inode&quot;</span>: 33538,</span><br><span class="line">                <span class="string">&quot;isblk&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="string">&quot;ischr&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="string">&quot;isdir&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="string">&quot;isfifo&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="string">&quot;isgid&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="string">&quot;islnk&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="string">&quot;isreg&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&quot;issock&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="string">&quot;isuid&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="string">&quot;mode&quot;</span>: <span class="string">&quot;0644&quot;</span>,</span><br><span class="line">                <span class="string">&quot;mtime&quot;</span>: 1668424993.3145647,</span><br><span class="line">                <span class="string">&quot;nlink&quot;</span>: 1,</span><br><span class="line">                <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/root/a.txt&quot;</span>,</span><br><span class="line">                <span class="string">&quot;pw_name&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">                <span class="string">&quot;rgrp&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&quot;roth&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&quot;rusr&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&quot;size&quot;</span>: 0,</span><br><span class="line">                <span class="string">&quot;uid&quot;</span>: 0,</span><br><span class="line">                <span class="string">&quot;wgrp&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="string">&quot;woth&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="string">&quot;wusr&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&quot;xgrp&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="string">&quot;xoth&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="string">&quot;xusr&quot;</span>: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;matched&quot;</span>: 1,</span><br><span class="line">        <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;All paths examined&quot;</span>,</span><br><span class="line">        <span class="string">&quot;skipped_paths&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PLAY [List files of nodes]</span><br><span class="line"></span><br><span class="line">TASK [Gathering Facts]</span><br><span class="line"></span><br><span class="line">TASK [List files]</span><br><span class="line">ok: [node-1]</span><br><span class="line"></span><br><span class="line">TASK [Print the List]</span><br><span class="line">ok: [node-1] =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;out&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;examined&quot;</span>: 8,</span><br><span class="line">        <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;files&quot;</span>: [],</span><br><span class="line">        <span class="string">&quot;matched&quot;</span>: 0,</span><br><span class="line">        <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;All paths examined&quot;</span>,</span><br><span class="line">        <span class="string">&quot;skipped_paths&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PLAY RECAP </span><br><span class="line">master-node                : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</span><br><span class="line">node-1                     : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</span><br></pre></td></tr></table></figure><h3 id="如何在playbook中使用过滤器"><a href="#如何在playbook中使用过滤器" class="headerlink" title="如何在playbook中使用过滤器?"></a>如何在playbook中使用过滤器?</h3><ol><li>处理未定义的变量</li></ol><ul><li><code>&#123;&#123; some_var | default('admin', true) &#125;&#125;</code>: 给some_var设置默认值为’admin’，true表示some_var是false或者空字符串的时候也使用默认值。</li><li><code>&#123;&#123; mode | default(omit) &#125;&#125;</code>: 如果mode没有定义就忽略它，直接使用系统的默认值。</li><li><code>&#123;&#123; some_var | mandatory &#125;&#125;</code>: 如果some_var没有定义，则ansible会执行失败。</li></ul><ol start="2"><li>根据变量的值是true/false/null来返回不同的结果， 如<code>&#123;&#123; enabled | ternary('no shutdown', 'shutdown', omit) &#125;&#125;</code></li><li>使用过滤器<code>type_debug</code>, <code>dict2items</code>及<code>items2dict</code>来获取或改变数据类型。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># playbook filters.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">list</span> <span class="string">to</span> <span class="string">dict</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">colors:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">fruit:</span> <span class="string">apple</span></span><br><span class="line">        <span class="attr">color:</span> <span class="string">red</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">fruit:</span> <span class="string">pear</span></span><br><span class="line">        <span class="attr">color:</span> <span class="string">yellow</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">fruit:</span> <span class="string">grapefruit</span></span><br><span class="line">        <span class="attr">color:</span> <span class="string">yellow</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Print</span> <span class="string">dict</span></span><br><span class="line">     <span class="attr">ansible.builtin.debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; colors | items2dict(key_name=&#x27;fruit&#x27;, value_name=&#x27;color&#x27;) | string &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;&#123;&#x27;apple&#x27;: &#x27;red&#x27;, &#x27;pear&#x27;: &#x27;yellow&#x27;, &#x27;grapefruit&#x27;: &#x27;yellow&#x27;&#125;&quot;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">dict</span> <span class="string">to</span> <span class="string">list</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">fruits:</span></span><br><span class="line">      <span class="attr">apple:</span> <span class="string">red</span></span><br><span class="line">      <span class="attr">pear:</span> <span class="string">yellow</span></span><br><span class="line">      <span class="attr">grapefruit:</span> <span class="string">yellow</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Print</span> <span class="string">list</span></span><br><span class="line">      <span class="attr">ansible.builtin.debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; fruits | dict2items(key_name=&#x27;fruit&#x27;, value_name=&#x27;color&#x27;) | string &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;[&#123;&#x27;fruit&#x27;: &#x27;apple&#x27;, &#x27;color&#x27;: &#x27;red&#x27;&#125;, &#123;&#x27;fruit&#x27;: &#x27;pear&#x27;, &#x27;color&#x27;: &#x27;yellow&#x27;&#125;, &#123;&#x27;fruit&#x27;: &#x27;grapefruit&#x27;, &#x27;color&#x27;: &#x27;yellow&#x27;&#125;]&quot;</span></span><br></pre></td></tr></table></figure></li><li>强制类型转换。<code>&#123;&#123; some_var | bool &#125;&#125;</code>, <code>&#123;&#123; some_var | to_json &#125;&#125;</code>, <code>&#123;&#123; some_var | to_nice_yaml(indent=4) &#125;&#125;</code><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># playbook: filters.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">to_json,</span> <span class="string">to_nice_json</span> <span class="string">and</span> <span class="string">from_json</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">fruits:</span></span><br><span class="line">      <span class="attr">apple:</span> <span class="string">red</span></span><br><span class="line">      <span class="attr">pear:</span> <span class="string">yellow</span></span><br><span class="line">      <span class="attr">grapefruit:</span> <span class="string">yellow</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Print</span> <span class="string">to_json</span></span><br><span class="line">     <span class="attr">ansible.builtin.debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; fruits | to_json&#125;&#125;</span>&quot;</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Print</span> <span class="string">to_nice_json</span></span><br><span class="line">     <span class="attr">ansible.builtin.debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; fruits | to_nice_json&#125;&#125;</span>&quot;</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Print</span> <span class="string">from_json</span></span><br><span class="line">     <span class="attr">ansible.builtin.debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; fruits | to_nice_json | from_json&#125;&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ok: [localhost] =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;&#123;\&quot;apple\&quot;: \&quot;red\&quot;, \&quot;pear\&quot;: \&quot;yellow\&quot;, \&quot;grapefruit\&quot;: \&quot;yellow\&quot;&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;&#123;\n    \&quot;apple\&quot;: \&quot;red\&quot;,\n    \&quot;grapefruit\&quot;: \&quot;yellow\&quot;,\n    \&quot;pear\&quot;: \&quot;yellow\&quot;\n&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;apple&quot;</span>: <span class="string">&quot;red&quot;</span>,</span><br><span class="line">        <span class="string">&quot;grapefruit&quot;</span>: <span class="string">&quot;yellow&quot;</span>,</span><br><span class="line">        <span class="string">&quot;pear&quot;</span>: <span class="string">&quot;yellow&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>使用<code>zip</code>, <code>zip_longest</code>合并列表。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># filters.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">zip,</span> <span class="string">zip_longest</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">indexes:</span> [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Print</span> <span class="string">list</span> <span class="string">with</span> <span class="string">zip.</span></span><br><span class="line">     <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; indexes | zip([&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;]) | string &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;[(0, &#x27;a&#x27;), (1, &#x27;b&#x27;), (2, &#x27;c&#x27;), (3, &#x27;d&#x27;)]&quot;</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Print</span> <span class="string">list</span> <span class="string">with</span> <span class="string">zip_longest.</span></span><br><span class="line">     <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; indexes | zip_longest([&#x27;a&#x27;], fillvalue=&#x27;x&#x27;) | string &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;[(0, &#x27;a&#x27;), (1, &#x27;x&#x27;), (2, &#x27;x&#x27;), (3, &#x27;x&#x27;)]&quot;</span></span><br></pre></td></tr></table></figure></li><li>使用<code>subelements</code>合并对象本身及其子元素。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># filters.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">zip,</span> <span class="string">zip_longest</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">users:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Han</span> <span class="string">Meimei</span></span><br><span class="line">        <span class="attr">roles:</span> [<span class="string">&#x27;developer&#x27;</span>, <span class="string">&#x27;tester&#x27;</span>, <span class="string">&#x27;sre&#x27;</span>]</span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Li</span> <span class="string">lei</span></span><br><span class="line">        <span class="attr">roles:</span> [<span class="string">&#x27;developer&#x27;</span>]</span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Print</span> <span class="string">combined</span> <span class="string">msg.</span></span><br><span class="line">     <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.0.name &#125;&#125;</span> is a <span class="template-variable">&#123;&#123; item.1 &#125;&#125;</span>.&quot;</span></span><br><span class="line">     <span class="attr">loop:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; users | subelements(&#x27;roles&#x27;) &#125;&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ok: [localhost] =&gt; (item=[&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Han Meimei&#x27;</span>, <span class="string">&#x27;roles&#x27;</span>: [<span class="string">&#x27;developer&#x27;</span>, <span class="string">&#x27;tester&#x27;</span>, <span class="string">&#x27;sre&#x27;</span>]&#125;, <span class="string">&#x27;developer&#x27;</span>]) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Han Meimei is a developer.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; (item=[&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Han Meimei&#x27;</span>, <span class="string">&#x27;roles&#x27;</span>: [<span class="string">&#x27;developer&#x27;</span>, <span class="string">&#x27;tester&#x27;</span>, <span class="string">&#x27;sre&#x27;</span>]&#125;, <span class="string">&#x27;tester&#x27;</span>]) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Han Meimei is a tester.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; (item=[&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Han Meimei&#x27;</span>, <span class="string">&#x27;roles&#x27;</span>: [<span class="string">&#x27;developer&#x27;</span>, <span class="string">&#x27;tester&#x27;</span>, <span class="string">&#x27;sre&#x27;</span>]&#125;, <span class="string">&#x27;sre&#x27;</span>]) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Han Meimei is a sre.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; (item=[&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Li lei&#x27;</span>, <span class="string">&#x27;roles&#x27;</span>: [<span class="string">&#x27;developer&#x27;</span>]&#125;, <span class="string">&#x27;developer&#x27;</span>]) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Li lei is a developer.&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>使用<code>combine</code>来合并字典。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#filters.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">combine</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">user:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">Han</span> <span class="string">Meimei</span></span><br><span class="line">      <span class="attr">roles:</span> [<span class="string">&#x27;developer&#x27;</span>, <span class="string">&#x27;tester&#x27;</span>, <span class="string">&#x27;sre&#x27;</span>]</span><br><span class="line">      <span class="attr">scores:</span></span><br><span class="line">        <span class="attr">math:</span> <span class="number">100</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Print</span> <span class="string">combined</span> <span class="string">user.</span></span><br><span class="line">     <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; user | combine(&#123; &#x27;roles&#x27;: [&#x27;designer&#x27;, &#x27;sre&#x27;], &#x27;scores&#x27;: &#123; &#x27;english&#x27;: 80 &#125; &#125;, list_merge=&#x27;append_rp&#x27;, recursive=True) | from_yaml &#125;&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ok: [localhost] =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Han Meimei&quot;</span>,</span><br><span class="line">        <span class="string">&quot;roles&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;developer&quot;</span>,</span><br><span class="line">            <span class="string">&quot;tester&quot;</span>,</span><br><span class="line">            <span class="string">&quot;designer&quot;</span>,</span><br><span class="line">            <span class="string">&quot;sre&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;scores&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;english&quot;</span>: 80,</span><br><span class="line">            <span class="string">&quot;math&quot;</span>: 100</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>使用<code>map</code>从列表或字典中抽取数据。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#filters.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">map</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Print</span> <span class="string">list.</span></span><br><span class="line">     <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; [0,2] | map(&#x27;extract&#x27;, [&#x27;x&#x27;,&#x27;y&#x27;,&#x27;z&#x27;]) | list | string &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;[&#x27;x&#x27;, &#x27;z&#x27;]&quot;</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Print</span> <span class="string">dict.</span></span><br><span class="line">     <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; [&#x27;x&#x27;,&#x27;y&#x27;] | map(&#x27;extract&#x27;, &#123;&#x27;x&#x27;: 42, &#x27;y&#x27;: 31&#125;) | list | string &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;[42, 31]&quot;</span></span><br></pre></td></tr></table></figure></li><li>使用<code>ansible.builtin.permutations</code>和<code>ansible.builtin.combinations</code>来获取列表的排列与组合。</li><li>使用<code>product</code>来获取两个列表的笛卡尔积。</li><li>使用<code>json_query</code>来获取json的子元素。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#filters.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">json_query</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">&quot;domain_definition&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;domain&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;cluster&quot;:</span> [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;name&quot;:</span> <span class="string">&quot;cluster1&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;name&quot;:</span> <span class="string">&quot;cluster2&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">&quot;server&quot;:</span> [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;name&quot;:</span> <span class="string">&quot;server11&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;cluster&quot;:</span> <span class="string">&quot;cluster1&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;port&quot;:</span> <span class="string">&quot;8080&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;name&quot;:</span> <span class="string">&quot;server12&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;cluster&quot;:</span> <span class="string">&quot;cluster1&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;port&quot;:</span> <span class="string">&quot;8090&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;name&quot;:</span> <span class="string">&quot;server21&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;cluster&quot;:</span> <span class="string">&quot;cluster2&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;port&quot;:</span> <span class="string">&quot;9080&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;name&quot;:</span> <span class="string">&quot;server22&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;cluster&quot;:</span> <span class="string">&quot;cluster2&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;port&quot;:</span> <span class="string">&quot;9090&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">&quot;library&quot;:</span> [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;name&quot;:</span> <span class="string">&quot;lib1&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;target&quot;:</span> <span class="string">&quot;cluster1&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;name&quot;:</span> <span class="string">&quot;lib2&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;target&quot;:</span> <span class="string">&quot;cluster2&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; domain_definition | json_query(&#x27;domain.cluster[*].name&#x27;) | string &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;[&#x27;cluster1&#x27;, &#x27;cluster2&#x27;]&quot;</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; domain_definition | json_query(&#x27;domain.server[?cluster==`cluster1`].port&#x27;) | string &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;[&#x27;8080&#x27;, &#x27;8090&#x27;]&quot;</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; domain_definition | json_query(&#x27;domain.server[?cluster==`cluster2`].&#123;name: name, port: port&#125;&#x27;) | string &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;[&#123;&#x27;name&#x27;: &#x27;server21&#x27;, &#x27;port&#x27;: &#x27;9080&#x27;&#125;, &#123;&#x27;name&#x27;: &#x27;server22&#x27;, &#x27;port&#x27;: &#x27;9090&#x27;&#125;]&quot;</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; domain_definition | json_query(&#x27;domain.server[?starts_with(name, `server1`)].port&#x27;) | string &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;[&#x27;8080&#x27;, &#x27;8090&#x27;]&quot;</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; domain_definition | json_query(&#x27;domain.server[?contains(name, `server1`)].port&#x27;) | string &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;[&#x27;8080&#x27;, &#x27;8090&#x27;]&quot;</span></span><br></pre></td></tr></table></figure></li><li>用<code>random</code>生成随机数。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#filters.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">random</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; [&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;] | random &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;msg&quot;: &quot;a&quot;</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; 60 | random &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;msg&quot;: &quot;39&quot;</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; 101 | random(step=10) &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;msg&quot;: &quot;80&quot;</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; 101 | random(start=1, step=10) &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;msg&quot;: &quot;21&quot;</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; 60 | random(seed=inventory_hostname) &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;msg&quot;: &quot;42&quot;</span></span><br></pre></td></tr></table></figure></li><li>用<code>shuffle</code>可以打乱列表。 <code>&#123;&#123; ['a','b','c'] | shuffle(seed=inventory_hostname) &#125;&#125;</code></li><li>用<code>max</code>, <code>min</code>, <code>flatten</code>处理列表。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#filters.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">list</span> <span class="string">management</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">nums:</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">    <span class="attr">nested_nums:</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, [<span class="number">4</span>, <span class="number">5</span>]]</span><br><span class="line">    <span class="attr">dict_list:</span> [&#123;<span class="attr">&#x27;val&#x27;:</span> <span class="number">1</span>&#125;, &#123;<span class="attr">&#x27;val&#x27;:</span> <span class="number">2</span>&#125;]</span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; nums | min &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;1&quot;</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; nums | max &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;3&quot;</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; dict_list | max(attribute=&#x27;val&#x27;) | string &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;&#123;&#x27;val&#x27;: 2&#125;&quot;</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; nested_nums | flatten(levels=1) | string  &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;[1, 2, 3, 4, 5]&quot;</span></span><br></pre></td></tr></table></figure></li><li>使用<code>unique</code>, <code>union</code>, <code>intersect</code>, <code>difference</code>, <code>symmetric_difference</code>给列表做集合运算。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#filters.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">sets</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">list1:</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">4</span>]</span><br><span class="line">    <span class="attr">list2:</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; list1 | unique | string &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;[1, 2, 3, 4, 5]&quot;</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; list1 | union(list2) | string &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;[1, 2, 3, 4, 5, 6, 7, 8]&quot;</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; list1 | intersect(list2) | string &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;[1, 2]&quot;</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; list1 | difference(list2) | string &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;[3, 4, 5]&quot;</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; list1 | symmetric_difference(list2) | string &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;[3, 4, 5, 6, 7, 8]&quot;</span></span><br></pre></td></tr></table></figure></li><li>使用<code>ipaddr</code>, <code>ipv4</code>, <code>ipv6</code>处理IP地址。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#filters.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">IP</span> <span class="string">address</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">s:</span> <span class="string">&quot;hello9.128.1.1world&quot;</span></span><br><span class="line">    <span class="attr">invalid_ip:</span> <span class="string">&quot;9.1.1.314&quot;</span></span><br><span class="line">    <span class="attr">ip:</span> <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">    <span class="attr">cidr:</span> <span class="string">&quot;192.0.2.1/24&quot;</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; s | ansible.utils.ipaddr &#125;&#125;</span>&quot;</span> <span class="comment"># false</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; s | ansible.utils.ipv4 &#125;&#125;</span>&quot;</span> <span class="comment"># false</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; s | ansible.utils.ipv6 &#125;&#125;</span>&quot;</span> <span class="comment"># false</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; s | ansible.utils.ipaddr(&#x27;address&#x27;) &#125;&#125;</span>&quot;</span> <span class="comment"># false</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; invalid_ip | ansible.utils.ipaddr &#125;&#125;</span>&quot;</span> <span class="comment"># false</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; cidr | ansible.utils.ipaddr(&#x27;address&#x27;) &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;192.0.2.1&quot;</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; ip | ansible.utils.ipv4 &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;127.0.0.1&quot;</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; ip | ansible.utils.ipaddr(&#x27;address&#x27;) &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;127.0.0.1&quot;</span></span><br></pre></td></tr></table></figure></li><li>使用<code>hash</code>, <code>checksum</code>, <code>password_hash</code>加密字符串和密码。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># playbook filters.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">hash,</span> <span class="string">checksum,</span> <span class="string">password_hash</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">pwd:</span> <span class="string">&quot;pass4root&quot;</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; pwd | hash(&#x27;sha1&#x27;) &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;0754b1729f43eb5e37007610e28a47bd60531b97&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; pwd | hash(&#x27;md5&#x27;) &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;f2feffd19d83fdac11a2e29c3e4d7fc6&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; pwd | checksum &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;0754b1729f43eb5e37007610e28a47bd60531b97&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; pwd | password_hash(&#x27;sha512&#x27;) &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;$6$rounds=656000$p3CTKl4HE5zC297h$/7MyWoqFwsug5n0aFaGh3CK2utVkxiuJW5wc04obh/NPPN2YiHe.XHlh4E/QXm4zNkR4zUg4zQEwzSCX03cLt/&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; pwd | password_hash(&#x27;sha256&#x27;, &#x27;mysecretsalt&#x27;) &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;$5$rounds=535000$mysecretsalt$UXdCeKTnnbG1O6cMAPkfEve5t17.eExAsSfxGYmd7H/&quot;</span></span><br></pre></td></tr></table></figure></li><li>使用<code>comment</code>, <code>urlencode</code>, <code>urlsplit</code>处理字符串。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># playbook filters.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">`comment`,</span> <span class="string">`urlencode`,</span> <span class="string">`urlsplit`</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">s:</span> <span class="string">&quot;hello world&quot;</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">&quot;http://user:password@www.example.com:9000/dir/index.html?query=term#fragment&quot;</span></span><br><span class="line">    <span class="attr">crn:</span> <span class="string">&quot;crn:v2:bluemix:uuid:a/accountid&quot;</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; s | comment(decoration=&#x27;# &#x27;, prefix=&#x27;######&#x27;, postfix=&#x27;######&#x27;) &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;######\n# hello world\n######&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; s | comment(&#x27;xml&#x27;) &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;&lt;!--\n -\n - hello world\n -\n--&gt;&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; crn | urlencode &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;crn%3Av2%3Abluemix%3Auuid%3Aa/accountid&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; url | urlsplit(&#x27;hostname&#x27;) &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;www.example.com&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; url | urlsplit | string &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;&#123;&#x27;fragment&#x27;: &#x27;fragment&#x27;, &#x27;hostname&#x27;: &#x27;www.example.com&#x27;, &#x27;netloc&#x27;: &#x27;user:password@www.example.com:9000&#x27;, &#x27;password&#x27;: &#x27;password&#x27;, &#x27;path&#x27;: &#x27;/dir/index.html&#x27;, &#x27;port&#x27;: 9000, &#x27;query&#x27;: &#x27;query=term&#x27;, &#x27;scheme&#x27;: &#x27;http&#x27;, &#x27;username&#x27;: &#x27;user&#x27;&#125;&quot;</span></span><br></pre></td></tr></table></figure></li><li>使用<code>regex_search</code>, <code>regex_findall</code>, <code>regex_replace</code>, <code>regex_escape</code>处理字符串。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># playbook filters.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">`regex_search`,</span> <span class="string">`regex_findall`,</span> <span class="string">`regex_replace`,</span> <span class="string">`regex_escape`</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; &#x27;server1/database42&#x27; | regex_search(&#x27;database[0-9]+&#x27;) &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;database42&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; &#x27;foo\nBAR&#x27; | regex_search(&#x27;^bar&#x27;, multiline=True, ignorecase=True) &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;BAR&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; &#x27;server1/database42&#x27; | regex_search(&#x27;server([0-9]+)/database([0-9]+)&#x27;, &#x27;\\1&#x27;, &#x27;\\2&#x27;) | string &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;[&#x27;1&#x27;, &#x27;42&#x27;]&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; &#x27;21/42&#x27; | regex_search(&#x27;(?P&lt;dividend&gt;[0-9]+)/(?P&lt;divisor&gt;[0-9]+)&#x27;, &#x27;\\g&lt;dividend&gt;&#x27;, &#x27;\\g&lt;divisor&gt;&#x27;) | string &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;[&#x27;21&#x27;, &#x27;42&#x27;]&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; &#x27;ansible&#x27; | regex_search(&#x27;foobar&#x27;) &#125;&#125;</span>&quot;</span> <span class="comment"># &#x27;&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; &#x27;ansible&#x27; | regex_search(&#x27;foobar&#x27;) == &#x27;&#x27; &#125;&#125;</span>&quot;</span> <span class="comment"># False</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; &#x27;ansible&#x27; | regex_search(&#x27;foobar&#x27;) is none &#125;&#125;</span>&quot;</span> <span class="comment"># True</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; &#x27;CAR\ntar\nfoo\nbar\n&#x27; | regex_findall(&#x27;^.ar$&#x27;, multiline=True, ignorecase=True) | string &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;[&#x27;CAR&#x27;, &#x27;tar&#x27;, &#x27;bar&#x27;]&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; &#x27;localhost:80&#x27; | regex_replace(&#x27;^(?P&lt;host&gt;.+):(?P&lt;port&gt;\\d+)$&#x27;, &#x27;\\g&lt;host&gt;, \\g&lt;port&gt;&#x27;) &#125;&#125;</span>&quot;</span> <span class="comment"># &#x27;localhost, 80&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; &#x27;^f.*o(.*)$&#x27; | regex_escape() &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;\\^f\\.\\*o\\(\\.\\*\\)\\$&quot;</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure></li><li>使用<code>basename</code>, <code>dirname</code>, <code>expanduser</code>, <code>expandvars</code>, <code>realpath</code>, <code>relpath</code>, <code>splitext</code>, <code>first</code>, <code>last</code>, <code>path_join</code>处理文件路径。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># playbook filters.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">`basename`,</span> <span class="string">`dirname`,</span> <span class="string">`expanduser`,</span> <span class="string">`expandvars`,</span> <span class="string">`realpath`,</span> <span class="string">`relpath`,</span> <span class="string">`splitext`,</span> <span class="string">`first`,</span> <span class="string">`last`,</span> <span class="string">`path_join`</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">~/sen/a.txt</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; path | basename &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;a.txt&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; path | dirname &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;~/sen&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; path | expanduser &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;/Users/senwang/sen/a.txt&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; path | expandvars &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;~/sen/a.txt&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; path | realpath &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;/Users/senwang/tools/ansible/~/sen/a.txt&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; path | relpath(&#x27;/etc&#x27;) &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;../Users/senwang/tools/ansible/~/sen/a.txt&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; path | splitext &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;(&#x27;~/sen/a&#x27;, &#x27;.txt&#x27;)&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; path | splitext | first &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;~/sen/a&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; (&#x27;/etc&#x27;, &#x27;dir&#x27;, &#x27;subdir&#x27;, &#x27;a.txt&#x27;) | path_join &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;/etc/dir/subdir/a.txt&quot;</span></span><br></pre></td></tr></table></figure></li><li>使用<code>join</code>, <code>split</code>, <code>b64decode</code>, <code>b64encode</code>处理字符串。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># playbook filters.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">`join`,</span> <span class="string">`split`,</span> <span class="string">`b64decode`,</span> <span class="string">`b64encode`</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">types:</span> [<span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;string&#x27;</span>, <span class="string">&#x27;list&#x27;</span>, <span class="string">&#x27;dict&#x27;</span>]</span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; types | join(&#x27;,&#x27;) &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;int,string,list,dict&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; types | join(&#x27;,&#x27;) | split(&#x27;,&#x27;) | string &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;[&#x27;int&#x27;, &#x27;string&#x27;, &#x27;list&#x27;, &#x27;dict&#x27;]&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; &#x27;hello world&#x27; | b64encode | b64decode &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;hello world&quot;</span></span><br></pre></td></tr></table></figure></li><li>使用<code>to_uuid</code>处理UUID。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">`to_uuid`</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; &#x27;string&#x27; | to_uuid &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;c7e8b99c-6668-5b4d-bdf9-26f4c0da60e5&quot;</span></span><br></pre></td></tr></table></figure></li><li>使用<code>to_datetime</code>, <code>strftime</code>处理时间和日期。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># playbook filters.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">`to_datetime`,</span> <span class="string">`strftime`</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; ((&#x27;2016-08-14 20:00:12&#x27; | to_datetime) - (&#x27;2015-12-25&#x27; | to_datetime(&#x27;%Y-%m-%d&#x27;))).total_seconds()  &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;20203212.0&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&#x27;<span class="template-variable">&#123;&#123; ((&quot;2016-08-14 20:00:12&quot; | to_datetime) - (&quot;2016-08-14 18:00:00&quot; | to_datetime)).seconds  &#125;&#125;</span>&#x27;</span> <span class="comment"># &quot;7212&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&#x27;<span class="template-variable">&#123;&#123; ((&quot;2016-08-14 20:00:12&quot; | to_datetime) - (&quot;2015-12-25&quot; | to_datetime(&quot;%Y-%m-%d&quot;))).days  &#125;&#125;</span>&#x27;</span> <span class="comment"># &quot;233&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; &#x27;%H:%M:%S&#x27; | strftime &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;19:42:01&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; &#x27;%Y-%m-%d %H:%M:%S&#x27; | strftime(0) &#125;&#125;</span>&quot;</span> <span class="comment"># &quot;1970-01-01 08:00:00&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; &#x27;%Y-%m-%d&#x27; | strftime(1441357287) &#125;&#125;</span>&quot;</span>  <span class="comment"># &quot;2015-09-04&quot;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="如何在受控节点上以其他用户的身份执行命令？"><a href="#如何在受控节点上以其他用户的身份执行命令？" class="headerlink" title="如何在受控节点上以其他用户的身份执行命令？"></a>如何在受控节点上以其他用户的身份执行命令？</h3><p>可以在play或者task上通过以下配置切换用户身份来执行play或者task。</p><p><code>become</code>: 设置为<code>yes</code>启用用户切换。<br><code>become_user</code>: 指定要切换的用户名，如果不指定默认为<code>root</code>用户。<br><code>become_method</code>: 指定<code>become</code>要使用的插件，如<code>su</code>, <code>sudo</code>等。</p><p>也可以在清单中为<code>group</code>或者节点设置<code>become</code>。</p><ul><li><code>ansible_become</code></li><li><code>ansible_become_user</code></li><li><code>ansible_become_password</code></li><li><code>ansible_become_method</code></li></ul><h3 id="如何在playbook中使用循环"><a href="#如何在playbook中使用循环" class="headerlink" title="如何在playbook中使用循环"></a>如何在playbook中使用循环</h3><ol><li>使用<code>loop</code>遍历简单列表。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># playbook.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">List</span> <span class="string">users</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Show</span> <span class="string">item.</span></span><br><span class="line">      <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">loop:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">user1</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">user2</span></span><br></pre></td></tr></table></figure></li><li>使用<code>loop</code>遍历字典列表。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Add</span> <span class="string">several</span> <span class="string">users</span></span><br><span class="line">  <span class="attr">ansible.builtin.user:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.name &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="attr">groups:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.groups &#125;&#125;</span>&quot;</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&#x27;testuser1&#x27;</span>, <span class="attr">groups:</span> <span class="string">&#x27;wheel&#x27;</span> &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&#x27;testuser2&#x27;</span>, <span class="attr">groups:</span> <span class="string">&#x27;root&#x27;</span> &#125;</span><br></pre></td></tr></table></figure></li><li>使用<code>loop</code>和<code>dict2items</code>遍历字典。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">loop</span> <span class="string">dict</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Using</span> <span class="string">dict2items</span></span><br><span class="line">      <span class="attr">ansible.builtin.debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.key &#125;&#125;</span> - <span class="template-variable">&#123;&#123; item.value &#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">loop:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; tag_data | dict2items &#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">vars:</span></span><br><span class="line">        <span class="attr">tag_data:</span></span><br><span class="line">          <span class="attr">Environment:</span> <span class="string">dev</span></span><br><span class="line">          <span class="attr">Application:</span> <span class="string">payment</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ok: [localhost] =&gt; (item=&#123;<span class="string">&#x27;key&#x27;</span>: <span class="string">&#x27;Environment&#x27;</span>, <span class="string">&#x27;value&#x27;</span>: <span class="string">&#x27;dev&#x27;</span>&#125;) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Environment - dev&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; (item=&#123;<span class="string">&#x27;key&#x27;</span>: <span class="string">&#x27;Application&#x27;</span>, <span class="string">&#x27;value&#x27;</span>: <span class="string">&#x27;payment&#x27;</span>&#125;) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Application - payment&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>使用<code>register</code>将loop的结果保存到变量。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">loop</span> <span class="string">register</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Register</span> <span class="string">loop</span> <span class="string">output</span> <span class="string">as</span> <span class="string">a</span> <span class="string">variable</span></span><br><span class="line">      <span class="attr">ansible.builtin.shell:</span> <span class="string">&quot;echo <span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">loop:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;one&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;two&quot;</span></span><br><span class="line">      <span class="attr">register:</span> <span class="string">echo</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Print</span> <span class="string">echo</span></span><br><span class="line">      <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">var:</span> <span class="string">echo</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">ok: [localhost] =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;echo&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;All items completed&quot;</span>,</span><br><span class="line">        <span class="string">&quot;results&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/opt/homebrew/bin/python3.10&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&quot;ansible_loop_var&quot;</span>: <span class="string">&quot;item&quot;</span>,</span><br><span class="line">                <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&quot;cmd&quot;</span>: <span class="string">&quot;echo one&quot;</span>,</span><br><span class="line">                <span class="string">&quot;delta&quot;</span>: <span class="string">&quot;0:00:00.007707&quot;</span>,</span><br><span class="line">                <span class="string">&quot;end&quot;</span>: <span class="string">&quot;2022-11-20 20:24:53.768577&quot;</span>,</span><br><span class="line">                <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="string">&quot;invocation&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;module_args&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;_raw_params&quot;</span>: <span class="string">&quot;echo one&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;_uses_shell&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                        <span class="string">&quot;argv&quot;</span>: null,</span><br><span class="line">                        <span class="string">&quot;chdir&quot;</span>: null,</span><br><span class="line">                        <span class="string">&quot;creates&quot;</span>: null,</span><br><span class="line">                        <span class="string">&quot;executable&quot;</span>: null,</span><br><span class="line">                        <span class="string">&quot;removes&quot;</span>: null,</span><br><span class="line">                        <span class="string">&quot;stdin&quot;</span>: null,</span><br><span class="line">                        <span class="string">&quot;stdin_add_newline&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                        <span class="string">&quot;strip_empty_ends&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                        <span class="string">&quot;warn&quot;</span>: <span class="literal">false</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&quot;item&quot;</span>: <span class="string">&quot;one&quot;</span>,</span><br><span class="line">                <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;rc&quot;</span>: 0,</span><br><span class="line">                <span class="string">&quot;start&quot;</span>: <span class="string">&quot;2022-11-20 20:24:53.760870&quot;</span>,</span><br><span class="line">                <span class="string">&quot;stderr&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;stderr_lines&quot;</span>: [],</span><br><span class="line">                <span class="string">&quot;stdout&quot;</span>: <span class="string">&quot;one&quot;</span>,</span><br><span class="line">                <span class="string">&quot;stdout_lines&quot;</span>: [</span><br><span class="line">                    <span class="string">&quot;one&quot;</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;ansible_loop_var&quot;</span>: <span class="string">&quot;item&quot;</span>,</span><br><span class="line">                <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&quot;cmd&quot;</span>: <span class="string">&quot;echo two&quot;</span>,</span><br><span class="line">                <span class="string">&quot;delta&quot;</span>: <span class="string">&quot;0:00:00.007317&quot;</span>,</span><br><span class="line">                <span class="string">&quot;end&quot;</span>: <span class="string">&quot;2022-11-20 20:24:53.973643&quot;</span>,</span><br><span class="line">                <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="string">&quot;invocation&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;module_args&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;_raw_params&quot;</span>: <span class="string">&quot;echo two&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;_uses_shell&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                        <span class="string">&quot;argv&quot;</span>: null,</span><br><span class="line">                        <span class="string">&quot;chdir&quot;</span>: null,</span><br><span class="line">                        <span class="string">&quot;creates&quot;</span>: null,</span><br><span class="line">                        <span class="string">&quot;executable&quot;</span>: null,</span><br><span class="line">                        <span class="string">&quot;removes&quot;</span>: null,</span><br><span class="line">                        <span class="string">&quot;stdin&quot;</span>: null,</span><br><span class="line">                        <span class="string">&quot;stdin_add_newline&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                        <span class="string">&quot;strip_empty_ends&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                        <span class="string">&quot;warn&quot;</span>: <span class="literal">false</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&quot;item&quot;</span>: <span class="string">&quot;two&quot;</span>,</span><br><span class="line">                <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;rc&quot;</span>: 0,</span><br><span class="line">                <span class="string">&quot;start&quot;</span>: <span class="string">&quot;2022-11-20 20:24:53.966326&quot;</span>,</span><br><span class="line">                <span class="string">&quot;stderr&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;stderr_lines&quot;</span>: [],</span><br><span class="line">                <span class="string">&quot;stdout&quot;</span>: <span class="string">&quot;two&quot;</span>,</span><br><span class="line">                <span class="string">&quot;stdout_lines&quot;</span>: [</span><br><span class="line">                    <span class="string">&quot;two&quot;</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;skipped&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;warnings&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;Platform darwin on host localhost is using the discovered Python interpreter at /opt/homebrew/bin/python3.10, but future installation of another Python interpreter could change the meaning of that path. See https://docs.ansible.com/ansible-core/2.13/reference_appendices/interpreter_discovery.html for more information.&quot;</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>使用<code>until</code>重试任务直到满足特定条件。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Retry</span> <span class="string">a</span> <span class="string">task</span> <span class="string">until</span> <span class="string">a</span> <span class="string">certain</span> <span class="string">condition</span> <span class="string">is</span> <span class="string">met</span></span><br><span class="line">  <span class="attr">ansible.builtin.shell:</span> <span class="string">/usr/bin/foo</span></span><br><span class="line">  <span class="attr">register:</span> <span class="string">result</span></span><br><span class="line">  <span class="attr">until:</span> <span class="string">result.stdout.find(&quot;all</span> <span class="string">systems</span> <span class="string">go&quot;)</span> <span class="type">!=</span> <span class="number">-1</span></span><br><span class="line">  <span class="attr">retries:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">delay:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure></li><li>使用<code>loop</code>遍历清单。<code>query</code>返回一个列表，<code>lookup</code>默认返回字符串，所以需要指定<code>wantlist=True</code>。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">loop:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; query(&#x27;inventory_hostnames&#x27;, &#x27;all&#x27;) &#125;&#125;</span>&quot;</span></span><br><span class="line"><span class="attr">loop:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; lookup(&#x27;inventory_hostnames&#x27;, &#x27;all&#x27;, wantlist=True) &#125;&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">loop</span> <span class="string">register</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Show</span> <span class="string">all</span> <span class="string">the</span> <span class="string">hosts</span> <span class="string">in</span> <span class="string">the</span> <span class="string">inventory</span></span><br><span class="line">      <span class="attr">ansible.builtin.debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">loop:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; groups[&#x27;all&#x27;] &#125;&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Show</span> <span class="string">all</span> <span class="string">the</span> <span class="string">hosts</span> <span class="string">in</span> <span class="string">the</span> <span class="string">current</span> <span class="string">play</span></span><br><span class="line">      <span class="attr">ansible.builtin.debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">loop:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; ansible_play_batch &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Show</span> <span class="string">all</span> <span class="string">the</span> <span class="string">hosts</span> <span class="string">in</span> <span class="string">the</span> <span class="string">inventory</span></span><br><span class="line">      <span class="attr">ansible.builtin.debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">loop:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; query(&#x27;inventory_hostnames&#x27;, &#x27;all&#x27;) &#125;&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">TASK [Show all the hosts <span class="keyword">in</span> the inventory] </span><br><span class="line">ok: [localhost] =&gt; (item=master-node) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;master-node&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; (item=node-1) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;node-1&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; (item=localhost) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;localhost&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TASK [Show all the hosts <span class="keyword">in</span> the current play] </span><br><span class="line">ok: [localhost] =&gt; (item=localhost) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;localhost&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TASK [Show all the hosts <span class="keyword">in</span> the inventory] </span><br><span class="line">ok: [localhost] =&gt; (item=master-node) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;master-node&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; (item=node-1) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;node-1&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; (item=localhost) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;localhost&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>使用<code>loop_control</code>。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">loop</span> <span class="string">register</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Show</span> <span class="string">all</span> <span class="string">the</span> <span class="string">hosts</span> <span class="string">in</span> <span class="string">the</span> <span class="string">inventory</span></span><br><span class="line">      <span class="attr">ansible.builtin.debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; it &#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">loop:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; groups[&#x27;all&#x27;] &#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">loop_control:</span></span><br><span class="line">        <span class="attr">loop_var:</span> <span class="string">it</span></span><br><span class="line">        <span class="attr">index_var:</span> <span class="string">i</span></span><br><span class="line">        <span class="attr">label:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; i &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">pause:</span> <span class="number">3</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="如何在playbook中使用条件判断语句？"><a href="#如何在playbook中使用条件判断语句？" class="headerlink" title="如何在playbook中使用条件判断语句？"></a>如何在playbook中使用条件判断语句？</h3><ul><li>可以使用<code>when</code>为task指定执行条件。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">when</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">list</span> <span class="string">all</span> <span class="string">files/dirs</span> <span class="string">in</span> <span class="string">$HOME</span> <span class="string">directory.</span></span><br><span class="line">      <span class="attr">command:</span> <span class="string">ls</span> <span class="string">~</span></span><br><span class="line">      <span class="attr">register:</span> <span class="string">result</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">print</span> <span class="string">result</span></span><br><span class="line">      <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">var:</span> <span class="string">result.stdout_lines</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">result.stdout_lines</span> <span class="string">|</span> <span class="string">length</span> <span class="string">&gt;</span> <span class="number">5</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">TASK [list all files/<span class="built_in">dirs</span> <span class="keyword">in</span> <span class="variable">$HOME</span> directory.]</span><br><span class="line">changed: [localhost]</span><br><span class="line">changed: [node-1]</span><br><span class="line">changed: [master-node]</span><br><span class="line"></span><br><span class="line">skipping: [master-node]</span><br><span class="line">skipping: [node-1]</span><br><span class="line">ok: [localhost] =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;result.stdout_lines&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;Desktop&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Documents&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Downloads&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Library&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Movies&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Music&quot;</span>,</span><br><span class="line">...</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>也可以使用<code>when</code>来根据前一个任务的状态做不同的处理。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">when</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">list</span> <span class="string">all</span> <span class="string">files/dirs</span> <span class="string">in</span> <span class="string">$HOME</span> <span class="string">directory.</span></span><br><span class="line">      <span class="attr">command:</span> <span class="string">ls</span> <span class="string">~</span></span><br><span class="line">      <span class="attr">register:</span> <span class="string">result</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">print</span> <span class="string">result</span></span><br><span class="line">      <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">var:</span> <span class="string">result.stdout_lines</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">result.stdout_lines</span> <span class="string">|</span> <span class="string">length</span> <span class="string">&gt;</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">register:</span> <span class="string">r</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">print</span> <span class="string">succeeded</span></span><br><span class="line">      <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;Task on <span class="template-variable">&#123;&#123; inventory_hostname &#125;&#125;</span> succeeded.&quot;</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">r</span> <span class="string">is</span> <span class="string">succeeded</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">print</span> <span class="string">failed</span></span><br><span class="line">      <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;Task on <span class="template-variable">&#123;&#123; inventory_hostname &#125;&#125;</span> failed.&quot;</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">r</span> <span class="string">is</span> <span class="string">failed</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">print</span> <span class="string">skipped</span></span><br><span class="line">      <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;Task on <span class="template-variable">&#123;&#123; inventory_hostname &#125;&#125;</span> skipped.&quot;</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">r</span> <span class="string">is</span> <span class="string">skipped</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">TASK [list all files/<span class="built_in">dirs</span> <span class="keyword">in</span> <span class="variable">$HOME</span> directory.]</span><br><span class="line">changed: [localhost]</span><br><span class="line">changed: [node-1]</span><br><span class="line">changed: [master-node]</span><br><span class="line"></span><br><span class="line">TASK [<span class="built_in">print</span> result] </span><br><span class="line">skipping: [master-node]</span><br><span class="line">ok: [localhost] =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;result.stdout_lines&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;Desktop&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Documents&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Downloads&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Library&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Movies&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Music&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Pictures&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Public&quot;</span>,</span><br><span class="line">        <span class="string">&quot;data&quot;</span>,</span><br><span class="line">        <span class="string">&quot;go&quot;</span>,</span><br><span class="line">        <span class="string">&quot;projects&quot;</span>,</span><br><span class="line">        <span class="string">&quot;sdk&quot;</span>,</span><br><span class="line">        <span class="string">&quot;tmp&quot;</span>,</span><br><span class="line">        <span class="string">&quot;tools&quot;</span>,</span><br><span class="line">        <span class="string">&quot;vpc&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">skipping: [node-1]</span><br><span class="line"></span><br><span class="line">ok: [master-node] =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Task on master-node succeeded.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [node-1] =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Task on node-1 succeeded.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Task on localhost succeeded.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TASK [<span class="built_in">print</span> failed]</span><br><span class="line">skipping: [master-node]</span><br><span class="line">skipping: [node-1]</span><br><span class="line">skipping: [localhost]</span><br><span class="line"></span><br><span class="line">TASK [<span class="built_in">print</span> skipped] </span><br><span class="line">skipping: [localhost]</span><br><span class="line">ok: [master-node] =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Task on master-node skipped.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [node-1] =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Task on node-1 skipped.&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>当<code>when</code>和<code>import_tasks: tasks.yaml</code>一起使用时，tasks.yaml中的task也会判断<code>when</code>后面的条件。</li><li>当<code>when</code>和<code>include_tasks: tasks.yaml</code>一起使用时，tasks.yaml中的task不会去做<code>when</code>判断。</li><li>常用的用于条件测试的facts：<table><thead><tr><th>fact</th><th>description</th></tr></thead><tbody><tr><td><code>ansible_facts[&#39;distribution&#39;]</code></td><td>操作系统发行版名称，如<code>Redhat</code></td></tr><tr><td><code>ansible_facts[&#39;distribution_major_version&#39;]</code></td><td>操作系统发行版主版本号，如<code>16</code></td></tr><tr><td><code>ansible_facts[&#39;os_family&#39;]</code></td><td>操作系统发行版家族，如<code>Redhat</code>，<code>Debian</code>等</td></tr></tbody></table></li></ul><h3 id="如何写条件判断语句中测试？"><a href="#如何写条件判断语句中测试？" class="headerlink" title="如何写条件判断语句中测试？"></a>如何写条件判断语句中测试？</h3><ul><li>语法： <code>variable is test_name</code> 例如： <code>result is failed</code></li><li>可以用<code>match</code>, <code>search</code>, <code>regex</code>测试字符创。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">string</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">connection:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">&quot;https://example.com/users/foo/resources/bar&quot;</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;url not match: false.&quot;</span> <span class="comment"># &quot;url not match: false.&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">url</span> <span class="string">is</span> <span class="string">not</span> <span class="string">match(&quot;example.com/users/.*/resources&quot;)</span> <span class="comment"># 必须从字符串开始就匹配</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;url match: true.&quot;</span> <span class="comment"># &quot;url match: true.&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">url</span> <span class="string">is</span> <span class="string">match(&quot;https://example.com/users/.*/resources&quot;)</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;url search: true.&quot;</span> <span class="comment"># &quot;url search: true.&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">url</span> <span class="string">is</span> <span class="string">search(&quot;users/.*/resources/.*&quot;)</span>  <span class="comment"># 不要求从字符串开始就匹配</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;url regex: true&quot;</span> <span class="comment"># &quot;url regex: true&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">url</span> <span class="string">is</span> <span class="string">regex(&quot;example\.com/\w+/foo&quot;)</span></span><br></pre></td></tr></table></figure></li><li>用<code>vault_encrypted</code>测试变量是否vault的加密值。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ ansible-vault encrypt_string --vault-id dev --ask-vault-password --output password.yaml <span class="string">&quot;pass4root&quot;</span> --name passwd</span><br><span class="line">$ cat password.yaml</span><br><span class="line">passwd: !vault |</span><br><span class="line">          <span class="variable">$ANSIBLE_VAULT</span>;1.1;AES256</span><br><span class="line">          62343061653433353330663564333233356439306535663837346631393737646538626164366664</span><br><span class="line">          6532303034383336366530326438396536343232366131390a313863383336323838643863376663</span><br><span class="line">          61383561323338353031363861633032616135316638393139616161306538333563363038653665</span><br><span class="line">          3137616362386362380a643061326663396436393430343830653836636134626463613863613732</span><br><span class="line">          6539%</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">vault_encrypted</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars_files:</span> <span class="string">password.yaml</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&#x27;<span class="template-variable">&#123;&#123; (passwd is vault_encrypted) | ternary(&quot;Vault encrypted&quot;, &quot;Not vault encrypted&quot;) &#125;&#125;</span>&#x27;</span> <span class="comment"># &quot;Vault encrypted&quot;</span></span><br></pre></td></tr></table></figure></li><li>用<code>truthy</code>和<code>falsy</code>来判断布尔值。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">truthy</span> <span class="string">and</span> <span class="string">falsy</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span> is Truthy&quot;</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">item</span> <span class="string">is</span> <span class="string">truthy(convert_bool=True)</span></span><br><span class="line">      <span class="attr">loop:</span> [<span class="string">&quot;&quot;</span>, <span class="number">0</span>, &#123;&#125;, [], <span class="string">&quot;hello world&quot;</span>, <span class="number">1</span>, &#123;<span class="attr">&quot;key&quot;:</span> <span class="string">&quot;value&quot;</span>&#125;, [<span class="number">1</span>]]</span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span> is Falsy&quot;</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">item</span> <span class="string">is</span> <span class="string">falsy(convert_bool=True)</span></span><br><span class="line">      <span class="attr">loop:</span> [<span class="string">&quot;&quot;</span>, <span class="number">0</span>, &#123;&#125;, [], <span class="string">&quot;hello world&quot;</span>, <span class="number">1</span>, &#123;<span class="attr">&quot;key&quot;:</span> <span class="string">&quot;value&quot;</span>&#125;, [<span class="number">1</span>]]</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">ok: [localhost] =&gt; (item=hello world) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;hello world is Truthy&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; (item=1) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;1 is Truthy&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; (item=&#123;<span class="string">&#x27;key&#x27;</span>: <span class="string">&#x27;value&#x27;</span>&#125;) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;&#123;&#x27;key&#x27;: &#x27;value&#x27;&#125; is Truthy&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; (item=[1]) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;[1] is Truthy&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ok: [localhost] =&gt; (item=) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot; is Falsy&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; (item=0) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;0 is Falsy&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; (item=&#123;&#125;) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;&#123;&#125; is Falsy&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; (item=[]) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;[] is Falsy&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>使用<code>version</code>比较版本号。可用的操作符包括<code>&lt;, lt, &lt;=, le, &gt;, gt, &gt;=, ge, ==, =, eq, !=, &lt;&gt;, ne</code>。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">version</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">master</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;OS version <span class="template-variable">&#123;&#123; ansible_facts[&#x27;distribution_version&#x27;] &#125;&#125;</span> &gt;= 1.0&quot;</span> <span class="comment"># &quot;OS version 22.04 &gt;= 1.0&quot;</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_facts[&#x27;distribution_version&#x27;]</span> <span class="string">is</span> <span class="string">version(&#x27;1.0&#x27;,</span> <span class="string">&#x27;&gt;=&#x27;</span><span class="string">)</span></span><br></pre></td></tr></table></figure></li><li>使用<code>superset</code>和<code>subset</code>来比较集合。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">superset</span> <span class="string">and</span> <span class="string">subset</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">a:</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">    <span class="attr">b:</span> [<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">          <span class="attr">msg:</span> <span class="string">&quot;A includes B&quot;</span> <span class="comment"># &quot;A includes B&quot;</span></span><br><span class="line">        <span class="attr">when:</span> <span class="string">a</span> <span class="string">is</span> <span class="string">superset(b)</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">          <span class="attr">msg:</span> <span class="string">&quot;B is included in A&quot;</span> <span class="comment"># &quot;B is included in A&quot;</span></span><br><span class="line">        <span class="attr">when:</span> <span class="string">b</span> <span class="string">is</span> <span class="string">subset(a)</span></span><br></pre></td></tr></table></figure></li><li>使用<code>all</code>和<code>any</code>判断列表里的值是否全部为truthy。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">all</span> <span class="string">and</span> <span class="string">any</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">mylist:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">1</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; 3 == 3 &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="literal">True</span></span><br><span class="line">    <span class="attr">myotherlist:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="literal">False</span></span><br><span class="line">        <span class="bullet">-</span> <span class="literal">True</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;all are true!&quot;</span> <span class="comment"># &quot;all are true!&quot;</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">mylist</span> <span class="string">is</span> <span class="string">all</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;at least one is true&quot;</span> <span class="comment"># &quot;at least one is true&quot;</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">myotherlist</span> <span class="string">is</span> <span class="string">any</span></span><br></pre></td></tr></table></figure></li><li>使用<code>directory, file, link, exists, abs, same_file, mount</code>来判断路径。</li><li>使用<code>human_readable</code>和<code>human_to_bytes</code>转换字节数。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">human_readable</span> <span class="string">and</span> <span class="string">human_to_bytes</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;Human Readable&quot;</span></span><br><span class="line">      <span class="attr">assert:</span> <span class="comment"># &quot;All assertions passed&quot;</span></span><br><span class="line">        <span class="attr">that:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&#x27;&quot;1.00 Bytes&quot; == 1|human_readable&#x27;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&#x27;&quot;1.00 bits&quot; == 1|human_readable(isbits=True)&#x27;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&#x27;&quot;10.00 KB&quot; == 10240|human_readable&#x27;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&#x27;&quot;97.66 MB&quot; == 102400000|human_readable&#x27;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&#x27;&quot;0.10 GB&quot; == 102400000|human_readable(unit=&quot;G&quot;)&#x27;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&#x27;&quot;0.10 Gb&quot; == 102400000|human_readable(isbits=True, unit=&quot;G&quot;)&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;Human to Bytes&quot;</span></span><br><span class="line">      <span class="attr">assert:</span>  <span class="comment"># &quot;All assertions passed&quot;</span></span><br><span class="line">        <span class="attr">that:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;&#x27;0&#x27;|human_to_bytes&#125;&#125;</span>        == 0&quot;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;&#x27;0.1&#x27;|human_to_bytes&#125;&#125;</span>      == 0&quot;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;&#x27;0.9&#x27;|human_to_bytes&#125;&#125;</span>      == 1&quot;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;&#x27;1&#x27;|human_to_bytes&#125;&#125;</span>        == 1&quot;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;&#x27;10.00 KB&#x27;|human_to_bytes&#125;&#125;</span> == 10240&quot;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;   &#x27;11 MB&#x27;|human_to_bytes&#125;&#125;</span> == 11534336&quot;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;  &#x27;1.1 GB&#x27;|human_to_bytes&#125;&#125;</span> == 1181116006&quot;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;&#x27;10.00 Kb&#x27;|human_to_bytes(isbits=True)&#125;&#125;</span> == 10240&quot;</span></span><br></pre></td></tr></table></figure></li><li>使用<code>string, mapping, iterable, sequence, integer, number, float</code>判断数据类型。</li></ul><h3 id="如何获取用户输入？"><a href="#如何获取用户输入？" class="headerlink" title="如何获取用户输入？"></a>如何获取用户输入？</h3><p>Ansible可以在play中用<code>vars_prompt</code>获取用户输入。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">vars_prompt</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars_prompt:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">username</span></span><br><span class="line">      <span class="attr">prompt:</span> <span class="string">What&#x27;s</span> <span class="string">your</span> <span class="string">user</span> <span class="string">name?</span></span><br><span class="line">      <span class="attr">private:</span> <span class="literal">false</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">password</span></span><br><span class="line">      <span class="attr">prompt:</span> <span class="string">what&#x27;s</span> <span class="string">your</span> <span class="string">password?</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">Username</span> <span class="string">is</span> &#123;&#123; <span class="string">username</span> &#125;&#125;</span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">Password</span> <span class="string">is</span> &#123;&#123; <span class="string">password</span> &#125;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ ansible-playbook -i hosts.yaml playbook.yaml</span><br><span class="line">What<span class="string">&#x27;s your user name?: Sen Wang</span></span><br><span class="line"><span class="string">what&#x27;</span>s your password?:</span><br><span class="line"></span><br><span class="line">PLAY [Example <span class="keyword">for</span> vars_prompt]</span><br><span class="line"></span><br><span class="line">TASK [debug]</span><br><span class="line">ok: [localhost] =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Username is Sen Wang&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TASK [debug]</span><br><span class="line">ok: [localhost] =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Password is 123456&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PLAY RECAP</span><br><span class="line">localhost                  : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</span><br></pre></td></tr></table></figure><h3 id="什么是fact和magic-variable"><a href="#什么是fact和magic-variable" class="headerlink" title="什么是fact和magic variable?"></a>什么是fact和magic variable?</h3><p>fact:</p><ul><li>Ansible facts是保存受控节点的系统信息的变量。在playbook中可以使用<code>ansible_facts</code>引用。</li><li>可以在play中使用<code>gather_facts: false</code>来禁止搜集受控节点信息并赋值给<code>ansible_facts</code>。</li><li>可以在<code>/etc/ansible/facts.d/x.fact</code>ini文件中设置自定义fact。然后用<code>ansible_local.x.section.var</code>来引用。</li></ul><p>Ansible magic variables是ansible的内置变量，用于保存ansible自身的一些信息。</p><ul><li><code>hostvars</code>: 保存所有受控节点的信息。</li><li><code>groups</code>: 保存清单中所有的group信息。</li><li><code>group_names</code>: 保存当前节点所在的所有组的信息。</li><li><code>inventory_hostname</code>: 保存当前节点的主机名。</li><li><code>ansible_play_hosts</code>: 保存当前play中所有active的主机名。</li><li><code>ansible_play_batch</code>: 保存当前play中正在运行的一批主机名，主机的个数和<code>serial</code>一致。</li><li><code>ansible_playbook_python</code>: 保存用于调用ansible命令行的python可执行文件路径。</li><li><code>inventory_dir</code>: 保存清单文件所在目录的路径。</li><li><code>playbook_dir</code>: 保存playbook所在目录的路径。</li><li><code>inventory_file</code>: 保存清单文件的路径。</li><li><code>role_path</code>: 只能在role中引用，保存当前role的路径。</li><li><code>ansible_check_mode</code>: 是否在命令行中使用<code>--check</code>启用了check mode。</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">magic</span> <span class="string">variables.</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">set_fact:</span></span><br><span class="line">        <span class="attr">magic_var_list:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; [hostvars[&#x27;master-node&#x27;].ansible_forks, groups, group_names, inventory_hostname, ansible_play_hosts, ansible_play_batch, ansible_playbook_python, inventory_dir, inventory_file, playbook_dir, ansible_check_mode] &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">       <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">loop:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; magic_var_list &#125;&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">$ ansible-playbook -i hosts.yaml playbook.yaml</span><br><span class="line"></span><br><span class="line">PLAY [Example <span class="keyword">for</span> magic variables.] </span><br><span class="line"></span><br><span class="line">TASK [set_fact]</span><br><span class="line">ok: [localhost]</span><br><span class="line"></span><br><span class="line">TASK [debug]</span><br><span class="line">ok: [localhost] =&gt; (item=5) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: 5</span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; (item=&#123;<span class="string">&#x27;all&#x27;</span>: [<span class="string">&#x27;master-node&#x27;</span>, <span class="string">&#x27;node-1&#x27;</span>, <span class="string">&#x27;localhost&#x27;</span>], <span class="string">&#x27;ungrouped&#x27;</span>: [], <span class="string">&#x27;master&#x27;</span>: [<span class="string">&#x27;master-node&#x27;</span>], <span class="string">&#x27;nodes&#x27;</span>: [<span class="string">&#x27;node-1&#x27;</span>], <span class="string">&#x27;prod&#x27;</span>: [<span class="string">&#x27;master-node&#x27;</span>, <span class="string">&#x27;node-1&#x27;</span>], <span class="string">&#x27;local&#x27;</span>: [<span class="string">&#x27;localhost&#x27;</span>]&#125;) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;all&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;master-node&quot;</span>,</span><br><span class="line">            <span class="string">&quot;node-1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;localhost&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;local&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;localhost&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;master&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;master-node&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;nodes&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;node-1&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;prod&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;master-node&quot;</span>,</span><br><span class="line">            <span class="string">&quot;node-1&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;ungrouped&quot;</span>: []</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; (item=[<span class="string">&#x27;local&#x27;</span>]) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;local&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; (item=localhost) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;localhost&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; (item=[<span class="string">&#x27;localhost&#x27;</span>]) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;localhost&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; (item=[<span class="string">&#x27;localhost&#x27;</span>]) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;localhost&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; (item=/opt/homebrew/Cellar/ansible/6.2.0/libexec/bin/python3.10) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;/opt/homebrew/Cellar/ansible/6.2.0/libexec/bin/python3.10&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; (item=/Users/senwang/tools/ansible) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;/Users/senwang/tools/ansible&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; (item=/Users/senwang/tools/ansible/hosts.yaml) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;/Users/senwang/tools/ansible/hosts.yaml&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; (item=/Users/senwang/tools/ansible) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;/Users/senwang/tools/ansible&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [localhost] =&gt; (item=False) =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PLAY RECAP</span><br><span class="line">localhost                  : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</span><br></pre></td></tr></table></figure><h3 id="如何使用role？"><a href="#如何使用role？" class="headerlink" title="如何使用role？"></a>如何使用role？</h3><p>role将变量、task、文件、handlers及其他的ansible元素以一定的目录结构组织起来，从而到达可重用及分享的目的。</p><p>role的目录结构如下：</p><ul><li>tasks/main.yml: role执行的task都放在该目录下。</li><li>handlers/main.yml: 存放role的handlers。</li><li>library/my_module.py: 存放自定义的module。</li><li>defaults/main.yml: 存放默认变量。</li><li>vars/main.yml: 存放其他变量。</li><li>files/main.yml: 存放文件。</li><li>templates/main.yml: 存放templates。</li><li>meta/main.yml: 存放role的metadata，包括role的依赖以及Galaxy的metadata。role所依赖的其他role会在这里指定，并且优先于role定义的task执行。</li><li>meta/argument_specs.yml: 如果role中有这个文件，那么在执行role时会先跑一个task来检查role的参数。</li></ul><p>role必须包含至少一个上述的目录。</p><p>Ansible查找role的路径优先级如下：</p><ul><li>collection</li><li>和playbook同目录下的roles目录</li><li>roles_path指定的目录。默认值为：<code>~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles</code></li><li>playbook同目录</li></ul><p>用以下的方式引用role：</p><ul><li>play level使用<code>roles</code>静态引入</li><li>tasks level使用<code>include_role</code>动态引入</li><li>tasks level使用<code>import_role</code>静态引入</li></ul><p>引入role之后，play执行的顺序：</p><ul><li>play中定义的pre_tasks。</li><li>pre_tasks notify的handlers。</li><li>定义在roles中的role按顺序执行。</li><li>play定义的tasks。</li><li>role和task notify的handlers。</li><li>play中定义的post_tasks。</li><li>post_tasks notify的handlers。</li></ul><h3 id="如何理解动态的include和静态的import？"><a href="#如何理解动态的include和静态的import？" class="headerlink" title="如何理解动态的include和静态的import？"></a>如何理解动态的include和静态的import？</h3><p>playbook可以使用include动态地引入<code>task</code>,<code>role</code>和<code>variable</code>，也可使用import静态的引入<code>playbook</code>,<code>role</code>和<code>task</code>。<br>所谓静态，指的是ansible在运行开始就把被import的playbook/task/role引入playbook中，其task跟普通的task类似。而用include动态引入task/role，则是在执行到include的时候，用一个task将被引入的task/role引入进来。这样导致了import和include有如下区别。</p><table><thead><tr><th></th><th>include</th><th>import</th></tr></thead><tbody><tr><td>类型</td><td>动态</td><td>静态</td></tr><tr><td>处理时机</td><td>运行时遇到的时候处理</td><td>解析playbook的时候预处理</td></tr><tr><td>是否可以引入playbook</td><td>只能引入task/role</td><td>可以引入playbook</td></tr><tr><td>task的选项</td><td>只作用于该task</td><td>作用于被引入的所有task</td></tr><tr><td>是否可以用于loop</td><td>可以</td><td>不可以</td></tr><tr><td>–list-tags/–list-tasks</td><td>被引入的task/tag不可见</td><td>可以列出</td></tr><tr><td>notify handler</td><td>被引入的handler/task只能被整体执行</td><td>可以单独notify被引入的某一个task/handler</td></tr></tbody></table><h3 id="如何在受控节点之外的节点上运行task"><a href="#如何在受控节点之外的节点上运行task" class="headerlink" title="如何在受控节点之外的节点上运行task?"></a>如何在受控节点之外的节点上运行task?</h3><p>在task中使用<code>delegate_to</code>可以将task委派给其他的节点执行。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">delegate_to</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">master</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">list</span> <span class="string">all</span> <span class="string">files/dirs</span> <span class="string">in</span> <span class="string">$HOME</span> <span class="string">directory.</span></span><br><span class="line">      <span class="attr">command:</span> <span class="string">&#x27;ls&#x27;</span></span><br><span class="line">      <span class="attr">register:</span> <span class="string">result</span></span><br><span class="line">      <span class="attr">delegate_to:</span> <span class="string">node-1</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">print</span> <span class="string">result</span></span><br><span class="line">      <span class="attr">ansible.builtin.debug:</span></span><br><span class="line">        <span class="attr">var:</span> <span class="string">result.stdout_lines</span> <span class="comment"># [&quot;file_on_node_1&quot;, &quot;snap&quot;]</span></span><br></pre></td></tr></table></figure><p>也可以使用<code>local_action</code>在控制节点上运行task。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">delegate_to</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">master</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">list</span> <span class="string">all</span> <span class="string">files/dirs</span> <span class="string">in</span> <span class="string">$HOME</span> <span class="string">directory.</span></span><br><span class="line">      <span class="attr">local_action:</span> <span class="string">command</span> <span class="string">ls</span> <span class="string">~</span></span><br><span class="line">      <span class="attr">register:</span> <span class="string">result</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">print</span> <span class="string">result</span></span><br><span class="line">      <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">var:</span> <span class="string">result.stdout_lines</span> <span class="comment"># [&quot;Desktop&quot;, &quot;Documents&quot;, &quot;Downloads&quot;, &quot;Library&quot;...]</span></span><br></pre></td></tr></table></figure><p>ansible默认收集的是当前受控节点的facts，如果希望收集delegate_to节点的facts可以用<code>delegate_facts: true</code>设置。</p><h3 id="如何使用handler？"><a href="#如何使用handler？" class="headerlink" title="如何使用handler？"></a>如何使用handler？</h3><ul><li>handler是一种特殊的task，它只有被别的task使用<code>notify</code>通知且通知的task的状态为<code>changed</code>时才会运行。</li><li>可以使用<code>listen</code>让多个handler监听同一个notify。</li><li>handler通常只在一组task或者role之后运行一次，即使它被多次notify。</li><li>可以在task中使用<code>meta: flush_handlers</code>提前运行handler。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">handler</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">file_name:</span> <span class="string">&quot;a.txt&quot;</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">a</span> <span class="string">new</span> <span class="string">file.</span></span><br><span class="line">      <span class="attr">file:</span> </span><br><span class="line">        <span class="attr">path:</span> <span class="string">&quot;~/<span class="template-variable">&#123;&#123; file_name &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">touch</span></span><br><span class="line">      <span class="attr">notify:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Print</span> <span class="string">file</span> <span class="string">created</span></span><br><span class="line">  <span class="attr">handlers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Print</span> <span class="string">file</span> <span class="string">created</span></span><br><span class="line">      <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;File <span class="template-variable">&#123;&#123; file_name &#125;&#125;</span> created.&quot;</span> <span class="comment"># File a.txt created.</span></span><br><span class="line">      <span class="attr">listen:</span> <span class="string">Print</span> <span class="string">message</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="如何处理错误？"><a href="#如何处理错误？" class="headerlink" title="如何处理错误？"></a>如何处理错误？</h3><ul><li>一个task在某个节点执行失败后(状态为failed)，后续的task也不会在该节点上执行了。 可以使用<code>ignore_errors: true</code>来继续执行后续的task。</li><li>使用<code>ignore_unreachable: true</code>来忽略网络错误。</li><li>使用<code>meta: clear_host_error</code>来清空被标记为unreachable的节点，后续的task才能重新尝试去连接这些主机。</li><li>handler在task失败后就不会被触发，可以在play上指定<code>force_handlers: True</code>来强制运行handler。</li><li>使用<code>failed_when</code>和<code>changed_when</code>来定义task是成功还是失败。</li><li>使用<code>any_errors_fatal: true</code>在第一个失败的任务后中断所有任务和play的执行。</li><li><code>max_fail_percentage: 30</code>指定在30%的主机执行任务失败后终止后续任务和play的执行。</li></ul><h3 id="如何给受控节点设置环境变量？"><a href="#如何给受控节点设置环境变量？" class="headerlink" title="如何给受控节点设置环境变量？"></a>如何给受控节点设置环境变量？</h3><p>可以在play,block,task级别使用<code>environment</code>给受控节点设置环境变量。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">for</span> <span class="string">environment</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">master</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">print</span> <span class="string">environment</span> <span class="string">variable</span></span><br><span class="line">      <span class="attr">command:</span> <span class="string">echo</span> <span class="string">$key</span></span><br><span class="line">      <span class="attr">environment:</span></span><br><span class="line">        <span class="attr">key:</span> <span class="string">value</span></span><br><span class="line">      <span class="attr">register:</span> <span class="string">result</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">Print</span> <span class="string">result</span></span><br><span class="line">  <span class="attr">handlers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Print</span> <span class="string">result</span></span><br><span class="line">      <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">var:</span> <span class="string">result.stdout_lines</span> <span class="comment"># [&quot;value&quot;]</span></span><br></pre></td></tr></table></figure><h3 id="如何使用ansible模块？"><a href="#如何使用ansible模块？" class="headerlink" title="如何使用ansible模块？"></a>如何使用ansible模块？</h3><p>Ansible module是最终跑在受控节点上的ansible组件，负责完成任务，维护受控节点状态并最终给控制节点返回结果。</p><ul><li>可以用<code>$ ansible-doc -l</code>查看所有的模块。</li><li>可以在play, block, task level用<code>module_defaults</code>给ansible模块指定默认参数。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">module_defaults:</span></span><br><span class="line">    <span class="attr">ansible.builtin.file:</span></span><br><span class="line">      <span class="attr">owner:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">group:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">mode:</span> <span class="number">0755</span></span><br><span class="line">  <span class="string">...</span></span><br></pre></td></tr></table></figure></li><li>可以在<code>/etc/ansible/plugin_filters.yml</code>文件中禁止ansible加载指定的模块。</li></ul><h3 id="什么是Ansible插件"><a href="#什么是Ansible插件" class="headerlink" title="什么是Ansible插件?"></a>什么是Ansible插件?</h3><p>Ansible 插件(plugin)是对Ansible核心功能的增强，plugin可以分为如下几类：</p><ul><li>Action plugins</li><li>Become plugins</li><li>Cache plugins</li><li>Callback plugins</li><li>Cliconf plugins</li><li>Connection plugins</li><li>Docs fragments</li><li>Filter plugins</li><li>Httpapi plugins</li><li>Inventory plugins</li><li>Lookup plugins</li><li>Modules</li><li>Module utilities</li><li>Netconf plugins</li><li>Shell plugins</li><li>Strategy plugins</li><li>Terminal plugins</li><li>Test plugins</li><li>Vars plugins</li></ul><p>可以在<a href="https://docs.ansible.com/ansible/latest/plugins/plugins.html">这里</a>获得所有插件的说明。</p><h3 id="Collection是什么？"><a href="#Collection是什么？" class="headerlink" title="Collection是什么？"></a>Collection是什么？</h3><p>Collection是Ansible的分发格式，也就是所谓的包，用户可以把自己的role,playbook,module,plugin以collection的形式放在分发服务器上，供其他用户安装使用。可以在<a href="https://docs.ansible.com/ansible/latest/collections/index.html#list-of-collections">这里</a>找到官方仓库的collection列表。<br>要使用一个collection，用户需要：</p><ol><li>使用命令<code>$ ansible-galaxy collection list</code>查看已经安装的collection。</li><li>使用命令<code>$ ansible-galaxy collection install space_name.collection_name</code>安装一个collection。</li><li>安装完成之后就可以在playbook的task中以<code>space_name.collection_name.module_name</code>来使用了。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ansible </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenAPI 概要</title>
      <link href="/2022/06/06/OpenAPI-%E6%A6%82%E8%A6%81/"/>
      <url>/2022/06/06/OpenAPI-%E6%A6%82%E8%A6%81/</url>
      
        <content type="html"><![CDATA[<h1 id="OpenAPI是什么？"><a href="#OpenAPI是什么？" class="headerlink" title="OpenAPI是什么？"></a>OpenAPI是什么？</h1><p>OpenAPI被用来描述基于HTTP的API，是目前被广泛接受和使用的API工业标准。</p><h1 id="使用OpenAPI规范的优势"><a href="#使用OpenAPI规范的优势" class="headerlink" title="使用OpenAPI规范的优势"></a>使用OpenAPI规范的优势</h1><ul><li>可以使用工具检查用户定义的API是否满足OpenAPI特定版本的规范，语法是否正确等。</li><li>可以检查请求和响应中的数据是否正确。</li><li>可以自动生成API文档。</li><li>自动生成客户端和服务端的代码。</li><li>可以用图形化工具快速、方便地创建API描述文件。</li><li>可以在写代码之前创建提供示例响应的伪HTTP服务器。</li><li>在API定义阶段就可以发现一些可能出现的安全漏洞。</li></ul><h1 id="API描述文件"><a href="#API描述文件" class="headerlink" title="API描述文件"></a>API描述文件</h1><p> API描述文件是一个机器可读的API定义文件。它应该是尽量完整的、细致的、明确的。开发者可以使用API描述文件来自动生成API文档以及代码。</p><p> 格式: JSON 或者 YAML</p><h3 id="最小化结构"><a href="#最小化结构" class="headerlink" title="最小化结构:"></a>最小化结构:</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">openapi:</span> <span class="number">3.1</span><span class="number">.0</span> <span class="comment"># OpenAPI版本</span></span><br><span class="line"><span class="attr">info:</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">A</span> <span class="string">minimal</span> <span class="string">OpenAPI</span> <span class="string">document</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">0.0</span><span class="number">.1</span> <span class="comment"># API版本</span></span><br><span class="line"><span class="attr">paths:</span> &#123;&#125; <span class="comment"># No endpoints defined</span></span><br></pre></td></tr></table></figure><h3 id="Servers对象"><a href="#Servers对象" class="headerlink" title="Servers对象"></a>Servers对象</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">servers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">url:</span> <span class="string">https://&#123;username&#125;.server.com:&#123;port&#125;/&#123;version&#125;</span></span><br><span class="line">    <span class="attr">variables:</span></span><br><span class="line">      <span class="attr">username:</span></span><br><span class="line">        <span class="attr">default:</span> <span class="string">demo</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">This</span> <span class="string">value</span> <span class="string">is</span> <span class="string">assigned</span> <span class="string">by</span> <span class="string">the</span> <span class="string">service</span> <span class="string">provider.</span></span><br><span class="line">      <span class="attr">port:</span></span><br><span class="line">        <span class="attr">enum:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&quot;8443&quot;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&quot;443&quot;</span></span><br><span class="line">        <span class="attr">default:</span> <span class="string">&quot;8443&quot;</span></span><br><span class="line">      <span class="attr">version:</span></span><br><span class="line">        <span class="attr">default:</span> <span class="string">v1</span></span><br></pre></td></tr></table></figure><h3 id="路径对象"><a href="#路径对象" class="headerlink" title="路径对象:"></a>路径对象:</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/board:</span> <span class="comment"># URI</span></span><br><span class="line">    <span class="attr">get:</span> <span class="comment"># HTTP方法</span></span><br><span class="line">      <span class="string">...</span></span><br><span class="line">    <span class="attr">put:</span></span><br><span class="line">      <span class="string">...</span></span><br></pre></td></tr></table></figure><h3 id="方法对象"><a href="#方法对象" class="headerlink" title="方法对象:"></a>方法对象:</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">get:</span></span><br><span class="line">  <span class="attr">summary:</span> <span class="string">Get</span> <span class="string">the</span> <span class="string">whole</span> <span class="string">board</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">Retrieves</span> <span class="string">the</span> <span class="string">current</span> <span class="string">state</span> <span class="string">of</span> <span class="string">the</span> <span class="string">board</span> <span class="string">and</span> <span class="string">the</span> <span class="string">winner.</span></span><br><span class="line">  <span class="attr">responses:</span></span><br><span class="line">    <span class="attr">&quot;200&quot;:</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;OK&quot;</span></span><br><span class="line">      <span class="attr">content:</span></span><br><span class="line">        <span class="string">...</span></span><br><span class="line"><span class="attr">post:</span></span><br><span class="line">  <span class="attr">summary:</span> </span><br><span class="line">  <span class="attr">description:</span></span><br><span class="line">  <span class="attr">response:</span></span><br><span class="line">  <span class="attr">requestBody:</span></span><br><span class="line">  <span class="attr">parameters:</span></span><br></pre></td></tr></table></figure><h3 id="response对象"><a href="#response对象" class="headerlink" title="response对象"></a>response对象</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/board:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">&quot;200&quot;:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Everything</span> <span class="string">went</span> <span class="string">fine.</span></span><br><span class="line">          <span class="attr">content:</span></span><br><span class="line">            <span class="string">...</span></span><br><span class="line">        <span class="attr">&quot;404&quot;:</span> <span class="string">...</span></span><br></pre></td></tr></table></figure><h3 id="内容对象"><a href="#内容对象" class="headerlink" title="内容对象:"></a>内容对象:</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">content:</span></span><br><span class="line">  <span class="attr">application/json:</span></span><br><span class="line">    <span class="string">...</span></span><br><span class="line">  <span class="attr">text/html:</span></span><br><span class="line">    <span class="string">...</span></span><br><span class="line">  <span class="string">text/*:</span></span><br><span class="line">    <span class="string">...</span></span><br></pre></td></tr></table></figure><h3 id="Media类型对象"><a href="#Media类型对象" class="headerlink" title="Media类型对象:"></a>Media类型对象:</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">content:</span></span><br><span class="line">  <span class="attr">application/json:</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">      <span class="attr">minimum:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">maximum:</span> <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="attr">content:</span></span><br><span class="line">  <span class="attr">application/json:</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">enum:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">Alice</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">Bob</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">Carl</span></span><br><span class="line"></span><br><span class="line"><span class="attr">content:</span></span><br><span class="line">  <span class="attr">application/json:</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">      <span class="attr">minItems:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">maxItems:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">items:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line"></span><br><span class="line"><span class="attr">content:</span></span><br><span class="line">  <span class="attr">application/json:</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">      <span class="attr">properties:</span></span><br><span class="line">        <span class="attr">productName:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">productPrice:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">number</span></span><br></pre></td></tr></table></figure><h3 id="requestBody对象"><a href="#requestBody对象" class="headerlink" title="requestBody对象"></a>requestBody对象</h3><p>方法对象中的requestBody和parameters共同定义了HTTP请求中的数据。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">requestBody:</span></span><br><span class="line">  <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">content:</span></span><br><span class="line">    <span class="attr">application/json:</span></span><br><span class="line">      <span class="attr">schema:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">enum:</span> [<span class="string">&quot;.&quot;</span>, <span class="string">&quot;X&quot;</span>, <span class="string">&quot;O&quot;</span>]</span><br></pre></td></tr></table></figure><h3 id="parameters对象"><a href="#parameters对象" class="headerlink" title="parameters对象"></a>parameters对象</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/users/&#123;id&#125;:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">id</span>  <span class="comment"># 必须有的，定义参数名</span></span><br><span class="line">        <span class="attr">in:</span> <span class="string">path</span>  <span class="comment"># 必须有的，定义参数的来源，可以是 path, query, header中的一个</span></span><br><span class="line">        <span class="attr">required:</span> <span class="literal">true</span> <span class="comment"># 可选的</span></span><br><span class="line">        <span class="attr">schema:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">          <span class="attr">minimum:</span> <span class="number">1</span></span><br><span class="line">          <span class="attr">maximum:</span> <span class="number">100</span></span><br></pre></td></tr></table></figure><h3 id="对象重用"><a href="#对象重用" class="headerlink" title="对象重用"></a>对象重用</h3><p>可以使用components和ref来重用一个对象，例如：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">components:</span></span><br><span class="line">  <span class="attr">schemas:</span></span><br><span class="line">    <span class="attr">coordinate:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">      <span class="attr">minimum:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">maximum:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">parameters:</span></span><br><span class="line">    <span class="attr">rowParam:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">row</span></span><br><span class="line">      <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line">      <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">schema:</span></span><br><span class="line">        <span class="string">$ref:</span> <span class="string">&quot;#/components/schemas/coordinate&quot;</span></span><br><span class="line">    <span class="attr">columnParam:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">column</span></span><br><span class="line">      <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line">      <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">schema:</span></span><br><span class="line">        <span class="string">$ref:</span> <span class="string">&quot;#/components/schemas/coordinate&quot;</span></span><br><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/board/&#123;row&#125;/&#123;column&#125;:</span></span><br><span class="line">    <span class="attr">post:</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">&quot;#/components/parameters/rowParam&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">&quot;#/components/parameters/columnParam&quot;</span></span><br><span class="line">  <span class="string">/page/&#123;row&#125;/&#123;column&#125;:</span></span><br><span class="line">    <span class="attr">post:</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">&quot;#/components/parameters/rowParam&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">&quot;#/components/parameters/columnParam&quot;</span></span><br></pre></td></tr></table></figure><h3 id="文档格式"><a href="#文档格式" class="headerlink" title="文档格式"></a>文档格式</h3><p>段落可以使用文本模式和折叠模式，文本模式中的段落会原样输出，而折叠模式将会自动换行。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">文本模式输入：</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">|</span></span><br><span class="line"><span class="string">  This is a string</span></span><br><span class="line"><span class="string">  in multiple lines.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">  <span class="string">And</span> <span class="string">an</span> <span class="string">extra</span> <span class="string">one.</span></span><br><span class="line"><span class="string">文本模式输出：</span></span><br><span class="line"><span class="string">This</span> <span class="string">is</span> <span class="string">a</span> <span class="string">string</span></span><br><span class="line"><span class="string">in</span> <span class="string">multiple</span> <span class="string">lines.</span></span><br><span class="line"></span><br><span class="line"><span class="string">And</span> <span class="string">an</span> <span class="string">extra</span> <span class="string">one.</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">折叠模式输入：</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">&gt;</span></span><br><span class="line"><span class="string">  This is a string</span></span><br><span class="line"><span class="string">  in multiple lines.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">  <span class="string">And</span> <span class="string">an</span> <span class="string">extra</span> <span class="string">one.</span></span><br><span class="line"><span class="string">折叠模式输出：</span></span><br><span class="line"><span class="string">This</span> <span class="string">is</span> <span class="string">a</span> <span class="string">string</span> <span class="string">in</span> <span class="string">multiple</span> <span class="string">lines.</span></span><br><span class="line"><span class="string">And</span> <span class="string">an</span> <span class="string">extra</span> <span class="string">one.</span></span><br></pre></td></tr></table></figure><p>description对象中也支持<a href="https://spec.commonmark.org/0.27/">markdown</a>的语法</p><h1 id="OpenAPI-Generator"><a href="#OpenAPI-Generator" class="headerlink" title="OpenAPI Generator"></a>OpenAPI Generator</h1><p>OpenAPI Generator可以根据OpenAPI的API描述文件自动生成客户端、服务器端代码以及API文档。使用homebrew安装的命令如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">|$ brew install openapi-generator</span><br></pre></td></tr></table></figure><p>生成代码的命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openapi-generator generate -i petstore.yaml -g ruby -o /tmp/<span class="built_in">test</span>/</span><br></pre></td></tr></table></figure><p>其中 <code>-i</code>指定API描述文件，<code>-g</code>指定代码语言，<code>-o</code>指定输出路径。</p><p>文档链接：<a href="https://openapi-generator.tech/docs/installation">https://openapi-generator.tech/docs/installation</a></p>]]></content>
      
      
      <categories>
          
          <category> 应用开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> openapi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>函数式编程概要</title>
      <link href="/2022/05/30/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E6%A6%82%E8%A6%81/"/>
      <url>/2022/05/30/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E6%A6%82%E8%A6%81/</url>
      
        <content type="html"><![CDATA[<h1 id="函数式编程是什么？"><a href="#函数式编程是什么？" class="headerlink" title="函数式编程是什么？"></a>函数式编程是什么？</h1><p>函数式编程是一种通过组合纯函数来编写软件的编程范式，它是声明式而非命令式的，其原则是避免<code>共享状态</code>, <code>改变数据</code>，以及<code>副作用</code>。</p><p>函数式编程推荐：</p><ol><li>使用纯函数</li><li>使用函数组合</li><li>使用声明式代码而非命令式代码</li></ol><p>函数式编程应当避免：</p><ol><li>副作用</li><li>改变数据</li><li>共享状态</li></ol><h1 id="术语解释"><a href="#术语解释" class="headerlink" title="术语解释"></a>术语解释</h1><h3 id="副作用-side-effect"><a href="#副作用-side-effect" class="headerlink" title="副作用(side effect)"></a>副作用(side effect)</h3><p>函数副作用是指函数在执行过程中改变了函数之外的环境。具体地说，函数副作用是指函数被调用，完成了函数既定的计算任务，但同时因为访问了外部数据，尤其是因为对外部数据进行了写操作，从而一定程度地改变了系统环境。 例如下面的函数就有副作用，它改变了外部变量count。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  count += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面的情形都是有副作用的：</p><ul><li>函数在执行过程中改变了外部变量</li><li>改变了函数的参数</li><li>抛出了异常</li><li>打印字符串到标准输出或者记录了日志</li><li>启动了一个子进程</li><li>调用了有副作用的函数</li></ul><h3 id="纯函数"><a href="#纯函数" class="headerlink" title="纯函数"></a>纯函数</h3><p>如果一个函数满足下列条件则它就是一个纯函数：</p><ol><li>有输入（参数）</li><li>没有状态 （如全局变量）</li><li>相同的输入，总是会的到相同的输出</li><li>没有任何副作用</li><li>函数只完成一个任务 (单一职责原则)</li></ol><p>纯函数的优点在于：</p><ol><li>可重用</li><li>可以组合使用</li><li>便于测试</li><li>便于缓存</li></ol><h3 id="改变数据"><a href="#改变数据" class="headerlink" title="改变数据"></a>改变数据</h3><p>改变数据在这里指的是改变函数中通过参数传过来的数据，因为Javascript在传递对象参数时，传递的是引用，如果改变了这些参数的属性值时，函数外边的数据也被改变了。</p><p>例如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>];</span><br><span class="line"><span class="keyword">let</span> sortArr = <span class="function">(<span class="params">list</span>) =&gt;</span> &#123; <span class="keyword">return</span> list.sort() &#125;</span><br><span class="line">sortArr(arr) <span class="comment">// [ 1, 3, 7, 8, 9 ]</span></span><br><span class="line"><span class="built_in">console</span>.log(arr) <span class="comment">//[ 1, 3, 7, 8, 9 ]</span></span><br></pre></td></tr></table></figure><p>可以看到 <code>sortArr</code>函数改变了其参数list，导致了外部数据arr的值也发生了变化。</p><p>我们可以通过如下的方法，在不改变参数数据的前提下来更新数组和对象。</p><h4 id="更新数组"><a href="#更新数组" class="headerlink" title="更新数组"></a>更新数组</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> arr1 = arr.map(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;<span class="keyword">return</span> item + <span class="number">1</span>&#125;);</span><br><span class="line"><span class="keyword">let</span> arr2 = arr.filter(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;<span class="keyword">return</span> item !== <span class="number">2</span>&#125;);</span><br><span class="line"><span class="keyword">let</span> sum = arr.reduce(<span class="function">(<span class="params">x,y</span>)=&gt;</span>x+y, <span class="number">0</span>)</span><br><span class="line"><span class="built_in">console</span>.log(arr); <span class="comment">//[ 1, 3, 7, 8, 9 ]</span></span><br><span class="line"><span class="built_in">console</span>.log(arr1); <span class="comment">//[ 2, 4, 8, 9, 10 ]</span></span><br><span class="line"><span class="built_in">console</span>.log(arr2); <span class="comment">//[ 1, 3, 7, 8, 9 ]</span></span><br><span class="line"><span class="built_in">console</span>.log(sum); <span class="comment">//28</span></span><br></pre></td></tr></table></figure><h4 id="更新对象"><a href="#更新对象" class="headerlink" title="更新对象"></a>更新对象</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> stu = &#123;<span class="attr">name</span>: <span class="string">&#x27;xiaoming&#x27;</span>, <span class="attr">age</span>: <span class="number">10</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> newStu = &#123; ...stu, <span class="attr">age</span>: <span class="number">11</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> &#123; name, ...stuWithoutName&#125; = stu;</span><br><span class="line"><span class="built_in">console</span>.log(stu); <span class="comment">//&#123; name: &#x27;xiaoming&#x27;, age: 10 &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(newStu); <span class="comment">//&#123; name: &#x27;xiaoming&#x27;, age: 11 &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(stuWithoutName); <span class="comment">//&#123; age: 10 &#125;</span></span><br></pre></td></tr></table></figure><h3 id="命令式-vs-声明式"><a href="#命令式-vs-声明式" class="headerlink" title="命令式 vs 声明式"></a>命令式 vs 声明式</h3><p>命令式(imperative)和声明式(declarative)是两种不同的编程范式。命令式编程需要告诉计算机如何完成任务（如计算机熟悉的顺序、分支、循环等），而声明式编程只需要告诉计算机要做什么（如组合函数），它抽象掉了具体的控制流。</p><p>下面的代码是命令式的编程方式，它告诉计算机要通过循环来将数组的每一项加1，放到新的数组里。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> newArr = [];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">  newArr.push(arr[i] + <span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(newArr);</span><br></pre></td></tr></table></figure><p>下面的代码则是声明式的代码，它只是通过函数add1告诉了计算机要做什么。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> add1 = <span class="function">(<span class="params">x</span>) =&gt;</span> x + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> newArr = arr.map(add1);</span><br><span class="line"><span class="built_in">console</span>.log(newArr);</span><br></pre></td></tr></table></figure><h1 id="如何进行函数式编程-funcational-programming-？"><a href="#如何进行函数式编程-funcational-programming-？" class="headerlink" title="如何进行函数式编程(funcational programming)？"></a>如何进行函数式编程(funcational programming)？</h1><p>通过函数式编程的定义我们知道，函数式编程是将纯函数组合起来，从而完成复杂任务的编程方式。其哲学思想类似于Unix <code>Do one thing, and do it well</code> 的设计理念。一个纯函数只负责完成一个小的任务，而通过纯函数的组合，可以完成更为复杂的任务。</p><h3 id="函数组合-composition"><a href="#函数组合-composition" class="headerlink" title="函数组合 (composition)"></a>函数组合 (composition)</h3><p>我们通过一个例子来看看如何将函数组合起来完成一个特定的任务。</p><p>这个例子给的任务是：统计一个句子中的单词数。我们可以把它拆成如下几个子任务，每个子任务都用一个纯函数来实现：</p><ul><li>trimStr: 将句子两端的空白符去掉</li><li>splitStr: 将句子分隔为数组，数组项是拆分出来的单词</li><li>rmArticle: 去掉数组中的冠词</li><li>nrArr: 统计数组的长度</li></ul><p>实现代码如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sentence = <span class="string">&#x27; Honesty and diligence should be your eternal mates. The proverb of Franklin. &#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> trimStr = <span class="function">(<span class="params">str</span>) =&gt;</span> str.trim();</span><br><span class="line"><span class="keyword">const</span> splitStr = <span class="function">(<span class="params">str</span>) =&gt;</span> str.split(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> rmArticle = <span class="function">(<span class="params">arr</span>) =&gt;</span> arr.filter(<span class="function">(<span class="params">w</span>) =&gt;</span> ![<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;AN&#x27;</span>, <span class="string">&#x27;THE&#x27;</span>].includes(w.toUpperCase()));</span><br><span class="line"><span class="keyword">const</span> nrArr = <span class="function">(<span class="params">arr</span>) =&gt;</span> arr.length;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> count = nrArr(rmArticle(splitStr(trimStr(sentence))));</span><br><span class="line"><span class="built_in">console</span>.log(count); <span class="comment">//11</span></span><br></pre></td></tr></table></figure><p>上面的代码通过<code>nrArr(rmArticle(splitStr(trimStr(sentence))))</code>将函数组合起来调用，但是这样的方式可读性太差。假设我们有一个函数<code>pipe</code>，它可以把上述函数组合起来生成一个新的函数，然后再调用这个新的函数，可读性就会好很多。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> countWords = pipe(trimStr, splitStr, rmArticle, nrArr);</span><br><span class="line"><span class="keyword">const</span> count = countWords(sentence);</span><br><span class="line"><span class="built_in">console</span>.log(count);</span><br></pre></td></tr></table></figure><p>那么<code>pipe</code>该如何实现呢？我们知道数组有一个方法叫reduce，它可以将数组项和上一次回调函数的执行结果作为参数放到回调函数中，于是，我们可以将需要组合的纯函数放到一个数组中，然后利用该数组的reduce逐个调用这些纯函数。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pipe = <span class="function">(<span class="params">...funcs</span>) =&gt;</span> <span class="function">(<span class="params">x</span>) =&gt;</span> funcs.reduce(<span class="function">(<span class="params">v, f</span>) =&gt;</span> f(v), x);</span><br></pre></td></tr></table></figure><h3 id="柯里化-Currying"><a href="#柯里化-Currying" class="headerlink" title="柯里化 (Currying)"></a>柯里化 (Currying)</h3><p>组合函数要求函数的输入是上一个函数的输出，那么，如果函数的参数不止一个那该怎么办，这时候就需要用到柯里化。柯里化是指将一个需要多个参数的函数转化为只接受一个参数的函数，而这个函数的返回值是另外一个函数，它需要传入下一个参数。例如，把 <code>add(a, b)</code> 函数柯里化之后它就可以这样调用<code>add(a)(b)</code>。</p><p>如果上述的例子中splitStr需要传入两个参数:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> splitStr = <span class="function">(<span class="params">s, str</span>) =&gt;</span> str.split(s);</span><br></pre></td></tr></table></figure><p>那么在组合它之前必须将其进行柯里化。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> curriedSplitStr = curry(splitStr);</span><br><span class="line"><span class="keyword">const</span> countWords = pipe(trimStr, curriedSplitStr(<span class="string">&#x27; &#x27;</span>), rmArticle, nrArr);</span><br></pre></td></tr></table></figure><p><code>curry</code>函数则是通过递归的方法来实现的：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> curry = <span class="function">(<span class="params">f</span>) =&gt;</span> (<span class="function"><span class="keyword">function</span> <span class="title">nextFunc</span>(<span class="params">prevArgs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">arg</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> args = [...prevArgs, arg];</span><br><span class="line">    <span class="keyword">if</span> (args.length &gt;= f.length) &#123;</span><br><span class="line">      <span class="keyword">return</span> f(...args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> nextFunc(args);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;([]));</span><br></pre></td></tr></table></figure><h3 id="工具库"><a href="#工具库" class="headerlink" title="工具库"></a>工具库</h3><p>当前有许多用于函数式编程的库，例如<a href="https://lodash.com/">lodash</a>和<a href="https://ramdajs.com/">Ramda</a>。这些库中的函数都是柯里化的，而且提供了函数式编程常用的工具函数如<code>pipe</code>, <code>curry</code>等等。我们以Ramda为例来看一看前面的例子如何通过这些库来实现。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> R <span class="keyword">from</span> <span class="string">&#x27;ramda&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sentence = <span class="string">&#x27; Honesty and diligence should be your eternal mates. The proverb of Franklin. &#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> trimStr = <span class="function">(<span class="params">str</span>) =&gt;</span> str.trim();</span><br><span class="line"><span class="keyword">const</span> splitStr = <span class="function">(<span class="params">s, str</span>) =&gt;</span> str.split(s);</span><br><span class="line"><span class="keyword">const</span> rmArticle = <span class="function">(<span class="params">arr</span>) =&gt;</span> arr.filter(<span class="function">(<span class="params">w</span>) =&gt;</span> ![<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;AN&#x27;</span>, <span class="string">&#x27;THE&#x27;</span>].includes(w.toUpperCase()));</span><br><span class="line"><span class="keyword">const</span> nrArr = <span class="function">(<span class="params">arr</span>) =&gt;</span> arr.length;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> countWords = R.pipe(trimStr, R.curry(splitStr)(<span class="string">&#x27; &#x27;</span>), rmArticle, nrArr);</span><br><span class="line"><span class="keyword">const</span> count = countWords(sentence);</span><br><span class="line"><span class="built_in">console</span>.log(count);</span><br></pre></td></tr></table></figure><h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>综上所述，函数式编程本质上是利用组合单一职责的纯函数来完成复杂任务的编程范式，就好像一条用函数组成的流水线，原材料经过这条流水线之后就变成了我们需要的产品。不论面向对象和函数式编程孰优孰劣，javascript因并不是天生的OOP语言而更加偏向于函数式编程，这点从React引入hooks就可见一斑。</p>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> 函数式编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go语言中的正则表达式</title>
      <link href="/2022/01/12/Go%E8%AF%AD%E8%A8%80%E4%B8%AD%E7%9A%84%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
      <url>/2022/01/12/Go%E8%AF%AD%E8%A8%80%E4%B8%AD%E7%9A%84%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>正则表达式在字符串的处理中占有重要的地位，Go语言中的regexp包提供了对正则表达式的支持。</p><h3 id="正则表达式基础"><a href="#正则表达式基础" class="headerlink" title="正则表达式基础"></a>正则表达式基础</h3><p>正则表达式(Regular Expression)是一个特殊的字符串，它定义了一种文本模式。通过正则表达式，你可以从所有文本中匹配到满足特定模式的文本(字符串)，然后可以：</p><ol><li>测试字符串是否满足这种特定模式，例如：是不是IP地址、电话号码，银行卡号等</li><li>替换文本，将文本中部分或者所有满足这种特定模式的字符串替换、删除掉</li><li>提取满足这种特定模式的子字符串</li></ol><h4 id="元字符"><a href="#元字符" class="headerlink" title="元字符"></a>元字符</h4><p>元字符在正则表达式中有特殊的意义，要匹配这些元字符本身的话，需要用反斜杆转义。元字符有12个，如下所示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$()*+.?[\^&#123;|</span><br></pre></td></tr></table></figure><p><code>]</code>和<code>&#125;</code>不属于元字符是因为它们是否需要被转义依赖于前面是否有<code>[</code>和<code>&#123;</code></p><h4 id="量词"><a href="#量词" class="headerlink" title="量词"></a>量词</h4><p>以下几个字符我们称之为量词，它们表示匹配字符重复的次数。</p><table><thead><tr><th>量词</th><th>含义</th></tr></thead><tbody><tr><td>?</td><td>重复0次或者1次</td></tr><tr><td>*</td><td>重复0次或者多次</td></tr><tr><td>+</td><td>重复1次或者多次</td></tr><tr><td>{m, n}</td><td>m,n为数字，至少重复m次，最多重复n次, m和n中的一个可以不指定</td></tr></tbody></table><h4 id="惰性匹配和贪婪匹配"><a href="#惰性匹配和贪婪匹配" class="headerlink" title="惰性匹配和贪婪匹配"></a>惰性匹配和贪婪匹配</h4><p>在量词后面加<code>?</code>表示惰性匹配，如<code>*?</code>,<code>+?</code>,<code>??</code>,<code>&#123;m,n&#125;?</code>等。惰性匹配每匹配到一次就会停下来然后接着匹配表达式后面的部分，如果后面的部分匹配成功，则停止匹配。</p><p>贪婪匹配则相反，量词匹配成功后不会停下来，它会接着匹配直到失败，然后回溯之后再接着匹配表达式后面的部分。</p><p>例如下面的HTML文本，</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">The very <span class="tag">&lt;<span class="name">em</span>&gt;</span>first<span class="tag">&lt;/<span class="name">em</span>&gt;</span> task is to find the beginning of a paragraph.</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">Then you have to find the end of the paragraph</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果用正则表达式<code>&lt;p&gt;.*?&lt;/p&gt;</code>来惰性匹配，它只匹配到第一个段，而如果用正则表达式<code>&lt;p&gt;.*&lt;/p&gt;</code>来进行贪婪匹配，它会匹配到整个文本。</p><h4 id="匹配多个备选中的一个"><a href="#匹配多个备选中的一个" class="headerlink" title="匹配多个备选中的一个"></a>匹配多个备选中的一个</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mary|Jane|Sue</span><br></pre></td></tr></table></figure><p>匹配 Mary, 或者 Jane 或者 Sue.</p><h4 id="零宽断言-Zero-Length-Assertions-或-环视-lookaround"><a href="#零宽断言-Zero-Length-Assertions-或-环视-lookaround" class="headerlink" title="零宽断言(Zero-Length Assertions) 或 环视 (lookaround)"></a>零宽断言(Zero-Length Assertions) 或 环视 (lookaround)</h4><p>零宽断言用来匹配某个字符串之前或者之后的文本，但匹配到的结果不包含该字符串本身。因为不包含该字符串，所以该断言匹配到的文本长度为0，所以称之为零宽断言。</p><p>零宽断言分为两种：</p><ol><li>回望(lookbehind)，即从匹配位置往后(左)查询。表达式为 <code>(?&lt;=exp)</code>，意思是如果文本的左边满足正则表达式exp，则匹配该文本，不包含exp本身匹配到的字符串。</li><li>前瞻(lookahead)，即从匹配位置往前(右)查询。表达式为<code>(?=exp)</code>，意思是如果文本的右边满足正则表达式exp，则匹配该文本，不包含exp本身匹配到的字符串。</li></ol><p>负向零宽断言(Negative lookaround)则是匹配不满足exp的情形，对应到回望和前瞻则是 <code>(?&lt;!=exp)</code> 和 <code>(?!=exp)</code>。例如<code>(?&lt;!=exp)</code>意思是如果文本的左边<strong>不</strong>满足正则表达式exp，则匹配该文本，同样不包含exp本身匹配不成功的字符串。</p><p>下面的例子可以说明零宽断言的作用。</p><p>如果需要匹配HTML中加粗的文本，但不包含HTML标签本身则可以用下面的正则表达式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(?&lt;=&lt;b&gt;)\w+(?=&lt;/b&gt;)</span><br></pre></td></tr></table></figure><p>如果用它来匹配文本 <code>My &lt;b&gt;cat&lt;/b&gt; is furry</code> 的话，只会匹配到<code>cat</code>，<code>&lt;b&gt;</code>和<code>&lt;/b&gt;</code>不会被匹配到。</p><h4 id="字符类"><a href="#字符类" class="headerlink" title="字符类"></a>字符类</h4><p>正则表达式内置了一些字符类，通过下表所列的字符类的写法可以匹配到多个属于这一类字符。</p><table><thead><tr><th>字符类</th><th>含义</th></tr></thead><tbody><tr><td>[chars]</td><td>匹配chars中的任一字符</td></tr><tr><td>[^chars]</td><td>匹配任一不在chars中的字符</td></tr><tr><td>[:name:]</td><td>字符类中的所有ASCII字符，name为分类名，正则表达式支持的类名及含义如下表所示</td></tr><tr><td>[^:name:]</td><td>不属于字符类中的所有ASCII字符</td></tr><tr><td>[[:name:]]</td><td>字符类中的任一ASCII字符</td></tr><tr><td>[[^:name:]]</td><td>不在字符类中的任一ASCII字符</td></tr><tr><td>.</td><td>匹配任一字符，如果不指定s修饰符的话，不包括换行符</td></tr><tr><td>\d</td><td>匹配任一ASCII数字，相当于[0-9]</td></tr><tr><td>\D</td><td>匹配任一非数字ASCII字符，相当于[^0-9]</td></tr><tr><td>\s</td><td>空白字符，[ \t\v\n\f\r]</td></tr><tr><td>\S</td><td>非空白字符</td></tr><tr><td>\w</td><td>任一ASCII单词字符，相当于[0-9A-Za-z_]</td></tr><tr><td>\W</td><td>任一ASCII非单词字符，[^0-9A-Za-z_]</td></tr><tr><td>\p{name}</td><td>匹配unicode某一类中的字符</td></tr><tr><td>\P{name}</td><td>匹配不在unicode某一类中的字符</td></tr></tbody></table><h4 id="分组与捕获"><a href="#分组与捕获" class="headerlink" title="分组与捕获"></a>分组与捕获</h4><p>可以用 <code>()</code>对正则表达式进行分组，例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\bMary|Jane|Sue\b</span><br></pre></td></tr></table></figure><p>表示 <code>\bMary</code>，<code>Jane</code>，<code>Sue\b</code>中的一个，这显然不是我们想要的。这时候就需要用括号进行分组。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\b(Mary|Jane|Sue)\b</span><br></pre></td></tr></table></figure><p>上面的正则表达式虽然达到了我们想要的结果，但是也捕获了一个分组。()中匹配到的内容会被记录到分组1里面。假如后面还有多个()，则分组名依次加1。但显然我们这里并没有用到捕获的内容，所以可以用下面的表达式告诉引擎不要捕获。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\b(?:Mary|Jane|Sue)\b</span><br></pre></td></tr></table></figure><p>那如果我们想要使用捕获到的结果该怎么办呢？可以用 \1 来引用它。 1位分组名，如果要引用第二个分组捕获到的内容则是 \2 (Go语言不支持)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\b\d\d(\d\d)-\1-\1\b</span><br></pre></td></tr></table></figure><p>上面的表达式可以匹配 <code>2008-08-08</code>, <code>2009-09-09</code>这样的日期。</p><p>如果不想使用默认的数字捕获组名字，可以用下面的方法来给捕获组命名。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\b\d\d(?P&lt;m&gt;\d\d)-\k&lt;m&gt;-\k&lt;m&gt;\b</span><br></pre></td></tr></table></figure><h4 id="正则表达式的选项"><a href="#正则表达式的选项" class="headerlink" title="正则表达式的选项"></a>正则表达式的选项</h4><table><thead><tr><th>选项</th><th>含义</th></tr></thead><tbody><tr><td>i</td><td>大小写不敏感</td></tr><tr><td>m</td><td>多行模式</td></tr><tr><td>s</td><td>. 可以匹配新行</td></tr></tbody></table><h3 id="Go语言中的regexp包"><a href="#Go语言中的regexp包" class="headerlink" title="Go语言中的regexp包"></a>Go语言中的regexp包</h3><h4 id="regexp中的函数"><a href="#regexp中的函数" class="headerlink" title="regexp中的函数"></a>regexp中的函数</h4><table><thead><tr><th>函数</th><th>作用</th></tr></thead><tbody><tr><td>regexp.Compile(exp)</td><td>用exp编译一个正则表达式，如果成功则返回 *regexp.Regexp和nil</td></tr><tr><td>regexp.MustCompile(exp)</td><td>同上，但编译失败则会触发panic</td></tr><tr><td>regexp.Match(exp, b)</td><td>如果b []byte 满足exp，则返回true, nil</td></tr><tr><td>regexp.MatchReader(exp, r)</td><td>同上, r为 io.RuneReader类型</td></tr><tr><td>regexp.MatchString(exp, s)</td><td>同上，s为字符串类型</td></tr></tbody></table><h4 id="Regexp类型-regexp-Regexp-的方法"><a href="#Regexp类型-regexp-Regexp-的方法" class="headerlink" title="Regexp类型(*regexp.Regexp)的方法"></a>Regexp类型(*regexp.Regexp)的方法</h4><table><thead><tr><th>方法</th><th>作用</th></tr></thead><tbody><tr><td>rx.Match(b)</td><td>如果类型为[]byte的b满足正则表达式，则返回true</td></tr><tr><td>rx.MatchReader(r)</td><td>如果类型为io.RuneReader的r满足正则表达式，则返回true</td></tr><tr><td>rx.MatchString(s)</td><td>如果字符串s满足正则表达式，则返回true</td></tr><tr><td>rx.ReplaceAllString(s, sr)</td><td>用sr替换s中匹配的部分</td></tr><tr><td>rx.FindString(s)</td><td>返回匹配到的字符串</td></tr><tr><td>rx.FindAllString(s, n)</td><td>返回所有匹配到的字符串 []string类型</td></tr></tbody></table><h4 id="regexp包的用法示例"><a href="#regexp包的用法示例" class="headerlink" title="regexp包的用法示例"></a>regexp包的用法示例</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;regexp&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">match, _ := regexp.MatchString(<span class="string">&quot;p[a-z]+ch&quot;</span>, <span class="string">&quot;peach&quot;</span>)</span><br><span class="line">fmt.Println(match) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">r, _ := regexp.Compile(<span class="string">&quot;p[a-z]+ch&quot;</span>)</span><br><span class="line"></span><br><span class="line">fmt.Println(r.MatchString(<span class="string">&quot;peach&quot;</span>)) <span class="comment">// true</span></span><br><span class="line">fmt.Println(r.FindString(<span class="string">&quot;peach punch&quot;</span>)) <span class="comment">// peach</span></span><br><span class="line">fmt.Println(r.FindStringIndex(<span class="string">&quot;peach punch&quot;</span>)) <span class="comment">// [0 5]</span></span><br><span class="line">fmt.Println(r.FindStringSubmatch(<span class="string">&quot;peach apple punch&quot;</span>)) <span class="comment">// [peach]</span></span><br><span class="line">fmt.Println(r.FindStringSubmatchIndex(<span class="string">&quot;peach apple punch&quot;</span>)) <span class="comment">// [0 5]</span></span><br><span class="line">fmt.Println(r.FindAllString(<span class="string">&quot;peach apple pinch&quot;</span>, <span class="number">1</span>)) <span class="comment">// [peach]</span></span><br><span class="line">fmt.Println(r.FindAllString(<span class="string">&quot;peach apple pinch&quot;</span>, <span class="number">2</span>)) <span class="comment">// [peach pinch]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
            <tag> regexp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go语言中的字符串</title>
      <link href="/2021/12/16/Go%E8%AF%AD%E8%A8%80%E4%B8%AD%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
      <url>/2021/12/16/Go%E8%AF%AD%E8%A8%80%E4%B8%AD%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
      
        <content type="html"><![CDATA[<h3 id="字符串语法基础"><a href="#字符串语法基础" class="headerlink" title="字符串语法基础"></a>字符串语法基础</h3><ul><li>Go语言中的字符串采用UTF-8编码格式</li><li>字符串字面量使用双引号<code>&quot;</code>以及反引号 ` 来创建，区别在于双引号解析转义字符而反引号不解析</li></ul><h3 id="字符串操作符"><a href="#字符串操作符" class="headerlink" title="字符串操作符"></a>字符串操作符</h3><p>Go语言中的字符串支持如下操作：</p><table><thead><tr><th>语法</th><th>描述</th></tr></thead><tbody><tr><td>s + t</td><td>将字符串s和字符串t连接起来</td></tr><tr><td>s += t</td><td>s = s + t</td></tr><tr><td>s[n]</td><td>字符串s中索引为n的字节 uint8类型</td></tr><tr><td>s[n:m]</td><td>从索引n到m-1取得的子字符串 (按字节)</td></tr><tr><td>s[n:]</td><td>从索引n到字符串结尾取得的子字符串 (按字节)</td></tr><tr><td>s[:m]</td><td>从字符串开头到索引位置m-1取得的子字符串 (按字节)</td></tr><tr><td>len(s)</td><td>计算字符串的字节数</td></tr><tr><td>[]rune(s)</td><td>将字符串转化为码点(int32)数组</td></tr><tr><td>len([]rune(s))</td><td>计算字符串的码点数, 即字符数</td></tr><tr><td>string(chars)</td><td>将一个码点数组转化为字符串</td></tr><tr><td>[]byte(s)</td><td>将字符串转化为字节(uint8)数组</td></tr><tr><td>string(bytes)</td><td>将字节数组转化为字符串</td></tr><tr><td>string(i)</td><td>将任意类型数字转化为字符串</td></tr><tr><td>strconv.Itoa(i)</td><td>将int类型的数值转化为字符串，返回(字符串，err)</td></tr><tr><td>fmt.Sprint(x)</td><td>任意类型的字符串表示，如x = 65，则返回”65”</td></tr></tbody></table><p>Go语言中的字符串也可以使用比较操作符 <code>&lt;, &lt;=, ==, !=, &gt;, &gt;=</code>。具体比较方法是将字符串转化成的字节数组中的字节逐一比较。</p><h3 id="字符串的索引与切片"><a href="#字符串的索引与切片" class="headerlink" title="字符串的索引与切片"></a>字符串的索引与切片</h3><p>Go语言中可以通过字符串索引来获取单个字符，通过切片来获取子字符串。例如：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  s := <span class="string">&quot;hello world&quot;</span></span><br><span class="line">  us := <span class="string">&quot;hello 世界&quot;</span></span><br><span class="line">  fmt.Println(s[<span class="number">0</span>]) <span class="comment">// 106</span></span><br><span class="line">  fmt.Println(s[<span class="number">0</span> : <span class="built_in">len</span>(s)<span class="number">-1</span>]) <span class="comment">// &quot;hello worl&quot;</span></span><br><span class="line">  fmt.Println(us[<span class="number">0</span> : <span class="built_in">len</span>(s)<span class="number">-1</span>]) <span class="comment">// &quot;hello 世�&quot;</span></span><br><span class="line">  fmt.Println(us[<span class="number">0</span> : <span class="built_in">len</span>(s)<span class="number">-2</span>]) <span class="comment">// &quot;hello 世&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="字符串相关的包"><a href="#字符串相关的包" class="headerlink" title="字符串相关的包"></a>字符串相关的包</h3><h4 id="fmt"><a href="#fmt" class="headerlink" title="fmt"></a>fmt</h4><p>fmt包可以用来格式化字符串。</p><table><thead><tr><th>语法</th><th>描述</th></tr></thead><tbody><tr><td>err := fmt.Errorf(format, args…)</td><td>返回一个包含格式化字符串的错误值</td></tr><tr><td>nrBytes, err := fmt.Fprint(writter, args…)</td><td>将args按照%v和空格分隔写入writter</td></tr><tr><td>nrBytes, err := fmt.Fprintf(writter, format, args…)</td><td>将格式化字符串写入writter</td></tr><tr><td>nrBytes, err := fmt.Fprintln(writter, args…)</td><td>将args按照%v和空格分隔换行结尾写入writter</td></tr><tr><td>nrBytes, err := fmt.Print(args…)</td><td>将args按照%v和空格分隔写入os.Stdout</td></tr><tr><td>nrBytes, err := fmt.Printf(format, args…)</td><td>将格式化字符串写入os.Stdout</td></tr><tr><td>nrBytes, err := fmt.Println(args…)</td><td>将args按照%v和空格分隔换行结尾写入os.Stdout</td></tr><tr><td>str := fmt.Sprint(args…)</td><td>返回一个args按照%v和空格分隔转换的字符串</td></tr><tr><td>str := fmt.Sprintf(format, args…)</td><td>返回一个由格式化字符串转换的字符串</td></tr><tr><td>str := fmt.Sprintln(args…)</td><td>返回一个args按照%v和空格分隔换行结尾转换的字符串</td></tr></tbody></table><p>例如：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  arr := [...]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line">    <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;hello world&quot;</span>,</span><br><span class="line">    <span class="number">2</span>&#125;</span><br><span class="line">  nr := <span class="number">5</span></span><br><span class="line">  err := fmt.Errorf(<span class="string">&quot;Error: component %v crashed.&quot;</span>, <span class="string">&quot;ui&quot;</span>)</span><br><span class="line">  fmt.Println(err) <span class="comment">//Error: component ui crashed.</span></span><br><span class="line">  fmt.Print(arr, nr, <span class="string">&quot;\n&quot;</span>) <span class="comment">//[1 hello world 2] 5</span></span><br><span class="line">  fmt.Printf(<span class="string">&quot;Array: %v, number: %v\n&quot;</span>, arr, nr) <span class="comment">//Array: [1 hello world 2], number: 5</span></span><br><span class="line">  fmt.Println(arr, nr) <span class="comment">//[1 hello world 2] 5</span></span><br><span class="line">  str := fmt.Sprint(arr, nr)</span><br><span class="line">  fmt.Println(str) <span class="comment">//[1 hello world 2] 5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>字符串格式化指令列表如下：</p><table><thead><tr><th>指令</th><th>描述</th></tr></thead><tbody><tr><td>%%</td><td>输出%</td></tr><tr><td>%b</td><td>二进制整数值，或者用科学计数法表示的指数为2的浮点数</td></tr><tr><td>%c</td><td>Unicode字符的码点值</td></tr><tr><td>%d</td><td>十进制数值</td></tr><tr><td>%e</td><td>用科学计数法e表示的浮点数或者复数值</td></tr><tr><td>%E</td><td>用科学计数法E表示的浮点数或者复数值</td></tr><tr><td>%f</td><td>浮点数或者复数值</td></tr><tr><td>%g</td><td>%e或者%f表示的浮点数或者复数值</td></tr><tr><td>%G</td><td>%E或者%f表示的浮点数或者复数值</td></tr><tr><td>%o</td><td>八进制数值</td></tr><tr><td>%p</td><td>十六进制表示的指针值</td></tr><tr><td>%q</td><td>使用Go语法必要时进行转义</td></tr><tr><td>%s</td><td>UTF8编码的字符串</td></tr><tr><td>%t</td><td>布尔值</td></tr><tr><td>%T</td><td>Go数值类型</td></tr><tr><td>%U</td><td>unicode表示法码点</td></tr><tr><td>%v</td><td>默认格式输出的内置或者自定义值，默认使用自定义类型的String()方法</td></tr><tr><td>%x</td><td>十六进制数值 a-f</td></tr><tr><td>%X</td><td>十六进制数值 A-F</td></tr></tbody></table><p>修饰符列表如下：</p><table><thead><tr><th>修饰符</th><th>描述</th></tr></thead><tbody><tr><td>#</td><td>%#v 使用Go语法将值自身输出，%#x 输出以0x打头的十六进制数，%#X 输出以0X打头的十六进制数</td></tr><tr><td>+</td><td>数值带正负号，字符串输出ASCII字符，结构体输出其字段名</td></tr><tr><td>-</td><td>向左对其，默认右对齐</td></tr><tr><td>0</td><td>以数字0填充而非空格填充</td></tr><tr><td>n.m</td><td>n个字符输出浮点数或者复数，小数点后输出m个数字, n和m都可以用*代替，也都可以被省略</td></tr></tbody></table><p>例如：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  b := <span class="number">37</span></span><br><span class="line">  o := <span class="number">41</span></span><br><span class="line">  x := <span class="number">3931</span></span><br><span class="line">  d := <span class="number">569</span></span><br><span class="line">  fmt.Printf(<span class="string">&quot;|%b|%9b|%-9b|%09b|\n&quot;</span>, b, b, b, b) <span class="comment">//|100101|   100101|100101   |000100101|</span></span><br><span class="line">  fmt.Printf(<span class="string">&quot;|%o|%#o|%#8o|%#+8o|%+08o|\n&quot;</span>, o, o, o, o, -o) <span class="comment">//|51|051|     051|    +051|-0000051|</span></span><br><span class="line">  fmt.Printf(<span class="string">&quot;|%x|%X|%8x|%08x|%#04X|0x%04X|\n&quot;</span>, x, x, x, x, x, x) <span class="comment">//|f5b|F5B|     f5b|00000f5b|0X0F5B|0x0F5B|</span></span><br><span class="line">  fmt.Printf(<span class="string">&quot;|%d|%06d|%+06d|\n&quot;</span>, d, d, d) <span class="comment">//|569|000569|+00569|</span></span><br><span class="line">  fmt.Printf(<span class="string">&quot;|%d|%#04x|%U|%c|\n&quot;</span>, <span class="number">0x3A6</span>, <span class="number">934</span>, <span class="string">&#x27;\u03A6&#x27;</span>, <span class="string">&#x27;\U000003A6&#x27;</span>) <span class="comment">//|934|0x03a6|U+03A6|Φ|</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="strings"><a href="#strings" class="headerlink" title="strings"></a>strings</h4><ol><li>字符串分隔相关的函数</li></ol><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>arr := strings.Split(string, “*”)</td><td>*为分隔符，返回一个字符串类型的切片</td></tr><tr><td>arr := strings.SplitN(string, “*”, n)</td><td>n为分隔后切片的长度，即分隔次数+1，从左到右</td></tr><tr><td>arr := strings.SplitAfter(string, “*”)</td><td>同Split，但返回的切片中字符串包含分隔符</td></tr><tr><td>arr := strings.SplitAfterN(string, “*”, n)</td><td>同SplitAfter，但只分隔n-1次，从左到右，n为分隔后切片的长度</td></tr><tr><td>arr := strings.Fields(string)</td><td>从字符串空白处切分字符串</td></tr><tr><td>arr := strings.FieldsFunc(string, f)</td><td>按照f返回为true的地方进行切分</td></tr></tbody></table><p>例如：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  str := <span class="string">&quot;Honesty*and*diligence*should*be*your*eternal*mates.&quot;</span></span><br><span class="line">  fmt.Println(strings.Split(str, <span class="string">&quot;*&quot;</span>)) <span class="comment">//[Honesty and diligence should be your eternal mates.]</span></span><br><span class="line">  fmt.Println(strings.SplitAfter(str, <span class="string">&quot;*&quot;</span>)) <span class="comment">//[Honesty* and* diligence* should* be* your* eternal* mates.]</span></span><br><span class="line">  fmt.Println(strings.SplitN(str, <span class="string">&quot;*&quot;</span>, <span class="number">2</span>)) <span class="comment">//[Honesty and*diligence*should*be*your*eternal*mates.]</span></span><br><span class="line">  fmt.Println(strings.SplitAfterN(str, <span class="string">&quot;*&quot;</span>, <span class="number">2</span>)) <span class="comment">//[Honesty* and*diligence*should*be*your*eternal*mates.]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>字符串替换相关的函数</li></ol><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>str := strings.Replace(str, old, new, n)</td><td>n为替换的次数，-1表示不限制</td></tr><tr><td>str := strings.Map(f, str)</td><td>按照func f(rune) rune{}规则替换str中的字符</td></tr></tbody></table><p>例如：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  str := <span class="string">&quot;Honesty*and*diligence*should*be*your*eternal*mates.&quot;</span></span><br><span class="line">  fmt.Println(strings.Replace(str, <span class="string">&quot;*&quot;</span>, <span class="string">&quot; &quot;</span>, <span class="number">-1</span>)) <span class="comment">//Honesty and diligence should be your eternal mates.</span></span><br><span class="line">  fmt.Println(strings.Replace(str, <span class="string">&quot;*&quot;</span>, <span class="string">&quot; &quot;</span>, <span class="number">1</span>)) <span class="comment">//Honesty and*diligence*should*be*your*eternal*mates.</span></span><br><span class="line">  fmt.Println(strings.Map(<span class="function"><span class="keyword">func</span><span class="params">(c <span class="keyword">rune</span>)</span> <span class="title">rune</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> c == <span class="string">&#x27;*&#x27;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27; &#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line">  &#125;, str)) <span class="comment">//Honesty and diligence should be your eternal mates.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>字符串过滤相关的函数</li></ol><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>str := strings.Trim(string, t)</td><td>从string两端去掉t，返回新的字符串</td></tr><tr><td>str := strings.TrimSpace(string)</td><td>从string两端去掉空格</td></tr><tr><td>str := strings.TrimFunc(string, f)</td><td>从string两端过滤掉f返回为true的字符</td></tr><tr><td>str := strings.TrimLeft(string, t)</td><td>从string左边过滤掉t</td></tr><tr><td>str := strings.TrimLeftFunc(string, f)</td><td>从string左边过滤掉f返回为true的字符</td></tr><tr><td>str := strings.TrimRight(string, t)</td><td>从string右边过滤掉t</td></tr><tr><td>str := strings.TrimRightFunc(string, f)</td><td>从string右边过滤掉f返回为true的字符</td></tr></tbody></table><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  str := <span class="string">&quot;  Honesty and diligence should be your eternal mates.  &quot;</span></span><br><span class="line">  str1 := <span class="string">&quot;**Honesty and diligence should*be your eternal mates.**&quot;</span></span><br><span class="line">  fmt.Println(strings.TrimSpace(str)) <span class="comment">//Honesty and diligence should be your eternal mates.</span></span><br><span class="line">  fmt.Println(strings.TrimLeft(str1, <span class="string">&quot;*&quot;</span>)) <span class="comment">//Honesty and diligence should*be your eternal mates.**</span></span><br><span class="line">  fmt.Println(strings.TrimRight(str1, <span class="string">&quot;*&quot;</span>)) <span class="comment">//**Honesty and diligence should*be your eternal mates.</span></span><br><span class="line">  fmt.Println(strings.Trim(str1, <span class="string">&quot;*&quot;</span>)) <span class="comment">//Honesty and diligence should*be your eternal mates.</span></span><br><span class="line">  fmt.Println(strings.TrimFunc(str1, <span class="function"><span class="keyword">func</span><span class="params">(c <span class="keyword">rune</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> c &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;)) <span class="comment">//Honesty and diligence should*be your eternal mates.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>字符串判断相关的函数</li></ol><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>b := strings.Contains(s, t)</td><td>如果s中包含t，则返回true</td></tr><tr><td>nr := strings.Count(s, t)</td><td>t在s中出现的次数</td></tr><tr><td>b := strings.EqualFold(s, t)</td><td>如果字符串s与t相等的话返回true，区分大小写</td></tr><tr><td>b := strings.HasPrefix(s, t)</td><td>如果s以t开头，则返回true</td></tr><tr><td>b := strings.HasSuffix(s, t)</td><td>如果s以t结尾，则返回true</td></tr><tr><td>idx := strings.Index(s, t)</td><td>t在s中第一次出现的索引位置</td></tr><tr><td>idx := strings.IndexAny(s, t)</td><td>t中的任意字符在s中第一次出现的索引位置</td></tr><tr><td>idx := strings.IndexFunc(s, f)</td><td>s中第一次令f返回true的索引位置</td></tr><tr><td>idx := strings.IndexRune(s, char)</td><td>字符char在s中第一次出现的索引位置</td></tr><tr><td>idx := strings.LastIndex(s, t)</td><td>t在s中最后一次出现的索引位置</td></tr><tr><td>idx := strings.LastIndexAny(s, t)</td><td>t中的任意字符在s中最后一次出现的索引位置</td></tr><tr><td>idx := strings.LastIndexFunc(s, f)</td><td>s中最后一次令f返回true的索引位置</td></tr><tr><td>idx := strings.LastIndexRune(s, char)</td><td>字符char在s中最后一次出现的索引位置</td></tr></tbody></table><p>例如：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  s := <span class="string">&quot;hello world&quot;</span></span><br><span class="line">  t := <span class="string">&quot;world&quot;</span></span><br><span class="line">  fmt.Println(strings.Index(s, t)) <span class="comment">//6</span></span><br><span class="line">  fmt.Println(strings.IndexAny(s, t)) <span class="comment">//2</span></span><br><span class="line">  fmt.Println(strings.IndexRune(s, <span class="string">&#x27;e&#x27;</span>)) <span class="comment">//1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>字符串修改相关的函数</li></ol><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>str := strings.Join(arr, t)</td><td>用t作为分隔符将arr中的字符串连接起来</td></tr><tr><td>str := strings.Repeat(s, nr)</td><td>将s重复nr次返回新的字符串</td></tr><tr><td>str := strings.Title(s)</td><td>将s中每个单词的首字母大写</td></tr><tr><td>str := strings.ToTitle(s)</td><td>将s中的所有字母大写</td></tr><tr><td>str := strings.ToLower(s)</td><td>将s中所有的字母转换为小写字母</td></tr><tr><td>str := strings.ToLowerSpecial(r unicode.SpecialCase, s)</td><td>按照r将s中的unicode字符转换为小写</td></tr><tr><td>str := strings.ToUpper(s)</td><td>将s中所有的字母转换为大写字母</td></tr><tr><td>str := strings.ToUpperSpecial(r unicode.SpecialCase, s)</td><td>按照r将s中的unicode字符转换为大写</td></tr></tbody></table><p>例如：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;strings&quot;</span></span><br><span class="line">  <span class="string">&quot;unicode&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  str := <span class="string">&quot;Honesty and diligence should be your eternal mates.&quot;</span></span><br><span class="line">  str1 := <span class="string">&quot;wow&quot;</span></span><br><span class="line">  str2 := <span class="string">&quot;Önnek İş&quot;</span></span><br><span class="line">  arr := []<span class="keyword">string</span>&#123;<span class="string">&quot;Honesty&quot;</span>, <span class="string">&quot;and&quot;</span>, <span class="string">&quot;diligence&quot;</span>, <span class="string">&quot;should&quot;</span>, <span class="string">&quot;be&quot;</span>, <span class="string">&quot;your&quot;</span>, <span class="string">&quot;eternal&quot;</span>, <span class="string">&quot;mates.&quot;</span>&#125;</span><br><span class="line">  fmt.Println(strings.Join(arr, <span class="string">&quot; &quot;</span>)) <span class="comment">//Honesty and diligence should be your eternal mates.</span></span><br><span class="line">  fmt.Println(strings.Repeat(str1, <span class="number">3</span>)) <span class="comment">//wowwowwow</span></span><br><span class="line">  fmt.Println(strings.Title(str)) <span class="comment">//Honesty And Diligence Should Be Your Eternal Mates.</span></span><br><span class="line">  fmt.Println(strings.ToTitle(str)) <span class="comment">//HONESTY AND DILIGENCE SHOULD BE YOUR ETERNAL MATES.</span></span><br><span class="line">  fmt.Println(strings.ToLower(str)) <span class="comment">//honesty and diligence should be your eternal mates.</span></span><br><span class="line">  fmt.Println(strings.ToUpper(str)) <span class="comment">//HONESTY AND DILIGENCE SHOULD BE YOUR ETERNAL MATES.</span></span><br><span class="line">  fmt.Println(strings.ToLowerSpecial(unicode.TurkishCase, str2)) <span class="comment">//önnek iş</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="strconv"><a href="#strconv" class="headerlink" title="strconv"></a>strconv</h4><p>strconv包提供了许多可以在字符串和其他类型之间转换的函数。</p><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>strconv.AppendBool(bs, b)</td><td>bs是byte类型的切片，返回的切片会将布尔值b的字符串表示追加到bs</td></tr><tr><td>strconv.AppendFloat(bs, f, fmt, prec, bits)</td><td>返回的切片会将f的字符串表示追加到bs</td></tr><tr><td>strconv.AppendInt(bs, i, base)</td><td>返回的切片会将整数i的字符串表示追加到bs</td></tr><tr><td>strconv.AppendQuote(bs, str)</td><td>返回的切片会将str的字符串表示（带双引号）追加到bs</td></tr><tr><td>strconv.AppendQuoteRune(bs, char)</td><td>返回的切片会将char的字符串表示（带单引号）追加到bs</td></tr><tr><td>strconv.AppendQuoteRuneToASCII(bs, char)</td><td>返回的切片会将char的字符串表示（非ascii字符用unicode十六进制表示）追加到bs</td></tr><tr><td>strconv.AppendQuoteToASCII(bs, str)</td><td>返回的切片会将str的字符串表示（非ascii字符用unicode十六进制表示）追加到bs</td></tr><tr><td>strconv.AppendUInt(bs, u, base)</td><td>返回的切片会将无符号数整型的字符串表示追加到bs</td></tr><tr><td>strconv.Atoi(s)</td><td>返回s转换的整型</td></tr><tr><td>strconv.CanBackquote(s)</td><td>检查s是否是一个合法的字符串常量（不包含反引号）</td></tr><tr><td>strconv.FormatBool(tf)</td><td>将布尔值转换为字符串”true”或者”false”</td></tr><tr><td>strconv.FormatFloat(f, fmt, prec, bits)</td><td>将浮点数f转换成字符串，fmt为转换格式，prec表示小数点后的位数，bits通常是64</td></tr><tr><td>strconv.FormatInt(i, base)</td><td>将整型数转换为字符串</td></tr><tr><td>strconv.FormatUint(u, base)</td><td>将无符号数转换为字符串</td></tr><tr><td>strconv.Itoa(i)</td><td>将十进制数i转换为字符串</td></tr><tr><td>strconv.IsPrint(c)</td><td>判断字符c是否可打印字符</td></tr><tr><td>strconv.ParseBool(s)</td><td>将字符串转换为布尔值，true: “1”,”t”,”T”,”true”,”True”,”TRUE”. false: “0”,”f”, “F”,”false”,”FALSE”,”False”</td></tr><tr><td>strconv.ParseFloat(s, bits)</td><td>将字符串转换为浮点类型的数值</td></tr><tr><td>strconv.ParseInt(s, base, bits)</td><td>base为0，自动判断进制，bits为0，则转换成int类型</td></tr><tr><td>strconv.ParseUint(s, base, bits)</td><td>同上，但返回无符号整型</td></tr><tr><td>strconv.Quote(s)</td><td>给字符串加双引号</td></tr><tr><td>strconv.QuoteRune(char)</td><td>给字符加上单引号</td></tr><tr><td>strconv.QuoteRuneToASCII(char)</td><td>同上，对非ASCII字符进行转义</td></tr><tr><td>strconv.QuoteToASCII(s)</td><td>同Quote，但对非ASCII字符进行转义</td></tr><tr><td>strconv.Unquote(s)</td><td>将s中的表示字符串、字符变量的单引号、反引号、双引号去掉</td></tr><tr><td>strconv.UnquoteChar(s, c)</td><td>s是目标字符串，c为0则不对单引号双引号进行转义，c为单引号则表示对单引号进行转义，为双引号则表示对双引号进行转义. 有4个返回值，第一个是s中第一个字符的rune值，第二个返回值表示s中第一个字符是否多字节unicode字符，第三个返回值表示剩下的字符串，第四个为error</td></tr></tbody></table><p>例子：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;strconv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  bs := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">10</span>)</span><br><span class="line">  fmt.Println(strconv.AppendBool(bs, <span class="literal">false</span>)) <span class="comment">//[0 0 0 0 0 0 0 0 0 0 102 97 108 115 101]</span></span><br><span class="line">  fmt.Println(strconv.AppendInt(bs, <span class="number">22</span>, <span class="number">10</span>)) <span class="comment">//[0 0 0 0 0 0 0 0 0 0 50 50]</span></span><br><span class="line">  fmt.Println(<span class="keyword">string</span>(strconv.AppendFloat(bs, <span class="number">12.65</span>, <span class="string">&#x27;e&#x27;</span>, <span class="number">5</span>, <span class="number">64</span>))) <span class="comment">//1.26500e+01</span></span><br><span class="line">  fmt.Println(<span class="keyword">string</span>(strconv.AppendQuote(bs, <span class="string">&quot;hello world&quot;</span>))) <span class="comment">//&quot;hello world&quot;</span></span><br><span class="line">  fmt.Println(<span class="keyword">string</span>(strconv.AppendQuoteRune(bs, <span class="string">&#x27;我&#x27;</span>))) <span class="comment">//&#x27;我&#x27;</span></span><br><span class="line">  fmt.Println(<span class="keyword">string</span>(strconv.AppendQuoteRune(bs, <span class="string">&#x27;d&#x27;</span>))) <span class="comment">//&#x27;d&#x27;</span></span><br><span class="line">  fmt.Println(<span class="keyword">string</span>(strconv.AppendQuoteRuneToASCII(bs, <span class="string">&#x27;我&#x27;</span>))) <span class="comment">//&#x27;\u6211&#x27;</span></span><br><span class="line">  fmt.Println(strconv.Atoi(<span class="string">&quot;123&quot;</span>)) <span class="comment">//123 &lt;nil&gt;</span></span><br><span class="line">  fmt.Println(strconv.Itoa(<span class="number">123</span>)) <span class="comment">//123</span></span><br><span class="line">  fmt.Println(strconv.CanBackquote(<span class="string">&quot;hello world`&quot;</span>)) <span class="comment">//false</span></span><br><span class="line">  fmt.Println(strconv.CanBackquote(<span class="string">&quot;hello world&quot;</span>)) <span class="comment">//true</span></span><br><span class="line">  fmt.Println(strconv.FormatBool(<span class="literal">true</span>)) <span class="comment">//true</span></span><br><span class="line">  fmt.Println(strconv.FormatBool(<span class="literal">false</span>)) <span class="comment">//false</span></span><br><span class="line">  fmt.Println(strconv.FormatFloat(<span class="number">12.625</span>, <span class="string">&#x27;f&#x27;</span>, <span class="number">2</span>, <span class="number">64</span>)) <span class="comment">//12.62</span></span><br><span class="line">  fmt.Println(strconv.FormatInt(<span class="number">123</span>, <span class="number">10</span>)) <span class="comment">//123</span></span><br><span class="line">  fmt.Println(strconv.IsPrint(<span class="number">50</span>)) <span class="comment">//true</span></span><br><span class="line">  fmt.Println(<span class="keyword">string</span>(strconv.AppendQuoteRune(bs, <span class="number">50</span>))) <span class="comment">//&#x27;2&#x27;</span></span><br><span class="line">  fmt.Println(strconv.ParseBool(<span class="string">&quot;True&quot;</span>)) <span class="comment">//true &lt;nil&gt;</span></span><br><span class="line">  fmt.Println(strconv.ParseFloat(<span class="string">&quot;1.32&quot;</span>, <span class="number">64</span>)) <span class="comment">//1.32 &lt;nil&gt;</span></span><br><span class="line">  fmt.Println(strconv.ParseInt(<span class="string">&quot;-0x25&quot;</span>, <span class="number">0</span>, <span class="number">0</span>)) <span class="comment">//-37 &lt;nil&gt;</span></span><br><span class="line">  fmt.Println(strconv.ParseUint(<span class="string">&quot;-0x25&quot;</span>, <span class="number">0</span>, <span class="number">0</span>)) <span class="comment">//0 strconv.ParseUint: parsing &quot;-0x25&quot;: invalid syntax</span></span><br><span class="line">  fmt.Println(strconv.Quote(<span class="string">&quot;hello world&quot;</span>)) <span class="comment">//&quot;hello world&quot;</span></span><br><span class="line">  fmt.Println(strconv.QuoteRune(<span class="string">&#x27;我&#x27;</span>)) <span class="comment">//&#x27;我&#x27;</span></span><br><span class="line">  fmt.Println(strconv.QuoteRuneToASCII(<span class="string">&#x27;我&#x27;</span>)) <span class="comment">//&#x27;\u6211&#x27;</span></span><br><span class="line">  fmt.Println(strconv.QuoteToASCII(<span class="string">&quot;我am&quot;</span>)) <span class="comment">//&quot;\u6211am&quot;</span></span><br><span class="line">  fmt.Println(strconv.Unquote(<span class="string">&quot;\&quot;我是谁\&quot;&quot;</span>)) <span class="comment">//我是谁 &lt;nil&gt;</span></span><br><span class="line">  fmt.Println(strconv.UnquoteChar(<span class="string">`&quot;Fran &amp; Freddie&#x27;s Diner&quot;`</span>, <span class="number">0</span>)) <span class="comment">//34 false Fran &amp; Freddie&#x27;s Diner&quot; &lt;nil&gt;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="utf8"><a href="#utf8" class="headerlink" title="utf8"></a>utf8</h4><p>utf8包中的函数主要用来查询和操作UTF-8编码的字符串或者字节切片。</p><p>b: []byte<br>s: string<br>c: rune</p><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>utf8.DecodeRune(b)</td><td>返回b中的第一个rune及占用的字节数</td></tr><tr><td>utf8.DecodeRuneInString(s)</td><td>返回字符串中第一个rune及其占用的字节数</td></tr><tr><td>utf8.DecodeLastRune(b)</td><td>返回b中最后一个rune及其占用的字节数</td></tr><tr><td>utf8.DecodeLastRuneInString(s)</td><td>返回字符串s中最后一个rune及其占用的字节数</td></tr><tr><td>utf8.FullRune(b)</td><td>如果b的第一个rune是完整的utf8编码的话返回true</td></tr><tr><td>utf8.FullRuneInString(s)</td><td>同上，但输入是字符串</td></tr><tr><td>utf8.RuneCount(b)</td><td>b中rune的个数</td></tr><tr><td>utf8.RuneCountInString(s)</td><td>s中rune的个数</td></tr><tr><td>utf8.RuneLen(c)</td><td>对c进行编码需要的字节数</td></tr><tr><td>utf8.RuneStart(x byte)</td><td>x是否可以作为一个rune的第一个字节</td></tr><tr><td>utf8.Valid(b)</td><td>b中的字节能否正确表示一个utf8编码的字符串</td></tr><tr><td>utf8.ValidString(s)</td><td>s中的字节能否正确表示一个utf8编码的字符串</td></tr></tbody></table><p>例如：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;unicode/utf8&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  s := <span class="string">&quot;hello 世界&quot;</span></span><br><span class="line">  b := []<span class="keyword">byte</span>(s)</span><br><span class="line">  c := <span class="string">&#x27;世&#x27;</span></span><br><span class="line">  buf := []<span class="keyword">byte</span>&#123;<span class="number">228</span>, <span class="number">184</span>, <span class="number">150</span>&#125; <span class="comment">// 世</span></span><br><span class="line">  str := <span class="string">&quot;世&quot;</span></span><br><span class="line"></span><br><span class="line">  fmt.Println(utf8.DecodeRune(b))  <span class="comment">//104 1</span></span><br><span class="line">  fmt.Println(utf8.DecodeLastRune(b)) <span class="comment">//30028 3</span></span><br><span class="line">  fmt.Println(utf8.DecodeRuneInString(s)) <span class="comment">//104 1</span></span><br><span class="line">  fmt.Println(utf8.DecodeLastRuneInString(s)) <span class="comment">//30028 3</span></span><br><span class="line">  fmt.Println(utf8.EncodeRune(b, c)) <span class="comment">//3</span></span><br><span class="line">  fmt.Println(<span class="keyword">string</span>(b)) <span class="comment">//世lo 世界</span></span><br><span class="line">  b = []<span class="keyword">byte</span>(s)</span><br><span class="line"></span><br><span class="line">  fmt.Println(utf8.FullRune(buf)) <span class="comment">//true</span></span><br><span class="line">  fmt.Println(utf8.FullRune(buf[:<span class="number">2</span>])) <span class="comment">//false</span></span><br><span class="line">  fmt.Println(utf8.FullRuneInString(str)) <span class="comment">//true</span></span><br><span class="line">  fmt.Println(utf8.FullRuneInString(str[:<span class="number">2</span>])) <span class="comment">//false</span></span><br><span class="line"></span><br><span class="line">  fmt.Println(utf8.RuneCount(b)) <span class="comment">//8</span></span><br><span class="line">  fmt.Println(<span class="built_in">len</span>(b)) <span class="comment">//12</span></span><br><span class="line">  fmt.Println(utf8.RuneCountInString(s)) <span class="comment">//8</span></span><br><span class="line">  fmt.Println(<span class="built_in">len</span>(s)) <span class="comment">//12</span></span><br><span class="line">  fmt.Println(utf8.RuneLen(c)) <span class="comment">//3</span></span><br><span class="line"></span><br><span class="line">  fmt.Println(utf8.RuneStart(b[<span class="number">0</span>])) <span class="comment">//true</span></span><br><span class="line">  fmt.Println(utf8.RuneStart(b[<span class="number">6</span>])) <span class="comment">//true</span></span><br><span class="line">  fmt.Println(utf8.RuneStart(b[<span class="number">7</span>])) <span class="comment">//false</span></span><br><span class="line">  fmt.Println(utf8.Valid(b)) <span class="comment">//true</span></span><br><span class="line">  fmt.Println(utf8.ValidString(s)) <span class="comment">//true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="unicode"><a href="#unicode" class="headerlink" title="unicode"></a>unicode</h4><p>unicode包主要提供了一个判断Unicode码点的函数。</p><p>c: rune</p><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>unicode.IsControl(c)</td><td>是否控制字符</td></tr><tr><td>unicode.IsDigit(c)</td><td>是否十进制数字</td></tr><tr><td>unicode.IsGraphic(c)</td><td>是否图形字符</td></tr><tr><td>unicode.IsLetter(c)</td><td>是否字母</td></tr><tr><td>unicode.IsLower(c)</td><td>是否小写字母</td></tr><tr><td>unicode.IsMark(c)</td><td>是否标记</td></tr><tr><td>unicode.IsPrint(c)</td><td>是否可打印</td></tr><tr><td>unicode.IsPunct(c)</td><td>是否标点符号</td></tr><tr><td>unicode.IsSpace(c)</td><td>是否空格</td></tr><tr><td>unicode.IsSymbol(c)</td><td>是否符号</td></tr><tr><td>unicode.IsTitle(c)</td><td>是否标题大写字符</td></tr><tr><td>unicode.IsUpper(c)</td><td>是否大写字母</td></tr><tr><td>unicode.ToLower(c)</td><td>转换为小写字母</td></tr><tr><td>unicode.ToUpper(c)</td><td>转换为大写字母</td></tr><tr><td>unicode.ToTitle(c)</td><td>转换为标题字母</td></tr></tbody></table><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;unicode&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// constant with mixed type runes</span></span><br><span class="line"><span class="keyword">const</span> mixed = <span class="string">&quot;\b5Ὂg̀9! ℃ᾭG十&quot;</span></span><br><span class="line"><span class="keyword">for</span> _, c := <span class="keyword">range</span> mixed &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;For %q:\n&quot;</span>, c)</span><br><span class="line"><span class="keyword">if</span> unicode.IsControl(c) &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;\tis control rune&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> unicode.IsDigit(c) &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;\tis digit rune&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> unicode.IsGraphic(c) &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;\tis graphic rune&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> unicode.IsLetter(c) &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;\tis letter rune&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> unicode.IsLower(c) &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;\tis lower case rune&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> unicode.IsMark(c) &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;\tis mark rune&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> unicode.IsNumber(c) &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;\tis number rune&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> unicode.IsPrint(c) &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;\tis printable rune&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> !unicode.IsPrint(c) &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;\tis not printable rune&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> unicode.IsPunct(c) &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;\tis punct rune&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> unicode.IsSpace(c) &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;\tis space rune&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> unicode.IsSymbol(c) &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;\tis symbol rune&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> unicode.IsTitle(c) &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;\tis title case rune&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> unicode.IsUpper(c) &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;\tis upper case rune&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">For <span class="string">&#x27;\b&#x27;</span>:</span><br><span class="line"><span class="literal">is</span> control rune</span><br><span class="line"><span class="literal">is</span><span class="built_in"> not</span> printable rune</span><br><span class="line">For <span class="string">&#x27;5&#x27;</span>:</span><br><span class="line"><span class="literal">is</span> digit rune</span><br><span class="line"><span class="literal">is</span> graphic rune</span><br><span class="line"><span class="literal">is</span><span class="built_in"> number</span> rune</span><br><span class="line"><span class="literal">is</span> printable rune</span><br><span class="line">For <span class="string">&#x27;Ὂ&#x27;</span>:</span><br><span class="line"><span class="literal">is</span> graphic rune</span><br><span class="line"><span class="literal">is</span> letter rune</span><br><span class="line"><span class="literal">is</span> printable rune</span><br><span class="line"><span class="literal">is</span> upper <span class="keyword">case</span> rune</span><br><span class="line">For <span class="string">&#x27;g&#x27;</span>:</span><br><span class="line"><span class="literal">is</span> graphic rune</span><br><span class="line"><span class="literal">is</span> letter rune</span><br><span class="line"><span class="literal">is</span> lower <span class="keyword">case</span> rune</span><br><span class="line"><span class="literal">is</span> printable rune</span><br><span class="line">For <span class="string">&#x27;̀&#x27;</span>:</span><br><span class="line"><span class="literal">is</span> graphic rune</span><br><span class="line"><span class="literal">is</span> mark rune</span><br><span class="line"><span class="literal">is</span> printable rune</span><br><span class="line">For <span class="string">&#x27;9&#x27;</span>:</span><br><span class="line"><span class="literal">is</span> digit rune</span><br><span class="line"><span class="literal">is</span> graphic rune</span><br><span class="line"><span class="literal">is</span><span class="built_in"> number</span> rune</span><br><span class="line"><span class="literal">is</span> printable rune</span><br><span class="line">For <span class="string">&#x27;!&#x27;</span>:</span><br><span class="line"><span class="literal">is</span> graphic rune</span><br><span class="line"><span class="literal">is</span> printable rune</span><br><span class="line"><span class="literal">is</span> punct rune</span><br><span class="line">For <span class="string">&#x27; &#x27;</span>:</span><br><span class="line"><span class="literal">is</span> graphic rune</span><br><span class="line"><span class="literal">is</span> printable rune</span><br><span class="line"><span class="literal">is</span> space rune</span><br><span class="line">For <span class="string">&#x27;℃&#x27;</span>:</span><br><span class="line"><span class="literal">is</span> graphic rune</span><br><span class="line"><span class="literal">is</span> printable rune</span><br><span class="line"><span class="literal">is</span> symbol rune</span><br><span class="line">For <span class="string">&#x27;ᾭ&#x27;</span>:</span><br><span class="line"><span class="literal">is</span> graphic rune</span><br><span class="line"><span class="literal">is</span> letter rune</span><br><span class="line"><span class="literal">is</span> printable rune</span><br><span class="line"><span class="literal">is</span> title <span class="keyword">case</span> rune</span><br><span class="line">For <span class="string">&#x27;G&#x27;</span>:</span><br><span class="line"><span class="literal">is</span> graphic rune</span><br><span class="line"><span class="literal">is</span> letter rune</span><br><span class="line"><span class="literal">is</span> printable rune</span><br><span class="line"><span class="literal">is</span> upper <span class="keyword">case</span> rune</span><br><span class="line">For <span class="string">&#x27;十&#x27;</span>:</span><br><span class="line"><span class="literal">is</span> graphic rune</span><br><span class="line"><span class="literal">is</span> letter rune</span><br><span class="line"><span class="literal">is</span> printable rune</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go语言中的数值类型</title>
      <link href="/2021/12/15/Go%E8%AF%AD%E8%A8%80%E4%B8%AD%E7%9A%84%E6%95%B0%E5%80%BC%E7%B1%BB%E5%9E%8B/"/>
      <url>/2021/12/15/Go%E8%AF%AD%E8%A8%80%E4%B8%AD%E7%9A%84%E6%95%B0%E5%80%BC%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p>与其它语言一样，Go语言支持整型和浮点型数值。不同的是，Go语言是强类型语言，数值运算需要在同一种类型的数值之间进行。</p><p>Go语言内置的数值类型都支持下面所列的运算：</p><table><thead><tr><th align="center">语法</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center">+x</td><td align="center">x</td></tr><tr><td align="center">-x</td><td align="center">x的负值</td></tr><tr><td align="center">x++</td><td align="center">x加上常量1</td></tr><tr><td align="center">x–</td><td align="center">x减去常量1</td></tr><tr><td align="center">x + y</td><td align="center">x加上y</td></tr><tr><td align="center">x - y</td><td align="center">x减去y</td></tr><tr><td align="center">x * y</td><td align="center">x乘以y</td></tr><tr><td align="center">x / y</td><td align="center">x除以y</td></tr><tr><td align="center">x += y</td><td align="center">x = x + y</td></tr><tr><td align="center">x -= y</td><td align="center">x = x - y</td></tr><tr><td align="center">x *=y</td><td align="center">x = x * y</td></tr><tr><td align="center">x /=y</td><td align="center">x = x / y</td></tr></tbody></table><h3 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h3><p>数值类型的变量在定义时就需要指定其类型，如果没有指定，Go会进行类型推断。常量可以与其它类型兼容，不用转换也可以进行运算。不同类型的数值运算需要先使用下面的方法进行类型转换。注意：类型转换可能会导致精度丢失。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span>(value)</span><br></pre></td></tr></table></figure><p>例如：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">const</span> times = <span class="number">3</span> <span class="comment">// 定义常量</span></span><br><span class="line">i := <span class="number">20</span>         <span class="comment">// 未指定其类型，推断为 int</span></span><br><span class="line">j := <span class="keyword">int16</span>(<span class="number">20</span>)  <span class="comment">// 等同于 var j int16 = 20</span></span><br><span class="line">i *= times      <span class="comment">// 常量可以与任意整数类型运算</span></span><br><span class="line">i += <span class="keyword">int</span>(j)     <span class="comment">// int类型变量与int16类型变量运算需要先进行类型转换</span></span><br><span class="line">fmt.Println(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="整型"><a href="#整型" class="headerlink" title="整型"></a>整型</h3><p>Go语言所有的整数类型如下所示：</p><table><thead><tr><th align="center">类型</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center">int</td><td align="center">32位平台等同于int32, 64位平台等同于int64</td></tr><tr><td align="center">int8</td><td align="center">有符号 8 位整型 (-128 到 127)</td></tr><tr><td align="center">int16</td><td align="center">有符号 16 位整型 (-32768 到 32767)</td></tr><tr><td align="center">int32</td><td align="center">有符号 32 位整型 (-2147483648 到 2147483647)</td></tr><tr><td align="center">int64</td><td align="center">有符号 64 位整型 (-9223372036854775808 到 9223372036854775807)</td></tr><tr><td align="center">uint8</td><td align="center">无符号 8 位整型 (0 到 255)</td></tr><tr><td align="center">uint16</td><td align="center">无符号 16 位整型 (0 到 65535)</td></tr><tr><td align="center">uint32</td><td align="center">无符号 32 位整型 (0 到 4294967295)</td></tr><tr><td align="center">uint64</td><td align="center">无符号 64 位整型 (0 到 18446744073709551615)</td></tr><tr><td align="center">byte</td><td align="center">等同于uint8</td></tr><tr><td align="center">rune</td><td align="center">等同于uint32</td></tr><tr><td align="center">uintptr</td><td align="center">32位平台等同于uint32, 64位平台等同于uint64</td></tr></tbody></table><p>只有整型数值支持的运算如下：</p><table><thead><tr><th>语法</th><th>描述</th></tr></thead><tbody><tr><td>^x</td><td>按位取反</td></tr><tr><td>x % y</td><td>x除以y的余数</td></tr><tr><td>x &amp; y</td><td>x按位与运算</td></tr><tr><td>x | y</td><td>x按位或运算</td></tr><tr><td>x ^ y</td><td>x异或y</td></tr><tr><td>x &amp;^</td><td>x y按位与非运算</td></tr><tr><td>x &lt;&lt; u</td><td>x 左移 u位 高位丢弃，低位补0</td></tr><tr><td>x &gt;&gt; u</td><td>x 右移 u位 低位丢弃，高位补0</td></tr><tr><td>x %= y</td><td>x = x % y</td></tr><tr><td>x</td><td>= y</td></tr><tr><td>x ^= y</td><td>x = x ^ y</td></tr><tr><td>x &amp;^ y</td><td>x = x &amp; y</td></tr><tr><td>x &gt;&gt;= u</td><td>x = x &gt;&gt; u</td></tr><tr><td>x &lt;&lt;= u</td><td>x = x &lt;&lt; u</td></tr></tbody></table><h3 id="浮点型"><a href="#浮点型" class="headerlink" title="浮点型"></a>浮点型</h3><h4 id="IEEE浮点数的表示"><a href="#IEEE浮点数的表示" class="headerlink" title="IEEE浮点数的表示"></a>IEEE浮点数的表示</h4><p>IEEE浮点数标准用如下的形式表示一个浮点数：</p><p>$$ V = (-1)^s \times M \times 2^E $$</p><p>其中 s 的值可以为0或者1，用来表示浮点数的正负。M 为1<del>2或者0</del>1之间的小数值。E 为阶码，用于对浮点数加权。例如：小数 3.75 可以表示为：</p><p>$$ (-1)^0 \times 1\frac{7}{8} \times 2^1 $$</p><p>对于float32来说，其中 s 占 1 位，E 占8位，M 占剩下的23位。对于float64来说，s 占1位，E 占11位，M 占剩下的52位。<br>为了产生 -126 ~ 127之间的E的取值， float32中表示E的8位，作为无符号整数，需要减去一个偏置值 127. float64与之类似。<br>因此，Go语言中的浮点类型有两种，与之对应，即float32和float64。</p><p>由于存储浮点数的字节数有限，以及不是所有的浮点数都能用二进制精确的表示，所有有的浮点数只是一个近似值，在进行 == 与 != 比较时需要特别注意。</p>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go基本数据类型</title>
      <link href="/2021/12/14/Go%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"/>
      <url>/2021/12/14/Go%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p>Go支持如下内置基本类型：</p><ul><li>一种内置布尔类型：bool</li><li>11种内置整数类型：int8、uint8、int16、uint16、int32、uint32、int64、uint64、int、uint和uintptr</li><li>两种内置浮点数类型：float32和float64</li><li>两种内置复数类型：complex64和complex128</li><li>一种内置字符串类型：string</li></ul><p>Go中有两种内置类型别名（type alias）：</p><ul><li>byte是uint8的内置别名。 我们可以将byte和uint8看作是同一个类型。</li><li>rune是int32的内置别名。 我们可以将rune和int32看作是同一个类型。</li></ul><p> uintptr、int以及uint类型的值的尺寸依赖于具体编译器实现。 通常地，在64位的架构上，int和uint类型的值是64位的；在32位的架构上，它们是32位的。 编译器必须保证uintptr类型的值的尺寸能够存下任意一个内存地址。</p><p>一个complex64复数值的实部和虚部都是float32类型的值。 一个complex128复数值的实部和虚部都是float64类型的值。 </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一些类型定义声明</span></span><br><span class="line"><span class="keyword">type</span> status <span class="keyword">bool</span>     <span class="comment">// status和bool是两个不同的类型</span></span><br><span class="line"><span class="keyword">type</span> MyString <span class="keyword">string</span> <span class="comment">// MyString和string是两个不同的类型</span></span><br><span class="line"><span class="keyword">type</span> Id <span class="keyword">uint64</span>       <span class="comment">// Id和uint64是两个不同的类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="built_in">real</span> <span class="keyword">float32</span>    <span class="comment">// real和float32是两个不同的类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 一些类型别名声明</span></span><br><span class="line"><span class="keyword">type</span> boolean = <span class="keyword">bool</span> <span class="comment">// boolean和bool表示同一个类型</span></span><br><span class="line"><span class="keyword">type</span> Text = <span class="keyword">string</span>  <span class="comment">// Text和string表示同一个类型</span></span><br><span class="line"><span class="keyword">type</span> U8 = <span class="keyword">uint8</span>     <span class="comment">// U8、uint8和 byte表示同一个类型</span></span><br><span class="line"><span class="keyword">type</span> char = <span class="keyword">rune</span>    <span class="comment">// char、rune和int32表示同一个类型</span></span><br></pre></td></tr></table></figure><h3 id="零值"><a href="#零值" class="headerlink" title="零值"></a>零值</h3><p>每种类型都有一个零值。一个类型的零值可以看作是此类型的默认值。</p><ul><li>一个布尔类型的零值表示真假中的假。</li><li>数值类型的零值都是零（但是不同类型的零在内存中占用的空间可能不同）。</li><li>一个字符串类型的零值是一个空字符串。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Feature flags 概要</title>
      <link href="/2021/11/10/Featureflags%E6%A6%82%E8%A6%81/"/>
      <url>/2021/11/10/Featureflags%E6%A6%82%E8%A6%81/</url>
      
        <content type="html"><![CDATA[<p>Feature flags可以让软件开发更加的安全、迭代更加迅速，而且可以更加灵活的控制软件产品。Feature flags将功能迭代从代码部署中分离出来，从而可以使产品团队（开发团队、管理团队、SRE等）在版本控制之外更加精细地控制谁、什么时候可以使用什么功能。</p><span id="more"></span><h3 id="什么是Feature-flags"><a href="#什么是Feature-flags" class="headerlink" title="什么是Feature flags?"></a>什么是Feature flags?</h3><p>Feature flags是一种软件开发方法，开发者将新的功能封装在带有标志位的<code>if/else</code>语句中，从而使得产品团队可以在版本之外通过设置标志位来控制哪些功能可以被用户使用。标志位的开关独立于软件部署，所以即使产品环境部署同样一份代码，也可以通过设置标志位来打开/关闭某种功能。因此，支持Feature  flags也是持续交付(Continous delivery)的重要一环，它可以让版本发布更加迅速、更加可靠。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (flags.kms) &#123;</span><br><span class="line">    <span class="comment">/* with KMS feature */</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">/* without KMS feature */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://sanmuny.github.io/post-images/1636536399408.png"></p><h3 id="Feature-flags最佳实践"><a href="#Feature-flags最佳实践" class="headerlink" title="Feature flags最佳实践"></a>Feature flags最佳实践</h3><ol><li>选择正确的级别。根据自身的需求来选择feature flags的级别。如果级别选的过低，可能会有成百上千的flags，而且还需要来维护一些用不上的flags。但如果级别定的过高，feature flags控制的粒度又不够，精细程度满足不了需求。</li><li>Flag的命名一定要准确的描述是什么功能。否则的话，系统可能因为错误的flag被关闭或者打开而被破坏。另外，如果一个flag总是处于打开或者关闭的状态，那就应该被删掉。</li><li>设置日志来记录是谁打开或者关闭了flag。</li><li>需要给开发者之外的人操作flag的权限。</li><li>控制flag的访问权限。</li><li>通过flag的状态来管理feature flags的生命周期。</li></ol><h3 id="蓝绿部署集成feature-flags"><a href="#蓝绿部署集成feature-flags" class="headerlink" title="蓝绿部署集成feature flags"></a>蓝绿部署集成feature flags</h3><p>蓝绿部署是一种比较成熟的用于降低风险的升级系统的方法。升级时维护两套系统，蓝系统和绿系统，分别为运行中的版本和新的版本。可以在系统升级的时候，通过负载均衡器将用户流量从旧版本系统导入到新版本的系统。蓝绿部署一方面可以缩短甚至消除升级的宕机时间，新版本部署的时候旧的系统仍在运行。另一方面可以降低风险，一旦新版本有问题，可以很容易地将用户流量切回到旧的版本。</p><p><img src="https://sanmuny.github.io/post-images/1636948353910.png"></p><p>在蓝绿部署中可以引入feature flags，新的版本可以将新的功能通过feature flags关闭，然后再逐一打开。蓝绿升级要么使用新的版本的所有功能，要么使用旧的版本。feature flags 则弥补了这个不足。</p><h3 id="nodejs-中的feature-flags资源"><a href="#nodejs-中的feature-flags资源" class="headerlink" title="nodejs 中的feature flags资源"></a>nodejs 中的feature flags资源</h3><ol><li><a href="https://launchdarkly.com/feature-management/">LaunchDarkly</a> 是一个完整的feature flags解决方案，它提供了服务器端和前端的SDK。</li><li><a href="https://github.com/FenrirUnbound/flipit">Flipit</a>是一个nodejs中使用feature flags的模块。它通过配置文件存取feature flags并提供了查询/更新feature flags的接口，可以让程序不需要重启便能读取到最新的配置文件更改。</li><li><a href="https://github.com/FredKSchott/fflip">fflip</a>除了查询/更新feature flags之外，增加了对feature flags访问权限的控制。</li><li><a href="https://github.com/Unleash/unleash">Unleash</a>和LaunchDarkly类似，是一个完整的feature flags解决方案，同样提供了nodejs和前端的SDK。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 应用开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> devops </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go环境变量及常用命令</title>
      <link href="/2021/10/20/Go%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%8F%8A%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
      <url>/2021/10/20/Go%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%8F%8A%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h3 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h3><ul><li>GOROOT: Go语言的安装路径</li><li>GOPATH: Go语言工作区路径，默认为<code>~/go</code>。项目中执行go install命令后，项目构建后生成的可执行程序、静态库文件以及源码文件会被安装到GOPATH相应的目录中去</li><li>GOBIN: 存放Go可执行文件，一般是<code>GOPATH/bin</code>会被默认设置到操作系统的PATH环境变量中</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ tree -L <span class="number">1</span> ~/<span class="keyword">go</span></span><br><span class="line">/Users/wangsen/<span class="keyword">go</span></span><br><span class="line">├── bin</span><br><span class="line">├── pkg</span><br><span class="line">└── src</span><br><span class="line"></span><br><span class="line">$ <span class="keyword">go</span> env | <span class="keyword">grep</span> GOPATH</span><br><span class="line">GOPATH=<span class="string">&quot;/Users/wangsen/go&quot;</span></span><br><span class="line"></span><br><span class="line">$ <span class="keyword">go</span> env | <span class="keyword">grep</span> GOBIN</span><br><span class="line">GOBIN=<span class="string">&quot;/Users/wangsen/go/bin&quot;</span></span><br></pre></td></tr></table></figure><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><ul><li><code>go build</code>: 构建go程序</li><li><code>go test</code>: 运行测试代码</li><li><code>go install</code>: 构建并安装go程序</li><li><code>go fmt</code>: 格式化go代码</li><li><code>go vet</code>: 用来检查编译器发现不了的逻辑错误</li><li><code>go run</code>: 运行go代码</li><li><code>go mod init</code>: 创建一个新的模块并初始化go.mod文件. <code>go build</code>、<code>go test</code> 以及其它构建命令会将新的依赖添加到go.mod文件中.</li><li><code>go list -m all</code> 列出模块所有的依赖.</li><li><code>go get</code> 更新或者添加依赖包.</li><li><code>go mod tidy</code>: 删除go.mod中未使用的依赖.</li></ul><h3 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h3><ul><li>const、func、import、package、type和var用来声明各种代码元素。</li><li>chan、interface、map和struct用做 一些组合类型的字面表示中。</li><li>break、case、continue、default、 else、fallthrough、for、 goto、if、range、 return、select和switch用在流程控制语句中。 详见基本流程控制语法。</li><li>defer和go也可以看作是流程控制关键字， 但它们有一些特殊的作用。详见协程和延迟函数调用</li></ul><h3 id="标识符"><a href="#标识符" class="headerlink" title="标识符"></a>标识符</h3><p>Go合法标识符由unicode字符、数字及<code>_</code>组成，但不能以数字开头，用来表示Go代码元素，如变量、函数、类型以及包名等。</p>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQL学习笔记 - SQL概要</title>
      <link href="/2021/09/30/SQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0SQL%E6%A6%82%E8%A6%81/"/>
      <url>/2021/09/30/SQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0SQL%E6%A6%82%E8%A6%81/</url>
      
        <content type="html"><![CDATA[<p>SQL 是为数不多的声明性语言之一，用来和数据库管理系统进行对话。SQL语句分为四种类型：</p><ul><li>DDL(Data Definition Language)，也就是数据定义语言，它用来定义我们的数据库对象，包括数据库、数据表和列。通过使用DDL，我们可以创建，删除和修改数据库和表结构。</li><li>DML(Data Manipulation Language)，数据操作语言，我们用它操作和数据库相关的记录，比如增加、删除、修改数据表中的记录。</li><li>DCL(Data Control Language)，数据控制语言，我们用它来定义访问权限和安全级别。</li><li>DQL(Data Query Language)，数据查询语言，我们用它查询想要的记录</li></ul><h4 id="SQL执行流程"><a href="#SQL执行流程" class="headerlink" title="SQL执行流程"></a>SQL执行流程</h4><p>Oracle数据库中的执行流程：<br><img src="https://sanmuny.github.io/post-images/1632991445921.webp"></p><ol><li>语法检查：检查SQL拼写是否正确，如果不正确，Oracle会报语法错误。</li><li>语义检查：检查SQL中的访问对象是否存在。比如我们在写SELECT语句的时候，列名写错了，系统就会提示错误。语法检查和语义检查的作用是保证SQL语句没有错误。</li><li>权限检查：看用户是否具备访问该数据的权限。</li><li>共享池检查：共享池（Shared Pool）是一块内存池，最主要的作用是缓存SQL语句和该语句的执行计划。Oracle通过检查共享池是否存在SQL语句的执行计划，来判断进行软解析，还是硬解析。那软解析和硬解析又该怎么理解呢？</li><li>在共享池中，Oracle首先对SQL语句进行Hash运算，然后根据Hash值在库缓存（Library Cache）中查找，如果存在SQL语句的执行计划，就直接拿来执行，直接进入“执行器”的环节，这就是软解析。</li><li>如果没有找到SQL语句和执行计划，Oracle就需要创建解析树进行解析，生成执行计划，进入“优化器”这个步骤，这就是硬解析。</li><li>优化器：优化器中就是要进行硬解析，也就是决定怎么做，比如创建解析树，生成执行计划。</li><li>执行器：当有了解析树和执行计划之后，就知道了SQL该怎么被执行，这样就可以在执行器中执行语句了。</li></ol><p>MySQL数据库中的执行流程：<br><img src="https://sanmuny.github.io/post-images/1632991752749.webp"></p><ol><li>查询缓存：Server如果在查询缓存中发现了这条SQL语句，就会直接将结果返回给客户端；如果没有，就进入到解析器阶段。需要说明的是，因为查询缓存往往效率不高，所以在MySQL8.0之后就抛弃了这个功能。</li><li>解析器：在解析器中对SQL语句进行语法分析、语义分析。</li><li>优化器：在优化器中会确定SQL语句的执行路径，比如是根据全表检索，还是根据索引来检索等。</li><li>执行器：在执行之前需要判断该用户是否具备权限，如果具备权限就执行SQL查询并返回结果。在MySQL8.0以下的版本，如果设置了查询缓存，这时会将查询结果进行缓存。</li></ol><p>MySQL支持的存储引擎插件：</p><ol><li>InnoDB存储引擎：它是MySQL 5.5版本之后默认的存储引擎，最大的特点是支持事务、行级锁定、外键约束等。</li><li>MyISAM存储引擎：在MySQL 5.5版本之前是默认的存储引擎，不支持事务，也不支持外键，最大的特点是速度快，占用资源少。</li><li>Memory存储引擎：使用系统内存作为存储介质，以便得到更快的响应速度。不过如果mysqld进程崩溃，则会导致所有的数据丢失，因此我们只有当数据是临时的情况下才使用Memory存储引擎.</li><li>NDB存储引擎：也叫做NDB Cluster存储引擎，主要用于MySQL Cluster分布式集群环境，类似于Oracle的RAC集群。</li><li>Archive存储引擎：它有很好的压缩机制，用于文件归档，在请求写入时会进行压缩，所以也经常用来做仓库。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 数据库技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>React hooks 概要</title>
      <link href="/2021/08/23/Reacthooks%E6%A6%82%E8%A6%81/"/>
      <url>/2021/08/23/Reacthooks%E6%A6%82%E8%A6%81/</url>
      
        <content type="html"><![CDATA[<h3 id="React-基础知识回顾"><a href="#React-基础知识回顾" class="headerlink" title="React 基础知识回顾"></a>React 基础知识回顾</h3><p>React(响应)的设计理念是，当数据发生变化时，UI能自动把变化反映出来。它的诞生颠覆了传统的web UI开发模式，它把UI的开发从复杂的DOM操作中解脱出来，让开发者专注于数据、逻辑和UI组件本身。</p><span id="more"></span><p><img src="https://sanmuny.github.io/post-images/1629707806132.webp"></p><h4 id="组件-component"><a href="#组件-component" class="headerlink" title="组件 (component)"></a>组件 (component)</h4><p>React 是通过组件的方式来组织和描述UI的。组件可以分为两种类型：</p><ol><li>内置组件。内置组件其实就是映射到 HTML 节点的组件，例如 div、input、table 等等，作为一种约定，它们都是小写字母。</li><li>自定义组件。自定义组件其实就是自己创建的组件，使用时必须以大写字母开头，例如 TopicList、TopicDetail。</li></ol><p><img src="https://sanmuny.github.io/post-images/1629708149299.webp"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CommentBox</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">CommentHeader</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">CommentList</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">CommentForm</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="状态-state-和属性-props"><a href="#状态-state-和属性-props" class="headerlink" title="状态 (state)和属性(props)"></a>状态 (state)和属性(props)</h4><p>组件的状态用于维护组件用到的数据，而属性则用于父组件向子组件传递数据。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  Checkbox, Typography, List, ListItem, ListItemText, CircularProgress,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@material-ui/core&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ToDoList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      <span class="attr">loading</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">items</span>: [],</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">this</span>.handleCheck = <span class="built_in">this</span>.handleCheckEvent.bind(<span class="built_in">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.getToDoList();</span><br><span class="line">    <span class="keyword">let</span> nr = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">this</span>.state.items.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (item.done === <span class="literal">false</span>) &#123;</span><br><span class="line">        nr += <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">document</span>.title = <span class="string">`<span class="subst">$&#123;nr&#125;</span> itmes left`</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">componentDidUpdate</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> nr = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">this</span>.state.items.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (item.done === <span class="literal">false</span>) &#123;</span><br><span class="line">        nr += <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">document</span>.title = <span class="string">`<span class="subst">$&#123;nr&#125;</span> itmes left`</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">handleCheckEvent</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> tmpState = <span class="built_in">this</span>.state;</span><br><span class="line">    tmpState.items.forEach(<span class="function">(<span class="params">task, index, array</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (task.id === id) &#123;</span><br><span class="line">        array[index].done = !array[index].done;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">this</span>.setState(tmpState);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">getToDoList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">        <span class="attr">loading</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">items</span>: [</span><br><span class="line">          &#123; <span class="attr">id</span>: <span class="number">0</span>, <span class="attr">text</span>: <span class="string">&#x27;Learn JavaScript&#x27;</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">          &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">&#x27;Learn React&#x27;</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">          &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">&#x27;Play around in JSFiddle&#x27;</span>, <span class="attr">done</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">          &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">text</span>: <span class="string">&#x27;Build something awesome&#x27;</span>, <span class="attr">done</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;todo-list-container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Typography</span> <span class="attr">variant</span>=<span class="string">&quot;h6&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          Todos</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Typography</span>&gt;</span></span></span><br><span class="line"><span class="xml">        &#123;this.state.loading ? <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;loading-container&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">CircularProgress</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">          : (</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">List</span> <span class="attr">dense</span> <span class="attr">className</span>=<span class="string">&quot;todo-list&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">              &#123;this.state.items.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">ListItem</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">className</span>=<span class="string">&quot;todo-item&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                  <span class="tag">&lt;<span class="name">Checkbox</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">edge</span>=<span class="string">&quot;start&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">checked</span>=<span class="string">&#123;item.done&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">tabIndex</span>=<span class="string">&#123;-1&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">disableRipple</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">inputProps</span>=<span class="string">&#123;&#123;</span> &#x27;<span class="attr">aria-labelledby</span>&#x27;<span class="attr">:</span> <span class="attr">item.id</span> &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">onChange</span>=<span class="string">&#123;()</span> =&gt;</span> &#123; this.handleCheck(item.id); &#125;&#125;</span></span><br><span class="line"><span class="xml">                  /&gt;</span></span><br><span class="line"><span class="xml">                  <span class="tag">&lt;<span class="name">ListItemText</span> <span class="attr">className</span>=<span class="string">&#123;item.done</span> ? &#x27;<span class="attr">done</span>&#x27; <span class="attr">:</span> &#x27;&#x27;&#125; <span class="attr">id</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">primary</span>=<span class="string">&#123;item.text&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">ListItem</span>&gt;</span></span></span><br><span class="line"><span class="xml">              ))&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">List</span>&gt;</span></span></span><br><span class="line"><span class="xml">          )&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ToDoList;</span><br></pre></td></tr></table></figure><h4 id="JSX"><a href="#JSX" class="headerlink" title="JSX"></a>JSX</h4><p>JSX 并不是一个新的模板语言，而可以认为是一个语法糖。</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">React.createElement(</span><br><span class="line">  <span class="string">&quot;div&quot;</span>,</span><br><span class="line">  <span class="built_in">null</span>,</span><br><span class="line">  React.createElement(</span><br><span class="line">    <span class="string">&quot;Typography&quot;</span>,</span><br><span class="line">    <span class="params">...</span></span><br><span class="line">  ),</span><br><span class="line">  React.createElement(</span><br><span class="line">    <span class="string">&quot;List&quot;</span>,</span><br><span class="line">    <span class="params">...</span></span><br><span class="line">  );</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>React.createElement API的作用就是创建一个组件的实例。此外，这个 API 会接收一组参数：第一个参数表示组件的类型；第二个参数是传给组件的属性，也就是 props；第三个以及后续所有的参数则是子组件。</p><h3 id="React-引入Hooks的原因"><a href="#React-引入Hooks的原因" class="headerlink" title="React 引入Hooks的原因"></a>React 引入Hooks的原因</h3><p>React 组件的模型其实很直观，就是从 Model 到 View 的映射，这里的 Model 对应到 React 中就是 state 和 props。</p><p><img src="https://sanmuny.github.io/post-images/1629798317799.webp"></p><p>虽然之前的react也支持函数作为组件，但因为函数组件只能是纯函数，没法使用state，所以更多的情形是用class来实现UI组件。但我们可以从上图可以看到，state/props 到view的本质就是一种函数关系。react用到的class并没有真正使用到面向对象的优势，比如说子组件和父组件并不是一种继承关系，组件之间也不会调用对方的方法。</p><p>于是Hooks被引入到react中，Hooks能够把一个外部的数据绑定到函数的执行。当数据变化时，函数能够自动重新执行。这样的话，任何会影响 UI 展现的外部数据，都可以通过这个机制绑定到 React 的函数组件。</p><p>前面我们说了，react 引入hooks的原因是其本质是函数映射，那么把react组件函数化最大的优势是什么？答案就是数据和逻辑复用。class组件之间是没法共享state的，父组件的state只能通过子组件的props传递给子组件。没有父子关系的组件之间要共享数据只能通过高阶组件。</p><h3 id="React常用的Hook"><a href="#React常用的Hook" class="headerlink" title="React常用的Hook"></a>React常用的Hook</h3><h4 id="useState"><a href="#useState" class="headerlink" title="useState"></a>useState</h4><p>useState可以让函数组件具有维护状态的能力。参考前面Counter的例子，<code>const [count, setCount] = React.useState(0);</code>定义了名为count的状态，使得函数组件Counter的多次渲染可以共享它。0是状态的默认值，而setCount则是用来改变state的函数，调用setCount会让react刷新组件。useState 这个 Hook 的用法总结出来就是这样的：</p><ol><li>useState(initialState) 的参数 initialState 是创建 state 的初始值，它可以是任意类型，比如数字、对象、数组等等。</li><li>useState() 的返回值是一个有着两个元素的数组。第一个数组元素用来读取 state 的值，第二个则是用来设置这个 state 的值。</li><li>如果要创建多个 state，那么我们就需要多次调用 useState。例如</li></ol><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 定义一个年龄的 <span class="keyword">state</span>，初始值是 <span class="number">42</span></span><br><span class="line"><span class="keyword">const</span> [age, <span class="built_in">set</span>Age] = useState(<span class="number">42</span>);</span><br><span class="line">// 定义一个水果的 <span class="keyword">state</span>，初始值是 banana</span><br><span class="line"><span class="keyword">const</span> [fruit, <span class="built_in">set</span>Fruit] = useState(&#x27;banana&#x27;);</span><br><span class="line">// 定一个一个数组 <span class="keyword">state</span>，初始值是包含一个 todo 的数组</span><br><span class="line"><span class="keyword">const</span> [todos, <span class="built_in">set</span>Todos] = useState([&#123; text: &#x27;Learn Hooks&#x27; &#125;]);</span><br></pre></td></tr></table></figure><h4 id="useEffect"><a href="#useEffect" class="headerlink" title="useEffect"></a>useEffect</h4><p>副作用(Side Effect)指的是与UI渲染没有直接关系的操作，例如从服务器端获取数据等。React使用useEffect来替代class中的生命周期函数。useEffect接受两个参数，一个是callback函数，另外一个是执行callback函数的条件。</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use<span class="constructor">Effect(<span class="params">callback</span>, <span class="params">dependencies</span>)</span></span><br></pre></td></tr></table></figure><ol><li>当只传递callback，没有dependencies时，callback会在组件每次渲染的时候执行一次。</li><li>当dependencies为空数组<code>[]</code>时，callback会在组件第一次渲染的时候执行，相当于componentDidMount</li><li>当callback返回一个函数时，这个函数会在组件卸载的时候执行一次，相当于componentWillUnmount</li></ol><p>React hooks的使用规则：</p><ol><li>在useEffect回调函数中使用的变量，都必须在依赖项中声明</li><li>Hooks不能出现在条件语句和循环中，也不能出现在return之后</li><li>Hooks只能在函数组件或者自定义Hook中使用</li></ol><p>使用eslint可以检查这些规则：</p><ol><li>安装eslint插件：<code>npm install --save-dev eslint-plugin-react-hooks</code></li><li>在eslint配置文件中添加规则：<code>react-hooks/rules-of-hooks</code> 以及<code>react-hooks/exhaustive-deps</code></li></ol><h4 id="useCallback"><a href="#useCallback" class="headerlink" title="useCallback"></a>useCallback</h4><p>每次state的变化都会导致组件函数重新执行一遍，事件处理函数就会被定义多遍，而且事件处理函数通常是闭包，不会被垃圾回收清理掉。事件处理函数会作为props传递给组件，重新定义事件处理函数也会导致组件的频繁更新。为了提升性能，useCallback被引入到React Hooks之中。useCallback的定义如下：</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use<span class="constructor">Callback(<span class="params">fn</span>, [<span class="params">deps</span>])</span></span><br></pre></td></tr></table></figure><p>fn是定义的函数，deps是依赖变量的数组。只有deps中的某个变量发生变化时，fn才会被重新声明。</p><h4 id="useMemo"><a href="#useMemo" class="headerlink" title="useMemo"></a>useMemo</h4><p>类似的，由于每次渲染都会重新执行组件函数，那些耗时的计算也会重复进行。useMemo则用于避免重复的耗时计算。</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const result = use<span class="constructor">Memo(<span class="params">fn</span>, [<span class="params">deps</span>])</span></span><br></pre></td></tr></table></figure><p>同样，只有deps中的变量发生变化时，result才会用fn重新计算。</p><h4 id="useRef"><a href="#useRef" class="headerlink" title="useRef"></a>useRef</h4><p>useRef可以使函数组件的多次渲染之间共享数据。它相当于在函数组件之外创建了一个存储对象，其current属性值可以在多次渲染之间共享。</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="built_in">container</span> = useRef(initialValue)</span><br></pre></td></tr></table></figure><h4 id="useContext"><a href="#useContext" class="headerlink" title="useContext"></a>useContext</h4><p>React组件之间传递数据的方式通常是父子组件之间使用props来进行。React context API可以使得各个组件可以共享上下文数据。主要用于language, theme 等上下文的共享。大规模的数据共享还是应该使用redux这类的状态管理框架来进行。</p><p><img src="https://sanmuny.github.io/post-images/1631515426473.png"></p><p>要使用context数据，首先需要在顶层组件中定义context.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ThemeContext = React.createContext(<span class="string">&#x27;light&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">ThemeContext.Provider</span> <span class="attr">value</span>=<span class="string">&#x27;light&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">ThemeContest.Provider</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>然后子组件中就可以使用useContext来获取context的值了。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> theme = useContext(ThemeContext);</span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">className</span>=<span class="string">&#123;theme&#125;</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>下面的例子展示了如何使用React Hooks将上面的ToDoList class组件改造为函数组件。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ToDoItems = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [loading, setLoading] = useState(<span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">const</span> [todos, setTodos] = useState([]);</span><br><span class="line">  <span class="keyword">const</span> theme = useContext(ThemeContext);</span><br><span class="line">  <span class="keyword">const</span> nrTasksLeft = useMemo(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> nr = <span class="number">0</span>;</span><br><span class="line">    todos.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (item.done === <span class="literal">false</span>) &#123;</span><br><span class="line">        nr += <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> nr;</span><br><span class="line">  &#125;, [todos]);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.title = <span class="string">`<span class="subst">$&#123;nrTasksLeft&#125;</span> itmes left`</span>;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> getToDoList = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        setLoading(<span class="literal">false</span>);</span><br><span class="line">        setTodos([</span><br><span class="line">          &#123; <span class="attr">id</span>: <span class="number">0</span>, <span class="attr">text</span>: <span class="string">&#x27;Learn JavaScript&#x27;</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">          &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">&#x27;Learn React&#x27;</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">          &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">&#x27;Play around in JSFiddle&#x27;</span>, <span class="attr">done</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">          &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">text</span>: <span class="string">&#x27;Build something awesome&#x27;</span>, <span class="attr">done</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">        ]);</span><br><span class="line">      &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    getToDoList();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleCheck = useCallback(<span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> tmpTodos = [...todos];</span><br><span class="line">    tmpTodos.forEach(<span class="function">(<span class="params">todo, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (todo.id === id) &#123;</span><br><span class="line">        tmpTodos[index].done = !tmpTodos[index].done;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    setTodos(tmpTodos);</span><br><span class="line">  &#125;, [todos]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;todo-list-container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Typography</span> <span class="attr">variant</span>=<span class="string">&quot;h6&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        Todos</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">Typography</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;loading ? <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;loading-container&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">CircularProgress</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        : (</span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">List</span> <span class="attr">dense</span> <span class="attr">className</span>=<span class="string">&quot;todo-list&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;todos.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">              <span class="tag">&lt;<span class="name">ListItem</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">className</span>=<span class="string">&#123;</span>`<span class="attr">todo-item</span> $&#123;<span class="attr">theme</span>&#125;`&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Checkbox</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                  <span class="attr">className</span>=<span class="string">&#123;theme&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                  <span class="attr">edge</span>=<span class="string">&quot;start&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                  <span class="attr">checked</span>=<span class="string">&#123;item.done&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                  <span class="attr">tabIndex</span>=<span class="string">&#123;-1&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                  <span class="attr">disableRipple</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                  <span class="attr">inputProps</span>=<span class="string">&#123;&#123;</span> &#x27;<span class="attr">aria-labelledby</span>&#x27;<span class="attr">:</span> <span class="attr">item.id</span> &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                  <span class="attr">onChange</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="xml">                    handleCheck(item.id);</span></span><br><span class="line"><span class="xml">                  &#125;&#125;</span></span><br><span class="line"><span class="xml">                /&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">ListItemText</span> <span class="attr">className</span>=<span class="string">&#123;item.done</span> ? `$&#123;<span class="attr">theme</span>&#125; <span class="attr">done</span>` <span class="attr">:</span> `$&#123;<span class="attr">theme</span>&#125;`&#125; <span class="attr">id</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">primary</span>=<span class="string">&#123;item.text&#125;</span> <span class="attr">color</span>=<span class="string">&#123;theme</span> === <span class="string">&#x27;light&#x27;</span> ? &#x27;<span class="attr">black</span>&#x27; <span class="attr">:</span> &#x27;<span class="attr">white</span>&#x27;&#125; /&gt;</span></span></span><br><span class="line"><span class="xml">              <span class="tag">&lt;/<span class="name">ListItem</span>&gt;</span></span></span><br><span class="line"><span class="xml">            ))&#125;</span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">List</span>&gt;</span></span></span><br><span class="line"><span class="xml">        )&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="自定义Hooks"><a href="#自定义Hooks" class="headerlink" title="自定义Hooks"></a>自定义Hooks</h3><p>除了上述react内置的hooks之外，用户可以根据自己的需求利用上述hooks来创建自定义hooks。自定义hooks主要有如下4种使用情况：</p><ol><li>抽取业务逻辑，让组件之间能代码复用。</li><li>封装通用逻辑，让类似的逻辑只实现一遍。</li><li>监听浏览器状态，让组件能够使用浏览器的状态数据。</li><li>拆分复杂组件，让组件的逻辑更加清晰明了。</li></ol><p>例如，定义如下的自定义hook可以让组件更简单的使用浏览器宽度。</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> const useWindowSize = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  const [width, setWidth] = useState(<span class="built_in">window</span>.innerWidth);</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    const handleWindowSize = <span class="function"><span class="params">()</span> =&gt;</span> &#123; setWidth(<span class="built_in">window</span>.innerWidth); &#125;;</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">&#x27;resize&#x27;</span>, handleWindowSize);</span><br><span class="line">    <span class="keyword">return</span> () =&gt; &#123;</span><br><span class="line">      <span class="built_in">window</span>.removeEventListener(<span class="string">&#x27;resize&#x27;</span>, handleWindowSize);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> width;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>组件使用自定义hook时只需要引入即可。</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useWindowSize &#125; <span class="keyword">from</span> <span class="string">&#x27;../hooks&#x27;</span>;</span><br><span class="line">...</span><br><span class="line">const width = useWindowSize();</span><br><span class="line">...</span><br><span class="line"><span class="keyword">return</span> &lt;<span class="keyword">div</span>&gt;window <span class="keyword">size</span>: &#123;width&#125;&lt;/<span class="keyword">div</span>&gt;</span><br></pre></td></tr></table></figure><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><table><thead><tr><th>Hook</th><th>用途</th></tr></thead><tbody><tr><td>const [width, setWidth] = useState(window.innerWidth)</td><td>定义组件的状态</td></tr><tr><td>useEffect(fn, [deps])</td><td>替代class组件中的声明周期函数</td></tr><tr><td>useCallback(fn, [deps])</td><td>避免fn函数的重复定义和组件的重新渲染，只有当deps中的变量变化时才会重新定义</td></tr><tr><td>const result = useMemo(fn, [deps])</td><td>避免数据的重复计算</td></tr><tr><td>const container = useRef(initialValue)</td><td>在函数组件的多次渲染之间共享数据</td></tr><tr><td>useContext</td><td>用于组件使用页面的上下文</td></tr><tr><td>自定义Hook</td><td>逻辑复用，监听浏览器状态， 拆分复杂组件</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 应用开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> react </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>云原生概要</title>
      <link href="/2021/08/12/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%A6%82%E8%A6%81/"/>
      <url>/2021/08/12/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%A6%82%E8%A6%81/</url>
      
        <content type="html"><![CDATA[<h1 id="什么是云原生"><a href="#什么是云原生" class="headerlink" title="什么是云原生"></a>什么是云原生</h1><h2 id="设计目的"><a href="#设计目的" class="headerlink" title="设计目的"></a>设计目的</h2><p>云原生软件的设计目的是预测故障，并且即使当它所依赖的基础设施出现故障，或者发生其他变化时，它也依然能够保持稳定运行。</p><p>将变化或者失败视为正常规律，让面向失败的设计成为它们构建、交付和管理软件过程中的一个组成部分。</p><span id="more"></span><h2 id="云计算时代应用需求"><a href="#云计算时代应用需求" class="headerlink" title="云计算时代应用需求"></a>云计算时代应用需求</h2><ol><li><p>零停机时间<br>软件开发人员或者架构师对设计和开发一个松耦合、组件化的系统同样负有责任，应该通过部署冗余组件来应对不可避免的故障，并设置隔离机制来防止故障在整个系统中引起连锁反应。而且，还必须把软件设计成能够在不停机的情况下完成计划事件（例如，升级）。</p></li><li><p>缩短反馈周期<br>频道的软件发布可以缩短反馈周期，降低风险</p></li><li><p>多设备支持<br>用户越来越希望他们的应用体验随时可以从一个设备无缝切换到另一个设备上。</p></li><li><p>互联设备（物联网）<br>数据量和基础架构之间的差异，需要新的软件设计和实践来解决。</p></li><li><p>数据驱动<br>数据量正在不断增加，数据源分布得更加广泛，而软件的交付周期正在缩短<br>这些应用程序需要的不是单一的共享数据库，而是一个由更小的、本地化数据库组成的网络，以及能够在多个数据库管理系统之间管理数据关系的软件。</p></li></ol><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>云原生软件是高度<strong>分布式</strong>的，必须在一个不断变化的环境中运行，而且自身也在不断地发生<strong>变化</strong></p><h2 id="不适合使用云原生架构的情形"><a href="#不适合使用云原生架构的情形" class="headerlink" title="不适合使用云原生架构的情形"></a>不适合使用云原生架构的情形</h2><ol><li>不需要云计算的软件，例如嵌入到家电中的软件。</li><li>云原生提供的是最终一致性，但如果需要数据强一致性的话，云原生架构就不适用了。</li><li>用云原生架构重写软件时并没有提供新的价值</li></ol><h2 id="云原生的价值"><a href="#云原生的价值" class="headerlink" title="云原生的价值"></a>云原生的价值</h2><p>云原生的绝妙之处在于它最终是由许多不同组件组成的，即使其中一些组件的模式不是最新的，云原生组件也可以与他们进行交互。即使你的软件使用了旧的模式，应用云原生模式依然可以带来立竿见影的效果。</p><h1 id="云原生与持续交付"><a href="#云原生与持续交付" class="headerlink" title="云原生与持续交付"></a>云原生与持续交付</h1><h2 id="生产环境运维面临的困难"><a href="#生产环境运维面临的困难" class="headerlink" title="生产环境运维面临的困难"></a>生产环境运维面临的困难</h2><p><strong>1. 碎片化的变化</strong></p><ul><li>环境发生变化</li><li>部署的构件发生变化</li></ul><p><strong>2. 部署是有风险的</strong><br>部署通常充满危险。在升级期间需要停机或者部署时引起意外停机都是很正常的，而停机的代价是昂贵的。</p><p><strong>3. 传统运维认为变化是例外</strong><br>开发人员通常会在初次部署之后退出，然后由运维人员接管。运维团队手里只有一本运维手册。虽然运维手册详细描述了可能的失败场景及其解决方案，但是更加深入思考一下不难了解，手册设定了一个假设，就是失败场景是已知的。但是，绝大多数情况不是这样的！</p><p><strong>4. 生产环境的不稳定性</strong></p><h2 id="云原生架构运维的解决办法"><a href="#云原生架构运维的解决办法" class="headerlink" title="云原生架构运维的解决办法"></a>云原生架构运维的解决办法</h2><p><strong>目标</strong></p><ul><li>简单且可以频繁地在生产环境中进行发布。</li><li>运维具有稳定性和可预测性。</li></ul><h3 id="持续交付（Continuous-delivery，CD）"><a href="#持续交付（Continuous-delivery，CD）" class="headerlink" title="持续交付（Continuous delivery，CD）"></a>持续交付（Continuous delivery，CD）</h3><p><strong>1. 什么是持续交付</strong><br>持续交付的每个开发/测试流程都不会进行部署，但每个流程都会生成可以交付的软件。之后，是否部署就看商业决策了，而传统的软件交付则是在创建可以发布到生产环境中的构件之前，会提前进行大量的开发工作和一个长时间的测试流程</p><p><strong>2. 持续交付的优势</strong></p><ul><li>何时进行下一次软件发布依赖于商业决策，而不是由一个复杂、不可预测的软件开发过程决定的</li><li>有机会收集反馈，并用来改进产品的后续版本</li></ul><h3 id="可重复部署"><a href="#可重复部署" class="headerlink" title="可重复部署"></a>可重复部署</h3><p>部署可重复有助于系统部署和保证系统的稳定性，并且通过在每次开发/测试的迭代过程中控制变化风险，可以缩短整个新功能的交付时间。</p><p>达到部署可重复手段包括：</p><p><strong>1. 控制环境</strong></p><p>你必须从标准化的机器镜像开始。例如，从一个基础Ubuntu镜像开始，并且软件需要Java开发工具包（JDK），那么可以通过脚本将JDK安装到基础镜像中。此模式也经常被称为基础设施即代码（Infrastructure as Code）。当需要一个环境的新实例时，可以从基础镜像开始并执行脚本，这样就可以保证每次都拥有相同的环境。</p><p><strong>2. 控制可部署构建</strong><br>一旦你为软件开发生命周期的不同阶段构建了不同的构件，可重复性就可能受到影响。为了实现高效、安全和可重复的生产环境运维，不要把环境相关的配置包含到代码中。</p><p><strong>3. 控制流程</strong><br>将各个部分组合起来并确保一致性的唯一方法就是自动化。</p><h3 id="安全部署"><a href="#安全部署" class="headerlink" title="安全部署"></a>安全部署</h3><ol><li>并行部署和版本化的服务<br>安全部署的核心是并行部署。与用新版本完全替换一个正在运行的软件版本不同，你可以在部署新版本的同时让已有的版本继续运行。一开始，只有一小部分流量被路由到新的版本，然后你可以观察会发生什么。你可以根据各种条件来控制哪些流量被路由到新的版本，例如请求来自何处（例如，来自某个地理位置或者引用页）或者用户是谁。</li><li>进行必要的远程监控</li><li>灵活的路由</li></ol><ul><li>软件构件必须实现版本控制，并且版本必须对路由可见，以便恰当地切分流量</li><li>用于分析新版本工作情况的数据可以有多种形式</li><li>路由是并行部署的一个关键因素，而路由算法属于软件的一部分</li><li>创建更小的部署单元</li></ul><h3 id="变化是一定的"><a href="#变化是一定的" class="headerlink" title="变化是一定的"></a>变化是一定的</h3><p>在不断变化的情况下保持系统功能的完整性，是我们设计软件的最终目标，而变化对系统稳定性和可靠性的影响也是显而易见的。一个能够自我修复的系统，其正常运行的时间比每次出故障都需要人工干预的系统要长得多。将部署作为一种新的期望状态，可以极大地简化部署过程并降低风险。坚持“变化是一定的”的思维模式，可以从根本上改变在生产环境中管理软件的方式。</p><h1 id="云原生平台"><a href="#云原生平台" class="headerlink" title="云原生平台"></a>云原生平台</h1><h3 id="云原生平台的发展"><a href="#云原生平台的发展" class="headerlink" title="云原生平台的发展"></a>云原生平台的发展</h3><ul><li>AWS：软件架构、开发和运维并没有太多的改变。优势是成本降低，但故障率偏高，API中引入了AZ的概念，继而影响软件架构</li><li>GAE以及Azure：限制了用户代码直接对计算、存储、网络资源的访问，提供了安全性及弹性的保证</li><li>云原生平台：IaaS平台是一个提供访问基础设施（例如，主机、存储和网络）的接口，而云原生平台则是一个让应用程序成为开发人员或运维人员最主要的交互对象的接口</li></ul><h3 id="云原生平台的核心原则"><a href="#云原生平台的核心原则" class="headerlink" title="云原生平台的核心原则"></a>云原生平台的核心原则</h3><ul><li>使用比虚拟机更加轻量级的容器技术</li><li>支持不断变化<br>系统管理是通过不断监控系统的实际状态（不断变化的），将其与期望状态进行比较，并在必要时进行调整来实现预期的。</li><li>支持高度分布式<br>应用程序自己的环境中运行多个微服务，同时支持独立开发并降低级联失败的影响。它们的确能带来这些好处，但是随之产生的是一个由分布式组件组成的系统，而非原来单个组件或者单个进程的架构，因此要面临的复杂性也是之前不存在的（或者很少存在）。<br>支持分布式的平台需要提供如下功能：</li></ul><ol><li>服务发现：单独的服务运行在不同的容器和不同的主机上，为了让一个服务能够调用另一个服务，它必须首先能够找到另一个服务</li><li>服务配置</li><li>分布式跟踪机制，允许自动将跟踪器嵌入请求中，以诊断多个微服务调用之间的问题。</li><li>断路器，防止意外产生的内部DDoS攻击，例如，网络中断时可能产生的重试风暴。</li></ol><h1 id="事件驱动模式"><a href="#事件驱动模式" class="headerlink" title="事件驱动模式"></a>事件驱动模式</h1><p>顺序式的编程模型会促使你以请求/响应的方式进行思考。<br>如果请求只有在犹如树状的所有级联请求都成功的情况下才能成功，那么微服务的可用性会降低很多。</p><ul><li>“请求/响应”微服务：接收到请求时执行的代码，会直接决定向请求者提供某种响应。</li><li>事件驱动的微服务：代码执行的结果与触发它的事件没有直接关系。</li></ul><p>事件驱动的核心思想在于，因为事件导致代码被执行，然后可能会产生更多的事件。</p><p>对于请求/响应的方式，聚合发生在用户发出请求的时候。而对于事件驱动的方式，聚合发生在系统中数据发生变化的时候，并且这是异步的。</p><p>在请求/响应的微服务架构中，重试是补偿网络分区的一个关键模式。在事件驱动的系统中，事件存储是对网络不稳定性的一个关键补充</p><h3 id="命令查询责任分离（CQRS）模式"><a href="#命令查询责任分离（CQRS）模式" class="headerlink" title="命令查询责任分离（CQRS）模式"></a>命令查询责任分离（CQRS）模式</h3><p>将写逻辑（命令）与读逻辑（查询）分离开来。这就是命令查询责任分离（CQRS）模式的核心思想。CQRS的核心就是将这两个关注点分离开来。其优点在于，</p><ol><li>写少量的数据，读取时可以通过计算得到更多的数据</li><li>读取可以采用请求与响应模式，但更新数据可以采用事件驱动模式</li></ol><h1 id="水平伸缩与无状态"><a href="#水平伸缩与无状态" class="headerlink" title="水平伸缩与无状态"></a>水平伸缩与无状态</h1><h3 id="水平伸缩"><a href="#水平伸缩" class="headerlink" title="水平伸缩"></a>水平伸缩</h3><p>灵活的伸缩性并不是采用多个实例的唯一动机，高可用、可靠性和运维效率也同样是考虑因素，例如避免单点故障、在线升级等</p><h3 id="无状态"><a href="#无状态" class="headerlink" title="无状态"></a>无状态</h3><p>对于云原生应用，相同的输入应该产生相同的结果，无论有多少实例，也无论请求被路由到哪个实例。</p><p>云原生不能继续使用黏性会话来处理有状态的服务，因为黏性会话指定的实例可能已经消失，或者由于网络异常而无法访问</p><p>云原生应用程序有存在状态的地方，同样重要的是，也有不存在状态的地方。应用程序应该是无状态的，状态应该存在于数据服务中。</p><p><strong>无状态的优势</strong></p><ol><li>当你的应用程序处于无状态时，云原生应用程序平台可以在旧的实例丢失的时候，轻松创建新的实例</li><li>可以有效地管理一个应用程序的多个版本，所有这些版本都可以同时部署和运行</li></ol><h1 id="应用程序配置"><a href="#应用程序配置" class="headerlink" title="应用程序配置"></a>应用程序配置</h1><ul><li>创建合适的抽象，将应用程序的部署参数化，从而在正确的时间、以合理的方式将不同环境中的参数值注入应用程序</li><li>比环境变量更好的方法是在应用程序中使用一个特定的配置层，可以在这里查看某个应用程序的所有配置选项。</li><li>可以将环境变量映射到配置文件中</li><li>也可以利用应用程序框架将配置注入到配置文件中</li></ul><h3 id="使用配置层的优点"><a href="#使用配置层的优点" class="headerlink" title="使用配置层的优点"></a>使用配置层的优点</h3><ol><li>所有配置参数都定义在同一个地方，开发人员或者运维人员可以轻松地查看和理解应用程序的配置参数。</li><li>属性文件会被编译成一个单独的可部署构件，并且可以被实例化到任何环境中。</li></ol><h1 id="应用程序升级"><a href="#应用程序升级" class="headerlink" title="应用程序升级"></a>应用程序升级</h1><ul><li>蓝绿升级：建立另一组实例，所有这些实例都拥有新的配置，然后将所有流量从第一组实例切换到第二组实例。运行中的版本称为“蓝色”版本，希望部署的新版本称为“绿色”版本。</li><li>滚动升级：滚动部署应用程序的实例，用一组新实例替换一组旧实例的子集，然后继续下一个子集。</li></ul><ol><li><p>蓝/绿升级比滚动升级需要更多的资源。</p></li><li><p>如果你构建的应用程序可以同时运行多个版本，那么你可以让一些消费者仍然使用旧的版本，而让另一些消费者使用新的版本。我们称之为并行部署。</p></li><li><p>除了支持滚动升级，并行部署的另一个用途是支持灰度发布。</p></li><li><p>密码更新策略：服务端同时支持新旧密码以保证零停机更新</p></li></ol><h1 id="服务发现"><a href="#服务发现" class="headerlink" title="服务发现"></a>服务发现</h1><h3 id="服务"><a href="#服务" class="headerlink" title="服务"></a>服务</h3><ul><li>单个服务代表了多个应用程序实例。</li><li>在云原生软件中，应用程序被部署为多个实例。为了让软件可以正常运行，你会希望每一组实例都作为一个单独的逻辑实体来运行</li><li>软件被定义为多个服务的组合。每个服务都是由一组服务实例来实现的</li></ul><h3 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h3><p>服务如何与它们所代表的应用程序实例关联</p><ol><li><p>更新实例列表</p></li><li><p>负载均衡</p></li></ol><ul><li>禁止使用粘性会话</li><li>使用集中式的负载均衡器而不是分布式的</li></ul><p>集中式负载均衡器的优势：</p><ul><li>技术成熟</li><li>实现易于理解</li><li>配置容易</li><li>为避免单点故障应该部署多个实例</li></ul><p>客户端负载均衡是在客户端配置负载均衡器，这样http请求就会直接发送给服务的某个实例，减少了一次网络跳转，性能更好</p><h3 id="服务发现-1"><a href="#服务发现-1" class="headerlink" title="服务发现"></a>服务发现</h3><p>服务的客户端如何发现和找到服务</p><ol><li>Kubernetes集群会提供一个名为CoreDNS的DNS服务。</li><li>在启动时，Kubernetes会将服务的名称和地址添加到CoreDNS服务中。</li><li>在Kubernetes环境中运行的所有pod（应用程序），都会配置CoreDNS服务的地址。</li><li>任何访问DNS的操作，例如，对包含某个名称的URL发出HTTP请求，都需要访问CoreDNS服务来解析地址。</li></ol><h1 id="交互冗余"><a href="#交互冗余" class="headerlink" title="交互冗余"></a>交互冗余</h1><h3 id="重试"><a href="#重试" class="headerlink" title="重试"></a>重试</h3><p>应用程序向远程服务发出请求，如果在合理的时间内没有接收到响应，将再次尝试。</p><p>重试风暴：使用重试时，系统需要15分钟才能从3分钟的网络中断中恢复。如果不使用重试，则可以立即从3分钟的网络中断中恢复。</p><p>重试既会造成灾难性的影响，但是又有巨大的好处，尤其是在调用只是间歇性失败的情况下。</p><p>友好的客户端会：</p><ol><li>限制重试的次数</li><li>降低重试的频率</li></ol><p>安全的方法：一个安全的方法是指可以被调用零次或者多次，而且效果相同。该方法不应该有其他任何副作用。如GET、HEAD、OPTIONS和TRACE</p><p>幂等的方法：一个幂等的方法是指可以被调用一次或者多次，而且效果相同。它可以有副作用，但是所有重复调用的副作用必须与第一次相同。如，PUT</p><p>重试安全的方法，而不是重试幂等的方法</p><h3 id="回退逻辑"><a href="#回退逻辑" class="headerlink" title="回退逻辑"></a>回退逻辑</h3><p>面向失败设计最基本的模式之一，是实现回退的方法，即当主逻辑失败时执行的代码。</p><h3 id="控制循环"><a href="#控制循环" class="headerlink" title="控制循环"></a>控制循环</h3><p>控制循环永远不会期望达到完成的状态。它的目的就是不断地寻找不可避免的变化，并做出适当的响应。</p><h1 id="断路器和API网关"><a href="#断路器和API网关" class="headerlink" title="断路器和API网关"></a>断路器和API网关</h1><h3 id="断路器"><a href="#断路器" class="headerlink" title="断路器"></a>断路器</h3><p>如果服务开始出现故障但是次数不多，先停止该服务的所有流量一段时间，希望给它一段时间，让它能够从故障中恢复。过一段时间后，让单个请求通过，查看其运行情况。如果请求失败，则继续维持保护措施，不允许后续的流量通过。如果请求成功，看看则视为服务恢复正常，并允许流量通过。</p><p>断路器状态：打开、关闭、半开</p><h3 id="API网关-服务网格实现"><a href="#API网关-服务网格实现" class="headerlink" title="API网关 服务网格实现"></a>API网关 服务网格实现</h3><p>API网关始终位于实现的最前面，并且提供了大量的服务。这些服务可能包括以下内容。</p><ol><li>身份验证和授权</li><li>加密解密</li><li>限流</li><li>访问日志</li></ol><p>API网关模式的目标之一是将服务开发人员的关注问题与运维的关注问题分开。希望让后者能够统一控制正在运行的服务，并且为他们提供一个易于管理的控制平面。</p><h1 id="服务网格"><a href="#服务网格" class="headerlink" title="服务网格"></a>服务网格</h1><h3 id="挎斗Sidecar"><a href="#挎斗Sidecar" class="headerlink" title="挎斗Sidecar"></a>挎斗Sidecar</h3><p>简单来看，挎斗是一个与主服务一起运行的进程，或者是与主服务容器运行于同一个pod中的容器。</p><p>Kubernetes pod中运行的所有服务都可以托管在相同的IP地址上，这意味着它们可以通过localhost互相寻址，因此网络开销将变得很小。</p><h1 id="打破数据单体"><a href="#打破数据单体" class="headerlink" title="打破数据单体"></a>打破数据单体</h1><h3 id="微服务需要缓存"><a href="#微服务需要缓存" class="headerlink" title="微服务需要缓存"></a>微服务需要缓存</h3><ol><li>提升性能</li><li>当下游服务出现故障时，由于缓存的存在，请求也有可能成功</li></ol><h3 id="数据一致性"><a href="#数据一致性" class="headerlink" title="数据一致性"></a>数据一致性</h3><p>请求/响应模式 转变为 事件驱动的方式</p><p>问题在于事件通知机制失败时，缓存中的数据可能是损坏的，而且可能会无限期的保持下去。解决方法为：</p><p>使用异步的消息传递系统，而不是直接发送消息给需要的微服务</p><ol><li>事件载荷的规则1 一个被发布到事件日志中的事件，应该完整地进行描述。</li><li>事件载荷的规则2 对于事件日志来说没有标准的事件模型。生产者可以控制所传递事件的数据格式，而消费者应该适配该格式。</li><li>事件载荷的规则3 所有发布到事件日志的事件都必须有一个相关的结构（schema），供所有相关方访问，并且必须对该结构进行版本控制。</li></ol><p>事件消费者，规则1 尽可能让事件消费者的操作是幂等的。</p><p>Envoy在这些交互的边缘实现了许多模式，包括重试、断路器、限速、负载均衡、服务发现、可观察性等。</p><p>Istio的口号是“连接、安全、控制和观测服务”，支持自动注入挎斗并提供Envoy代理配置、证书处理和策略执行的组件。控制平面API提供了与此管理控制平面相关的接口。</p><h1 id="日志、监控与跟踪"><a href="#日志、监控与跟踪" class="headerlink" title="日志、监控与跟踪"></a>日志、监控与跟踪</h1><h3 id="应用程序日志"><a href="#应用程序日志" class="headerlink" title="应用程序日志"></a>应用程序日志</h3><p>3日志出现的位置应该完全由应用程序部署来控制，而不是由应用程序本身来决定。日志消息是出现在指定文件中还是出现在控制台中，或者出现在其他地方，都应该在部署时确定。</p><p>对云原生应用程序来说，该部署配置应该将日志行发送到stdout和stderr。这是因为：</p><ol><li>禁止将日志直接写入文件。本地文件系统与容器的生命周期是一致的。</li><li>stdout和stderr与供应商无关</li><li>stdout和stderr与操作系统无关</li><li>stdout和stderr是流式API，日志本身也是流。</li></ol><p>日志需要进行大规模提取和存储，并且接口必须支持对这些海量数据的搜索和分析。ELK技术栈（详情参见链接46）汇集了三个开源项目—Elasticsearch、Logstash和Kibana—来满足这些要求。</p><h3 id="应用程序监控"><a href="#应用程序监控" class="headerlink" title="应用程序监控"></a>应用程序监控</h3><p>在基于拉的方法中，度量指标聚合器会作为一个收集器，从每个应用程序实例中收集请求指标数据，并将这些指标存储在时序数据库中。问题在于，<br>有多个经过负载均衡的应用程序实例，你只能从其中一个实例获取指标，并且不知道具体是哪个实例。这。</p><p>基于推的模式，其中，每个应用实例负责按固定时间间隔将指标发给指标聚合器。一个挎斗代理不仅可以提供指标值，还可以代理应用程序发来的指标推送，因为即使应用程序没有安装代理（Agent），挎斗依然可以提供一定程度的可观察性。因为它代理了进出应用程序的流量，所以可以代替应用程序来生成许多指标</p><h3 id="应用程序跟踪"><a href="#应用程序跟踪" class="headerlink" title="应用程序跟踪"></a>应用程序跟踪</h3><p>分布式跟踪解决的是如何跨多个分布式组件来跟踪程序流的问题。</p><p>Zipkin是当今使用的一种流行技术，核心包括以下几方面内容：</p><ul><li>使用跟踪器（tracer）在请求和响应中插入唯一标识符，以便找到相关的应用程序调用。</li><li>一个控制平面（control plane）使用这些跟踪器将一组调用组装成调用图（或者是特意设计的独立调用）。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 云计算 </tag>
            
            <tag> 云原生 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript中的异步编程</title>
      <link href="/2020/01/15/Javascript%E4%B8%AD%E7%9A%84%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/"/>
      <url>/2020/01/15/Javascript%E4%B8%AD%E7%9A%84%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>Javascript最开始是用于浏览器中的前端编程语言。Javascript是单线程的，为了能及时响应用户操作，javascript对耗时操作（如Ajax请求、本地文件读取等)的处理是异步进行的，也即是所谓的异步编程。除了快速响应用户操作之外，另外一个让javascript采用异步方式的原因是，程序无法预知用户会进行哪些操作。比如说程序无法提前知道用户是点“取消”按钮还是“确定”按钮。所以，Javascript采用了事件注册的方式来处理这个问题。在程序编写时，可以给用户点击“取消”按钮和“确认”按钮注册不同的回调函数，这样当用户点击不同的按钮时，不同的回调函数会被执行。本文从回调函数开始，介绍了Promise、async/await几种Javascript主要的异步编程方式。</p><span id="more"></span><h1 id="异步编程和回调函数"><a href="#异步编程和回调函数" class="headerlink" title="异步编程和回调函数"></a>异步编程和回调函数</h1><p>无论是Ajax请求，还是事件处理，Javascript都是通过回调函数来完成的。谈及异步编程和回调函数，可以回想一下操作系统中的中断及中断处理程序。由于CPU的速度比外设快出许多，为了提高CPU的处理效率，计算机系统引入了中断的概念，外设在读写数据的时候，CPU可以忙别的事情，等到外设读写完数据后，会给CPU发一个中断信号，CPU就可以来执行已经注册好的、相应的中断处理程序。Javascript中的回调函数和中断处理程序都是类似的原理。</p><p>先来看一个异步的例子：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;Start...&quot;</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;in progress&quot;</span>);</span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;End...&quot;</span>);</span><br></pre></td></tr></table></figure><p>如果是同步的话，输出的顺序应该是：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Start...</span><br><span class="line"><span class="keyword">in</span> progress</span><br><span class="line">End...</span><br></pre></td></tr></table></figure><p>然而真实的输出结果却是这样的：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Start...</span><br><span class="line">End...</span><br><span class="line"><span class="keyword">in</span> progress</span><br></pre></td></tr></table></figure><p>原因在于setTimeout中的第一个参数，箭头函数(即上文所说的回调函数)是异步执行的。setTimeout相当于注册一个回调函数，该回调函数在2000毫秒(2秒)之后运行。由于是异步的，主程序并不会等到两秒之后才跑setTimeout后面的代码，而是立即执行，所以先输出了<code>End...</code>，2秒之后，注册的回调函数运行了，输出了<code>in progress</code>。</p><p>举一反三，Ajax请求、事件处理都是类似的。比如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">  <span class="attr">url</span>: url,</span><br><span class="line">  <span class="attr">data</span>: data,</span><br><span class="line">  <span class="attr">success</span>: <span class="function">()=&gt;</span>&#123;&#125;,</span><br><span class="line">  <span class="attr">dataType</span>: dataType</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$(<span class="string">&#x27;#mydiv&#x27;</span>).on(<span class="string">&#x27;click&#x27;</span>, <span class="function">()=&gt;</span>&#123;&#125;)</span><br></pre></td></tr></table></figure><p>其中的两个箭头函数就是回调函数。</p><p>当后面的异步操作依赖于前面异步操作的结果时，就需要在回调函数中嵌套回调函数，例如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;Start...&quot;</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;A&#x27;</span>);</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;AB&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;End...&quot;</span>);</span><br></pre></td></tr></table></figure><p>嵌套回调可以保证 <code>AB</code>一定在<code>A</code>之后输出。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Start...</span><br><span class="line">End...</span><br><span class="line">A</span><br><span class="line">AB</span><br></pre></td></tr></table></figure><p>回调函数是Javascript异步编程最基本的编写方式，但是容易遇到回调地狱的问题。所谓回调地狱，其实就是回调嵌套的太多，导致了代码难以阅读和编写。这是<a href="http://callbackhell.com/">http://callbackhell.com/</a> 给出的一个例子：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">fs.readdir(source, <span class="function"><span class="keyword">function</span> (<span class="params">err, files</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Error finding files: &#x27;</span> + err)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    files.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">filename, fileIndex</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(filename)</span><br><span class="line">      gm(source + filename).size(<span class="function"><span class="keyword">function</span> (<span class="params">err, values</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">&#x27;Error identifying file size: &#x27;</span> + err)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(filename + <span class="string">&#x27; : &#x27;</span> + values)</span><br><span class="line">          aspect = (values.width / values.height)</span><br><span class="line">          widths.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">width, widthIndex</span>) </span>&#123;</span><br><span class="line">            height = <span class="built_in">Math</span>.round(width / aspect)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;resizing &#x27;</span> + filename + <span class="string">&#x27;to &#x27;</span> + height + <span class="string">&#x27;x&#x27;</span> + height)</span><br><span class="line">            <span class="built_in">this</span>.resize(width, height).write(dest + <span class="string">&#x27;w&#x27;</span> + width + <span class="string">&#x27;_&#x27;</span> + filename, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">              <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(<span class="string">&#x27;Error writing file: &#x27;</span> + err)</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;.bind(<span class="built_in">this</span>))</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h1><p>为了解决回调地狱的问题，Promise被囊括到ES6中。Promise解决回调地狱问题的核心思想是：</p><ol><li>将异步操作的定义和对结果的处理分开来写</li><li>对结果的处理可以串联</li></ol><p>有点抽象，我们来看一个具体的例子。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;Start...&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> waitOneSecond = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data = <span class="number">1</span>;</span><br><span class="line">    resolve(data);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">let</span> waitTenSeconds = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data = <span class="number">10</span>;</span><br><span class="line">    resolve(data);</span><br><span class="line">  &#125;, <span class="number">10000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;Async operation registered...&quot;</span>);</span><br><span class="line"></span><br><span class="line">waitOneSecond</span><br><span class="line">  .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`first output: <span class="subst">$&#123;data&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span> waitTenSeconds;</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`second output: <span class="subst">$&#123;data&#125;</span>`</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;End...&quot;</span>);</span><br></pre></td></tr></table></figure><p>输出如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Start...</span><br><span class="line">Async operation registered...</span><br><span class="line">End...</span><br><span class="line">first output: <span class="number">1</span></span><br><span class="line">second output: <span class="number">10</span></span><br></pre></td></tr></table></figure><p>上面的代码首先定义了两个异步操作：waitOneSecond和waitTenSeconds。分别是等待1秒和10秒和把1和10传给处理函数去处理。直到<code>console.log(&quot;Async operation registered...&quot;);</code>语句，两个异步操作都还没有开始。当执行到waitOneSecond.then时，异步操作才开始进行，主程序继续执行，输出了<code>End...</code>，1秒之后第一个then中注册的处理函数开始执行，输出了数字1，然后第二个异步操作waitTenSenconds.then开始执行，10秒后处理函数输出了数字10.</p><p>由此可以看到，两个异步操作的处理同样是先后执行，类似于上文例子中先打印<code>A</code>，后打印<code>AB</code>，引入Promise后就避免了嵌套回调，两个then函数调用串联起来，从而也就解决了回调地狱的问题。需要注意的是，要想将两个Promise串联起来的前提是，第一个Promise的处理函数必须返回一个Promise，如例子中的<code>return waitTenSeconds;</code></p><p>除了解决回调地狱的问题，将异步操作定义和结果处理分开之后，我们可以更加灵活地处理多个异步操作。比如说，</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise1 = <span class="built_in">Promise</span>.resolve(<span class="number">3</span>);</span><br><span class="line"><span class="keyword">const</span> promise2 = <span class="number">42</span>;</span><br><span class="line"><span class="keyword">const</span> promise3 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(resolve, <span class="number">100</span>, <span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.all([promise1, promise2, promise3]).then(<span class="function"><span class="keyword">function</span>(<span class="params">values</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(values);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// expected output: Array [3, 42, &quot;foo&quot;]</span></span><br></pre></td></tr></table></figure><p>promise1, promise2, promise3将会一起执行，如果都成功，我们可以在then函数中对所有的结果一起进行处理。</p><p>再例如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(resolve, <span class="number">500</span>, <span class="string">&#x27;one&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> promise2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(resolve, <span class="number">100</span>, <span class="string">&#x27;two&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.any([promise1, promise2]).then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value);</span><br><span class="line">  <span class="comment">// Both resolve, but promise2 is faster</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// expected output: &quot;two&quot;</span></span><br></pre></td></tr></table></figure><p>如果promise1和promise2有一个已经完成(无论成功或者失败)，就只处理这个已经完成的异步操作。</p><h1 id="async-await"><a href="#async-await" class="headerlink" title="async/await"></a>async/await</h1><p>ES6引入了迭代器和生成器，yield可以让程序暂停，而迭代器中的next()又可以程序恢复运行，利用这一点，Javascript便可以让主程序等待异步操作的完成。这对于习惯其他不使用异步编程语言(例如C语言)的同学来说就非常亲切了。而async/await正是利用迭代器和生成器编写异步函数的语法糖。例如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> waitTenSeconds = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data = <span class="number">10</span>;</span><br><span class="line">    resolve(data);</span><br><span class="line">  &#125;, <span class="number">10000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncFunc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;Start...&quot;</span>);</span><br><span class="line">  <span class="keyword">await</span> waitTenSeconds.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;End...&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">asyncFunc();</span><br></pre></td></tr></table></figure><p>如果asyncFunc不是async/await函数的话，输出结果应该是:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Start...</span><br><span class="line">End...</span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure><p>因为asyncFunc是异步操作，主程序会先打印<code>End...</code>，10秒之后才会打印<code>10</code>。而把asyncFunc改造为异步函数(即加了async关键字)之后，await关键字会让主程序等待waitTenSeconds异步操作执行完成之后才继续运行，所以输出结果是：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Start...</span><br><span class="line"><span class="number">10</span></span><br><span class="line">End...</span><br></pre></td></tr></table></figure><p>所以，async函数的写法其实更像是同步函数。值得注意的是，这样的写法虽然更加直观明了，但Javascript的性能主要是靠异步操作来提升的，如果没有必要，是不建议使用await来等待的。</p><p>async/await语法如下：</p><ul><li>需要在要异步函数前加上关键字async</li><li>await只能用于async函数中</li><li>async函数总是返回一个Promise</li></ul><h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>随着Javascript语言的发展，异步编程的写法越来越简单明了，越来越灵活多样，但无论怎么变化，回调函数是Javascript实现异步操作最基本的语法，类似于中断机制的异步原理始终未变。无论技术如何发展，如何变化，但万变不离其宗，基本原理始终未变。</p>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> promise </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sass 概要</title>
      <link href="/2019/06/18/Sass%E6%A6%82%E8%A6%81/"/>
      <url>/2019/06/18/Sass%E6%A6%82%E8%A6%81/</url>
      
        <content type="html"><![CDATA[<p>前端开发中最大的坑之一莫过于写css，流水账式的写法让众多码农们头痛不已。好在有了sass，写css不再死板。sass对css的增强如下：</p><h3 id="宏定义"><a href="#宏定义" class="headerlink" title="宏定义"></a>宏定义</h3><p>宏定义的优点在于一处定义，多处使用，需要修改的时候只需要修改定义的地方即可。虽然sass没有明确的说明，但其实以下几种语法与C语言中的宏定义非常类似：</p><ol><li>变量 sass中的变量适用于替换css中参数的值。例如： scss: $basic-margin: “10px 20px”; #box01 {<br>   margin: $basic-margin;<br> } #box02 {<br>   margin: $basic-margin;<br> } css: #box01 {<br>   margin: “10px 20px”;<br> } #box02 {<br>   margin: “10px 20px”;<br> } sass允许根据变量，选择性的输出css，类似于开关，例如： scss: $rounded-corners: false; .button {<br>   border: 1px solid black;<br>   border-radius: if($rounded-corners, 5px, null);<br> } css: .button {<br>   border: 1px solid black;<br> } sass 也允许在子模块中给变量设置默认值，引用的时候可以再重新定义变量的值 _module.scss: $userColor: red !default; .bass {<br>   padding: 0 20px;<br>   color: $userColor;<br> } test.scss: $userColor: black;<br> @import “module”; test.css: .bass {<br>   padding: 0 20px;<br>   color: black;<br> } test.scss: @import “module”; test.css<br> .bass {<br>   padding: 0 20px;<br>   color: red;<br> } 使用!global可以在局部环境中设置全局变量的值，例如：  test.scss: $color: red; .text {<br>   $color: black !global;<br> } .box {<br>   color: $color;<br> } test.css: .box {<br>   color: black;<br> }</li><li>mixin sass中的mixin类似于支持参数的代码片段，可以很方便的将一段常用的代码片段插入到css规则中去，例如： scss: @mixin normal-font($fontfamily) {<br>   font-size: 18px;<br>   font-family: $fontfamily;<br> } .box {<br>   width: 200px;<br>   height: 200px;<br>   @include normal-font(“IBM Plex Sans”);<br> } css: .box {<br>   width: 200px;<br>   height: 200px;<br>   font-size: 18px;<br>   font-family: “IBM Plex Sans”;<br> }</li><li>扩展与继承 sass中的扩展相当于不带参数的代码片段，适用于同一组件的不同状态，语法如下： scss: %message-shared {<br>   border: 1px solid #ccc;<br>   padding: 10px;<br>   color: #333;<br> } .message {<br>   @extend %message-shared;<br> } .success {<br>   @extend %message-shared;<br>   border-color: green;<br> } .error {<br>   @extend %message-shared;<br>   border-color: red;<br> } .warning {<br>   @extend %message-shared;<br>   border-color: yellow;<br> } css: .warning, .error, .success, .message {<br>   border: 1px solid #ccc;<br>   padding: 10px;<br>   color: #333;<br> } .success {<br>   border-color: green;<br> } .error {<br>   border-color: red;<br> } .warning {<br>   border-color: yellow;<br> }  </li></ol><h3 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h3><p>sass也借鉴了编程语言中的模块化思想，允许文件引入。以下划线开头的文件类似于子模块，不会被被sass编译为css，只能被其他scss文件引用。例如：</p><p> _module.scss:</p><p>.bass {<br>  padding: 0 20px;<br>}</p><p>test.scss:</p><p>@import “module”;</p><p>$basic-margin: “10px 20px”;</p><p>#box01 {<br>  margin: $basic-margin;<br>}</p><p>#box02 {<br>  margin: $basic-margin;<br>}</p><p>test.css:</p><p>.bass {<br>  padding: 0 20px;<br>}</p><p>#box01 {<br>  margin: “10px 20px”;<br>}</p><p>#box02 {<br>  margin: “10px 20px”;<br>}</p><h3 id="语法简化"><a href="#语法简化" class="headerlink" title="语法简化"></a>语法简化</h3><p>scss也对css的语法做了一些简化，比如说：</p><ol><li>嵌套 写scss子元素的规则不再另起一条规则，只需要嵌套在父元素中的规则中即可，例如：  scss: $basic-margin: “10px 20px”; .bss {<br>   margin: $basic-margin;<br>   #dash {<pre><code> margin-top: 20px; padding-top: 20px;</code></pre>   }<br>   .dash {<pre><code> margin-top: 20px; margin-bottom: 20px;</code></pre>   }<br> } css: .bss {<br>   margin: “10px 20px”;<br> }<br> .bss #dash {<br>   margin-top: 20px;<br>   padding-top: 20px;<br> }<br> .bss .dash {<br>   margin-top: 20px;<br>   margin-bottom: 20px;<br> } 另一种方式的嵌套：  scss： .box {<br>   margin: {<pre><code> top: 20px; bottom: 10px; right: 10px; left: 20px;</code></pre>   }<br> } css: .box {<br>   margin-top: 20px;<br>   margin-bottom: 10px;<br>   margin-right: 10px;<br>   margin-left: 20px;<br> }</li></ol><h3 id="可编程化"><a href="#可编程化" class="headerlink" title="可编程化"></a>可编程化</h3><p>sass也做了一些工作让css更像一门编程语言而不是一遍作文。其中包括：</p><ol><li>支持运算 css是不支持运算的，而在scss中可以做一些简单的运算，例如：  scss: .box {<br>   width: 100px / 200px * 100%;<br> } css: .box {<br>   width: 50%;<br> }</li><li>数值类型 scss中的值分为以下几种类型：<ul><li>  数字，例如： 20, 20px</li><li>  字符串，例如：”IBM Plex Sans”, bold</li><li>  颜色值，例如：#ffffff, blue</li><li>  布尔值, true, false</li><li>  列表，例如：0 20px 30px 40px</li><li>  字典，例如：(“background”: red, “foreground”: pink)</li></ul></li><li>操作符 scss中的操作符包括：<ul><li>  == , !=  : 判断两个值是否相等/不相等</li><li>  + - * / %</li><li>  &lt; &lt;= &gt; &gt;=</li><li>  and or not</li><li>  + - / 可用于字符串拼接</li><li>  () 用于优先级设定</li><li>  &amp;父元素选择器</li><li>  #{} 可以将sass表达式插入到css的文本中</li></ul></li><li>代码注释<ul><li>  // 单行注释，不会编译到css中</li><li>  /**/多行注释，一般会被编译进css</li><li>  压缩模式下，多行注释不会被编译进css，除非以/*!开头</li><li>  ///为文档注释，不会被编译到css中，会被sassdoc工具使用，生成sass的文档</li></ul></li><li>函数 scss中的函数主要用于数值计算，例如： scss: @function pow($base, $exponent) {<br>   $result: 1;<br>   @for $_ from 1 through $exponent {<pre><code> $result: $result * $base;</code></pre>   }<br>   @return $result;<br> } .sidebar {<br>   float: left;<br>   margin-left: pow(4, 3) * 1px;<br> } css: .sidebar {<br>   float: left;<br>   margin-left: 64px;<br> } Sass中的内建函数详见 <a href="https://sass-lang.com/documentation/functions">https://sass-lang.com/documentation/functions</a></li><li> 流程控制<ul><li>分支 @if , @else, @else if 例如：  scss:  @mixin triangle($color, $size, $direction) {<pre><code>display: block;height: 0;width: 0;border: $size/2 solid transparent;@if $direction == up &#123;  border-bottom-color: $color;&#125; @else if $direction == down &#123;  border-top-color: $color;&#125; @else if $direction == left &#123;  border-right-color: $color;&#125; @else if $direction == right &#123;  border-left-color: $color;&#125; @else &#123;  @error &quot;wrong direction: #&#123;$direction&#125;&quot;;&#125;</code></pre>  }  .next {<pre><code>@include triangle(green, 20px, right);</code></pre>  }  css:  .next {<pre><code>display: block;height: 0;width: 0;border: 10px solid transparent;border-left-color: green;</code></pre>  }</li><li>循环 @each @for @while 例如：   scss:  $sizes: 40px, 50px, 80px;  @each $size in $sizes {<pre><code>.icon-#&#123;$size&#125; &#123;  font-size: $size;  height: $size;  width: $size;&#125;</code></pre>  }  css:  .icon-40px {<pre><code>font-size: 40px;height: 40px;width: 40px;</code></pre>  }  .icon-50px {<pre><code>font-size: 50px;height: 50px;width: 50px;</code></pre>  }  .icon-80px {<pre><code>font-size: 80px;height: 80px;width: 80px;</code></pre>  }   scss:<br>  $base-color: #036;  @for $i from 1 through 3 {<pre><code>ul:nth-child(3n + #&#123;$i&#125;) &#123;  background-color: lighten($base-color, $i * 5%);&#125;</code></pre>  }  css:  ul:nth-child(3n + 1) {<pre><code>background-color: #004080;</code></pre>  }  ul:nth-child(3n + 2) {<pre><code>background-color: #004d99;</code></pre>  }  ul:nth-child(3n + 3) {<pre><code>background-color: #0059b3;</code></pre>  }   scss:<br>  @function scale-below($value, $base, $ratio: 1.618) {<pre><code>@while $value &gt; $base &#123;  $value: $value / $ratio;&#125;@return $value;</code></pre>  }  $normal-font-size: 16px;<br>  sup {<pre><code>font-size: scale-below(20px, 16px);</code></pre>  }  css:<br>  sup {<pre><code>font-size: 12.36094px;</code></pre>  }</li></ul></li><li>数值类型 sass中的数值类型包括以下几种：数值，字符串，颜色，List, Map，布尔值，null及函数<ul><li>数值包含数字和单位，sass的强大之处在于支持带单位的运算，例如：  @debug 1in + 6px; // 102px or 1.0625in</li><li>list和map的用法举例：  $prefixes-by-browser: (“firefox”: moz, “safari”: webkit, “ie”: ms);  @function prefixes-for-browsers($browsers) {<pre><code>$prefixes: ();@each $browser in $browsers &#123;  $prefixes: append($prefixes, map-get($prefixes-by-browser, $browser));&#125;@return $prefixes;</code></pre>  }  @debug prefixes-for-browsers(“firefox” “ie”); // moz ms</li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> 应用开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css </tag>
            
            <tag> sass </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>获取隐藏元素的宽度</title>
      <link href="/2019/01/11/%E8%8E%B7%E5%8F%96%E9%9A%90%E8%97%8F%E5%85%83%E7%B4%A0%E7%9A%84%E5%AE%BD%E5%BA%A6/"/>
      <url>/2019/01/11/%E8%8E%B7%E5%8F%96%E9%9A%90%E8%97%8F%E5%85%83%E7%B4%A0%E7%9A%84%E5%AE%BD%E5%BA%A6/</url>
      
        <content type="html"><![CDATA[<h4 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h4><p>如果DOM元素的fu’yu是被隐藏的(display: none)，那么无论使用DOM的接口，还是jquery的接口来获取该元素的宽度，得到的结果始终是0. 例如：</p><pre><code>&lt;div id=&quot;node&quot;&gt;&lt;p&gt;    hello world&lt;/p&gt;&lt;/div&gt;#node &#123;    display: none;&#125;alert($(&#39;#node p&#39;).width());</code></pre><h4 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h4><p>在过去元素的宽度之前，临时修改元素的display为block，获取之后再讲其设置回none 例如：</p><pre><code>function get_width(obj) &#123;var width = 0;  obj.parent().css(&#39;display&#39;, &#39;block&#39;);width = obj.width();obj.parent().css(&#39;display&#39;, &#39;none&#39;);return width;&#125;alert(get_width($(&#39;#node p&#39;)));</code></pre><h4 id="给jquery添加一个函数"><a href="#给jquery添加一个函数" class="headerlink" title="给jquery添加一个函数"></a>给jquery添加一个函数</h4><p>参考<a href="https://stackoverflow.com/questions/1472303/jquery-get-width-of-element-when-not-visible-display-none">StackOverflow</a> ,Tim Banks给jquery添加了一个函数，用来获取隐藏元素的宽度和高度信息。</p><pre><code>(function ($) &#123;$.fn.getHiddenDimensions = function (include_margin) &#123;    var $item = this,    props = &#123; position: &#39;absolute&#39;, visibility: &#39;hidden&#39;, display: &#39;block&#39; &#125;,    dim = &#123; width: 0, height: 0, innerWidth: 0, innerHeight: 0, outerWidth: 0, outerHeight: 0 &#125;,    $hiddenParents = $item.parents().addBack().not(&#39;:visible&#39;),    includeMargin = (include\_margin == null) ? false : include\_margin;    var oldProps = \[\];    $hiddenParents.each(function () &#123;        var old = &#123;&#125;;        for (var name in props) &#123;            old\[name\] = this.style\[name\];            this.style\[name\] = props\[name\];        &#125;        oldProps.push(old);    &#125;);    dim.width = $item.width();    dim.outerWidth = $item.outerWidth(includeMargin);    dim.innerWidth = $item.innerWidth();    dim.height = $item.height();    dim.innerHeight = $item.innerHeight();    dim.outerHeight = $item.outerHeight(includeMargin);    $hiddenParents.each(function (i) &#123;        var old = oldProps\[i\];        for (var name in props) &#123;            this.style\[name\] = old\[name\];        &#125;    &#125;);    return dim;&#125;&#125;($));alert($(&#39;#node p&#39;).getHiddenDimensions().width);</code></pre><p>在jsFiddle上试一试 <a href="https://jsfiddle.net/sen_wang/za7L1e8g/">-&gt;</a></p>]]></content>
      
      
      <categories>
          
          <category> 应用开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ES6: 模块编程</title>
      <link href="/2019/01/08/ES6%E6%A8%A1%E5%9D%97%E7%BC%96%E7%A8%8B/"/>
      <url>/2019/01/08/ES6%E6%A8%A1%E5%9D%97%E7%BC%96%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h4 id="Javascript模块的限制"><a href="#Javascript模块的限制" class="headerlink" title="Javascript模块的限制"></a>Javascript模块的限制</h4><ul><li>  只能运行于严格模式</li><li>  模块中的顶级作用域中的变量，不会被自动添加到全局作用域</li><li>  顶级作用域的this为undefined</li></ul><h4 id="导出"><a href="#导出" class="headerlink" title="导出"></a>导出</h4><p>如果想让模块中的变量、函数、类被其他模块使用，需要将其导出，导出的方法如下：</p><ul><li>  export var color = “red”;</li><li>  export function print_hello(){};</li><li>  export { print_hello }</li><li>  export { print_hello as printh };</li><li>  export default function print_hello(){};</li><li>  export default print_hello</li><li>  export { print_hello as default}</li></ul><h4 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h4><p>如果想使用其他模块中的变量、函数、类，需要将其导入。导入后的变量、类、函数为只读。导入的方法如下：</p><ul><li>  import { color, print_hello } from “./example.js”;</li><li>  import * as example from “./example.js”;  //example.color, example.print_hello</li><li>  import { print_hello as printh } from “./example.js”;</li><li>  import print_hello, { color } from “./example.js”; // print_hello 为默认导出的函数</li><li>  import { default as printh } from “./example.js”;</li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> es6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ES6：数组</title>
      <link href="/2019/01/03/ES6%E6%95%B0%E7%BB%84/"/>
      <url>/2019/01/03/ES6%E6%95%B0%E7%BB%84/</url>
      
        <content type="html"><![CDATA[<h4 id="新增的静态方法"><a href="#新增的静态方法" class="headerlink" title="新增的静态方法"></a>新增的静态方法</h4><p>Array.of() ：可以将传入的参数逐个传入数组，即使只有一个数值类型的参数，也会成为新数组的成员，而不是代表数组的长度 Array.from()：可以将类数组结构转化为数组，例如: Array.from(arguments). 利用Array.from()也可以转换原来的数组，例如：</p><pre><code>let trans_args = function() &#123;    let args = Array.from(arguments, (value)=&gt;value + 1);    console.log(args);&#125;trans_args(1, 2, 3);$ node test.js [ 2, 3, 4 ]</code></pre><h4 id="新增的普通方法"><a href="#新增的普通方法" class="headerlink" title="新增的普通方法"></a>新增的普通方法</h4><p>find() 与findIndex()：传入一个回调函数来表明查找的条件，例如：</p><pre><code>&gt; let arr = [1, 2, 3, 4, 5];undefined&gt; arr.find((n)=&gt;n&gt;3);4&gt; arr.findIndex((n)=&gt;n&gt;3);3</code></pre><p>fill(value, start, end)：填充value到数组的start到end位置，不包括end. 例如：</p><pre><code>let arr = [1, 2, 3, 4, 5];arr.fill(1, 1, 4);[ 1, 1, 1, 1, 5 ]</code></pre><p>copyWithin(toIndex, fromIndex, stopIndex): 从fromIndex开始复制元素到toIndex，遇到stopIndex停止，例如：</p><pre><code>&gt; let arr = [1, 2, 3, 4, 5]undefined&gt; arr.copyWithin(2, 0, 1);[ 1, 2, 1, 4, 5 ]</code></pre><h4 id="类型化数组"><a href="#类型化数组" class="headerlink" title="类型化数组"></a>类型化数组</h4><p>javascript中的数组缓冲区类似于c的malloc，例如，可以用如下方法分配一个10个字节大小的内存区域：</p><pre><code>&gt; let bu = new ArrayBuffer(10);undefined&gt; bu.byteLength10</code></pre><p>可以使用slice(start, end)方法来对分配的内存进行切片。 要操作新分配的内存，需要使用DataView(buf, index, length)创建一个视图，例如：</p><pre><code>&gt; let buf = new ArrayBuffer(50);&gt; let view = new DataView(buf, 0, 50);</code></pre><p>获取视图的信息：</p><pre><code>&gt; view.buffer === buf;true&gt; view.byteOffset0&gt; view.byteLength50</code></pre><p>读写数据：</p><pre><code>&gt; view.setUint8(4, 233);undefined&gt; view.getUint8(4)233</code></pre>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> es6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ES6中的类</title>
      <link href="/2019/01/02/ES6%E4%B8%AD%E7%9A%84%E7%B1%BB/"/>
      <url>/2019/01/02/ES6%E4%B8%AD%E7%9A%84%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<p>ES6中添加的class关键字其实并非真正的类，而是ES5用函数来模拟类的语法糖。在ES6中可以用如下的语法创建一个类：</p><pre><code>class Students &#123;    constructor(name, age) &#123;        this.name = name;        this.age = age;    &#125;    sayName() &#123;        console.log(this.name);    &#125;    sayAge() &#123;        console.log(this.age);    &#125;&#125;let st1 = new Students(&#39;sen&#39;, 18);st1.sayName();st1.sayAge();</code></pre><p>使用ES6的class语法糖和ES5自定义的类还是有些区别的：</p><ul><li>  类的声明不会被提升，类的实例化只能在类的声明之后</li><li>  类声明中的代码只能运行在严格模式下</li><li>  类中的方法是不可枚举的</li><li>  实例化的时候必须加new关键字</li><li>  在方法内部修改类名会抛出错误，但可以在外部修改类名</li></ul><p>下面的例子展示了如何在外部修改类名：</p><pre><code>class Students &#123;    constructor(name, age) &#123;        this.name = name;        this.age = age;    &#125;    sayName() &#123;        console.log(this.name);    &#125;    sayAge() &#123;        console.log(this.age);    &#125;&#125;let st1 = new Students(&#39;sen&#39;, 18);st1.sayName();st1.sayAge();let Stu = Students;let st2 = new Stu(&#39;sen&#39;, 18);st2.sayName();st2.sayAge();console.log(st1 instanceof Students); //trueconsole.log(st2 instanceof Students); //trueconsole.log(st2 instanceof Stu); //trueconsole.log(st1 instanceof Stu); //true</code></pre><h4 id="类中的访问器属性"><a href="#类中的访问器属性" class="headerlink" title="类中的访问器属性"></a>类中的访问器属性</h4><p>可以使用get和set关键字来定义访问器属性，例如：</p><pre><code>class Students &#123;    constructor(name) &#123;        this.name = name;    &#125;    get n() &#123;        return this.name;    &#125;    set n(value) &#123;        this.name = value;    &#125;&#125;let st1 = new Students(&#39;sen&#39;, 18);console.log(st1.n);st1.n = &#39;wang&#39;;console.log(st1.n);</code></pre><h4 id="需计算的属性名"><a href="#需计算的属性名" class="headerlink" title="需计算的属性名"></a>需计算的属性名</h4><p>和其他需计算的名字一样，都是加上方括号，例如：</p><p>let propName = “sayName”;</p><pre><code>class Students &#123;    constructor(name) &#123;        this.name = name;    &#125;    [propName]() &#123;        console.log(this.name);    &#125;&#125;let st1 = new Students(&#39;sen&#39;);st1.sayName();</code></pre><h4 id="给类添加默认的生成器"><a href="#给类添加默认的生成器" class="headerlink" title="给类添加默认的生成器"></a>给类添加默认的生成器</h4><p>可以利用Symbol来给类添加默认的生成器，如：</p><pre><code>class Collection &#123;    constructor() &#123;        this.items = [];    &#125;    *[Symbol.iterator]() &#123;        yield *this.items.values();    &#125;&#125;let col = new Collection();col.items.push(1);col.items.push(2);col.items.push(3);for( let i of col) &#123;    console.log(i);&#125;</code></pre><h4 id="给类添加静态属性-方法"><a href="#给类添加静态属性-方法" class="headerlink" title="给类添加静态属性/方法"></a>给类添加静态属性/方法</h4><p>类的静态方法/属性只能通过类名来访问，而不能通过类的实例来访问，具体做法是在方法/属性定义前面加上static关键字，例如：</p><pre><code>class Students &#123;    constructor(name) &#123;        this.name = name;    &#125;    static sayClassName() &#123;        console.log(&quot;Collection&quot;);    &#125;&#125;Students.sayClassName();let stu = new Students(&#39;sen&#39;);stu.sayClassName(); // error</code></pre><h4 id="类的继承"><a href="#类的继承" class="headerlink" title="类的继承"></a>类的继承</h4><p>ES6引入了extends和super来实现类的继承，例如：</p><pre><code>class Rectangle &#123;    constructor(length, width) &#123;        this.length = length;        this.width = width;    &#125;    getArea() &#123;        return this.length * this.width;    &#125;&#125;class Square extends Rectangle &#123;    constructor(length) &#123;        super(length, length);    &#125;&#125;let sq = new Square(5);console.log(sq.getArea());</code></pre><p>使用super需要注意：</p><ul><li>  super只能用在派生类中</li><li>  在constructor里，super负责初始化this，所以必须在this使用之前调用</li></ul>]]></content>
      
      
      <categories>
          
          <category> 应用开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> es6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ES6: 迭代器与生成器</title>
      <link href="/2018/12/07/ES6%E8%BF%AD%E4%BB%A3%E5%99%A8%E4%B8%8E%E7%94%9F%E6%88%90%E5%99%A8/"/>
      <url>/2018/12/07/ES6%E8%BF%AD%E4%BB%A3%E5%99%A8%E4%B8%8E%E7%94%9F%E6%88%90%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h4 id="什么是迭代器？"><a href="#什么是迭代器？" class="headerlink" title="什么是迭代器？"></a>什么是迭代器？</h4><p>迭代器是一个对象，它拥有一个next方法，调用next方法会返回一个对象，该对象有两个属性值，value和done。每次调用next方法，返回的value表示可迭代对象中的下一个值，done表示迭代是否完成。根据此定义，可用下面的代码实现一个迭代器:</p><pre><code>let create_iter = function(items) &#123;    let i = 0;    return &#123;        next: function() &#123;            let value, done;            if (i &gt;= items.length) &#123;                value = null;                done = true;            &#125; else &#123;                value = items\[i++\];                done = false;            &#125;            return &#123;                value: value,                done: done            &#125;        &#125;    &#125;&#125;</code></pre><h4 id="什么是生成器？"><a href="#什么是生成器？" class="headerlink" title="什么是生成器？"></a>什么是生成器？</h4><p>用来创建迭代器的函数称之为生成器，ES6为了简化生成器，引入了新的语法：</p><ul><li>  在生成器函数前加*</li><li>  使用yield关键字抛出下一个value</li></ul><p>引入新的语法后，生成器的代码可以简化为：</p><pre><code>let gen = function*(items) &#123;    for (let i = 0; i &lt; items.length; i++) &#123;        yield items\[i\];    &#125;&#125;</code></pre><h4 id="举个栗子"><a href="#举个栗子" class="headerlink" title="举个栗子"></a>举个栗子</h4><p>下面的代码比较了两种创建迭代器的方法：</p><pre><code>let create_iter = function(items) &#123;    let i = 0;    return &#123;        next: function() &#123;            let value, done;            if (i &gt;= items.length) &#123;                value = null;                done = true;            &#125; else &#123;                value = items[i++];                done = false;            &#125;            return &#123;                value: value,                done: done            &#125;        &#125;    &#125;&#125;let gen = function*(items) &#123;    for (let i = 0; i &lt; items.length; i++) &#123;        yield items[i];    &#125;&#125;let items = [1, 2, 3, 4, 5];let it = gen(items);console.log(it.next());console.log(it.next());console.log(it.next());console.log(it.next());console.log(it.next());console.log(it.next());</code></pre><p>输出结果：</p><pre><code>$ node test.js &#123; value: 1, done: false &#125;&#123; value: 2, done: false &#125;&#123; value: 3, done: false &#125;&#123; value: 4, done: false &#125;&#123; value: 5, done: false &#125;&#123; value: undefined, done: true &#125;&#123; value: undefined, done: true &#125;</code></pre><h4 id="生成器的表现形式"><a href="#生成器的表现形式" class="headerlink" title="生成器的表现形式"></a>生成器的表现形式</h4><ul><li>  function *my_generator(items) {}</li><li>  let my_generator = function *(items) {}</li><li>  let obj = {*my_generator(items){}};</li></ul><h4 id="可迭代对象"><a href="#可迭代对象" class="headerlink" title="可迭代对象"></a>可迭代对象</h4><p>可迭代对象指的是包含Symbol.iterator属性的对象，数组、Set、Map、字符串都是可迭代对象，都有默认的迭代器。 可迭代对象可以与for-of配合使用，例如：</p><pre><code>let numbers = [1, 2, 3, 4, 5];for (let num of numbers) &#123;    console.log(num);&#125;</code></pre><p>可以用一下方法自定义一个可迭代对象：</p><pre><code>let colors = &#123;    items: [1, 2, 3, 4, 5],    *[Symbol.iterator]() &#123;        for (let item of this.items) &#123;            yield item;        &#125;    &#125;&#125;</code></pre><h4 id="内置迭代器"><a href="#内置迭代器" class="headerlink" title="内置迭代器"></a>内置迭代器</h4><p>数组、Map和Set 都有一下三个内置的迭代器：</p><ul><li>  entries(): 返回一个包含键值对(数组)的迭代器</li><li>  values(): 返回一个只包含值的迭代器</li><li>  keys(): 返回一个只包含键的迭代器</li></ul><p>对于数组来说，keys返回的是元素的下标，对于Set来说，返回的是元素的值，而对于Map来说，返回的是元素的key。</p><h4 id="给迭代器传入参数"><a href="#给迭代器传入参数" class="headerlink" title="给迭代器传入参数"></a>给迭代器传入参数</h4><p>当调用next方法时，若传入参数，则该参数会替代上一次yield表达式的值，例如：</p><pre><code>let gen = function *() &#123;    let a = yield 1;    let b = yield a + 1;    yield b + 1;&#125;let iter = gen();console.log(iter.next());console.log(iter.next(100));console.log(iter.next(200));console.log(iter.next());执行结果：$ node test.js &#123; value: 1, done: false &#125;&#123; value: 101, done: false &#125;&#123; value: 201, done: false &#125;&#123; value: undefined, done: true &#125;#### 生成器委托也就是生成器的嵌套，例如：let generator0 = function *() &#123;    yield 0;    yield 1;    yield 2;&#125;let generator1 = function *() &#123;    yield 3;    yield 4;    yield 5;&#125;let generator = function *() &#123;    yield *generator0();    yield *generator1();    yield 6;&#125;let iter = generator();console.log(iter.next());console.log(iter.next());console.log(iter.next());console.log(iter.next());console.log(iter.next());console.log(iter.next());console.log(iter.next());console.log(iter.next());</code></pre>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> es6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>单链表反转</title>
      <link href="/2018/12/07/%E5%8D%95%E9%93%BE%E8%A1%A8%E5%8F%8D%E8%BD%AC/"/>
      <url>/2018/12/07/%E5%8D%95%E9%93%BE%E8%A1%A8%E5%8F%8D%E8%BD%AC/</url>
      
        <content type="html"><![CDATA[<h4 id="实现单链表反转的思路"><a href="#实现单链表反转的思路" class="headerlink" title="实现单链表反转的思路"></a>实现单链表反转的思路</h4><p>实现单链表反转的难点在于，如果让当前节点的next指向前驱节点，那么链表就断了，所以解决的办法就是在进行反转操作之前用一个临时指针变量保存后继节点的地址。</p><h4 id="单链表反转的代码实现"><a href="#单链表反转的代码实现" class="headerlink" title="单链表反转的代码实现"></a>单链表反转的代码实现</h4><pre><code>#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;typedef struct LIST_NODE &#123;    int data;    struct LIST_NODE* next;&#125; LIST_NODE;void show\_list(LIST\_NODE *head) &#123;    LIST_NODE *p = head-&gt;next;    while(p != NULL) &#123;        printf(&quot;%d &quot;, p-&gt;data);        p = p-&gt;next;    &#125;    printf(&quot;\\n&quot;);&#125;void reverse\_list(LIST\_NODE *head) &#123;    LIST_NODE \*p, \*q, *tmp;    p = head;    q = p-&gt;next;    while (q != NULL) &#123;        tmp = q-&gt;next;        if (p == head) &#123;            q-&gt;next = NULL;        &#125; else &#123;            q-&gt;next = p;        &#125;        p = q;        q = tmp;    &#125;    head-&gt;next = p;&#125;int main(int argc, char **argv) &#123;    LIST_NODE head = &#123;        .data = 0,        .next = NULL    &#125;;    int data;    LIST_NODE *tail = &amp;head;    while (1) &#123;        printf(&quot;Please input a number: (0 to stop input)\\n&quot;);        scanf(&quot;%d&quot;, &amp;data);        if (data == 0) &#123;            break;        &#125;        LIST\_NODE *new\_node = malloc(sizeof(LIST_NODE));        new_node-&gt;data = data;        new_node-&gt;next = NULL;        tail-&gt;next = new_node;        tail = new_node;    &#125;    show_list(&amp;head);    reverse_list(&amp;head);    show_list(&amp;head);    return 0;&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>冒泡排序、插入法排序及选择排序</title>
      <link href="/2018/11/22/%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F%E6%8F%92%E5%85%A5%E6%B3%95%E6%8E%92%E5%BA%8F%E5%8F%8A%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F/"/>
      <url>/2018/11/22/%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F%E6%8F%92%E5%85%A5%E6%B3%95%E6%8E%92%E5%BA%8F%E5%8F%8A%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<p>冒泡排序、插入法排序以及选择排序是排序算法中比较基础的三种，其平均时间复杂度都是O(n^2)。 <img src="https://static001.geekbang.org/resource/image/34/50/348604caaf0a1b1d7fee0512822f0e50.jpg"></p><h3 id="原理介绍"><a href="#原理介绍" class="headerlink" title="原理介绍"></a>原理介绍</h3><h4 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h4><p>冒泡排序的步骤是：比较相邻两个数，看是否满足大小关系，如果不满足则交换这两个数，使他们满足大小关系，这样可以保证最大（最小）的数始终会向后流动，循环一次之后，最大（最小）的数就会被交换到数组的最后。一次冒泡会让至少一个元素移动到它应该在的位置，重复 n 次，就完成了 n 个数据的排序工作。</p><h4 id="插入法排序"><a href="#插入法排序" class="headerlink" title="插入法排序"></a>插入法排序</h4><p>插入法排序的思路是：把数组分成两个部分：排好序的，和未排序的。开始的时候，数组的第一个元素会被当做拍好序的部分，对其余未排好序的数值进行迭代，将其插入到排好序的部分中合适的位置。</p><h4 id="选择法排序"><a href="#选择法排序" class="headerlink" title="选择法排序"></a>选择法排序</h4><p>选择法排序和插入法排序类似，都是将数组分为排好序的和未排序的两个部分。不同的是，选择法排序每次迭代都会选择未排序部分中的最小（最大）值，将其插入到排好序部分的队首（队尾）。</p><h3 id="C语言实现"><a href="#C语言实现" class="headerlink" title="C语言实现"></a>C语言实现</h3><p>需要实现四个函数， 第一个是打印数组，接下来三个函数分别实现三种排序算法：</p><ul><li>  void print_arry(int *a, int len)</li><li>  static inline void insertion_sort(int *a, int len)</li><li>  static inline void bubble_sort(int *a, int len)</li><li>  static inline void selection_sort(int *a, int len)</li></ul><p>main函数中，首先需要用户输入指定数目(#define LEN 10)的数值，如果用户输入-1则随机生成这些数值。然后需要用户输入排序算法。输入完成后打印排序前的数组，然后根据相应的排序算法进行排序，最后再打印出排序后的数组。代码如下：  </p><pre><code>#include &lt;stdio.h&gt;#include &lt;time.h&gt;#include &lt;stdlib.h&gt;#define LEN 10#define NR_METHOD 3#define RAND_RANGE 100void print_arry(int *a, int len) &#123;    int i = 0;    for (int i = 0; i &lt; len; i++) &#123;        printf(&quot;%d &quot;, a\[i\]);    &#125;    printf(&quot;\\n&quot;);&#125;static inline void insertion_sort(int *a, int len) &#123;    int tmp = 0;    int i, j;    for (i = 1; i &lt; len; i++) &#123;        tmp = a\[i\];        for (j = i - 1; j &gt;= 0; j--) &#123;            if (a\[j\] &gt; tmp) &#123;                a\[j + 1\] = a\[j\];            &#125; else &#123;                break;            &#125;        &#125;        a\[j + 1\] = tmp;    &#125;&#125;static inline void bubble_sort(int *a, int len) &#123;    int i, j;    int tmp;    int swapped = 0;    for (i = len - 1; i &gt;= 0; i--) &#123;        for (j = 0; j &lt; i; j++) &#123;            if (a\[j\] &gt; a\[j + 1\]) &#123;                tmp = a\[j\];                a\[j\] = a\[j + 1\];                a\[j + 1\] = tmp;                swapped = 1;            &#125;        &#125;        if (!swapped) &#123;            break;        &#125;    &#125;&#125;static inline void selection_sort(int *a, int len) &#123;    int i, j, min, tmp;    for (i = 0; i &lt; len -1; i++) &#123;        min = i;        for (j = i + 1; j &lt; len; j++) &#123;            if(a\[j\] &lt; a\[min\]) &#123;                min = j;            &#125;        &#125;        if (min != i) &#123;            tmp = a\[min\];            a\[min\] = a\[i\];            a\[i\] = tmp;        &#125;    &#125;&#125;int main(int argc, char **argv) &#123;    srand(time(NULL));    int a\[LEN\];    int data;    for (int i = 0; i &lt; LEN; i++) &#123;        printf(&quot;Please input a number: %d left: (-1 for random numbers)&quot;, LEN - i);        scanf(&quot;%d&quot;, &amp;data);        if(data != -1) &#123;            a\[i\] = data;        &#125; else &#123;            for (int j = 0; j &lt; LEN; j++) &#123;                a\[j\] = rand() % RAND_RANGE;            &#125;            break;        &#125;    &#125;    while (1) &#123;        printf(&quot;Please select a sort method:\\n&quot;);        printf(&quot;0: Insertion sort\\n&quot;);        printf(&quot;1: Bubble sort \\n&quot;);        printf(&quot;2: Selection sort \\n&quot;);        scanf(&quot;%d&quot;, &amp;data);        if(data &gt;= 0 &amp;&amp; data &lt; NR_METHOD) &#123;            break;        &#125; else &#123;            printf(&quot;Please input a valid number!\\n&quot;);        &#125;    &#125;    printf(&quot;Original Array: \\n&quot;);    print_arry(a, LEN);    switch(data) &#123;        case 0:        printf(&quot;You selected insertion sort\\n&quot;);        insertion_sort(a, LEN);        break;        case 1:        printf(&quot;You selected bubble sort\\n&quot;);        bubble_sort(a, LEN);        break;        case 2:        printf(&quot;You selected selection sort\\n&quot;);        selection_sort(a, LEN);        break;    &#125;    printf(&quot;Sorted Array: \\n&quot;);    print_arry(a, LEN);    return 0;&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>用单链表实现LRU缓存置换算法</title>
      <link href="/2018/10/30/%E7%94%A8%E5%8D%95%E9%93%BE%E8%A1%A8%E5%AE%9E%E7%8E%B0LRU%E7%BC%93%E5%AD%98%E7%BD%AE%E6%8D%A2%E7%AE%97%E6%B3%95/"/>
      <url>/2018/10/30/%E7%94%A8%E5%8D%95%E9%93%BE%E8%A1%A8%E5%AE%9E%E7%8E%B0LRU%E7%BC%93%E5%AD%98%E7%BD%AE%E6%8D%A2%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h4 id="缓存置换算法所解决的问题"><a href="#缓存置换算法所解决的问题" class="headerlink" title="缓存置换算法所解决的问题"></a>缓存置换算法所解决的问题</h4><p>在存储系统的金字塔结构中，缓存的存取速度比内存快，然而成本比内存高，所以缓存的容量有限。缓存置换算法所要解决的问题便是在容量有限的缓存中，存放哪些数据可以提升缓存命中率。  </p><h4 id="LRU缓存置换算法的核心思想"><a href="#LRU缓存置换算法的核心思想" class="headerlink" title="LRU缓存置换算法的核心思想"></a>LRU缓存置换算法的核心思想</h4><p>LRU算法认为最近访问过的数据被再次访问的可能性最大，所以缓存中存放的是最近使用过的数据。具体的做法是：</p><ul><li>把缓存当做一个队列，队首的数据是最近被访问的数据，而队尾的数据则是即将被置换出缓存的数据。</li><li>每当有新数据被访问时，会在队列中查找该数据，如果存在，就被该数据挪到队首。</li><li>如果被访问的数据没有在队列（缓存）中，而且缓存未满，则该数据被放到队首。</li><li>如果被访问的数据没有在队列中，然而缓存已经满了，则把队尾的数据从队列中删除，再把新数据放置到队首。</li></ul><h4 id="用C语言实现LRU缓存置换算法"><a href="#用C语言实现LRU缓存置换算法" class="headerlink" title="用C语言实现LRU缓存置换算法"></a>用C语言实现LRU缓存置换算法</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CACHE_SIZE 20</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> nr_of_list = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">CACHE_ITEM</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">CACHE_ITEM</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125; CACHE_ITEM;</span><br><span class="line"></span><br><span class="line">CACHE_ITEM list_head;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">init_list_head</span><span class="params">(CACHE_ITEM *head)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!head) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s: parameter error - no list head\n&quot;</span>, __func__);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    head-&gt;data = <span class="number">0</span>;</span><br><span class="line">    head-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">insert_node</span><span class="params">(CACHE_ITEM *head, CACHE_ITEM *node)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!head || !node) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s: parameter error - no list head or node\n&quot;</span>, __func__);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    node-&gt;next = head-&gt;next;</span><br><span class="line">    head-&gt;next = node;</span><br><span class="line">    nr_of_list += <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">remove_node</span><span class="params">(CACHE_ITEM *head, CACHE_ITEM *node)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!head || !node) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s: parameter error - no list head or node\n&quot;</span>, __func__);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    CACHE_ITEM *p = head;</span><br><span class="line">    <span class="keyword">while</span>(p-&gt;next) &#123;</span><br><span class="line">        <span class="keyword">if</span>(p-&gt;next == node) &#123;</span><br><span class="line">            p-&gt;next = node-&gt;next;</span><br><span class="line">            nr_of_list -= <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            p = p-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">remove_tail_node</span><span class="params">(CACHE_ITEM *head)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!head) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s: parameter error - no list head\n&quot;</span>, __func__);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    CACHE_ITEM *p = head;</span><br><span class="line">    <span class="keyword">while</span>(p-&gt;next) &#123;</span><br><span class="line">        <span class="keyword">if</span>(p-&gt;next &amp;&amp; !p-&gt;next-&gt;next) &#123;</span><br><span class="line">            p-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">            nr_of_list -= <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            p = p-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">CACHE_ITEM *<span class="title">search_list</span><span class="params">(CACHE_ITEM *head, <span class="keyword">int</span> number)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!head) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s: parameter error - no list head\n&quot;</span>, __func__);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    CACHE_ITEM *p = head-&gt;next;</span><br><span class="line">    CACHE_ITEM *q = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">while</span>(p) &#123;</span><br><span class="line">        <span class="keyword">if</span>(p-&gt;data == number) &#123;</span><br><span class="line">            q = p;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            p = p-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> q;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">show_list</span><span class="params">(CACHE_ITEM *head)</span> </span>&#123;</span><br><span class="line">    CACHE_ITEM *p = head-&gt;next;</span><br><span class="line">    <span class="keyword">while</span>(p) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, p-&gt;data);</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;List Length: %d\n&quot;</span>, nr_of_list);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lru</span><span class="params">(CACHE_ITEM *head, <span class="keyword">int</span> number)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!head) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s: parameter error - no list head\n&quot;</span>, __func__);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    CACHE_ITEM *p = search_list(head, number);</span><br><span class="line">    <span class="keyword">if</span> (p) &#123;</span><br><span class="line">        remove_node(head, p);</span><br><span class="line">        insert_node(head, p);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nr_of_list &lt; CACHE_SIZE) &#123;</span><br><span class="line">        CACHE_ITEM *new_node = (CACHE_ITEM *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(CACHE_ITEM));</span><br><span class="line">        new_node-&gt;data = number;</span><br><span class="line">        insert_node(head, new_node);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        remove_tail_node(head);</span><br><span class="line">        CACHE_ITEM *new_node = (CACHE_ITEM *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(CACHE_ITEM));</span><br><span class="line">        new_node-&gt;data = number;</span><br><span class="line">        insert_node(head, new_node);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    CACHE_ITEM *head = &amp;list_head;</span><br><span class="line">    init_list_head(head);</span><br><span class="line">    <span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;请输入数字：\n&quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;num);</span><br><span class="line">        lru(head, num);</span><br><span class="line">        show_list(head);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">请输入数字：</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">List Length: 1</span><br><span class="line">请输入数字：</span><br><span class="line">2</span><br><span class="line">2 1</span><br><span class="line">List Length: 2</span><br><span class="line">请输入数字：</span><br><span class="line">3</span><br><span class="line">3 2 1</span><br><span class="line">List Length: 3</span><br><span class="line">请输入数字：</span><br><span class="line">4</span><br><span class="line">4 3 2 1</span><br><span class="line">List Length: 4</span><br><span class="line">请输入数字：</span><br><span class="line">5</span><br><span class="line">5 4 3 2 1</span><br><span class="line">List Length: 5</span><br><span class="line">请输入数字：</span><br><span class="line">3</span><br><span class="line">3 5 4 2 1</span><br><span class="line">List Length: 5</span><br><span class="line">请输入数字：</span><br><span class="line">1</span><br><span class="line">1 3 5 4 2</span><br><span class="line">List Length: 5</span><br><span class="line">请输入数字：</span><br><span class="line">6</span><br><span class="line">6 1 3 5 4 2</span><br><span class="line">List Length: 6</span><br><span class="line">请输入数字：</span><br><span class="line">7</span><br><span class="line">7 6 1 3 5 4 2</span><br><span class="line">List Length: 7</span><br><span class="line">请输入数字：</span><br><span class="line">8</span><br><span class="line">8 7 6 1 3 5 4 2</span><br><span class="line">List Length: 8</span><br><span class="line">请输入数字：</span><br><span class="line">9</span><br><span class="line">9 8 7 6 1 3 5 4 2</span><br><span class="line">List Length: 9</span><br><span class="line">请输入数字：</span><br><span class="line">10</span><br><span class="line">10 9 8 7 6 1 3 5 4 2</span><br><span class="line">List Length: 10</span><br><span class="line">请输入数字：</span><br><span class="line">11</span><br><span class="line">11 10 9 8 7 6 1 3 5 4 2</span><br><span class="line">List Length: 11</span><br><span class="line">请输入数字：</span><br><span class="line">12</span><br><span class="line">12 11 10 9 8 7 6 1 3 5 4 2</span><br><span class="line">List Length: 12</span><br><span class="line">请输入数字：</span><br><span class="line">13</span><br><span class="line">13 12 11 10 9 8 7 6 1 3 5 4 2</span><br><span class="line">List Length: 13</span><br><span class="line">请输入数字：</span><br><span class="line">14</span><br><span class="line">14 13 12 11 10 9 8 7 6 1 3 5 4 2</span><br><span class="line">List Length: 14</span><br><span class="line">请输入数字：</span><br><span class="line">15</span><br><span class="line">15 14 13 12 11 10 9 8 7 6 1 3 5 4 2</span><br><span class="line">List Length: 15</span><br><span class="line">请输入数字：</span><br><span class="line">16</span><br><span class="line">16 15 14 13 12 11 10 9 8 7 6 1 3 5 4 2</span><br><span class="line">List Length: 16</span><br><span class="line">请输入数字：</span><br><span class="line">17</span><br><span class="line">17 16 15 14 13 12 11 10 9 8 7 6 1 3 5 4 2</span><br><span class="line">List Length: 17</span><br><span class="line">请输入数字：</span><br><span class="line">18</span><br><span class="line">18 17 16 15 14 13 12 11 10 9 8 7 6 1 3 5 4 2</span><br><span class="line">List Length: 18</span><br><span class="line">请输入数字：</span><br><span class="line">19</span><br><span class="line">19 18 17 16 15 14 13 12 11 10 9 8 7 6 1 3 5 4 2</span><br><span class="line">List Length: 19</span><br><span class="line">请输入数字：</span><br><span class="line">20</span><br><span class="line">20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 1 3 5 4 2</span><br><span class="line">List Length: 20</span><br><span class="line">请输入数字：</span><br><span class="line">21</span><br><span class="line">21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 1 3 5 4</span><br><span class="line">List Length: 20</span><br><span class="line">请输入数字：</span><br><span class="line">22</span><br><span class="line">22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 1 3 5</span><br><span class="line">List Length: 20</span><br><span class="line">请输入数字：</span><br><span class="line">23</span><br><span class="line">23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 1 3</span><br><span class="line">List Length: 20</span><br><span class="line">请输入数字：</span><br><span class="line">1</span><br><span class="line">1 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 3</span><br><span class="line">List Length: 20</span><br><span class="line">请输入数字：</span><br><span class="line">4</span><br><span class="line">4 1 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6</span><br><span class="line">List Length: 20</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ES6: Set 与 Map</title>
      <link href="/2018/10/15/ES6Set%E4%B8%8EMap/"/>
      <url>/2018/10/15/ES6Set%E4%B8%8EMap/</url>
      
        <content type="html"><![CDATA[<p>Set</p><ul><li>  let my_set = new Set();</li><li>  let my_set = new Set([1, 1, 2, 2]);</li><li>  my_set.add(5);</li><li>  my_set.delete(5);</li><li>  my_set.has(5);</li><li>  my_set.forEach(function(value){});</li><li>  let my_set = WeakSet() // 只允许对象作为set的元素，便于垃圾回收</li></ul><p>Map</p><ul><li>  let my_map = new Map();</li><li>  let map = new Map([[“name”, “Nicholas”], [“age”, 25]]);</li><li>  my_map.set(key, value);</li><li>  my_map.get(key)</li><li>  my_map.has(key)</li><li>  my_map.delete(key);</li><li>  my_map.clear();</li><li>  my_map.size;</li><li>  my_map.forEach(function(value, key, ownerMap) { console.log(key + “ “ + value); console.log(ownerMap === map); });</li><li>  let map = new WeakMap();</li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> es6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ES6: 符号类型</title>
      <link href="/2018/10/15/ES6%E7%AC%A6%E5%8F%B7%E7%B1%BB%E5%9E%8B/"/>
      <url>/2018/10/15/ES6%E7%AC%A6%E5%8F%B7%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p>引入原因：</p><ul><li>实现私有属性  let s = Symbol()<br>  let obj = {[s]: ‘hello world’};<br>  console.log(obj.s); //undefined</li><li>符号值唯一  let s = Symbol()<br>  let m = Symbol()<br>  console.log(s === m)</li></ul><p>创建：</p><ul><li>  不能用字面量形式创建</li><li>  使用Symbol(desc)函数创建，不需要添加new</li><li>  Symbol.for(key)在全局符号注册表中查找key符号值，如果找到就返回，没找到就创建一个新的符号值</li><li>  Symbol.keyFor(symbol): 返回符号值的key</li></ul><p>枚举：</p><ul><li>  符号类型的key是不能被枚举的，Object.keys()以及Object.getOwnPropertyNames()都不能返回符号类型的key</li><li>  Object.getOwnPropertySymbols()则会返回对象中所有符号类型的key</li></ul><p>共享符号值：</p><ul><li>  Symbol.for(desc): 在全局符号注册表中查找描述为desc的符号，如果找到，返回这个符号值，如果没有，则创建一个新的符号值并返回</li><li>  Symbol.keyFor(var): 返回全局符号注册表中符号值为var的desc.</li></ul><p>转换：</p><ul><li>  不能强制转化为字符串或者数值类型, 所以 symbol + “hello” 或者 symbol/1 会报错</li><li>  可以调用String()来转换</li></ul><p>知名符号：</p><ul><li>Symbol.hasInstance(obj): 判断obj是不是当前函数的实例，如Array<a href="obj">Symbol.hasInstance</a>; 可以通过以下代码改变instanceof的默认行为：  Object.defineProperty(MyObject, Symbol.hasInstance, {<pre><code>  value: function(v) &#123;      return false;  &#125;</code></pre>  });</li><li>Symbol.isConcatSpreadable  let collection = {<pre><code>  0: &quot;Hello&quot;,  1: &quot;world&quot;,  length: 2,  [Symbol.isConcatSpreadable]: true</code></pre>  };<br>  let messages = [ “Hi” ].concat(collection);<br>  console.log(messages.length); // 3<br>  console.log(messages); // [“hi”,”Hello”,”world”]</li><li>  Symbol.match 、 Symbol.replace 、 Symbol.search 、Symbol.split</li><li>Symbol.toPrimitive  function Temperature(degrees) {<pre><code>  this.degrees = degrees;</code></pre>  }<br>  Temperature.prototype[Symbol.toPrimitive] = function(hint) {<pre><code>  switch (hint) &#123;  case &quot;string&quot;:      return this.degrees + &quot;\\u00b0&quot;; // 温度符号  case &quot;number&quot;:      return this.degrees;  case &quot;default&quot;:      return this.degrees + &quot; degrees&quot;;  &#125;</code></pre>  };<br>  let freezing = new Temperature(32);<br>  console.log(freezing + “!”); // “32 degrees!”<br>  console.log(freezing / 2); // 16<br>  console.log(String(freezing)); // “32°”</li><li>Symbol.toStringTag<blockquote><p>age[Symbol.toStringTag] = ‘Node’;<br>  ‘Node’<br>age<br>  { age: 32,<br>  [Symbol(Symbol.toPrimitive)]: [Function],<br>  [Symbol(Symbol.toStringTag)]: ‘Node’ }<br>age.toString();<br>  ‘[object Node]’</p></blockquote></li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> es6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ES6: 对象和数组解构</title>
      <link href="/2018/09/18/ES6%E5%AF%B9%E8%B1%A1%E5%92%8C%E6%95%B0%E7%BB%84%E8%A7%A3%E6%9E%84/"/>
      <url>/2018/09/18/ES6%E5%AF%B9%E8%B1%A1%E5%92%8C%E6%95%B0%E7%BB%84%E8%A7%A3%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<p>所谓解构，指的是将数据结构分解为更小的部分，从而使数据提取变得容易。 对象解构：</p><ul><li>  使用解构时，必须提供初始化值 <code>let Person = &#123; name: &#39;sen&#39;, age: 18 &#125; let &#123;name, age&#125; = Person;</code></li><li>  解构表达式的值为=右侧的值</li><li>  如果对象中没有同名属性时，解构表达式新赋值的变量的值为undefined</li><li>  解构对象只是赋值时，需要加()</li><li>  赋值给不同名的变量 <code>let Person = &#123; name: &#39;sen&#39;, age: 18 &#125; let &#123;name: localName, age: localAge&#125; = Person;</code></li><li>  设置默认值 <code>let Person = &#123; name: &#39;sen&#39;, age: 18 &#125; let &#123;name, age: localAge = 18&#125; = Person; </code></li><li>  嵌套解构 <code>let Person = &#123; name: &#39;sen&#39;, age: 18, score: &#123; maths: 100 &#125; &#125; let &#123;name, score: &#123;maths&#125;&#125; = Person; console.log(maths); </code></li></ul><p>数组解构</p><ul><li>  <code>let score = [99, 88, 77]; let [maths, english, chinese] = score; [,,chinese] = score;</code></li><li>  数组解构赋值不需要加()  <code>let a = 3; let b = 4; [a, b] = [b, a] </code></li><li>  嵌套的解构 <code>let score = [99, 88, [77]]; let [,,[chinese]] = score; </code></li><li>  剩余项 <code>let score = [99, 88, 77]; let [maths, ...restScore] = score; console.log(restScore) // [88, 77] </code></li><li>  数组和对象可以混合解构<code>let Person = &#123; name: &#39;sen&#39;, age: [0, 18] &#125; let &#123;name: localName, age: [start]&#125; = Person; console.log(start);</code></li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> es6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ES6: 对象扩展</title>
      <link href="/2018/09/18/ES6%E5%AF%B9%E8%B1%A1%E6%89%A9%E5%B1%95/"/>
      <url>/2018/09/18/ES6%E5%AF%B9%E8%B1%A1%E6%89%A9%E5%B1%95/</url>
      
        <content type="html"><![CDATA[<ul><li>  初始化简写： <code>function createPerson(name, age) &#123; return &#123; name: name, age: age &#125;; &#125; ---&gt; function createPerson(name, age) &#123; return &#123; name, age &#125;; &#125; </code></li><li>  方法简写： <code>var person = &#123; name: &quot;sen&quot;, sayName: function() &#123; return this.name; &#125; &#125;---&gt; var person = &#123; name: &quot;sen&quot;, sayName() &#123; return this.name; &#125; &#125; </code></li><li>  需要计算的属性名用[]表示</li><li>  Object.is() 与===表现相同，除了 Object.is(NaN, NaN) // true Object.is(+0, -0) // false</li><li>  Object.assign(target, source) 将source中的属性和方法混入target对象</li><li>  允许重发的属性定义，排在最后的为实际值</li><li>属性枚举的顺序：<ul><li>  所有数字类型的键按升序排列</li><li>  所有字符串类型的键按添加进对象的顺序排列</li><li>  所有符号类型的键也按照添加进对象的顺序排列</li></ul></li><li>  可修改对象的原型： Object.setPrototypeOf(obj, new_prototype)</li><li>  使用super作为指向原型对象的指针</li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> es6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ES6: 函数扩展</title>
      <link href="/2018/08/20/ES6%E5%87%BD%E6%95%B0%E6%89%A9%E5%B1%95/"/>
      <url>/2018/08/20/ES6%E5%87%BD%E6%95%B0%E6%89%A9%E5%B1%95/</url>
      
        <content type="html"><![CDATA[<ul><li>带默认值参数的函数：var get_name = function(url, id=1, callback){};<ul><li>  如果传入了第二个参数，将不会使用默认值</li><li>  如果给第二个参数赋值为undefined，会使用默认值</li><li>  带有默认值的参数后，arguments的内容将不会随着形参的改变而改变</li><li>  排在后面的参数可以将前面的参数作为默认值，而前面的参数不能引用后面的参数作为默认值</li></ul></li><li>剩余参数：var get_name = function(url, …keys)<ul><li>  除了第一个参数url外，剩余所有参数都会被放到keys数组中</li><li>  函数只能有一个剩余参数，且必须放到最后</li><li>  剩余参数不能在对象字面量的setter属性中使用</li></ul></li><li>  延展运算符：<code>var args = [&#39;url&#39;, 123, &#39;st&#39;]; get_names(...args);</code></li><li>  new.target: 使用new创建一个对象时，会被赋值为新对象的构造器</li><li>  ES6允许在代码块中定义函数，在严格模式中，块级函数只能在块级作用域中使用，而非严格模式中，块级函数会被提升到全局</li><li>箭头函数<ul><li>  没有this,super,arguments,new.target,这些值由所在的、最靠近的非箭头函数来决定</li><li>  不能使用new来调用</li><li>  没有原型</li><li>  不能更改this</li><li>  不允许有重复的具名参数</li><li>语法<ul><li>  <code>var reflect = value =&gt; value;</code></li><li>  <code>var sum = (num1, num2) =&gt; num1 + num2;</code></li><li>  <code>var getName = () =&gt; &#39;Nicholas&#39;;</code></li><li>  <code>var sum = (num1, num2) =&gt; &#123;return num1 + num2&#125;;</code></li><li>  <code>var doSomething = () =&gt; &#123;&#125;;</code></li><li>  <code>var getItem = (id) =&gt; (&#123;id: id, name: &#39;Nicholas&#39;&#125;);</code></li><li>  <code>var person = ((name) =&gt; &#123;return &#123;getName: function() &#123;return name&#125;&#125;;&#125;)</code></li></ul></li></ul></li><li>尾调用优化：满足以下条件的尾调用将会被优化，在尾调用时不会创建新的栈帧，而是清除当前栈帧并再次利用它<ul><li>  尾调用不能引用当前栈帧中的变量(意味着该函数不能是闭包)</li><li>  进行尾调用的函数在尾调用返回结果后不能做额外操作</li><li>  尾调用的结果作为当前函数的返回值</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> es6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ES6: 字符串处理</title>
      <link href="/2018/07/24/ES6%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%84%E7%90%86/"/>
      <url>/2018/07/24/ES6%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>UTF-16编码：</p><ul><li>  str.codePointAt(index)</li><li>  String.fromCodePoint(codepoint);</li><li>  normalize()</li></ul><p>正则表达式</p><ul><li>  新增u修饰符用来处理UTF-16编码的问题  /&amp;.$/u</li><li>  新增pattern.flags 属性 // ‘ig’</li><li>  新增pattern.sticky 属性及’y’修饰符 // 只从lastIndex处匹配，如果和’g’一起存在则’g’被忽略</li><li>  复制正则表达式  // let pattern = new RegEX(old_pattern, ‘gi’)</li></ul><p>字符串处理</p><ul><li>  str.includes(sub_string) // true or false</li><li>  str.startsWith(sub_string)  // true or false</li><li>  str.endsWith(sub_string) // true or false</li><li>  str.repeat(times);  // str * times</li><li>模板字面量<ul><li>  支持多行字符串</li><li>  支持变量  // `hello ${name}`</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> es6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ES6: 块级作用域</title>
      <link href="/2018/07/18/ES6%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F/"/>
      <url>/2018/07/18/ES6%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F/</url>
      
        <content type="html"><![CDATA[<p>var</p><ul><li>  没有块级作用域的概念</li><li>  会被提升到定义函数的顶部</li><li>  可以重复声明</li></ul><p>let</p><ul><li>  有块级作用域</li><li>  不会被提升</li><li>  禁止重复声明</li></ul><p>const</p><ul><li>  有块级作用域</li><li>  不会被提升</li><li>  禁止重复声明</li><li>  其值不可更改</li><li>  必须进行初始化</li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> es6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript中的表单</title>
      <link href="/2018/07/18/Javascript%E4%B8%AD%E7%9A%84%E8%A1%A8%E5%8D%95/"/>
      <url>/2018/07/18/Javascript%E4%B8%AD%E7%9A%84%E8%A1%A8%E5%8D%95/</url>
      
        <content type="html"><![CDATA[<p>var form = document.getElementById(‘myform’);</p><ul><li>  form.acceptCharset 服务器能处理的字符集</li><li>  form.action 接受请求的URL</li><li>  form.elements 表单中的所有控件</li><li>  form.enctype 编码类型</li><li>  form.length 控件数量</li><li>  form.method HTTP请求类型</li><li>  form.name   // document.forms[form.name]</li><li>  form.reset()</li><li>  form.submit()</li><li>  form.target</li></ul><p>var text = form.elements[‘sex’];</p><ul><li>  text.disabled</li><li>  text.form</li><li>  text.name</li><li>  text.value</li><li>  text.readOnly</li><li>  text.tabIndex</li><li>  text.type</li><li>  text.select()</li><li>  text.setSelectionRange(start, end)</li><li>  text.value.substring(text.selectionStart, text.selectionEnd)</li></ul><p>text的事件：</p><ul><li>  change</li><li>  focus</li><li>  blur</li></ul><p>剪贴板 var clipboard = window.clipboardData ; //event.clipboardData;</p><ul><li>  clipboard.getData()</li><li>  clipboard.setData()</li><li>  clipboard.clearData()</li></ul><p>剪贴板事件</p><ul><li>  beforecopy</li><li>  copy</li><li>  beforecut</li><li>  cut</li><li>  beforepaste</li><li>  paste</li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript中的事件</title>
      <link href="/2018/07/18/Javascript%E4%B8%AD%E7%9A%84%E4%BA%8B%E4%BB%B6/"/>
      <url>/2018/07/18/Javascript%E4%B8%AD%E7%9A%84%E4%BA%8B%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<p>事件捕获(capturing)和事件冒泡(bubbling) </p><p>添加事件处理程序的两种方法</p><ul><li>  <div onclick="alert('ddd')"></div>  // onclick=null</li><li>  elem.addEventListener(“click”, e_func, false); //elem.removeEventListener(‘click’, e_func, false); //false 表明在冒泡阶段被触发</li></ul><p>事件对象</p><ul><li>  e.bubbles // true or false 是否冒泡</li><li>  e.cancelable // true of false 是否可取消默认行为</li><li>  e.currentTarget // 正在处理事件的元素，事件处理程序中的this指向该元素</li><li>  e.target // 事件发生的目标元素</li><li>  e.defaultPrevented // true or false 默认行为是否被取消</li><li>  e.detail</li><li>  e.eventPhase // 1 捕获阶段 2 处于目标 3冒泡阶段</li><li>  e.preventDefault()</li><li>  e.stopImmediatePropagation() //阻止事件冒泡和所有事件处理程序</li><li>  e.stopPropagation() //阻止事件冒泡</li><li>  e.trusted // true 表示事件由浏览器生成，false表示有javascript触发</li><li>  e.type</li><li>  e.view</li><li>  e.clientX e.clientY 事件发生时鼠标的视图位置</li><li>  e.pageX e.pageY 事件发生时鼠标的页面位置</li><li>  e.screenX e.screenY 事件发生时鼠标的屏幕位置</li><li>  e.ctrlKey e.shiftKey e.altKey e.metaKey 事件发生时修饰键是否被按下</li><li>  e.button // 0 主键 1 滚轮键 2右键 被按下</li><li>  e.wheelDelta</li><li>  e.charCode</li><li>  e.keyCode</li><li>  e.data //textinput 事件时输入的字符</li><li>  e.iputMethod //0-9 输入来源，如键盘、粘贴、拖放等</li></ul><p>事件类型</p><ul><li>UI事件<ul><li>  load  (window, img)</li><li>  unload</li><li>  resize (window)</li><li>  scroll (window)</li></ul></li><li>焦点事件<ul><li>  blur 失去焦点事触发，不会冒泡</li><li>  focusin</li><li>  focusout</li><li>  focus 不会冒泡</li></ul></li><li>鼠标与滚轮事件<ul><li>  click</li><li>  dbclick</li><li>  mousedown 任何鼠标按键被按下时触发</li><li>  mouseup</li><li>  mouseenter 不冒泡</li><li>  mouseover 冒泡</li><li>  mousemove</li><li>  mouseleave 不冒泡</li><li>  mouseout 冒泡</li><li>  mousewheel</li><li>  contextmenu 鼠标右键弹出菜单</li></ul></li><li>键盘事件<ul><li>  keydown</li><li>  keypress</li><li>  keyup</li><li>  textinput</li></ul></li><li>DOM变动事件<ul><li>  DOMSubtreeModified</li><li>  DOMNodeInserted</li><li>  DOMNodeRemoved</li><li>  DOMNodeInsertedIntoDocument</li><li>  DOMNodeRemovedFromDocument</li><li>  DOMAttrModified</li><li>  DOMCharacterDataModified</li></ul></li></ul><p>事件委托和移除 为提升性能，利用事件冒泡来减少事件处理程序；在DOM元素被innerHTML移除后，需要手动的移除事件处理程序 事件模拟</p><ul><li>  var e = document.createEvent(‘MouseEvents’);</li><li>  e.initMouseEvent(….);</li><li>  elem.dispatchEvent(e);</li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DOM中的选择符API及元素遍历</title>
      <link href="/2018/07/11/DOM%E4%B8%AD%E7%9A%84%E9%80%89%E6%8B%A9%E7%AC%A6API%E5%8F%8A%E5%85%83%E7%B4%A0%E9%81%8D%E5%8E%86/"/>
      <url>/2018/07/11/DOM%E4%B8%AD%E7%9A%84%E9%80%89%E6%8B%A9%E7%AC%A6API%E5%8F%8A%E5%85%83%E7%B4%A0%E9%81%8D%E5%8E%86/</url>
      
        <content type="html"><![CDATA[<h3 id="选择符API"><a href="#选择符API" class="headerlink" title="选择符API"></a>选择符API</h3><ul><li>  document.querySelector(css_selector) var checked_radio = document.querySelector(‘.checked’);</li><li>  var node_list = document.querySelector(css_selector);</li><li>  elem.matchesSelector(css_selector) // true or false</li></ul><h3 id="HTML-5中的类名操作"><a href="#HTML-5中的类名操作" class="headerlink" title="HTML 5中的类名操作"></a>HTML 5中的类名操作</h3><p>classList是DOMTokenList的实例，因而具有以下方法：</p><ul><li>  elem.classList.add(value); 如果已经有了就不添加了</li><li>  elem.classList.contain(value) //true or false</li><li>  elem.classList.remove(value)</li><li>  elem.classList.toggle(value); 如果有就删除，如果没有就添加</li></ul><h3 id="元素遍历"><a href="#元素遍历" class="headerlink" title="元素遍历"></a>元素遍历</h3><p>Element新增5个属性：</p><ul><li>  childElementCount: 子元素的个数（不包括Text和Comment类型）</li><li>  firstElementChild</li><li>  lastElementChild</li><li>  previousElementSibling</li><li>  nextElementSibling</li></ul>]]></content>
      
      
      <categories>
          
          <category> 应用开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dom </tag>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript中的DOM节点类型</title>
      <link href="/2018/07/11/Javascript%E4%B8%AD%E7%9A%84DOM%E8%8A%82%E7%82%B9%E7%B1%BB%E5%9E%8B/"/>
      <url>/2018/07/11/Javascript%E4%B8%AD%E7%9A%84DOM%E8%8A%82%E7%82%B9%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h3 id="Node类型"><a href="#Node类型" class="headerlink" title="Node类型"></a>Node类型</h3><ul><li>node.nodeType:<ul><li>  Node.ELEMENT_NODE(1);</li><li>  Node.ATTRIBUTE_NODE(2);</li><li>  Node.TEXT_NODE(3);</li><li>  Node.CDATA_SECTION_NODE(4);</li><li>  Node.ENTITY_PREFERENCE_NODE(5);</li><li>  Node.ENTITY_NODE(6);</li><li>  Node.PROCESSING_INSTRUCTION_NODE(7);</li><li>  Node.COMMENT_NODE(8);</li><li>  Node.DOCUMENT_NODE(9);</li><li>  Node.DOCUMENT_TYPE_NODE(10);</li><li>  Node.DOCUMENT_FRAGMENT_NODE(11);</li><li>  Node.NOTATION_NODE(12);</li></ul></li><li>  node.nodeName: 标签名</li><li>  node.childNodes[0]  node.childNodes.item(0);</li><li>  node.childNodes.length;</li><li>  node.parentNode;</li><li>  node.nextSibling;</li><li>  node.previousSibling;</li><li>  node.firstChild;</li><li>  node.lastChild;</li><li>  node.appendChild(newNode);</li><li>  node.insertBefore(newNode);</li><li>  node.replaceChild(newNode, oldNode);</li><li>  node.removeChild(node);</li><li>  node.cloneNode(true//深复制)</li></ul><h3 id="HTMLDocument类型"><a href="#HTMLDocument类型" class="headerlink" title="HTMLDocument类型"></a>HTMLDocument类型</h3><ul><li>  document.nodeType = 9</li><li>  document.nodeName = “#document”</li><li>  document.nodeValue = null</li><li>  document.parentNode = null</li><li>  document.ownerDocument = null</li><li>  document.firstChild === document.childNodes[0] === document.documentElement 都指向<html>元素</li><li>  document.body指向<body>元素</li><li>  document.head</li><li>  document.charset</li><li>  document.URL;</li><li>  document.title;</li><li>  document.domain;</li><li>  document.getElementById();</li><li>  document.getElementByClassName();</li><li>  document.getElementsByTagName();</li><li>  document.getElementsByName();</li><li>  document.images;</li><li>  document.anchors;</li><li>  document.links;</li><li>  document.forms;</li><li>  document.createElement(‘div’)</li><li>  document.activeElement: 指向获得焦点的元素</li><li>  document.readyState // loading or complete</li></ul><h3 id="Element类型"><a href="#Element类型" class="headerlink" title="Element类型"></a>Element类型</h3><p>var elem = document.getElementById(‘elem_id’);</p><ul><li>  elem.nodeType = 1</li><li>  elem.nodeName 为元素的标签名</li><li>  elem.nodeValue = null</li><li>  elem.parentNode 为document或者Element</li><li>  elem.nodeName === elem.tagName</li><li>  elem.getAttribute(“id”)</li><li>  elem.setAttribute(“id”, “new_id”)</li><li>  elem.attributes.getNamedItem(‘id’)</li><li>  elem.attributes.removeNamedItem(‘id’)</li><li>  elem.attributes.setNamedItem(new_attr)</li><li>  elem.getElementsByTagName()</li><li>  elem.dataset // data- 前缀自定义的属性及属性值</li><li>  elem.innerHTML // 元素的内容（所有子节点HTML）</li><li>  elem.scrollIntoView() //将元素滚动至可见视图中</li><li>  elem.style.width</li><li>  elem.style</li></ul><h3 id="Text类型"><a href="#Text类型" class="headerlink" title="Text类型"></a>Text类型</h3><div>hello world</dev> var text\_node = div.firstChild; var text\_node = document.createTextNode(text);<ul><li>  text_node.nodeValue = text_node.data = ‘hello world’</li><li>  text_node.appendData(‘string’);</li><li>  text_node.deleteData(offset, count);</li><li>  text_node.insertData(offset, text);</li><li>  text_node.replaceData(offset, count, new_text);</li><li>  text_node.splitText(offset);</li><li>  text_node.substringData(offset);</li><li>  text_node.length = text_node.data.length = text_node.nodeValue.length;</li><li>  text_node.parentNode.normalize() // 将两个子文本节点合并</li></ul><h3 id="Comment类型"><a href="#Comment类型" class="headerlink" title="Comment类型"></a>Comment类型</h3><pre><code>&lt;div id=&#39;mydiv&#39;&gt;&lt;!-- comment --&gt;&lt;/div&gt; var mydiv = document.getElementById(&#39;mydiv&#39;); var comment = mydiv.firstChild; var comment = document.createComment(&#39;comment&#39;);</code></pre><ul><li>  comment类型和Text类型继承自同一个基类，拥有除splitText之外Text的所有属性和方法</li></ul><h3 id="Attr类型"><a href="#Attr类型" class="headerlink" title="Attr类型"></a>Attr类型</h3><p>elem.attributes中的节点 var attr = document.createAttribute(attr_name);</p><ul><li>  attr.nodeType = 11</li><li>  attr.nodeName 属性名</li><li>  attr.nodeValue 属性值</li><li>  attr.parentNode = null</li><li>  elem.setAttributeNode(attr);</li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dom </tag>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript中的history对象</title>
      <link href="/2018/06/25/Javascript%E4%B8%AD%E7%9A%84history%E5%AF%B9%E8%B1%A1/"/>
      <url>/2018/06/25/Javascript%E4%B8%AD%E7%9A%84history%E5%AF%B9%E8%B1%A1/</url>
      
        <content type="html"><![CDATA[<ul><li>  history.go(): 参数为负数表示后退，正数表示前进； 接URL表示跳到历史记录最近的URL</li><li>  history.back(): 后退一个页面</li><li>  history.forward(): 前进一个页面</li><li>  history.length: 历史记录的个数</li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript中的navigator对象</title>
      <link href="/2018/06/25/Javascript%E4%B8%AD%E7%9A%84navigator%E5%AF%B9%E8%B1%A1/"/>
      <url>/2018/06/25/Javascript%E4%B8%AD%E7%9A%84navigator%E5%AF%B9%E8%B1%A1/</url>
      
        <content type="html"><![CDATA[<ul><li>  navigator.appVersion</li><li>  navigator.buildID // firefox</li><li>  navigator.cookieEnabled</li><li>  navigator.javaEnabled()</li><li>  navigator.mimeTypes</li><li>  navigator.language</li><li>  navigator.onLine</li><li>  navigator.oscpu</li><li>  navigator.platform</li><li>  navigator.plugins</li><li>  navigator.userAgent</li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript中的location对象</title>
      <link href="/2018/06/25/Javascript%E4%B8%AD%E7%9A%84location%E5%AF%B9%E8%B1%A1/"/>
      <url>/2018/06/25/Javascript%E4%B8%AD%E7%9A%84location%E5%AF%B9%E8%B1%A1/</url>
      
        <content type="html"><![CDATA[<ul><li>  window.location === document.location // true</li><li>  location的属性列表</li><li>  修改location的属性会导致页面刷新并产生新的历史记录</li><li>  window.location = “URL” 和 location.href=”URL”效果一样，都会调用location.assign(URL)</li><li>  location.replace(URL)不会产生新的历史记录，而且会禁用后退</li><li>  location.reload(true): 重新加载页面，参数可以选择是否从服务器加载（而不是从缓存加载）</li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript中的window对象</title>
      <link href="/2018/06/23/Javascript%E4%B8%AD%E7%9A%84window%E5%AF%B9%E8%B1%A1/"/>
      <url>/2018/06/23/Javascript%E4%B8%AD%E7%9A%84window%E5%AF%B9%E8%B1%A1/</url>
      
        <content type="html"><![CDATA[<p>window对象的两个作用：</p><ul><li>  表示浏览器的一个实例</li><li>  ECMAscript中的Global对象 直接定义Global变量与在window上定义Global变量的区别是：直接定义的Global变量的[[configurable]]特性为false，也就是说，它不能用delete删除</li></ul><p>窗口关系及框架</p><ul><li>  如果html中包含框架(frame)，那么每个框架都有自己的window对象，它们从上到下，从左到右，依次存放于window.frames数组中。可以通过window.frames[index]或者window.frames[frame_name]来获取frame的window对象</li><li>  window.name为frame的name</li><li>  top对象表示最外层html的window对象</li><li>  parent对象表示上层frame的window对象</li><li>  self表示frame自身的window对象</li></ul><p>窗口位置</p><ul><li>window.screenLeft window.screenTop 或者firefox中的window.screenX window.screenY表示窗口左上角的位置  var left = (typeof window.screenLeft == “number”) ? window.screenLeft: window.screenX;<br>  var top = (typeof window.screenTop == “number”) ? window.screenTop: window.screenY;</li><li>  window.outerHight window.outerWidth 表示窗口的高和宽</li><li>  window.innerHight window.innerWidth 表示页面视图的高和宽</li></ul><p>打开新窗口</p><ul><li>  window.open(URL, target, args, is_replace) URL: 新窗口打开的网址 target: 目标frame的名字，或者_self, _parent,_top,_blank args: <img src="http://wangsen.site/wp-content/uploads/2018/06/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7-2018-06-23-%E4%B8%8B%E5%8D%885.37.10.png">is_replace: 是否替代当前窗口</li><li>  window.close() : 关闭一个窗口</li><li>  window.closed: 布尔值，window是否已经关闭</li><li>  window.opener: 表示打开本窗口的窗口window对象</li></ul><p>超时调用与间歇调用</p><ul><li>  var id = setTimeout(function, ms)  ; clearTimeout(id);</li><li>  var id = setInterval(function, ms) ; clearInterval(id);</li></ul><p>系统对话框</p><ul><li>  alert(‘string’)</li><li>  var boolean = confirm(“string”);</li><li>  var result_string = prompt(“string”, “default_answer”);</li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript中的函数表达式</title>
      <link href="/2018/06/22/Javascript%E4%B8%AD%E7%9A%84%E5%87%BD%E6%95%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
      <url>/2018/06/22/Javascript%E4%B8%AD%E7%9A%84%E5%87%BD%E6%95%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<ul><li><p>函数声明 有提升 而函数表达式没有，因此不应该通过if…else来声明函数</p><p>  if (condition) {</p><pre><code>  function sayHi() &#123;&#125;</code></pre><p>  } else {</p><pre><code>  function sayHi() &#123;&#125;</code></pre><p>  }</p></li><li><p>在递归函数中使用arguments.callee可以避免因函数名改变产生的错误。</p><p>  function factorial(num) {</p><pre><code>  if (num &lt;= 1) &#123;      return 1;  &#125; else &#123;      return num * arguments.callee(num - 1);  &#125;</code></pre><p>  }</p></li><li><p>  闭包是指函数中定义的函数，闭包的作用域链中包含父函数的执行环境（变量对象），所以即使父函数退出，如果闭包仍然被引用，那么父函数的变量对象就一直存在于内存中。所以，过度的使用闭包会导致内存占用过多</p></li><li><p>闭包的另外一个副作用是闭包只能取得父函数中变量的最后一个值，例如：<br>  function createFunctions() {</p><pre><code>  var result = new Array();  for(var i = 0; i &lt; 10; i++) &#123;      result\[i\] = function() &#123;          return i;      &#125;  &#125;  return result;</code></pre><p>  }<br>  调用result中的每个函数都会返回10</p></li><li><p>  闭包如果是匿名函数，则该函数中的this指向全局对象</p></li><li><p>可以用定义一个立即执行函数来模仿块级作用域：<br>  (function(){<br>  //块级作用域<br>  })();</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript中的对象</title>
      <link href="/2018/06/20/Javascript%E4%B8%AD%E7%9A%84%E5%AF%B9%E8%B1%A1/"/>
      <url>/2018/06/20/Javascript%E4%B8%AD%E7%9A%84%E5%AF%B9%E8%B1%A1/</url>
      
        <content type="html"><![CDATA[<h2 id="属性的类型"><a href="#属性的类型" class="headerlink" title="属性的类型"></a>属性的类型</h2><h3 id="1-1-数据类属性"><a href="#1-1-数据类属性" class="headerlink" title="1.1 数据类属性"></a>1.1 数据类属性</h3><p>数据类属性的属性——特性为：</p><ul><li>  [[Configurable]]: 默认为true。表示能否通过delete删除属性，能否修改属性的特性。</li><li>  [[Enumerable]]: 默认为true。表示在用for-in迭代对象时，能否迭代出该属性。</li><li>  [[Writable]]: 默认为true。表示能否修改属性的值。</li><li>  [[Value]]: 默认为undefined。保存属性的值。</li></ul><h3 id="1-2-访问器类属性"><a href="#1-2-访问器类属性" class="headerlink" title="1.2 访问器类属性"></a>1.2 访问器类属性</h3><p>访问器类属性的特性为：</p><ul><li>  [[Configurable]]: 默认为true。表示能否通过delete删除属性，能否修改属性的特性。</li><li>  [[Enumerable]]: 默认为true。表示在用for-in迭代对象时，能否迭代出该属性。</li><li>  [[Get]]: 默认为undefined。读取属性时调用的函数。</li><li>  [[Set]]: 默认为undefined。写入属性时调用的函数。</li></ul><p>使用访问器类型的属性的常用方法是写入该属性时往往会导致其他属性也跟着变化。  </p><h3 id="1-3-对特性的操作方法："><a href="#1-3-对特性的操作方法：" class="headerlink" title="1.3 对特性的操作方法："></a>1.3 对特性的操作方法：</h3><p>Object.defineProperty(Object, propertyName, {attributes}): 设置属性的特性。 Object.defineProperties(Object, {propertyName: {attributes},}): 设置多个属性的特性。 Object.getOwnPropertyDescriptor(Object, propertyName);  </p><h2 id="创建对象的方法"><a href="#创建对象的方法" class="headerlink" title="创建对象的方法"></a>创建对象的方法</h2><h3 id="2-1-工厂模式"><a href="#2-1-工厂模式" class="headerlink" title="2.1 工厂模式"></a>2.1 工厂模式</h3><pre><code>function createPerson(name, age, job) &#123;    var o = new Object();    o.name = name;    o.age = age;    o.job = job;    o.sayName = function() &#123;        alert(this.name);    &#125;    return o;&#125;var sen = createPerson(&#39;sen&#39;, 19, &#39;programer&#39;);</code></pre><p>缺点：无法识别一个对象属于哪一个类</p><pre><code>alert(sen instanceof createPerson) // false</code></pre><h3 id="2-2-构造函数模式"><a href="#2-2-构造函数模式" class="headerlink" title="2.2 构造函数模式"></a>2.2 构造函数模式</h3><pre><code>function Person(name, age, job) &#123;    this.name = name;    this.age = age;    this.job = job;    this.sayName = function() &#123;        alert(this.name);    &#125;&#125;var sen = new Person(&quot;sen&quot;, 19, &quot;programer&quot;);alert(sen instanceof Person) // truealert(sen.constructor === Person) // true</code></pre><p>缺点：每个对象都会有独立的函数定义</p><pre><code>var sen1 = new Person(&quot;sen1&quot;, 19, &quot;player&quot;);alert(sen1.sayName == sen.sayName) // false</code></pre><h3 id="2-3-原型模式"><a href="#2-3-原型模式" class="headerlink" title="2.3 原型模式"></a>2.3 原型模式</h3><pre><code>function Person() &#123;&#125;Person.prototype.name = &quot;sen&quot;;Person.prototype.age = &quot;19&quot;;Person.prototype.job = &quot;programer&quot;;Person.prototype.sayName = fucntion() &#123;    alert(this.name);&#125;var sen = new Person();Person.prototype.constructor === Person // truePerson.prototype.isPrototypeOf(sen) // trueObject.getPrototypeOf(sen) === Person.prototype // truesen.hasOwnProperty(&quot;name&quot;) // false&quot;name&quot; in sen // true</code></pre><p>判断属性是不是在原型对象中：</p><pre><code>!sen.hasOwnProperty(&quot;name&quot;) &amp;&amp; (&quot;name&quot; in sen)</code></pre><p>原型模式更简洁的写法：</p><pre><code>function Person()&#123;&#125;;Person.prototype = &#123;    constructor = Person,    name: &quot;sen&quot;,    age: 19,    job: &quot;programer&quot;,    sayName: function() &#123;        alert(this.name);    &#125;&#125;Object.defineProperty(Person.prototype, &#123;    enumerable: false,    value: Person&#125;);</code></pre><p>缺点： 1. 省略了传递初始化参数 2. 如果原型中的属性为引用类型，则所有对象会共用这个引用类型</p><h3 id="2-4-组合使用构造模式和原型模式"><a href="#2-4-组合使用构造模式和原型模式" class="headerlink" title="2.4 组合使用构造模式和原型模式"></a>2.4 组合使用构造模式和原型模式</h3><pre><code>function Person(name, age, job) &#123;    this.name = name;    this.age = age;    this.job = job;&#125;Person.prototype.sayName = function() &#123;    alert(this.name)&#125;</code></pre><p>缺点： 构造函数和原型是独立的</p><h3 id="2-5-动态原型模式"><a href="#2-5-动态原型模式" class="headerlink" title="2.5 动态原型模式"></a>2.5 动态原型模式</h3><pre><code>function Person(name, age, job) &#123;    this.name = name;    this.age = age;    this.job = job;    if (typeof this.sayName !== &quot;function&quot;) &#123;        Person.prototype.sayName = function() &#123;            alert(this.name);        &#125;;    &#125;&#125;</code></pre><h3 id="2-6-寄生构造函数模式"><a href="#2-6-寄生构造函数模式" class="headerlink" title="2.6 寄生构造函数模式"></a>2.6 寄生构造函数模式</h3><pre><code>function Person(name, age, job) &#123;    var o = new Object();    o.name = name;    o.age = age;    o.job = job;    o.sayName = function() &#123;        alert(this.name);    &#125;    return o;&#125;var sen = new Person(&#39;sen&#39;, 19, &#39;programer&#39;);</code></pre><p>寄生构造函数模式一般用于创建特殊的引用类型。例如，创建一个包含toPipedString方法的数组类型。</p><pre><code>function SpecialArray() &#123;    var arr = new Array();    arr.push.apply(arr, arguments);    arr.toPipedString = function() &#123;        return this.join(&quot; | &quot;);    &#125;    return arr;&#125;var colors = new SpecialArray(&quot;red&quot;, &quot;black&quot;);alert(colors.toPipedString());</code></pre><p>缺点和工厂模式一样，都无法被instanceof识别</p><h3 id="2-7-稳妥构造函数模式"><a href="#2-7-稳妥构造函数模式" class="headerlink" title="2.7 稳妥构造函数模式"></a>2.7 稳妥构造函数模式</h3><p>与寄生构造函数类似，区别在于：</p><ul><li><p>  不使用this给类添加公共属性</p></li><li><p>创建对象时不使用new关键字</p><p>  function Person(name, age, job) {</p><pre><code>  var o = new Object();  o.sayName = function() &#123;      alert(name);  &#125;  return o;</code></pre><p>  }</p><p>  var sen = Person(‘sen’, 19, ‘programer’);</p></li></ul><p>缺点和工厂模式一样，都无法被instanceof识别</p><h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><h3 id="3-1-原型链"><a href="#3-1-原型链" class="headerlink" title="3.1 原型链"></a>3.1 原型链</h3><pre><code>function SuperType() &#123;    this.property = true;&#125;SuperType.prototype.getSuperValue = function() &#123;    return this.property;&#125;function SubType() &#123;    this.subProperty = false;&#125;SubType.prototype = new SuperType();SubType.prototype.getSubValue = function() &#123;    return this.subProperty;&#125;var obj = new SubType();alert(obj instanceof SubType) // truealert(obj instanceof SuperType) // truealert(obj instanceof Object) // true</code></pre><p>缺点：</p><ul><li>  SuperType中的属性如果为引用类型，所以的子类都会共用该属性</li><li>  创建子类时，如果给父类传递参数，会影响其他的子类</li></ul><h3 id="3-2-构造函数继承继承"><a href="#3-2-构造函数继承继承" class="headerlink" title="3.2 构造函数继承继承"></a>3.2 构造函数继承继承</h3><pre><code>function SuperType() &#123;    this.colors = [&#39;black&#39;, &#39;red&#39;];&#125;function SubType() &#123;    SuperType.call(this);&#125;</code></pre><p>缺点：函数无法复用</p><h3 id="3-3-组合继承"><a href="#3-3-组合继承" class="headerlink" title="3.3 组合继承"></a>3.3 组合继承</h3><pre><code>function SuperType(name) &#123;    this.name = name;    this.colors = [&#39;black&#39;, &#39;red&#39;];&#125;SuperType.prototype.sayName = function() &#123;    return this.name;&#125;function SubType(name) &#123;    SuperType.call(this, name);&#125;SubType.prototype = new SuperType();</code></pre><h3 id="3-4-原型式继承"><a href="#3-4-原型式继承" class="headerlink" title="3.4 原型式继承"></a>3.4 原型式继承</h3><pre><code>var person = &#123;    name: &quot;sen&quot;&#125;var newPerson = Object.create(person, &#123;name: &#123;    value: &quot;yang&quot;&#125;&#125;);</code></pre><p>缺点： 原型式继承仅仅是对父类做了一个浅拷贝，并加入了子类自己的属性。所以问题和原型链相同，父类中的引用类型属性会被所有子类共用。</p><h3 id="3-5-寄生式继承"><a href="#3-5-寄生式继承" class="headerlink" title="3.5 寄生式继承"></a>3.5 寄生式继承</h3><pre><code>function createAnother(obj) &#123;    var clone = Object.create(obj);        clone.sayHi = function() &#123;        alert(&#39;hi&#39;);    &#125;    return clone;&#125;</code></pre><p>缺点： 函数不能复用</p><h3 id="3-6-寄生组合式继承-常用"><a href="#3-6-寄生组合式继承-常用" class="headerlink" title="3.6 寄生组合式继承 (常用)"></a>3.6 寄生组合式继承 (常用)</h3><pre><code>function inheritPrototype(subType, superType) &#123;    var prototype = Object.create(superType.prototype);    prototype.constructor = subType;    subType.prototype = prototype;&#125;function SuperType(name) &#123;    this.name = name;    this.colors = [&#39;red&#39;, &#39;black&#39;];&#125;SuperType.prototype.sayName = function() &#123;    alert(this.name);&#125;function SubType(name) &#123;    SuperType.call(this, name);    this.age = age;&#125;inheritPrototype(SubType, SuperType);</code></pre>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript中的单体内置对象</title>
      <link href="/2018/05/29/Javascript%E4%B8%AD%E7%9A%84%E5%8D%95%E4%BD%93%E5%86%85%E7%BD%AE%E5%AF%B9%E8%B1%A1/"/>
      <url>/2018/05/29/Javascript%E4%B8%AD%E7%9A%84%E5%8D%95%E4%BD%93%E5%86%85%E7%BD%AE%E5%AF%B9%E8%B1%A1/</url>
      
        <content type="html"><![CDATA[<h3 id="Global"><a href="#Global" class="headerlink" title="Global"></a>Global</h3><ol><li> encodeURI() encodeURIComponent(): 用utf-8编码替换URI中的无效字符，区别在于encodeURI并不对属于URI的特殊字符进行编码，如:// #?等</li><li> eval(“var msg=’hello world’”); alert(msg);</li><li>Global对象的属性：<ul><li>  undefined</li><li>  NaN</li><li>  Infinity</li><li>  Object</li><li>  Array</li><li>  Function</li><li>  Boolean</li><li>  String</li><li>  Number</li><li>  Date</li><li>  RegExp</li><li>  Error</li><li>  EvalError</li><li>  RangeError</li><li>  ReferenceError</li><li>  SyntaxError</li><li>  TypeError</li><li>  URIError</li></ul></li><li> 可通过window对象来访问global对象的变量和函数</li><li> var global = function(){return this;}();</li></ol><h3 id="Math"><a href="#Math" class="headerlink" title="Math"></a>Math</h3><ul><li>Math对象的属性：<ul><li>  Math.E</li><li>  Math.LN10</li><li>  Math.LN2</li><li>  Math.LOG2E</li><li>  Math.LOG10E</li><li>  Math.PI</li><li>  Math.SQRT1_2</li><li>  Math.SQRT2</li></ul></li><li>  Math.min([1, 2, 3]) Math.max([1, 2, 3])</li><li>  Math.ceil()</li><li>  Math.floor()</li><li>  Math.round()</li><li>  Math.random():  [0-1)</li><li>  Math.abs()</li><li>  Math.exp()</li><li>  Math.log()</li><li>  Math.pow(num, power)</li><li>  Math.sqrt()</li><li>  Math.acos(x)</li><li>  Math.asin(x)</li><li>  Math.atan(x)</li><li>  Math.atan2(y, x)</li><li>  Math.cos(x)</li><li>  Math.sin(x)</li><li>  Math.tan(x)</li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript中的基本包装类型</title>
      <link href="/2018/05/29/Javascript%E4%B8%AD%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8C%85%E8%A3%85%E7%B1%BB%E5%9E%8B/"/>
      <url>/2018/05/29/Javascript%E4%B8%AD%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8C%85%E8%A3%85%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p>当读取一个基本类型(Boolean、String、Number)的值时，后台对创建一个对应的基本包装类型，从而让我们可以调用一些方法来操作这些数据。 基本包装类型与引用类型的区别：</p><ul><li>  生存期。自动创建的包装类型只存在于一行代码存在的瞬间。不能在运行时为基本类型添加属性和方法。</li></ul><h3 id="Number类型常用的方法"><a href="#Number类型常用的方法" class="headerlink" title="Number类型常用的方法"></a>Number类型常用的方法</h3><ul><li>  toString()</li><li>  toFixed(2) //小数点后两位</li><li>  toExponential()</li><li>  toPrecision(3)</li></ul><h3 id="String类型常用的属性和方法"><a href="#String类型常用的属性和方法" class="headerlink" title="String类型常用的属性和方法"></a>String类型常用的属性和方法</h3><ul><li>  length: 返回字符串的长度</li><li>  charAt(2) charCodeAt(2): 返回字符串中第三个字符/编码</li><li>  concat(“xxx”) 或者 + “xxx”: 字符串拼接</li><li>  slice(start, end) subString(start, end) subStr(start, number): 字符串切片 当start为负值时，slice和subStr会把它与字符串长度相加得到新的start;而subString则会将其转化为0 当end/number为负值时，slice会把它与字符串长度相加得到新的end，subStr和subString会将其转化为0</li><li>  indexOf(‘d’, start) 和lastIndexOf(‘d’, start): 从start位置开始向左(右)查找’d’在字符串中的位置</li><li>  trim(): 返回删除字符串左右的空格的新字符串</li><li>  trimLeft() trimRight(): 返回删除字符串左(右)的空格的新字符串</li><li>  toLowerCase() toLocaleLowerCase() toUpperCase() toLocaleUpperCase()</li><li>  match(pattern/RegExp): 返回的数组与RegExp.exec相同</li><li>  search(pattern/RegExp): 返回匹配到的位置</li><li>  replace(old, new): 如果old为字符串时，仅替换该字符串；如果Old是带’g’标志的pattern时，会替换所有匹配的字符串 new字符串中可以是下列特殊序列： $$: $ $&amp;: 等价于RegExp.lastMatch $’: RegExp.leftContext $`: RegExp.rightContext $n $nn: 第n个捕获组匹配到的字符串 new可以是一个函数：function(match, pos, orignialText){return string}</li><li>  var array = “string”.split(‘string/pattern’, number)</li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript中的函数</title>
      <link href="/2018/05/28/Javascript%E4%B8%AD%E7%9A%84%E5%87%BD%E6%95%B0/"/>
      <url>/2018/05/28/Javascript%E4%B8%AD%E7%9A%84%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h3 id="函数的定义"><a href="#函数的定义" class="headerlink" title="函数的定义"></a>函数的定义</h3><ol><li>  var foo = fucntion(a, b) {}; //函数表达式</li><li> function foo(a, b) {}; //函数声明</li><li> var foo = new Function(“a”, “b”, “return false”); //不推荐</li></ol><p>对于函数声明，可以在声明之前调用该函数；而对于函数表达式，不可以在表达式之前调用该函数。</p><h3 id="函数的属性"><a href="#函数的属性" class="headerlink" title="函数的属性"></a>函数的属性</h3><ul><li>  this: 引用的是函数执行的环境对象，全局作用域中的this引用的是window对象</li><li>  arguments: 保存函数参数的数组</li><li>  arguments.callee: 指向该函数的指针</li><li>  caller: 函数的调用者</li><li>  length: 函数希望接收到的命名参数的个数</li></ul><h3 id="函数的方法"><a href="#函数的方法" class="headerlink" title="函数的方法"></a>函数的方法</h3><ul><li>  call(obj, arg1, arg2…)  //设置函数的运行环境（改变this的值)</li><li>  apply(obj, [arg1, arg2]) //设置函数的运行环境（改变this的值)</li><li>  bind(obj) //绑定函数的运行环境</li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript中的正则表达式</title>
      <link href="/2018/05/23/Javascript%E4%B8%AD%E7%9A%84%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
      <url>/2018/05/23/Javascript%E4%B8%AD%E7%9A%84%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<ol><li>RegExp类型的创建 var expression = /pattern/flags; 或者 var expression = new RegExp(“pattern”, “flags”); </li></ol><ul><li>  g ：全局匹配</li><li>  i ：忽略大小写</li><li>  m ：多行模式</li></ul><ol start="2"><li>RegExp实例的属性</li></ol><ul><li>  global: true or false, 表示标志位’g’是否被设置</li><li>  ignoreCase: true or false</li><li>  multiline: true or false</li><li>  lastIndex: 下一次搜索开始的字符位置</li><li>  source: pattern的字符串表示</li></ul><ol start="3"><li>RegExp实例的方法</li></ol><ul><li>exec(“target_string”)<ul><li>  ret.index: 匹配到的字符串的起始位置</li><li>  ret.input: “target_string”</li><li>  ret[0]: 匹配到的字符串</li><li>  ret[1 - n]: 匹配组1-n匹配到的字符串</li></ul></li><li>test(“target_string”)<ul><li>  true: 匹配到字符串</li><li>  false: 没有匹配到字符串</li></ul></li><li>  exec和test只有在设置了’g’标志位的情况下才回去更新exp.lastIndex</li></ul><ol start="4"><li>RegExp 构造函数属性</li></ol><ul><li>  input ($_): 最近一次匹配成功的源字符串</li><li>  lastMatch($&amp;): 最近一次的匹配项</li><li>  lastParen($+): 最近一次匹配的捕获组</li><li>  leftContext($`): input字符串中匹配项之前的字符串</li><li>  rightContext($*): input字符串中匹配项之后的字符串</li><li>  $1-9: 第1-9个匹配组</li></ul><p>附录： 正则表达式元字符表</p><p>Metacharacter</p><p>Description</p><p><code>^</code></p><p>Matches the starting position within the string. In line-based tools, it matches the starting position of any line.</p><p><code>.</code></p><p>Matches any single character (many applications exclude <a href="https://en.wikipedia.org/wiki/Newline" title="Newline">newlines</a>, and exactly which characters are considered newlines is flavor-, character-encoding-, and platform-specific, but it is safe to assume that the line feed character is included). Within POSIX bracket expressions, the dot character matches a literal dot. For example, <code>a.c</code> matches “abc”, etc., but <code>[a.c]</code> matches only “a”, “.”, or “c”.</p><p><code>[ ]</code></p><p>A bracket expression. Matches a single character that is contained within the brackets. For example, <code>[abc]</code> matches “a”, “b”, or “c”. <code>[a-z]</code> specifies a range which matches any lowercase letter from “a” to “z”. These forms can be mixed: <code>[abcx-z]</code> matches “a”, “b”, “c”, “x”, “y”, or “z”, as does <code>[a-cx-z]</code>.The <code>-</code> character is treated as a literal character if it is the last or the first (after the <code>^</code>, if present) character within the brackets: <code>[abc-]</code>, <code>[-abc]</code>. Note that backslash escapes are not allowed. The <code>]</code> character can be included in a bracket expression if it is the first (after the <code>^</code>) character: <code>[]abc]</code>.</p><p><code>[^ ]</code></p><p>Matches a single character that is not contained within the brackets. For example, <code>[^abc]</code> matches any character other than “a”, “b”, or “c”. <code>[^a-z]</code> matches any single character that is not a lowercase letter from “a” to “z”. Likewise, literal characters and ranges can be mixed.</p><p><code>$</code></p><p>Matches the ending position of the string or the position just before a string-ending newline. In line-based tools, it matches the ending position of any line.</p><p><code>( )</code></p><p>Defines a marked subexpression. The string matched within the parentheses can be recalled later (see the next entry, <code>_n_</code>). A marked subexpression is also called a block or capturing group. <strong>BRE mode requires <code>\( \)</code></strong>.</p><p><code>_n_</code></p><p>Matches what the _n_th marked subexpression matched, where <em>n</em> is a digit from 1 to 9. This construct is vaguely defined in the POSIX.2 standard. Some tools allow referencing more than nine capturing groups.</p><p><code>*</code></p><p>Matches the preceding element zero or more times. For example, <code>ab*c</code> matches “ac”, “abc”, “abbbc”, etc. <code>[xyz]*</code> matches “”, “x”, “y”, “z”, “zx”, “zyx”, “xyzzy”, and so on. <code>(ab)*</code> matches “”, “ab”, “abab”, “ababab”, and so on.</p><p><code>&#123;_m_,_n_&#125;</code></p><p>Matches the preceding element at least <em>m</em> and not more than <em>n</em> times. For example, <code>a&#123;3,5&#125;</code> matches only “aaa”, “aaaa”, and “aaaaa”. This is not found in a few older instances of regexes. <strong>BRE mode requires <code>&#123;_m_,_n_&#125;</code></strong>.</p><p> </p><p>Metacharacter</p><p>Description</p><p><code>?</code></p><p>Matches the preceding element zero or one time. For example, <code>ab?c</code> matches only “ac” or “abc”.</p><p><code>+</code></p><p>Matches the preceding element one or more times. For example, <code>ab+c</code> matches “abc”, “abbc”, “abbbc”, and so on, but not “ac”.</p><p><code>|</code></p><p>The choice (also known as alternation or set union) operator matches either the expression before or the expression after the operator. For example, <code>abc|def</code> matches “abc” or “def”.</p><p> </p><p>POSIX</p><p>Non-standard</p><p>Perl/Tcl</p><p>Vim</p><p>Java</p><p>ASCII</p><p>Description</p><p><code>[:ascii:]</code><a href="https://en.wikipedia.org/wiki/Regular_expression#cite_note-char-classes-emacs-list-2016-30">[30]</a></p><p><code>\p&#123;ASCII&#125;</code></p><p><code>[\x00-\x7F]</code></p><p>ASCII characters</p><p><code>[:alnum:]</code></p><p><code>\p&#123;Alnum&#125;</code></p><p><code>[A-Za-z0-9]</code></p><p>Alphanumeric characters</p><p><code>[:word:]</code>[<em><a href="https://en.wikipedia.org/wiki/Wikipedia:Citation_needed" title="Wikipedia:Citation needed">citation needed</a></em>]</p><p><code>\w</code></p><p><code>\w</code></p><p><code>\w</code></p><p><code>[A-Za-z0-9_]</code></p><p>Alphanumeric characters plus “_”</p><p><code>\W</code></p><p><code>\W</code></p><p><code>\W</code></p><p><code>[^A-Za-z0-9_]</code></p><p>Non-word characters</p><p><code>[:alpha:]</code></p><p><code>\a</code></p><p><code>\p&#123;Alpha&#125;</code></p><p><code>[A-Za-z]</code></p><p>Alphabetic characters</p><p><code>[:blank:]</code></p><p><code>\s</code></p><p><code>\p&#123;Blank&#125;</code></p><p><code>[ [[\t]]]</code></p><p>Space and tab</p><p><code>\b</code></p><p><code>\&lt; \&gt;</code></p><p><code>\b</code></p><p><code>(?&lt;=\W)(?=\w)|(?&lt;=\w)(?=\W)</code></p><p>Word boundaries</p><p><code>\B</code></p><p><code>(?&lt;=\W)(?=\W)|(?&lt;=\w)(?=\w)</code></p><p>Non-word boundaries</p><p><code>[:cntrl:]</code></p><p><code>\p&#123;Cntrl&#125;</code></p><p><code>[\x00-\x1F\x7F]</code></p><p><a href="https://en.wikipedia.org/wiki/Control_character" title="Control character">Control characters</a></p><p><code>[:digit:]</code></p><p><code>\d</code></p><p><code>\d</code></p><p><code>\p&#123;Digit&#125;</code> or <code>\d</code></p><p><code>[0-9]</code></p><p>Digits</p><p><code>\D</code></p><p><code>\D</code></p><p><code>\D</code></p><p><code>[^0-9]</code></p><p>Non-digits</p><p><code>[:graph:]</code></p><p><code>\p&#123;Graph&#125;</code></p><p><code>[\x21-\x7E]</code></p><p>Visible characters</p><p><code>[:lower:]</code></p><p><code>\l</code></p><p><code>\p&#123;Lower&#125;</code></p><p><code>[a-z]</code></p><p>Lowercase letters</p><p><code>[:print:]</code></p><p><code>\p</code></p><p><code>\p&#123;Print&#125;</code></p><p><code>[\x20-\x7E]</code></p><p>Visible characters and the space character</p><p><code>[:punct:]</code></p><p><code>\p&#123;Punct&#125;</code></p><p><code>[][!&quot;#$%&amp;&#39;()*+,./:;&lt;=&gt;?@\^_`&#123;|&#125;~-]</code></p><p>Punctuation characters</p><p><code>[:space:]</code></p><p><code>\s</code></p><p><code>\_s</code></p><p><code>\p&#123;Space&#125;</code> or <code>\s</code></p><p><code>[ [\t](https://en.wikipedia.org/wiki/%5Ct &quot;\t&quot;)[\r](https://en.wikipedia.org/wiki/%5Cr &quot;\r&quot;)[\n](https://en.wikipedia.org/wiki/%5Cn &quot;\n&quot;)[\v](https://en.wikipedia.org/wiki/%5Cv &quot;\v&quot;)[\f](https://en.wikipedia.org/wiki/%5Cf &quot;\f&quot;)]</code></p><p><a href="https://en.wikipedia.org/wiki/Whitespace_character" title="Whitespace character">Whitespace characters</a></p><p><code>\S</code></p><p><code>\S</code></p><p><code>\S</code></p><p><code>[^ \t\r\n\v\f]</code></p><p>Non-whitespace characters</p><p><code>[:upper:]</code></p><p><code>\u</code></p><p><code>\p&#123;Upper&#125;</code></p><p><code>[A-Z]</code></p><p>Uppercase letters</p><p><code>[:xdigit:]</code></p><p><code>\x</code></p><p><code>\p&#123;XDigit&#125;</code></p><p><code>[A-Fa-f0-9]</code></p><p>Hexadecimal digits</p><p> </p><p>常用分组语法</p><p>分类</p><p>代码/语法</p><p>说明</p><p>捕获</p><p>(exp)</p><p>匹配exp,并捕获文本到自动命名的组里</p><p>(?<name>exp)</p><p>匹配exp,并捕获文本到名称为name的组里，也可以写成(?’name’exp)</p><p>(?:exp)</p><p>匹配exp,不捕获匹配的文本，也不给此分组分配组号</p><p>零宽断言</p><p>(?=exp)</p><p>匹配exp前面的位置</p><p>(?&lt;=exp)</p><p>匹配exp后面的位置</p><p>(?!exp)</p><p>匹配后面跟的不是exp的位置</p><p>(?&lt;!exp)</p><p>匹配前面不是exp的位置</p><p>注释</p><p>(?#comment)</p><p>这种类型的分组不对正则表达式的处理产生任何影响，用于提供注释让人阅读</p><p> </p><p>常用的反义代码</p><p>代码/语法</p><p>说明</p><p>\W</p><p>匹配任意不是字母，数字，下划线，汉字的字符</p><p>\S</p><p>匹配任意不是空白符的字符</p><p>\D</p><p>匹配任意非数字的字符</p><p>\B</p><p>匹配不是单词开头或结束的位置</p><p>[^x]</p><p>匹配除了x以外的任意字符</p><p>[^aeiou]</p><p>匹配除了aeiou这几个字母以外的任意字符</p>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> regexp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript中的Date</title>
      <link href="/2018/05/17/Javascript%E4%B8%AD%E7%9A%84Date/"/>
      <url>/2018/05/17/Javascript%E4%B8%AD%E7%9A%84Date/</url>
      
        <content type="html"><![CDATA[<ol><li>Date类型的创建</li></ol><ul><li>  var date = new Date() //获取当前时间</li><li>  var date = new Date(ms) //根据Unix时间戳来创建Date对象</li><li>var date = new Date(Date.parse(“string”)) //string为日期时间组成的字符串，符合要求的字符串格式包括：<ul><li>  “m/d/y”</li><li>  “January 12, 2004”</li><li>  “Tue May 25 2004 00:00:00 GMT-0700”</li><li>  YYYY-MM-DDTHH:mm:ss.sssZ”</li></ul></li><li>  var date = new Date(Date.UTC()) // Date.UTC的参数为年、月、日、小时、分钟、秒、毫秒</li></ul><ol start="2"><li>Date类型的操作 var date = new Date();</li></ol><ul><li>  Date.now() 或者+new Date()获取当前的时间戳, “+”操作符可获取Date对象的时间戳</li><li>  date.toDateString(); // “Thu May 17 2018”</li><li>  date.toTimeString(); // “14:37:29 GMT+0800 (CST)”</li><li>  date.toLocaleDateString(); // “2018/5/17”</li><li>  date.toLocaleTimeString(); // “下午2:37:29”</li><li>  date.toUTCString(); // “Thu, 17 May 2018 06:37:29 GMT”</li><li>  date.toLocaleString(); // “2018/5/17 下午2:37:29”</li><li>  date.getTime(); // 1526539049298</li><li>  +date; // 1526539049298</li><li>  date.setTime(1526539049300);</li><li>  date.getFullYear(); // 2018</li><li>  date.getUTCFullYear(); // 2018</li><li>  date.getMonth(); // 0-11</li><li>  date.getUTCMonth(); // 0-11</li><li>  date.getDate(); //1-31</li><li>  date.getUTCDate(); // 1-31</li><li>  date.getDay(); // 0-6 0表示周日</li><li>  date.getUTCDay(); // 0-6 0表示周日</li><li>  date.getHours(); // 0-23</li><li>  date.getUTCHours(); // 0-23</li><li>  date.getMinutes(); // 0-59</li><li>  date.getUTCMinutes(); // 0-59</li><li>  date.getSeconds(); // 0-59</li><li>  date.getUTCSeconds(); // 0-59</li><li>  date.getMilliseconds(); // 0-999</li><li>  date.getUTCMilliseconds(); // 0-999</li><li>  date.getTimezoneOffset(); // -480</li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[转]A Complete Guide to Flexbox</title>
      <link href="/2018/02/12/ACompleteGuidetoFlexbox/"/>
      <url>/2018/02/12/ACompleteGuidetoFlexbox/</url>
      
        <content type="html"><![CDATA[<h1 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h1><p>The <code>Flexbox Layout</code> (Flexible Box) module (currently a W3C Last Call Working Draft) aims at providing a more efficient way to lay out, align and distribute space among items in a container, even when their size is unknown and/or dynamic (thus the word “flex”). The main idea behind the flex layout is to give the container the ability to alter its items’ width/height (and order) to best fill the available space (mostly to accommodate to all kind of display devices and screen sizes). A flex container expands items to fill available free space, or shrinks them to prevent overflow. Most importantly, the flexbox layout is direction-agnostic as opposed to the regular layouts (block which is vertically-based and inline which is horizontally-based). While those work well for pages, they lack flexibility (no pun intended) to support large or complex applications (especially when it comes to orientation changing, resizing, stretching, shrinking, etc.). <strong>Note:</strong> Flexbox layout is most appropriate to the components of an application, and small-scale layouts, while the <a href="http://css-tricks.com/snippets/css/complete-guide-grid/">Grid</a> layout is intended for larger scale layouts.</p><h1 id="Basics-and-Terminology"><a href="#Basics-and-Terminology" class="headerlink" title="Basics and Terminology"></a>Basics and Terminology</h1><p><img src="https://css-tricks.com/wp-content/uploads/2014/05/flex-container.svg"><img src="https://css-tricks.com/wp-content/uploads/2014/05/flex-items.svg"></p><h2 id="Properties-for-the-Parent"><a href="#Properties-for-the-Parent" class="headerlink" title="Properties for the Parent"></a>Properties for the Parent</h2><h4 id="display"><a href="#display" class="headerlink" title="display"></a>display</h4><p>This defines a flex container; inline or block depending on the given value. It enables a flex context for all its direct children.</p><pre><code>.container &#123;  display: flex; /* or inline-flex */&#125;</code></pre><p>Note that CSS columns have no effect on a flex container.</p><h4 id="flex-direction"><a href="#flex-direction" class="headerlink" title="#flex-direction"></a><a href="https://css-tricks.com/snippets/css/a-guide-to-flexbox/#article-header-id-3">#</a>flex-direction</h4><p><img src="https://css-tricks.com/wp-content/uploads/2013/04/flex-direction2.svg"> This establishes the main-axis, thus defining the direction flex items are placed in the flex container. Flexbox is (aside from optional wrapping) a single-direction layout concept. Think of flex items as primarily laying out either in horizontal rows or vertical columns.</p><pre><code>.container &#123;  flex-direction: row | row-reverse | column | column-reverse;&#125;</code></pre><ul><li>  <code>row</code> (default): left to right in <code>ltr</code>; right to left in <code>rtl</code></li><li>  <code>row-reverse</code>: right to left in <code>ltr</code>; left to right in <code>rtl</code></li><li>  <code>column</code>: same as <code>row</code> but top to bottom</li><li>  <code>column-reverse</code>: same as <code>row-reverse</code> but bottom to top</li></ul><h4 id="flex-wrap"><a href="#flex-wrap" class="headerlink" title="#flex-wrap"></a><a href="https://css-tricks.com/snippets/css/a-guide-to-flexbox/#article-header-id-4">#</a>flex-wrap</h4><p><img src="https://css-tricks.com/wp-content/uploads/2014/05/flex-wrap.svg"> By default, flex items will all try to fit onto one line. You can change that and allow the items to wrap as needed with this property.</p><pre><code>.container&#123;  flex-wrap: nowrap | wrap | wrap-reverse;&#125;</code></pre><ul><li>  <code>nowrap</code> (default): all flex items will be on one line</li><li>  <code>wrap</code>: flex items will wrap onto multiple lines, from top to bottom.</li><li>  <code>wrap-reverse</code>: flex items will wrap onto multiple lines from bottom to top.</li></ul><p>There are some <a href="https://css-tricks.com/almanac/properties/f/flex-wrap/">visual demos of <code>flex-wrap</code> here</a>.</p><h4 id="flex-flow-Applies-to-parent-flex-container-element"><a href="#flex-flow-Applies-to-parent-flex-container-element" class="headerlink" title="#flex-flow (Applies to: parent flex container element)"></a><a href="https://css-tricks.com/snippets/css/a-guide-to-flexbox/#article-header-id-5">#</a>flex-flow (Applies to: parent flex container element)</h4><p>This is a shorthand <code>flex-direction</code> and <code>flex-wrap</code> properties, which together define the flex container’s main and cross axes. Default is <code>row nowrap</code>.</p><pre><code>flex-flow: &lt;‘flex-direction’&gt; || &lt;‘flex-wrap’&gt;</code></pre><h4 id="justify-content"><a href="#justify-content" class="headerlink" title="#justify-content"></a><a href="https://css-tricks.com/snippets/css/a-guide-to-flexbox/#article-header-id-6">#</a>justify-content</h4><p><img src="https://cdn.css-tricks.com/wp-content/uploads/2013/04/justify-content-2.svg"> This defines the alignment along the main axis. It helps distribute extra free space left over when either all the flex items on a line are inflexible, or are flexible but have reached their maximum size. It also exerts some control over the alignment of items when they overflow the line.</p><pre><code>.container &#123;  justify-content: flex-start | flex-end | center | space-between | space-around | space-evenly;&#125;</code></pre><ul><li>  <code>flex-start</code> (default): items are packed toward the start line</li><li>  <code>flex-end</code>: items are packed toward to end line</li><li>  <code>center</code>: items are centered along the line</li><li>  <code>space-between</code>: items are evenly distributed in the line; first item is on the start line, last item on the end line</li><li>  <code>space-around</code>: items are evenly distributed in the line with equal space around them. Note that visually the spaces aren’t equal, since all the items have equal space on both sides. The first item will have one unit of space against the container edge, but two units of space between the next item because that next item has its own spacing that applies.</li><li>  <code>space-evenly</code>: items are distributed so that the spacing between any two items (and the space to the edges) is equal.</li></ul><h4 id="align-items"><a href="#align-items" class="headerlink" title="#align-items"></a><a href="https://css-tricks.com/snippets/css/a-guide-to-flexbox/#article-header-id-7">#</a>align-items</h4><p><img src="https://cdn.css-tricks.com/wp-content/uploads/2014/05/align-items.svg"> This defines the default behaviour for how flex items are laid out along the cross axis on the current line. Think of it as the <code>justify-content</code> version for the cross-axis (perpendicular to the main-axis).</p><pre><code>.container &#123;  align-items: flex-start | flex-end | center | baseline | stretch;&#125;</code></pre><ul><li>  <code>flex-start</code>: cross-start margin edge of the items is placed on the cross-start line</li><li>  <code>flex-end</code>: cross-end margin edge of the items is placed on the cross-end line</li><li>  <code>center</code>: items are centered in the cross-axis</li><li>  <code>baseline</code>: items are aligned such as their baselines align</li><li>  <code>stretch</code> (default): stretch to fill the container (still respect min-width/max-width)</li></ul><h4 id="align-content"><a href="#align-content" class="headerlink" title="#align-content"></a><a href="https://css-tricks.com/snippets/css/a-guide-to-flexbox/#article-header-id-8">#</a>align-content</h4><p><img src="https://css-tricks.com/wp-content/uploads/2013/04/align-content.svg"> This aligns a flex container’s lines within when there is extra space in the cross-axis, similar to how <code>justify-content</code> aligns individual items within the main-axis. <strong>Note:</strong> this property has no effect when there is only one line of flex items.</p><pre><code>.container &#123;  align-content: flex-start | flex-end | center | space-between | space-around | stretch;&#125;</code></pre><ul><li>  <code>flex-start</code>: lines packed to the start of the container</li><li>  <code>flex-end</code>: lines packed to the end of the container</li><li>  <code>center</code>: lines packed to the center of the container</li><li>  <code>space-between</code>: lines evenly distributed; the first line is at the start of the container while the last one is at the end</li><li>  <code>space-around</code>: lines evenly distributed with equal space around each line</li><li>  <code>stretch</code> (default): lines stretch to take up the remaining space</li></ul><h2 id="Properties-for-the-Children"><a href="#Properties-for-the-Children" class="headerlink" title="Properties for the Children"></a>Properties for the Children</h2><h4 id="order"><a href="#order" class="headerlink" title="order"></a>order</h4><p><img src="https://css-tricks.com/wp-content/uploads/2013/04/order-2.svg"> By default, flex items are laid out in the source order. However, the <code>order</code> property controls the order in which they appear in the flex container.</p><pre><code>.item &#123;  order: &lt;integer&gt;; /* default is 0 */&#125;</code></pre><h4 id="flex-grow"><a href="#flex-grow" class="headerlink" title="#flex-grow"></a><a href="https://css-tricks.com/snippets/css/a-guide-to-flexbox/#article-header-id-10">#</a>flex-grow</h4><p><img src="https://css-tricks.com/wp-content/uploads/2014/05/flex-grow.svg"> This defines the ability for a flex item to grow if necessary. It accepts a unitless value that serves as a proportion. It dictates what amount of the available space inside the flex container the item should take up. If all items have <code>flex-grow</code> set to 1, the remaining space in the container will be distributed equally to all children. If one of the children has a value of 2, the remaining space would take up twice as much space as the others (or it will try to, at least).</p><pre><code>.item &#123;  flex-grow: &lt;number&gt;; /* default 0 */&#125;</code></pre><p>Negative numbers are invalid.</p><h4 id="flex-shrink"><a href="#flex-shrink" class="headerlink" title="#flex-shrink"></a><a href="https://css-tricks.com/snippets/css/a-guide-to-flexbox/#article-header-id-11">#</a>flex-shrink</h4><p>This defines the ability for a flex item to shrink if necessary.</p><pre><code>.item &#123;  flex-shrink: &lt;number&gt;; /* default 1 */&#125;</code></pre><p>Negative numbers are invalid.</p><h4 id="flex-basis"><a href="#flex-basis" class="headerlink" title="#flex-basis"></a><a href="https://css-tricks.com/snippets/css/a-guide-to-flexbox/#article-header-id-12">#</a>flex-basis</h4><p>This defines the default size of an element before the remaining space is distributed. It can be a length (e.g. 20%, 5rem, etc.) or a keyword. The <code>auto</code> keyword means “look at my width or height property” (which was temporarily done by the <code>main-size</code> keyword until deprecated). The <code>content</code> keyword means “size it based on the item’s content” - this keyword isn’t well supported yet, so it’s hard to test and harder to know what its brethren <code>max-content</code>, <code>min-content</code>, and <code>fit-content</code> do.</p><pre><code>.item &#123;  flex-basis: &lt;length&gt; | auto; /* default auto */&#125;</code></pre><p>If set to <code>0</code>, the extra space around content isn’t factored in. If set to <code>auto</code>, the extra space is distributed based on its <code>flex-grow</code> value. <a href="http://www.w3.org/TR/css3-flexbox/images/rel-vs-abs-flex.svg">See this graphic.</a></p><h4 id="flex"><a href="#flex" class="headerlink" title="#flex"></a><a href="https://css-tricks.com/snippets/css/a-guide-to-flexbox/#article-header-id-13">#</a>flex</h4><p>This is the shorthand for <code>flex-grow,``flex-shrink</code> and <code>flex-basis</code> combined. The second and third parameters (<code>flex-shrink</code> and <code>flex-basis</code>) are optional. Default is <code>0 1 auto</code>.</p><pre><code>.item &#123;  flex: none | [ &lt;&#39;flex-grow&#39;&gt; &lt;&#39;flex-shrink&#39;&gt;? || &lt;&#39;flex-basis&#39;&gt; ]&#125;</code></pre><p><strong>It is recommended that you use this shorthand property</strong> rather than set the individual properties. The short hand sets the other values intelligently.</p><h4 id="align-self"><a href="#align-self" class="headerlink" title="#align-self"></a><a href="https://css-tricks.com/snippets/css/a-guide-to-flexbox/#article-header-id-14">#</a>align-self</h4><p><img src="https://css-tricks.com/wp-content/uploads/2014/05/align-self.svg"> This allows the default alignment (or the one specified by <code>align-items</code>) to be overridden for individual flex items. Please see the <code>align-items</code> explanation to understand the available values.</p><pre><code>.item &#123;  align-self: auto | flex-start | flex-end | center | baseline | stretch;&#125;</code></pre><p>Note that <code>float</code>, <code>clear</code> and <code>vertical-align</code> have no effect on a flex item.</p><h1 id="Browser-Support"><a href="#Browser-Support" class="headerlink" title="Browser Support"></a>Browser Support</h1><p>Broken up by “version” of flexbox:</p><ul><li>  (new) means the recent syntax from the specification (e.g. <code>display: flex;</code>)</li><li>  (tweener) means an odd unofficial syntax from 2011 (e.g. <code>display: flexbox;</code>)</li><li>  (old) means the old syntax from 2009 (e.g. <code>display: box;</code>)</li></ul><p>Chrome</p><p>Safari</p><p>Firefox</p><p>Opera</p><p>IE</p><p>Android</p><p>iOS</p><p>20- (old) 21+ (new)</p><p>3.1+ (old) 6.1+ (new)</p><p>2-21 (old) 22+ (new)</p><p>12.1+ (new)</p><p>10 (tweener) 11+ (new)</p><p>2.1+ (old) 4.4+ (new)</p><p>3.2+ (old) 7.1+ (new)</p><p>Blackberry browser 10+ supports the new syntax. For more informations about how to mix syntaxes in order to get the best browser support, please refer to <a href="https://css-tricks.com/using-flexbox/">this article (CSS-Tricks)</a> or <a href="http://dev.opera.com/articles/view/advanced-cross-browser-flexbox/#fallbacks">this article (DevOpera)</a>.</p><p><a href="https://css-tricks.com/snippets/css/a-guide-to-flexbox/">阅读原文</a></p>]]></content>
      
      
      <categories>
          
          <category> 应用开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css </tag>
            
            <tag> flex </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>操作系统级虚拟化概述</title>
      <link href="/2018/01/05/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%BA%A7%E8%99%9A%E6%8B%9F%E5%8C%96%E6%A6%82%E8%BF%B0/"/>
      <url>/2018/01/05/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%BA%A7%E8%99%9A%E6%8B%9F%E5%8C%96%E6%A6%82%E8%BF%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="操作系统级虚拟化"><a href="#操作系统级虚拟化" class="headerlink" title="操作系统级虚拟化"></a>操作系统级虚拟化</h1><p>KVM、XEN等虚拟化技术允许各个虚拟机拥有自己独立的操作系统。与KVM、XEN等虚拟化技术不同，所谓操作系统级虚拟化，也被称作容器化，是操作系统自身的一个特性，它允许多个相互隔离的用户空间实例的存在。这些用户空间实例也被称作为容器。普通的进程可以看到计算机的所有资源而容器中的进程只能看到分配给该容器的资源。通俗来讲，操作系统级虚拟化将操作系统所管理的计算机资源，包括进程、文件、设备、网络等分组，然后交给不同的容器使用。容器中运行的进程只能看到分配给该容器的资源。从而达到隔离与虚拟化的目的。 实现操作系统虚拟化需要用到Namespace及cgroups技术。</p><h1 id="命名空间-Namespace"><a href="#命名空间-Namespace" class="headerlink" title="命名空间(Namespace)"></a>命名空间(Namespace)</h1><p>在编程语言中，引入命名空间的概念是为了重用变量名或者服务例程名。在不同的命名空间中使用同一个变量名而不会产生冲突。Linux系统引入命名空间也有类似的作用。例如，在没有操作系统级虚拟化的Linux系统中，用户态进程从1开始编号(PID)。引入操作系统虚拟化之后，不同容器有着不同的PID命名空间，每个容器中的进程都可以从1开始编号而不产生冲突。 目前，Linux中的命名空间有6种类型，分别对应操作系统管理的6种资源：</p><ul><li>  挂载点(mount point) CLONE_NEWNS</li><li>  进程(pid) CLONE_NEWPID</li><li>  网络(net) CLONE_NEWNET</li><li>  进程间通信(ipc) CLONE_NEWIPC</li><li>  主机名(uts) CLONE_NEWUTS</li><li>  用户(uid) CLONW_NEWUSER</li></ul><p>将来还会引入时间、设备等对应的namespace. Linux 2.4.19版本引入了第一个命名空间——挂载点，因为那时还没有其他类型的命名空间，所以clone系统调用中引入的flag就叫做CLONE_NEWNS</p><h2 id="与命名空间相关的三个系统调用-system-calls"><a href="#与命名空间相关的三个系统调用-system-calls" class="headerlink" title="与命名空间相关的三个系统调用(system calls)"></a>与命名空间相关的三个系统调用(system calls)</h2><p>下面3个系统调用用来操作命名空间：</p><ul><li>  clone() —— 用来创建新的进程及新的命名空间，新的进程会被放到新的命名空间中</li><li>  unshare() —— 创建新的命名空间但并不创建新的子进程，之后创建的子进程会被放到新创建的命名空间中去</li><li>  setns() —— 将进程加入到已经存在的命名空间中</li></ul><p>注意：这３个系统调用都不会改变调用进程(calling process)的pid命名空间，而是会影响其子进程的pid命名空间 命名空间本身并没用名字(囧)，不同的命名空间用不同的inode号来标识，这也符合Linux用文件一统天下的惯例。可以在proc文件系统中查看一个进程所属的命名空间，例如，查看PID为4123的进程所属的命名空间：</p><pre><code>kelvin@desktop:~$ ls -l /proc/4123/ns/总用量 0lrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 cgroup -&gt; cgroup:[4026531835]lrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 ipc -&gt; ipc:[4026531839]lrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 mnt -&gt; mnt:[4026531840]lrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 net -&gt; net:[4026531963]lrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 pid -&gt; pid:[4026531836]lrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 user -&gt; user:[4026531837]lrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 uts -&gt; uts:[4026531838]</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="Click and drag to move"></p><p>下面的代码演示了如何利用上述3个系统调用来操作进程的命名空间：</p><pre><code>#define _GNU_SOURCE#include &lt;sys/types.h&gt;#include &lt;sys/wait.h&gt;#include &lt;sched.h&gt;#include &lt;signal.h&gt;#include &lt;unistd.h&gt;#include &lt;stdio.h&gt;#include &lt;string.h&gt;#include &lt;stdlib.h&gt;#include &lt;errno.h&gt;#include &lt;sys/types.h&gt;#include &lt;sys/stat.h&gt;#include &lt;fcntl.h&gt;#define STACK_SIZE (10 * 1024 * 1024)char child_stack[STACK_SIZE];int child_main(void* args) &#123;    pid_t child_pid = getpid();    printf(&quot;I&#39;m child process and my pid is %d \n&quot;, child_pid);    // 子进程会被放到clone系统调用新创建的pid命名空间中, 所以其pid应该为1    sleep(300);    // 命名空间中的所有进程退出后该命名空间的inode将会被删除, 为后续操作保留它    return 0;&#125;int main() &#123;    /* Clone */    pid_t child_pid = clone(child_main, child_stack + STACK_SIZE, \        CLONE_NEWPID | SIGCHLD, NULL);    if(child_pid &lt; 0) &#123;        perror(&quot;clone failed&quot;);    &#125;    /* Unshare */    int ret = unshare(CLONE_NEWPID); // 父进程调用unshare, 创建了一个新的命名空间,    //但不会创建子进程. 之后再创建的子进程将会被加入到新的命名空间中    if (ret &lt; 0) &#123;        perror(&quot;unshare failed&quot;);    &#125;    int fpid = fork();    if (fpid &lt; 0) &#123;        perror(&quot;fork error&quot;);    &#125; else if (fpid == 0) &#123;        printf(&quot;I am child process. My pid is %d  \n&quot;, getpid());        // Fork后的子进程会被加入到unshare创建的命名空间中, 所以pid应该为1        exit(0);    &#125; else &#123;    &#125;    waitpid(fpid, NULL, 0);    /* Setns */    char path[80] = &quot;&quot;;    sprintf(path, &quot;/proc/%d/ns/pid&quot;, child_pid);    int fd = open(path, O_RDONLY);    if (fd == -1)        perror(&quot;open error&quot;);    if (setns(fd, 0) == -1)    // setns并不会改变当前进程的命名空间, 而是会设置之后创建的子进程的命名空间        perror(&quot;setns error&quot;);    close(fd);    int npid = fork();    if (npid &lt; 0) &#123;        perror(&quot;fork error&quot;);    &#125; else if (npid == 0) &#123;        printf(&quot;I am child process. My pid is %d  \n&quot;, getpid());        // 新的子进程会被加入到第一个子进程的pid命名空间中, 所以其pid应该为2        exit(0);    &#125; else &#123;    &#125;    return 0;&#125;</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="Click and drag to move"></p><p>运行结果：</p><pre><code>$ sudo ./nsI&#39;m child process and my pid is 1 I am child process. My pid is 1  I am child process. My pid is 2 </code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="Click and drag to move"></p><h1 id="控制组-Cgroups"><a href="#控制组-Cgroups" class="headerlink" title="控制组(Cgroups)"></a>控制组(Cgroups)</h1><p>如果说命名空间是从命名和编号的角度进行隔离，而控制组则是将进程进行分组，并真正的将各组进程的计算资源进行限制、隔离。控制组是一种内核机制，它可以对进程进行分组、跟踪限制其使用的计算资源。对于每一类计算资源，控制组通过所谓的子系统(subsystem)来进行控制，现阶段已有的子系统包括：</p><ul><li>  cpusets: 用来分配一组CPU给指定的cgroup，该cgroup中的进程只能被调度到该组CPU上去执行</li><li>  blkio : 限制cgroup的块IO</li><li>  cpuacct : 用来统计cgroup中的CPU使用</li><li>  devices : 用来黑白名单的方式控制cgroup可以创建和使用的设备节点</li><li>  freezer : 用来挂起指定的cgroup，或者唤醒挂起的cgroup</li><li>  hugetlb : 用来限制cgroup中hugetlb的使用</li><li>  memory : 用来跟踪限制内存及交换分区的使用</li><li>  net_cls : 用来根据发送端的cgroup来标记数据包，流量控制器(traffic controller)会根据这些标记来分配优先级</li><li>  net_prio : 用来设置cgroup的网络通信优先级</li><li>  cpu :用来设置cgroup中CPU的调度参数</li><li>  perf_event : 用来监控cgroup的CPU性能</li></ul><p>与命名空间不同，控制组并没有增加系统调用，而是实现了一个文件系统，通过文件及目录操作来管理控制组。下面通过一个例子来看一看cgroup是如何利用cpuset子系统来把进程绑定到指定的CPU上去执行的。 1. 创建一个一直执行的shell脚本</p><pre><code>#!/bin/bashx=0while [ True ];do    :done;</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="Click and drag to move"></p><p>2. 在后台执行这个脚本</p><pre><code># bash run.sh &amp;[1] 20553</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="Click and drag to move"></p><p>3. 查看该脚本在哪个CPU上运行</p><pre><code># ps -eLo ruser,lwp,psr,args | grep 20553 | grep -v greproot     20553   3 bash run.sh</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="Click and drag to move"></p><p>可以看到PID为20553的进程运行在编号为3的CPU上，下面利用cgroups将其绑定到编号为2的CPU上去执行 4. 挂载cgroups类型的文件系统到一个新创建的目录cgroups中</p><pre><code># mkdir cgroups# mount -t cgroup -o cpuset cgroups ./cgroups/# ls cgroups/cgroup.clone_children   cpuset.memory_pressure_enabledcgroup.procs            cpuset.memory_spread_pagecgroup.sane_behavior    cpuset.memory_spread_slabcpuset.cpu_exclusive    cpuset.memscpuset.cpus             cpuset.sched_load_balancecpuset.effective_cpus   cpuset.sched_relax_domain_levelcpuset.effective_mems   dockercpuset.mem_exclusive    taskscpuset.mem_hardwall     notify_on_releasecpuset.memory_migrate   release_agentcpuset.memory_pressure</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="Click and drag to move"></p><p>5. 创建一个新的组group0</p><pre><code># mkdir group0# ls group0/cgroup.clone_children  cpuset.mem_exclusive       cpuset.memscgroup.procs           cpuset.mem_hardwall        cpuset.sched_load_balancecpuset.cpu_exclusive   cpuset.memory_migrate      cpuset.sched_relax_domain_levelcpuset.cpus            cpuset.memory_pressure     notify_on_releasecpuset.effective_cpus  cpuset.memory_spread_page  taskscpuset.effective_mems  cpuset.memory_spread_slab</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="Click and drag to move"></p><p>6. 将上面的进程20553加入到新建的控制组中：</p><pre><code># echo 20553 &gt;&gt; group0/tasks # cat group0/tasks 20553</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="Click and drag to move"></p><p>7. 限制该组的进程只能运行在编号为2的CPU上</p><pre><code># echo 2 &gt; group0/cpuset.cpus# cat group0/cpuset.cpus2</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="Click and drag to move"></p><p>8. 查看PID为20553的进程所运行的CPU编号</p><pre><code># ps -eLo ruser,lwp,psr,args | grep 20553 | grep -v greproot     20553   2 bash run.sh</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="Click and drag to move"></p><p>上面的例子简单的展示了如何使用控制组。控制组通过文件和目录来操作，文件系统又是树形结构，因此如果不对cgroups的使用做一些限制的话，配置会变得异常复杂和混乱。因此，在新版的cgroups中做了一些限制。</p><h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>本文简要介绍了操作系统虚拟化的概念，以及实现操作系统虚拟化的技术——命名空间及控制组。并通过两个简单的例子演示了命名空间及控制组的使用方法。</p>]]></content>
      
      
      <categories>
          
          <category> 云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 云原生 </tag>
            
            <tag> cgroups </tag>
            
            <tag> namespace </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript中的数组</title>
      <link href="/2017/11/16/Javascript%E4%B8%AD%E7%9A%84%E6%95%B0%E7%BB%84/"/>
      <url>/2017/11/16/Javascript%E4%B8%AD%E7%9A%84%E6%95%B0%E7%BB%84/</url>
      
        <content type="html"><![CDATA[<ul><li>数组的定义：<ul><li>  var colors = new Array(20);</li><li>  var colors = new Array(‘red’);  // [‘red’]</li><li>  var colors = [‘red’, ‘green’];</li></ul></li><li>判断变量是不是数组：<ul><li>  colors instanceof Array;  //true</li><li>  Array.isArray(colors); //true</li></ul></li><li>将数组转化为字符串：<ul><li>  colors.toString(); // ‘red,green’</li><li>  colors.join(‘ ‘); //‘red green’</li><li>colors = [ “red”, undefined, “green”, null, “yellow” ];<br>colors.toString(); //“red,,green,,yellow”<br>colors.join(‘ ‘); //“red  green  yellow”<br>colors.join(‘;’); //“red;;green;;yellow”</li></ul></li><li>栈方法<ul><li>  colors.push(‘yellow’); //[‘red’, ‘green’, ‘yellow’]</li><li>  colors.pop(); //[‘red’, ‘green’]</li></ul></li><li>队列方法<ul><li>  colors.push(‘yellow’); //[‘red’, ‘green’, ‘yellow’]</li><li>  colors.shift(); //[‘green’, ‘yellow’]</li><li>  colors.unshift(‘black’); //[‘black’, ‘red’, ‘green’]</li></ul></li><li>重新排序<ul><li>  colors.reverse(); //[‘green’, ‘red’]</li><li>colors.sort();<ul><li>按字符串升序排列<ul><li>  var nums = [1, 5, 10]; //nums.sort();//[1, 10, 5]</li></ul></li><li>  colors.sort(function(a,b){return a - b;});升序排列</li><li>  colors.sort(function(a,b){return b - a;});降序排列</li></ul></li></ul></li><li>操作<ul><li>  var ret = colors.concat(‘black’); // ret = [‘red’, ‘green’, ‘black’]</li><li>  var ret = colors.slice(0, 1); //[‘red’] 切片</li><li>  colors.splice(pos, length, item, item…); 在pos处删除length项，然后插入item…</li></ul></li><li>位置<ul><li>  indexOf(‘red’); //0</li><li>  lastIndexOf(‘red’); //0</li></ul></li><li>迭代<ul><li>  colors.every(function(item, index, array){}); 所有元素返回true则返回true</li><li>  colors.filter(function(item, index, array){}); 返回为true的元素组成的数组</li><li>  colors.forEach(function(item, index, array){}); 无返回值</li><li>  colors.map(function(item, index, array){}); 返回函数调用结果组成的数组</li><li>  colors.some(function(item, index, array){}); 如果有一项返回true则返回true</li></ul></li><li>归并方法<ul><li>  var sum = values.reduce(function(prev, cur, index, array){return prev + cur}, 0);</li><li>  reduceRight(); 从后往前循环</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript中的基本数据类型</title>
      <link href="/2017/11/15/Javascript%E4%B8%AD%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"/>
      <url>/2017/11/15/Javascript%E4%B8%AD%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="Undefined"><a href="#Undefined" class="headerlink" title="Undefined"></a>Undefined</h1><ul><li>  在var或者let中声明了变量但没有赋值时，这个变量的值就是undefined.</li><li>  使用typeof关键字检测未声明变量的类型为undefined.</li></ul><h1 id="Null"><a href="#Null" class="headerlink" title="Null"></a>Null</h1><ul><li>  null表示一个空对象指针，所以用typeof检测null时，会返回object</li><li>  undefine派生自null, null == undefined 为true, null === undefined为false</li></ul><h1 id="Boolean"><a href="#Boolean" class="headerlink" title="Boolean"></a>Boolean</h1><ul><li>  true false 区分大小写</li><li>  空字符串、0和NaN、null、undefined转换为boolean的值为false</li></ul><h1 id="Number"><a href="#Number" class="headerlink" title="Number"></a>Number</h1><ul><li>  Number表示整数和浮点数</li><li>  八进制数以0开头，十六进制数以0x开头</li><li>  Number.MIN_VALUE 表示Javascript支持的正的最小数值，Number.MAX_VALUE表示Javascript支持的最大数值</li><li>  超出最大数值就会被转化为Infinity，如果为负值则会被转化为-Infinity</li><li>  isFinite()函数可以判断一个数值是否在支持的范围之内</li><li>  NaN表示本来该返回数值的操作数未返回数值的情况，如除以0就会返回NaN</li><li>  NaN的数值运算会返回NaN</li><li>  NaN == NaN 为false</li><li>  isNaN()函数可以判断一个数值是不是NaN</li><li>Number()函数可以将其他类型的值转换为Number类型：<ul><li>  Number(true) = 1; Number(false) = 0;</li><li>  Number(null) = 0;</li><li>  Number(“”) = 0; Number(“0x1a”) = 26; Number(‘076’) = 76;</li><li>  Number(‘100hello’) = NaN;</li><li>  如果是对象，则会调用对象的valueOf()方法，如果返回的是NaN则会先调用toString方法转化为字符串，然后根据字符串的转换规则来转换</li></ul></li><li>parseInt()函数：<ul><li>  parseInt(‘100hello’) = 100;</li><li>  parseInt(‘’) = NaN;</li><li>  parseInt(‘0x1a’) = 26;</li><li>  parseInt(‘076’) = 76; parseInt(‘076’, 8) = 62;</li></ul></li><li>parseFloat()与parseInt()类似，但有如下区别：<ul><li>  parseFloat不能传入第二个参数（进制），不能解析十六进制字符串</li></ul></li></ul><h1 id="String"><a href="#String" class="headerlink" title="String"></a>String</h1><ul><li>  字符串一旦创建，其值不能改变，如：var lang = ‘Java’; lang += ‘Script’; 会重新创建一个字符串，填充上’JavaScript’, ‘Java’和’Script’都将被销毁</li><li>  除了null和undefined之外，其他的几个数据类型都有toString()方法，可以将其转换为字符串</li><li>  数值类型调用toString()方法可以传入进制作为参数，如：var a=20; a.toString(2);</li><li>  String()方法可以将null转化为’null’，把undefined转化为’undefined’</li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>React 概要</title>
      <link href="/2017/09/12/React%E6%A6%82%E8%A6%81/"/>
      <url>/2017/09/12/React%E6%A6%82%E8%A6%81/</url>
      
        <content type="html"><![CDATA[<h1 id="React-简介"><a href="#React-简介" class="headerlink" title="React 简介"></a>React 简介</h1><p>React 是一个开源的javascript库，用来构建用户接口(UI)。下图是React的一些基本信息：</p><h1 id="React-的特点"><a href="#React-的特点" class="headerlink" title="React 的特点"></a>React 的特点</h1><ol><li>单向数据流<ul><li>数据自上而下<ul><li>  Props 不可变</li><li>  States可变</li><li>  任何数据、函数都可以作为属性(props)传    递给子组件(Props,　States,　Handlers,　Styles)</li></ul></li><li>事件冒泡<ul><li>  子组件触发的事件会传递到父组件</li></ul></li></ul></li><li>虚拟DOM<ul><li>  Javascript内存中的DOM数据缓存</li><li>  组件发生变化时渲染虚拟DOM</li><li>  React将虚拟DOM与DOM的差异转化为一系列的DOM操作</li><li>  将这些操作同步应用到真实的DOM中</li></ul></li><li>JSX<ul><li>  可以使用HTML语法创建Javascript 对象</li><li>  代码更少</li><li>会被转化为Javascript执行<ul><li>  Offline - react-tools</li><li>  In-Browser - JSXTransformer</li></ul></li><li>  不改变Javascript语义</li></ul></li><li>其他特点<ul><li>  元素嵌套: 每个组件只允许有一个顶层元素(div, table …)</li><li>  自定义属性: 除了HTML标签自带属性之外，React也支持自定义属性，自定义属性需要加上data- 前缀</li><li>  JavaScript表达式: 可以通过{}在JSX中使用Javascript表达式</li><li>  三目运算符: JSX中不能使用if-else但可以使用三目运算</li></ul></li></ol><h1 id="React元素"><a href="#React元素" class="headerlink" title="React元素"></a>React元素</h1><pre><code>const element = &lt;h1&gt;Hello, world&lt;/h1&gt;;</code></pre><ul><li>  React 元素 != DOM 元素</li><li>将元素渲染到 DOM 中    ReactDOM.render(element, document.getElementById(‘root’));     </li><li>  更新元素 - 重新 Render</li><li>  更新元素只会更新变化的部分</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tick</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> element = (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, world!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">h2</span>&gt;</span>It is &#123;new Date().toLocaleTimeString()&#125;.<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">    element,</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">setInterval</span>(tick, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><h1 id="React组件"><a href="#React组件" class="headerlink" title="React组件"></a>React组件</h1><p>组件可以将UI切分成一些的独立的、可复用的部件，这样你就只需专注于构建每一个单独的部件。</p><ul><li>如何定义一个组件<ul><li>  函数</li></ul></li></ul><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title">Welcome</span>(props) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">&lt;h1&gt;Hello,</span> &#123;props.name&#125;&lt;/h1&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>*   class</code></pre> <figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Welcome</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">        render() &#123;</span><br><span class="line">        <span class="keyword">return</span> &lt;h1&gt;<span class="type">Hello</span>, &#123;<span class="keyword">this</span>.props.name&#125;&lt;/h1&gt;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">```        </span><br><span class="line">*   渲染组件</span><br><span class="line">    *   `const element = &lt;<span class="type">Welcome</span> name=<span class="string">&quot;Sara&quot;</span> /&gt;;`</span><br><span class="line">*   组合组件</span><br></pre></td></tr></table></figure><p>function App() {<br>    return (<br>    <div><br>        <Welcome name="Sara" /><br>        <Welcome name="Cahal" /><br>        <Welcome name="Edite" /><br>    </div><br>    );<br>}</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="section">状态与生命周期</span></span><br><span class="line"><span class="section">=======</span></span><br><span class="line"></span><br><span class="line">因为react中props为只读，如果需要更新数据，可以使用react中的状态。在使用状态之前，需要把组件函数转变为类。</span><br><span class="line"></span><br><span class="line"><span class="bullet">*   </span>创建一个名称扩展为 React.Component 的ES6 类</span><br><span class="line"><span class="bullet">*   </span>创建一个叫做render()的空方法</span><br><span class="line"><span class="bullet">*   </span>将函数体移动到 render() 方法中</span><br><span class="line"><span class="bullet">*   </span>在 render() 方法中，使用 this.props 替换 props</span><br><span class="line"><span class="bullet">*   </span>删除剩余的空函数声明</span><br><span class="line"></span><br><span class="line">将组件函数转化为类之后就可以添加状态了：</span><br><span class="line"></span><br><span class="line"><span class="bullet">*   </span>在 render() 方法中使用 this.state.date 替代 this.props.date</span><br><span class="line"><span class="bullet">*   </span>添加一个类构造函数来初始化状态 this.state</span><br><span class="line"><span class="bullet">*   </span>使用 this.setState() 来更新组件局部状</span><br></pre></td></tr></table></figure><p>class Clock extends React.Component {<br>    constructor(props) {<br>    super(props);<br>    this.state = {date: new Date()};<br>    }<br>    componentDidMount() {<br>    this.timerID = setInterval(<br>        () =&gt; this.tick(),<br>        1000<br>    );<br>    }<br>    componentWillUnmount() {<br>    clearInterval(this.timerID);<br>    }<br>    tick() {<br>    this.setState({<br>        date: new Date()<br>    });<br>    }<br>    render() {<br>    return (<br>        <div><br>        <h1>Hello, world!</h1><br>        <h2>It is {this.state.date.toLocaleTimeString()}.</h2><br>        </div><br>    );<br>    }<br>}<br>ReactDOM.render(<br>    <Clock />,<br>    document.getElementById(‘root’)<br>);</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">事件处理</span></span><br><span class="line"><span class="section">====</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">*   </span>React事件绑定属性的命名采用驼峰式写法，而不是小写。</span><br><span class="line"><span class="bullet">*   </span>如果采用 JSX 的语法你需要传入一个函数作为事件处理函数，而不是一个字符串(DOM元素的写法)</span><br><span class="line"><span class="bullet">*   </span>React不能使用返回 false 的方式阻止默认行为</span><br><span class="line"></span><br><span class="line"><span class="section">条件渲染</span></span><br><span class="line"><span class="section">====</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">*   </span>使用 JavaScript 操作符 if 或条件运算符来创建表示当前状态的元素,然后让 React 根据它们来更新 UI</span><br><span class="line"><span class="bullet">*   </span>使用变量来储存元素</span><br></pre></td></tr></table></figure><pre><code>function Greeting(props) &#123;    const isLoggedIn = props.isLoggedIn;    if (isLoggedIn) &#123;    return &lt;UserGreeting /&gt;;    &#125;    return &lt;GuestGreeting /&gt;;&#125;ReactDOM.render(    // Try changing to isLoggedIn=&#123;true&#125;:    &lt;Greeting isLoggedIn=&#123;false&#125; /&gt;,    document.getElementById(&#39;root&#39;));</code></pre><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">*   &amp;&amp;运算符</span><br><span class="line"> ```<span class="javascript">   </span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">Mailbox</span>(<span class="params">props</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> unreadMessages = props.unreadMessages;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> (</span></span><br><span class="line"><span class="javascript">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span></span><br><span class="line"><span class="xml"><span class="javascript">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span></span><br><span class="line"><span class="xml"><span class="javascript">            &#123;unreadMessages.length &gt; 0 &amp;&amp;</span></span></span><br><span class="line"><span class="xml"><span class="javascript">            <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span></span></span><br><span class="line"><span class="xml"><span class="javascript">                You have &#123;unreadMessages.length&#125; unread messages.</span></span></span><br><span class="line"><span class="xml"><span class="javascript">            <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span></span><br><span class="line"><span class="xml"><span class="javascript">            &#125;</span></span></span><br><span class="line"><span class="xml"><span class="javascript">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span><br><span class="line"><span class="javascript">        );</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br></pre></td></tr></table></figure><ul><li>三目运算符<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">    render() &#123;</span></span><br><span class="line"><span class="code">        const isLoggedIn = this.state.isLoggedIn;</span></span><br><span class="line"><span class="code">        return (</span></span><br><span class="line"><span class="code">        &lt;div&gt;</span></span><br><span class="line"><span class="code">            The user is &lt;b&gt;&#123;isLoggedIn ? &#x27;currently&#x27; : &#x27;not&#x27;&#125;&lt;/b&gt; logged in.</span></span><br><span class="line"><span class="code">        &lt;/div&gt;</span></span><br><span class="line"><span class="code">        );</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code"> ```   </span></span><br><span class="line"><span class="section">列表渲染</span></span><br><span class="line"><span class="section">====</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">*   </span>React 可以直接渲染列表</span><br><span class="line"><span class="bullet">*   </span>Keys可以在DOM中的某些元素被增加或删除的时候帮助React识别哪些元素发生了变化。因此应当给数组中的每一个元素赋予一个确定的标识。</span><br><span class="line"><span class="bullet">*   </span>元素的key只有在它和它的兄弟节点对比时才有意义</span><br><span class="line"><span class="bullet">*   </span>jsx中可以使用map</span><br></pre></td></tr></table></figure>  function ListItem(props) {<br>    return <li>{props.value}</li>;<br>  }<br>  function NumberList(props) {<pre><code>const numbers = props.numbers;const listItems = numbers.map((number) =&gt;  &lt;ListItem key=&#123;number.toString()&#125;            value=&#123;number&#125; /&gt;);return (  &lt;ul&gt;    &#123;listItems&#125;  &lt;/ul&gt;);</code></pre>  }<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">表单</span></span><br><span class="line"><span class="section">==</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">*   </span>HTML表单元素与React中的其他DOM元素有所不同,因为表单元素生来就保留一些内部状态</span><br><span class="line"><span class="bullet">*   </span>在HTML当中，像<span class="code">`&lt;input&gt;`</span>,<span class="code">`&lt;textarea&gt;`</span>, 和 <span class="code">`&lt;select&gt;`</span>这类表单元素会维持自身状态，并根据用户输入进行更新</span><br><span class="line"><span class="bullet">*   </span>在React中，可变的状态通常保存在组件的状态属性中，并且只能用 setState(). 方法进行更新</span><br></pre></td></tr></table></figure>  class Reservation extends React.Component {<pre><code>constructor(props) &#123;  super(props);  this.state = &#123;    isGoing: true,    numberOfGuests: 2  &#125;;  this.handleInputChange = this.handleInputChange.bind(this);&#125;handleInputChange(event) &#123;  const target = event.target;  const value = target.type === &#39;checkbox&#39; ? target.checked : target.value;  const name = target.name;  this.setState(&#123;    [name]: value  &#125;);&#125;render() &#123;  return (    &lt;form&gt;      &lt;label&gt;        Is going:        &lt;input          name=&quot;isGoing&quot;          type=&quot;checkbox&quot;          checked=&#123;this.state.isGoing&#125;          onChange=&#123;this.handleInputChange&#125; /&gt;      &lt;/label&gt;      &lt;br /&gt;      &lt;label&gt;        Number of guests:        &lt;input          name=&quot;numberOfGuests&quot;          type=&quot;number&quot;          value=&#123;this.state.numberOfGuests&#125;          onChange=&#123;this.handleInputChange&#125; /&gt;      &lt;/label&gt;    &lt;/form&gt;  );&#125;</code></pre>  }<br>```</li></ul>]]></content>
      
      
      <categories>
          
          <category> 应用开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> react </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[转]Linux Mint启用VNC</title>
      <link href="/2017/09/05/LinuxMint%E5%90%AF%E7%94%A8VNC/"/>
      <url>/2017/09/05/LinuxMint%E5%90%AF%E7%94%A8VNC/</url>
      
        <content type="html"><![CDATA[<p>This tutorial was adapted from <a href="https://help.ubuntu.com/community/VNC/Servers">here.</a></p><p><strong>1. Remove the default Vino server:</strong></p><p>sudo apt-get -y remove vino</p><p><strong>2. Install x11vnc:</strong></p><p>sudo apt-get -y install x11vnc</p><p><strong>3. Create the directory for the password file:</strong></p><p>sudo mkdir /etc/x11vnc</p><p><strong>4. Create the encrypted password file:</strong></p><p>sudo x11vnc –storepasswd /etc/x11vnc/vncpwd</p><p>You will be asked to enter and verify the password.  Then press Y to save the password file.</p><p><strong>5. Create the systemd service file for the x11vnc service:</strong></p><p>sudo xed /lib/systemd/system/x11vnc.service</p><p>Copy/Paste this code into the empty file:</p><p>[Unit]<br>Description=Start x11vnc at startup.<br>After=multi-user.target</p><p>[Service]<br>Type=simple<br>ExecStart=/usr/bin/x11vnc -auth guess -forever -noxdamage -repeat -rfbauth /etc/x11vnc/vncpwd -rfbport 5900 -shared</p><p>[Install]<br>WantedBy=multi-user.target  </p><p><strong>6: Reload the services:</strong></p><p>sudo systemctl daemon-reload</p><p><strong>7. Enable the x11vnc service at boot time:</strong></p><p>sudo systemctl enable x11vnc.service</p><p><strong>8. Start the service:</strong></p><p>Either reboot or</p><p>sudo systemctl start x11vnc.service</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> vnc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS概要</title>
      <link href="/2017/07/05/CSS%E6%A6%82%E8%A6%81/"/>
      <url>/2017/07/05/CSS%E6%A6%82%E8%A6%81/</url>
      
        <content type="html"><![CDATA[<h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><p>CSS全称为“层叠样式表 (Cascading Style Sheets)”，它主要是用于定义HTML内容在浏览器内的显示样式， 如文字大小、颜色、字体加粗等。使用CSS样式的一个好处是通过定义某个样式，可以让不同网页位置的 文字有着统一的字体、字号或者颜色等。</p><p>CSS语法<br>    选择符 { 属性:值}</p><ul><li>  选择符:又称选择器，指明网页中要应用样式规则的元素，如本例中是网页中所有的段(p)的文字将变 成蓝色，而其他的元素(如ol)不会受到影响。</li><li>  声明:在英文大括号“{}”中的的就是声明，属性和值之间用英文冒号“:”分隔。当有多条声明时，中间 可以英文分号“;”分隔</li></ul><ol><li> 最后一条声明可以没有分号，但是为了以后修改方便，一般也加上分号</li><li> CSS注释 - /<em>注释语句</em>/</li><li> CSS的某些样式是具有继承性的。</li><li> 为了使用样式更加容易阅读，可以将每条代码写在一个新行内</li></ol><h4 id="插入方式"><a href="#插入方式" class="headerlink" title="插入方式"></a>插入方式</h4><p>CSS样式可以写在哪些地方呢?从CSS 样式代码插入的形式来看基本可以分为以下3种:内联式、嵌入式和<br>外部式三种。</p><ol><li> 内联式:把css代码用style属性直接写在现有的HTML标签中。如: <code>&lt;p style=&quot;color:red&quot;&gt;这里文字是红色。&lt;/p&gt;</code></li><li> 嵌入式:把css样式代码写在<code>&lt;style type=“text/css”&gt;&lt;/style&gt;</code>标签之间。并且一般情况下嵌入式css样式 写在<code>&lt;head&gt;&lt;/head&gt;</code>之间。如:<code>&lt;style type=&quot;text/css&quot;&gt; span&#123; color:red; &#125; &lt;/style&gt;</code></li><li> 外部式:把css代码写一个单独的外部文件中，这个css样式文件以“.css”为扩展名，在<code>&lt;head&gt;</code>内(不是在<code>&lt;style&gt;</code>标签内)使用<code>&lt;link&gt;</code>标签将css样式文件链接到HTML文件内。如: <code>&lt;link href=&quot;base.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;</code></li></ol><p>优先级:内联式 &gt; 嵌入式 &gt; 外部式 ?</p><p>离被设置元素越近优先级别越高</p><h4 id="权值、层叠、重要性"><a href="#权值、层叠、重要性" class="headerlink" title="权值、层叠、重要性"></a>权值、层叠、重要性</h4><p>标签的权值为1，类选择符的权值为10，ID选择符的权值最高为100</p><ul><li>  <code>p&#123;color:red;&#125;</code> /<em>权值为1</em>/</li><li>  <code>p span&#123;color:green;&#125;</code> /<em>权值为1+1=2</em>/</li><li>  <code>.warning&#123;color:white;&#125; </code>/<em>权值为10</em>/</li><li>  <code>p span.warning&#123;color:purple;&#125;</code> /<em>权值为1+1+10=12</em>/</li><li>  <code>#footer .note p&#123;color:yellow;&#125;</code> /<em>权值为100+10+1=111</em>/</li></ul><p>层叠就是在html文件中对于同一个元素可以有多个css样式存在，当有相同权重的样式存在时，会根据这些 css样式的前后顺序来决定，处于最后面的css样式会被应用。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span>&#123;<span class="attribute">color</span>:red;&#125;  </span><br><span class="line"><span class="selector-tag">p</span>&#123;<span class="attribute">color</span>:green;&#125;  </span><br><span class="line">&lt;<span class="selector-tag">p</span> class=&quot;first&quot;&gt;hello world&lt;/<span class="selector-tag">p</span>&gt;</span><br></pre></td></tr></table></figure><p>!important语句可以把样式改变为最高权值</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span>&#123;<span class="attribute">color</span>:red <span class="meta">!important</span>;&#125; <span class="selector-tag">p</span>&#123;<span class="attribute">color</span>:green;&#125;  </span><br><span class="line">&lt;<span class="selector-tag">p</span> class=&quot;first&quot;&gt;hello world&lt;/<span class="selector-tag">p</span>&gt;</span><br></pre></td></tr></table></figure><h4 id="单位和值"><a href="#单位和值" class="headerlink" title="单位和值"></a>单位和值</h4><p>颜色值</p><ol><li> 英文命令颜色。 如: <code>p&#123;color:red;&#125;</code></li><li> RGB颜色 <code>p&#123;color:rgb(133,45,200);&#125; </code></li><li> 3.十六进制颜色 <code>p&#123;color:#00ffff;&#125;</code></li></ol><p>长度值</p><ol><li> 像素。 如: <code>p&#123;font-size: 20px&#125;</code></li><li> em。1 em = 父元素的font-size 如: <code>p&#123;font-size:14px&#125; span&#123;font-size:0.8em;&#125; &lt;p&gt;以这个&lt;span&gt;例子&lt;/span&gt;为例。&lt;/p&gt;</code></li><li> 百分比<code> p&#123;font-size:12px;line-height:130%&#125;</code></li></ol><h4 id="CSS-选择器"><a href="#CSS-选择器" class="headerlink" title="CSS 选择器"></a>CSS 选择器</h4><p>在{}之前的部分就是“选择器”，“选择器”指明了{}中的“样式”的作用对象，也就是“样式”作用于网页中的哪些元素。</p><ul><li>标签选择器 - 标签选择器其实就是html代码中的标签。</li><li>类选择器  .setGreen {<br>      color:green;<br>  }  &lt;span class=”setGreen”&gt;胆小如鼠</span></li><li>ID选择器  #setGreen {<br>       color:green;<br>  }</li><li>子选择器 - 即大于符号(&gt;),用于选择指定标签元素的<strong>第一代</strong>子元素  .food&gt;li{border:1px solid red;}</li><li>包含选择器 - 即加入空格,用于选择指定标签元素下的后辈元素</li><li>通用选择器 - 它使用一个(*)号指定，它的作用是匹配html中所有标签元素</li><li>伪类选择符 - 它允许给html不存在的标签(标签的某种状态)设置样式，如:<code>a:hover&#123;color:red;&#125;</code></li><li>分组选择符 - html中多个标签元素设置同一个样式时，可以使用分组选择符  h1,span{color:red;}</li></ul><h4 id="CSS-排版"><a href="#CSS-排版" class="headerlink" title="CSS 排版"></a>CSS 排版</h4><ol><li>设置字体: <code>font-family:&quot;宋体”</code></li><li>设置字号、颜色:<code>font-size:12px;color:#666</code></li><li>设置文字的样式:粗体、斜体、下划线、删除线:<ul><li><code>font-weight:bold</code></li><li><code>font-style:italic</code></li><li><code>text-decoration:underline;</code></li><li><code>text-decoration:line-through;</code></li></ul></li><li>设置文字缩进:<code>text-indent:2em;</code></li><li>设置行高:<code>line-height:2em;</code></li><li>设置字符间距、单词间距:<ul><li><code>letter-spacing:50px;</code></li><li><code>word-spacing:50px;</code></li></ul></li><li>设置对齐方式:<ul><li><code>text-align:left;</code></li><li><code>text-align:center;</code></li><li><code> text-align:right;</code></li></ul></li></ol><h4 id="CSS-布局模型"><a href="#CSS-布局模型" class="headerlink" title="CSS 布局模型"></a>CSS 布局模型</h4><p>元素分类 在CSS中，html中的标签元素大体被分为三种不同的类型:块状元素、内联元素(又叫行内元素)和内联块状元素。</p><p>常用的块状元素(display: block)有: <code>&lt;div&gt;、&lt;p&gt;、&lt;h1&gt;...&lt;h6&gt;、&lt;ol&gt;、&lt;ul&gt;、&lt;dl&gt;、&lt;table&gt;、&lt;address&gt;、&lt;blockquote&gt; 、&lt;form&gt;</code></p><ul><li>  每个块级元素都从新的一行开始，并且其后的元素也另起一行。</li><li>  元素的高度、宽度、行高以及顶和底边距都可设置。</li><li>  元素宽度在不设置的情况下，是它本身父容器的100%(和父元素的宽度一致)，除非设定一个宽度。</li></ul><p>常用的内联元素(display: inline)有: <code>&lt;a&gt;、&lt;span&gt;、&lt;br&gt;、&lt;i&gt;、&lt;em&gt;、&lt;strong&gt;、&lt;label&gt;、&lt;q&gt;、&lt;var&gt;、&lt;cite&gt;、&lt;code&gt;</code></p><ul><li>  和其他元素都在一行上;</li><li>  元素的高度、宽度及顶部和底部边距不可设置;</li><li>  元素的宽度就是它包含的文字或图片的宽度，不可改变。</li></ul><p>常用的内联块状元素(display: inline-block)有: <code>&lt;img&gt;、&lt;input&gt;</code></p><ul><li>  和其他元素都在一行上;</li><li>  元素的高度、宽度、行高以及顶和底边距都可设置。</li></ul><h4 id="流动模型-flow"><a href="#流动模型-flow" class="headerlink" title="流动模型 flow"></a>流动模型 flow</h4><p>流动模型，流动(Flow)是默认的网页布局模式。也就是说网页在默认状态下的 HTML 网页元素都是根据流动模型来分布网页内容的。 流动布局模型具有2个比较典型的特征:</p><ul><li>  块状元素都会在所处的包含元素内自上而下按顺序垂直延伸分布，因为在默认状态下，块状元素的 宽度都为100%。实际上，块状元素都会以行的形式占据位置。</li><li>  在流动模型下，内联元素都会在所处的包含元素内从左到右水平分布显示。</li></ul><h4 id="浮动模型-float"><a href="#浮动模型-float" class="headerlink" title="浮动模型 float"></a>浮动模型 float</h4><p>浮动模型，浮动(Float)如果想让两个块状元素并排显示，需要用到浮动模型。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;  </span><br><span class="line">    <span class="attribute">width</span>:<span class="number">200px</span>;  </span><br><span class="line">    <span class="attribute">height</span>:<span class="number">200px</span>;  </span><br><span class="line">    <span class="attribute">border</span>:<span class="number">2px</span> red solid;  </span><br><span class="line">    <span class="attribute">float</span><span class="selector-pseudo">:left</span>;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;<span class="selector-tag">div</span> id=&quot;div1&quot;&gt; &lt;/<span class="selector-tag">div</span>&gt;  </span><br><span class="line">&lt;<span class="selector-tag">div</span> id=&quot;div2&quot;&gt; &lt;/<span class="selector-tag">div</span>&gt;</span><br></pre></td></tr></table></figure><h4 id="层模型"><a href="#层模型" class="headerlink" title="层模型"></a>层模型</h4><p>什么是层布局模型?层布局模型就像是图像软件PhotoShop中非常流行的图层编辑功能一样，每个图层能够 精确定位操作，但在网页设计领域，由于网页大小的活动性，层布局没能受到热捧。但是在网页上局部使用 层布局还是有其方便之处的</p><p>层模型有三种形式:</p><ol><li>绝对定位(position: absolute)</li><li>相对定位(position: relative)</li><li>固定定位(position: fixed)</li></ol><p>如果想为元素设置层模型中的<strong>绝对定位</strong>，需要设置<code>position:absolute</code>(表示绝对定位)，这条语句的作用将元素从文档流中拖出来，然后使用left、right、top、bottom属性相对于其最接近的一个具有定位属性的父包含块 进行绝对定位。如果不存在这样的包含块，则相对于body元素，即相对于浏览器窗口。</p><p>如果想为元素设置层模型中的<strong>相对定位</strong>，需要设置<code>position:relative</code>(表示相对定位)，它通过left、right、top、 bottom属性确定元素在正常文档流中的偏移位置。相对定位完成的过程是首先按static(float)方式生成一个元 素(并且元素像层一样浮动了起来)，然后相对于以前的位置移动，移动的方向和幅度由left、right、top、 bottom属性确定，偏移前的位置保留不动。</p><p>fixed:表示<strong>固定定位</strong>，与absolute定位类型类似，但它的相对移动的坐标是视图(屏幕内的网页窗口)本身。 由于视图本身是固定的，它不会随浏览器窗口的滚动条滚动而变化，除非你在屏幕中移动浏览器窗口的屏幕 位置，或改变浏览器窗口的显示大小，因此固定定位的元素会始终位于浏览器窗口内视图的某个位置，不会 受文档流动影响</p><h4 id="弹性盒布局"><a href="#弹性盒布局" class="headerlink" title="弹性盒布局"></a>弹性盒布局</h4><p>详细介绍请参考：<a href="https://www.ibm.com/developerworks/cn/web/1409_chengfu_css3flexbox/">https://www.ibm.com/developerworks/cn/web/1409_chengfu_css3flexbox/</a></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.flex-container</span> &#123;</span><br><span class="line"><span class="attribute">list-style</span>: none;</span><br><span class="line"><span class="attribute">display</span>: flex;</span><br><span class="line"><span class="attribute">flex-direction</span>: row;</span><br><span class="line"><span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;<span class="selector-tag">ul</span> class=&quot;<span class="attribute">flex</span>-container&quot;&gt;</span><br><span class="line">&lt;<span class="selector-tag">li</span> class=&quot;<span class="attribute">flex</span>-item&quot;&gt;&lt;imgsrc=&quot;//placehold<span class="selector-class">.it</span>/<span class="number">300</span>&amp;text=<span class="number">1</span>&quot;&gt;&lt;/<span class="selector-tag">li</span>&gt;</span><br><span class="line">&lt;<span class="selector-tag">li</span> class=&quot;<span class="attribute">flex</span>-item&quot;&gt;&lt;<span class="selector-tag">img</span> <span class="attribute">src</span>=&quot;//placehold<span class="selector-class">.it</span>/<span class="number">300</span>&amp;text=<span class="number">2</span>&quot;&gt;&lt;/<span class="selector-tag">li</span>&gt;</span><br><span class="line">&lt;<span class="selector-tag">li</span> class=&quot;<span class="attribute">flex</span>-item&quot;&gt;&lt;<span class="selector-tag">img</span> <span class="attribute">src</span>=&quot;//placehold<span class="selector-class">.it</span>/<span class="number">300</span>&amp;text=<span class="number">3</span>&quot;&gt;&lt;/<span class="selector-tag">li</span>&gt;</span><br><span class="line">&lt;<span class="selector-tag">li</span> class=&quot;<span class="attribute">flex</span>-item&quot;&gt;&lt;<span class="selector-tag">img</span> <span class="attribute">src</span>=&quot;//placehold<span class="selector-class">.it</span>/<span class="number">300</span>&amp;text=<span class="number">4</span>&quot;&gt;&lt;/<span class="selector-tag">li</span>&gt;</span><br><span class="line">&lt;<span class="selector-tag">li</span> class=&quot;<span class="attribute">flex</span>-item&quot;&gt;&lt;<span class="selector-tag">img</span> <span class="attribute">src</span>=&quot;//placehold<span class="selector-class">.it</span>/<span class="number">300</span>&amp;text=<span class="number">5</span>&quot;&gt;&lt;/<span class="selector-tag">li</span>&gt;</span><br><span class="line">&lt;<span class="selector-tag">li</span> class=&quot;<span class="attribute">flex</span>-item&quot;&gt;&lt;<span class="selector-tag">img</span> <span class="attribute">src</span>=&quot;//placehold<span class="selector-class">.it</span>/<span class="number">300</span>&amp;text=<span class="number">6</span>&quot;&gt;&lt;/<span class="selector-tag">li</span>&gt;</span><br><span class="line">&lt;/<span class="selector-tag">ul</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.flex-item</span> &#123;   </span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CSS-设计技巧"><a href="#CSS-设计技巧" class="headerlink" title="CSS 设计技巧"></a>CSS 设计技巧</h4><p>• 水平居中设置-行内元素</p><p>通过给父元素设置 <code>text-align:center </code>来实现的</p><p>• 水平居中设置-定宽块状元素</p><p>通过设置“左右margin”值为“auto”来实现居中的</p><p>• 水平居中设置-不定宽块状元素方法</p><ol><li> 加入 table 标签  </li><li> 设置 display: inline 方法:与第一种类似，显示类型设为 行内元素，进行不定宽元素的属性设置  </li><li> 设置 position:relative 和 left:50%:利用 相对定位 的方式，将元素向左偏移 50% ，即达到居中的目的</li></ol><p>• 垂直居中-父元素高度确定的单行文本</p><p>通过设置父元素的 height 和 line-height 高度一致来实现的</p><p>• 垂直居中-父元素高度确定的多行文本</p><ol><li> 使用插入 table (包括tbody、tr、td)标签，同时设置 vertical-align:middle</li><li> 设置块级元素的 display 为 table-cell(设置为表格单元显示)，激活 vertical-align 属性</li></ol>]]></content>
      
      
      <categories>
          
          <category> 应用开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ATOM快捷键操作</title>
      <link href="/2017/05/25/ATOM%E5%BF%AB%E6%8D%B7%E9%94%AE%E6%93%8D%E4%BD%9C/"/>
      <url>/2017/05/25/ATOM%E5%BF%AB%E6%8D%B7%E9%94%AE%E6%93%8D%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<p><strong>光标移动</strong></p><ul><li><p>Alt+Left or Alt+B - Move to the beginning of word</p></li><li><p>Alt+Right or Alt+F - Move to the end of word</p></li><li><p>Cmd+Left or Ctrl+A - Move to the first character of the current line</p></li><li><p>Cmd+Right or Ctrl+E - Move to the end of the line</p></li><li><p>Cmd+Up - Move to the top of the file</p></li><li><p>Cmd+Down - Move to the bottom of the file</p></li><li><p>Ctrl+P – Go up a single character</p></li><li><p>Ctrl+N – Go down a single character</p></li><li><p>Ctrl+B – Go left to a single character</p></li><li><p>Ctrl+F – Go right to a single character</p></li><li><p>Ctrl+G – Go to a certain line</p></li><li><p>Cmd+R – Jump to a symbol such as a method definition</p></li><li><p>Cmd+Shift+R – Search for symbols across the project</p></li><li><p>Alt+Cmd+Down to go to and Alt+Cmd+Up to return from the declaration of the symbol under the cursor</p></li></ul><p><strong>选择文本</strong></p><ul><li><p>Shift+移动快捷键</p></li><li><p>Cmd+A - Select the entire contents of the file</p></li><li><p>Cmd+L - Select the entire line</p></li><li><p>Ctrl+Shift+W - Select the current word</p></li></ul><p><strong>编辑文本</strong></p><ul><li><p>Cmd+J - Join the next line to the end of the current line</p></li><li><p>Cmd+Ctrl+Up/Down - Move the current line up or down</p></li><li><p>Cmd+Shift+D - Duplicate the current line</p></li><li><p>Cmd+K Cmd+U - Upper case the current word</p></li><li><p>Cmd+K Cmd+L - Lower case the current word</p></li><li><p>Ctrl+T - Transpose characters. This swaps the two characters on either side of the cursor.</p></li><li><p>Ctrl+Shift+K - Delete current line</p></li><li><p>Alt+Backspace or Alt+H - Delete to beginning of word</p></li><li><p>Alt+Delete or Alt+D - Delete to end of word</p></li><li><p>Cmd+Delete - Delete to end of line</p></li><li><p>Ctrl+K - Cut to end of line</p></li><li><p>Cmd+Backspace - Delete to beginning of line</p></li></ul><p><strong>多光标操作</strong></p><ul><li><p>Cmd+Click - Add a new cursor at the clicked location</p></li><li><p>Ctrl+Shift+Up/Down - Add another cursor above/below the current cursor</p></li><li><p>Cmd+D - Select the next word in the document that is the same as the currently selected word</p></li><li><p>Cmd+Ctrl+G - Select all words in the document that are the same as the currently selected word</p></li><li><p>Cmd+Shift+L - Convert a multi-line selection into multiple cursors</p></li></ul><p><strong>查找和替换文本</strong></p><ul><li><p>Cmd+F - Search within a buffer</p></li><li><p>Cmd+Shift+F - Search the entire project</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 开发工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> atom </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTML概要</title>
      <link href="/2017/05/24/HTML%E6%A6%82%E8%A6%81/"/>
      <url>/2017/05/24/HTML%E6%A6%82%E8%A6%81/</url>
      
        <content type="html"><![CDATA[<h2 id="HTML-CSS-Javascript-的关系"><a href="#HTML-CSS-Javascript-的关系" class="headerlink" title="HTML CSS Javascript 的关系"></a>HTML CSS Javascript 的关系</h2><p>HTML是网页内容的载体。内容就是网页制作者放在页面上想要让用户浏览的信息，可以包含文字、图片、视频等。</p><p>CSS样式是表现。就像网页的外衣。比如，标题字体、颜色变化，或为标题加入背景图片、边框等。所有这些用来改变内容外观的东西称之为表现。</p><p>JavaScript是用来实现网页上的动态效果。如:鼠标滑过弹出下拉菜单。或鼠标滑过表格的背景颜色改变。还有焦点新闻(新闻图片)的轮换。</p><h2 id="HTML-标签语法"><a href="#HTML-标签语法" class="headerlink" title="HTML 标签语法"></a>HTML 标签语法</h2><p>1. <strong>标签</strong>由英文尖括号**&lt;**和**&gt;**括起来，如<code>&lt;html&gt;</code>就是一个标签。</p><p>2. html中的标签一般都是成对出现的，分<strong>开始标签</strong>和<strong>结束标签</strong>。结束标签比开始标签多了一个/。</p><p>如：</p><p>（1） <code>&lt;p&gt;&lt;/p&gt;</code></p><p>（2） <code>&lt;div&gt;&lt;/div&gt;</code></p><p>（3）<code>&lt;span&gt;&lt;/span&gt;</code></p><p>3. 标签与标签之间是可以嵌套的，但先后顺序必须保持一致，如：<code>&lt;div&gt;</code>里嵌套<code>&lt;p&gt;</code>，那么<code>&lt;/p&gt;</code>必须放在<code>&lt;/div&gt;</code>的前面。如下图所示。</p><p>4. HTML标签不区分大小写，<code>&lt;h1&gt;</code>和<code>&lt;H1&gt;</code>是一样的，但建议小写，因为大部分程序员都以小写为准。</p><h2 id="HTML标签"><a href="#HTML标签" class="headerlink" title="HTML标签"></a>HTML标签</h2><p><strong><code>&lt;p&gt;</code> 标签</strong></p><p>如果想在网页上显示文章，就需要<p>标签，把文章的段落放到<p>标签中。</p><p>语法：</p><p><code>&lt;p&gt;段落文本&lt;/p&gt;</code></p><p><strong><code>&lt;hx\&gt;</code> 标签</strong></p><p>使用<code>&lt;hx&gt;</code>标签来制作<strong>文章的标题</strong>。<br>标题标签一共有6个，h1、h2、h3、h4、h5、h6分别为一级标题、二级标题、三级标题、四级标题、五级标题、六级标题。并且依据重要性递减。<code>&lt;h1&gt;</code>是最高的等级。</p><p>语法：</p><p><code>&lt;h1&gt;段落文本&lt;/h1&gt;</code></p><p><strong><code>&lt;strong&gt;</code> 和 <code>&lt;em&gt;</code>标签</strong></p><p>在一段话中特别强调某几个文字，这时候就可以用到<code>&lt;em&gt;</code>或<code>&lt;strong&gt;</code>标签。</p><p>但两者在强调的语气上有区别:<code>&lt;em\&gt;</code> 表示强调，<code>&lt;strong&gt;</code> 表示更强烈的强调。并且在浏览器中<code>&lt;em\&gt;</code> 默认用<strong>斜体</strong>表示，<code>&lt;strong&gt;</code> 用<strong>粗体</strong>表示。</p><p>语法：</p><p><code>&lt;em&gt;段落文本&lt;/em&gt;</code></p><p><code>&lt;strong&gt;段落文本&lt;/strong&gt;</code></p><p><strong><code>&lt;q&gt;</code> 标签</strong></p><p>使用q标签可以在html中添加一段引用，如作家的话、诗句等。</p><p>1. 注意要引用的文本不用加<strong>双引号</strong>，浏览器会对q标签自动添加双引号。</p><p>语法：</p><p>段落文本<code>&lt;q&gt;</code>引用文本<code>&lt;/q&gt;</code>段落文本</p><p><strong><code>&lt;blockquote\&gt;</code> 标签</strong></p><p>blockquote的作用也是引用别人的文本。但它是对<strong>长文本</strong>的引用，如在文章中引入大段某知名作家的文字，这时需要这个标签。</p><p>1. 浏览器对<code>&lt;blockquote&gt;</code>标签的解析是<strong>缩进</strong>样式，而不是添加引号</p><p>语法：</p><p><code>&lt;blockquote&gt;引用段落&lt;/blockquote&gt; </code></p><p><strong><code>&lt;br  /&gt;</code> 标签</strong></p><p> 需要加回车换行的地方加入<code>&lt;br /&gt;</code>，<code>&lt;br /&gt;</code>标签作用相当于word文档中的回车。</p><p>1. 浏览器会忽略HTML中的回车和空格，如果需要换行，就要用到<code>&lt;br  /&gt;</code>标签。</p><ol><li>如果需要加空格，则需要用<code>&amp;nbsp</code>来替换空格。</li></ol><p>语法：</p><p>引用段落<code>&lt;br /&gt;</code></p><p><strong><code>&lt;hr  /&gt; </code>标签</strong></p><p>在信息展示时，有时会需要加一些用于分隔的横线，这样会使文章看起来整齐些.</p><p>1. <code>&lt;hr /&gt;</code>标签和<code>&lt;br /&gt;</code>标签一样也是一个<strong>空标签</strong>，所以只有一个开始标签，没有结束标签。</p><p>2. <code>&lt;hr /&gt;</code>标签的在浏览器中的默认样式线条比较粗，颜色为灰色。可以通过css来改变水平线的样式。</p><p>语法：</p><p><code>&lt;p&gt;文本段落&lt;/p&gt;</code></p><p><code>&lt;hr /&gt;</code></p><p><strong><code>&lt;address&gt;</code> 标签</strong></p><p>一般网页中会有一些网站的联系地址信息需要在网页中展示出来，这些联系地址信息如公司的地址就可以<code>&lt;address&gt;</code>标签。也可以定义一个地址（比如电子邮件地址）、签名或者文档的作者身份。</p><p><code>&lt;address&gt;</code>标签中的内容会在浏览器中显示为斜体。</p><p>语法：</p><p><code>&lt;address&gt;</code>地址信息或联系人信息<code>&lt;/address&gt;</code></p><p><img src="http://wangsen.site/wp-content/uploads/2018/01/162315_bRJt_182939.png"></p><p><strong><code>&lt;code&gt;</code>和<code>&lt;pre&gt;</code> 标签</strong></p><p>在介绍语言技术的网站中，避免不了在网页中显示一些计算机专业的编程代码，当代码为一行代码时，你就可以使用<code>&lt;code&gt;</code>标签了，如下面例子：</p><p><code>&lt;code&gt;</code>var  i=i+300;<code>&lt;/code&gt;</code></p><p>如果是多行代码，可以使用<code>&lt;pre&gt;</code>标签。<br><code>&lt;pre&gt;</code> 标签的主要作用:预格式化的文本。被包围在 pre 元素中的文本通常会保留空格和换行符。</p><p>语法：</p><p><code>&lt;code&gt;一行计算机代码&lt;/code&gt; </code><br><code>&lt;pre&gt;多行计算机代码&lt;/pre&gt; </code><br><strong><code>&lt;ul\&gt;</code> 和 <code>&lt;li&gt;</code>标签</strong></p><p>利用<code>&lt;ul&gt;</code>和<code>&lt;li&gt;</code>可以生成没有顺序的列表。</p><p>语法：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">&lt;li&gt;[精彩少年](http:<span class="regexp">//</span>www.zuowen.com<span class="regexp">/e/</span><span class="number">20130805</span><span class="regexp">/51ff0eacd8d21.shtml)&lt;/</span>li&gt;</span><br><span class="line">&lt;li&gt;[美丽突然出现](http:<span class="regexp">//</span>www.zuowen.com<span class="regexp">/e/</span><span class="number">20130802</span><span class="regexp">/51fb0a622ef8d.shtml)&lt;/</span>li&gt;</span><br><span class="line">&lt;li&gt;[触动心灵的旋律](http:<span class="regexp">//</span>www.zuowen.com<span class="regexp">/e/</span><span class="number">20130713</span><span class="regexp">/51e0a742d81db.shtml)&lt;/</span>li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure><p><strong><code>&lt;ol&gt;</code> 和 <code>&lt;li&gt;</code>标签</strong></p><p>利用<code>&lt;ol&gt;</code>和<code>&lt;li&gt;</code>可以生成有顺序的列表。</p><p>语法：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;ol&gt;</span><br><span class="line"></span><br><span class="line">  &lt;li&gt;前端开发面试心法 &lt;/li&gt;</span><br><span class="line"></span><br><span class="line">  &lt;li&gt;[零基础学习](<span class="link">http://www.zuowen.com/e/20130802/51fb0a622ef8d.shtml)</span>[<span class="string">html</span>](http://www.zuowen.com/e/20130802/51fb0a622ef8d.shtml)&lt;/li&gt;</span><br><span class="line"></span><br><span class="line">  &lt;li&gt;JavaScript全攻略&lt;/li&gt;</span><br><span class="line"></span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure><p><strong><code>&lt;div&gt;</code> 标签</strong></p><p>在网页制作过程过中，可以把一些独立的逻辑部分划分出来，放在一个<code>&lt;div&gt;</code>标签中，这个<code>&lt;div&gt;</code>标签的作用就相当于一个容器。</p><p>1. div和span类似，都没有特殊的语义。</p><ol><li><p> div可以用来排版。</p></li><li><p> div属于块级元素。</p></li><li><p>可以用id来为div分组命名</p></li></ol><p>语法：</p><pre><code>&lt;div  id=’xxx’&gt;…&lt;/div&gt;</code></pre><p><strong><code>&lt;caption&gt;</code> 标签</strong></p><p>可以使用caption标签来为表格添加标题：</p><p>语法：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">caption</span>&gt;</span>标题文本<span class="tag">&lt;/<span class="name">caption</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">td</span>&gt;</span>…<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">td</span>&gt;</span>…<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> …</span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> …</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong><code>&lt;a&gt;</code> 标签</strong></p><p>使用<code>&lt;a&gt;</code>标签可实现超链接，它在网页制作中可以说是无处不在，只要有链接的地方，就会有这个标签。</p><p>语法：</p><p><code>&lt;a href=&quot;目标网址&quot; title=&quot;鼠标滑过显示的文本&quot;&gt;链接显示的文本&lt;/a&gt; </code><br>1. title属性的作用：鼠标滑过链接文字时会显示这个属性的文本内容。这个属性在实际网页开发中作用很大，主要方便搜索引擎了解链接地址的内容（语义化更友好）<br>2. <code>&lt;a&gt;</code>标签在默认情况下，链接的网页是在当前浏览器窗口中打开，如果需要在新的浏览器窗口中打开，则需要用到target选项。</p><p><code>&lt;a href=&quot;目标网址&quot; **target=&quot;_blank&quot;**&gt;click here!&lt;/a&gt;   </code><br>a标签还有一个作用是可以链接Email地址，使用mailto能让访问者便捷向网站管理者发送电子邮件。</p><p><strong><code>&lt;img&gt;</code> 标签</strong></p><p>使用<code>&lt;img&gt;</code>标签可以在网页中插入图片。</p><p>语法：<br><code>&lt;img  src=&quot;图片地址&quot; alt=&quot;下载失败时的替换文本&quot; title = &quot;提示文本&quot;&gt;   </code><br>1、src：标识图像的位置；<br>2、alt：指定图像的描述性文本，当图像不可见时（下载不成功时），可看到该属性指定的文本；<br>3、title：提供在图像可见时对图像的描述(鼠标滑过图片时显示的文本)；<br>4、图像可以是GIF，PNG，JPEG格式的图像文件。</p><h2 id="HTML表单"><a href="#HTML表单" class="headerlink" title="HTML表单"></a><strong>HTML表单</strong></h2><p>表单可以把浏览者输入的数据传送到服务器端，这样服务器端程序就可以处理表单传过来的数据。</p><p><strong>语法：</strong></p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;form <span class="function"><span class="keyword">method</span>=&quot;传送方式&quot; <span class="title">action</span>=”<span class="title">URL</span>&quot;&gt;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">&lt;/<span class="title">form</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li><strong><form>：</strong><code>&lt;form&gt;</code>标签是成对出现的，以<code>&lt;form&gt;</code>开始，以<code>&lt;/form&gt;</code>结束。</li><li><strong>action：</strong>浏览者输入的数据被传送到的地方,比如一个PHP页面(save.php)。</li><li><strong>method：</strong> 数据传送的方式（get/post)</li><li>所有表单控件（文本框、文本域、按钮、单选框、复选框等）都必须放在<code>&lt;form&gt;&lt;/form&gt;</code>标签之间* </li><li>get请求会把表单提供的参数放到URL中，而post请求会把参数放到http请求体中</li></ol><p><strong>文本、密码输入框</strong></p><p>当用户要在表单中键入字母、数字等内容时，就会用到<strong>文本输入框</strong>。文本框也可以转化为<strong>密码输入框</strong>。</p><p><strong>语法：</strong></p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">form</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;<span class="keyword">input</span> <span class="keyword">type</span>=<span class="string">&quot;text/password&quot;</span> name=<span class="string">&quot;名称&quot;</span> value=<span class="string">&quot;文本&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/<span class="keyword">form</span>&gt;</span><br></pre></td></tr></table></figure><p>1、type：</p><p>   当type=”text”时，输入框为文本输入框;</p><p>   当type=”password”时, 输入框为密码输入框。</p><p>2、name：为文本框命名，以备后台程序ASP 、PHP使用。</p><p>3、value：为文本输入框设置默认值。(一般起到提示作用)</p><p><strong>文本域 多行文本输入</strong></p><p>当用户需要在表单中输入大段文字时，需要用到文本输入域。</p><p><strong>语法：</strong></p><pre><code>&lt;textarea  **rows=&quot;行数&quot;**  **cols=&quot;列数&quot;**&gt;文本&lt;/textarea&gt;</code></pre><p>1、<code>&lt;textarea&gt;</code>标签是成对出现的，以<code>&lt;textarea&gt;</code>开始，以<code>&lt;/textarea&gt;</code>结束。</p><p>2、<strong>cols</strong>：多行输入域的<strong>列数</strong>。</p><p>3、<strong>rows</strong>：多行输入域的<strong>行数</strong>。</p><p>4、在<code>&lt;textarea&gt;&lt;/textarea&gt;</code>标签之间可以输入<strong>默认值</strong>。</p><p><strong>单选框、复选框</strong></p><p>在使用表单设计调查表时，为了减少用户的操作，使用选择框是一个好主意，html中有两种选择框，即<strong>单选框</strong>和<strong>复选框</strong>，两者的区别是<strong>单选框</strong>中的选项用户只能选择一项，而<strong>复选框</strong>中用户可以任意选择多项，甚至全选</p><p><strong>语法：</strong></p><p><code>&lt;input type=&quot;radio/checkbox&quot; value=&quot;值&quot; name=&quot;名称&quot; checked=&quot;checked&quot;/&gt; </code><br>1、type:</p><p>   当 type=”radio” 时，控件为单选框</p><p>   当 type=”checkbox” 时，控件为复选框</p><p>2、value：提交数据到服务器的值（后台程序PHP使用）</p><p>3、name：为控件命名，以备后台程序 ASP、PHP 使用</p><p>4、checked：当设置 checked=”checked” 时，该选项被默认选中</p><p><strong>下拉列表框</strong></p><p>下拉列表在网页中也常会用到，它可以有效的节省网页空间。既可以单选、又可以多选</p><p>下拉列表也可以进行多选操作，在<code>&lt;select&gt;</code>标签中设置multiple=”multiple”属性，就可以实现多选功能</p><p><strong>提交按钮</strong></p><p>在表单中有两种按钮可以使用，分别为：提交按钮、重置。这一小节讲解提交按钮：当用户需要提交表单信息到服务器时，需要用到<strong>提交按钮</strong>。</p><p><strong>语法</strong>：</p><p><code>&lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt; </code><br>1, type：只有当type值设置为submit时，按钮才有提交作用<br>2, value：按钮上显示的文字</p><p><strong>重置按钮</strong></p><p>当用户需要重置表单信息到初始时的状态时，比如用户输入“用户名”后，发现书写有误，可以使用重置按钮使输入框恢复到初始状态。只需要把type设置为”reset”就可以。</p><p><strong>语法</strong>：</p><p><code>&lt;input type=&quot;reset&quot;  value=&quot;重置&quot;&gt; </code><br>1, type：只有当type值设置为reset时，按钮才有重置作用</p><p>2, value：按钮上显示的文字</p><p><strong>form表单中的label标签</strong></p><p>label标签不会向用户呈现任何特殊效果，它的作用是为鼠标用户改进了可用性。如果你在 label 标签内点击文本，就会触发此控件。</p><p><strong>语法</strong>：</p><pre><code>&lt;label  for=&quot;控件id名称&quot;&gt; &lt;/label&gt;</code></pre><h2 id="HTML5"><a href="#HTML5" class="headerlink" title="HTML5"></a><strong>HTML5</strong></h2><p><strong>更简化的语法：</strong></p><ul><li>  <code>&lt;!doctype html&gt;</code></li><li>  <code>&lt;html  lang=“zh-CN”&gt;</code></li><li>  <code>&lt;meta  charset=“utf-8”&gt;</code></li><li>  不区分大小写 HTML  =  HtMl</li><li>  checked=“checked” or checked</li><li>  <code>&lt;html&gt;&lt;head&gt;&lt;body&gt;</code>可以省略</li></ul><p>      。。。</p><p><strong>废除的标签</strong></p><ul><li>  能用css替代的标签：basefont,  font,  center…</li><li>  Frame相关的标签，只支持iframe： frameset,  frame,  noframes</li><li>  只有部分浏览器支持的标签：applet,  bgsound…</li><li>  其他废除的标签：rb,  dir,  listing,  xmp…</li></ul><p><strong>废除了一些和样式相关的属性</strong></p><p><strong>HTML5 新增标签</strong></p><ul><li>  <code>&lt;section&gt;&lt;/section&gt;</code> 表示页面中的一个内容区块，不用作排版</li><li>  <code>&lt;article&gt;&lt;/article&gt;</code> 表示与上下文不相干的独立内容，比如说文章</li><li>  <code>&lt;aside&gt;&lt;/aside&gt;</code> 表示与文章相关的辅助信息，如文章后面的推荐阅读</li><li>  <code>&lt;header&gt;&lt;/header&gt;</code> 页眉</li><li>  <code>&lt;footer&gt;&lt;/footer&gt;</code> 页脚</li><li>  <code>&lt;nav&gt;&lt;/nav&gt; </code>导航栏</li><li>  <code>&lt;figure&gt;&lt;/figure&gt; </code> 标签规定独立的流内容（图像、图表、照片、代码等等）。figure 元素的内容应该与主内容相关，但如果被删除，则不应对文档流产生影响。</li><li>  <code>&lt;figcaption&gt;&lt;/figcaption&gt;</code>标签定义 figure 的标题（caption）。”figcaption” 元素应该被置于 “figure” 元素的第一个或最后一个子元素的位置。</li><li>  <code>&lt;video&gt;&lt;/video&gt;</code> 视频标签</li><li>  <code>&lt;audio&gt;&lt;/audio&gt; </code>音频标签</li><li>  <code>&lt;embed  /&gt; </code>嵌入标签，可以是视频、音频、flash等多媒体内容</li><li>  <code>&lt;mark&gt;&lt;/mark&gt;</code> 替换文本的背景色来标记文本</li><li>  &lt;<code>progress  max=“100”  value=“85”&gt;&lt;/progress&gt;</code> 进度条</li><li>  <code>&lt;canvas&gt;&lt;/canvas&gt;</code> 绘图，替代flash</li><li>  <code>&lt;details&gt;&lt;summary&gt;always  show&lt;/summary&gt;something  can  be  hidden&lt;/details&gt;</code></li><li> <code> &lt;datalist&gt;&lt;/datalist&gt;</code></li></ul><p><strong>HTML5</strong> <strong>新增属性</strong></p><ul><li>  <code>&lt;html  manifest=“xxx.manifest”&gt;</code></li><li>  <code>&lt;meta  charset=“utf-8”&gt;</code></li><li>  <code>&lt;link  rel=‘icon’  href=“URL”  type=image/gif  sizes=“16x16”&gt; </code>//目前几乎没有主流浏览器支持 sizes 属性。</li><li>  <code>&lt;script  defer  src=“*.js”&gt;&lt;/script&gt;</code></li><li>  <code>&lt;script  async  src=“*.js”&gt;&lt;/script&gt;</code></li><li>  <code>&lt;a  media=“tv”  href=[“www.baidu.com](http://www.baidu.com/)”  hreflang=“zh”  ref=“external”&gt;baidu&lt;/a&gt;</code></li><li>  <code>&lt;ol  start=”50”  reversed&gt;&lt;/ol&gt;</code></li><li>  <code>&lt;style  scoped&gt;&lt;/style&gt;</code></li><li>  <code>&lt;iframe  seamless  srcdoc=“&lt;h1&gt;hello&lt;/h1&gt;”  sandbox  src=[www.baidu.com](http://www.baidu.com/)&gt;  &lt;/iframe&gt;</code></li></ul><p><strong>HTML5</strong> <strong>新增全局属性</strong></p><ul><li>  data-*</li><li>  Hidden</li><li>  Tabindex</li><li>  spellcheck=”true”</li><li>  contenteditable=“true”</li></ul>]]></content>
      
      
      <categories>
          
          <category> 应用开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> html </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python中list的遍历</title>
      <link href="/2017/02/09/Python%E4%B8%ADlist%E7%9A%84%E9%81%8D%E5%8E%86/"/>
      <url>/2017/02/09/Python%E4%B8%ADlist%E7%9A%84%E9%81%8D%E5%8E%86/</url>
      
        <content type="html"><![CDATA[<p>在python中，若要遍历一个list而且需要在遍历时修改list，则需要十分注意，因为这样可能会导致死循环，例如：</p><pre><code>In [10]: ls = [&#39;hello&#39;, &#39;world&#39;, &#39;bugggggggg&#39;]In [11]: for item in ls:   ....:     if len(item) &gt; 5:   ....:         ls.insert(0, item)   ....:         print ls   ....:         [&#39;bugggggggg&#39;, &#39;hello&#39;, &#39;world&#39;, &#39;bugggggggg&#39;][&#39;bugggggggg&#39;, &#39;bugggggggg&#39;, &#39;hello&#39;, &#39;world&#39;, &#39;bugggggggg&#39;][&#39;bugggggggg&#39;, &#39;bugggggggg&#39;, &#39;bugggggggg&#39;, &#39;hello&#39;, &#39;world&#39;, &#39;bugggggggg&#39;]...</code></pre><p>所以，为了安全起见，在遇到需要修改列表的时候，都不对列表本身进行遍历，而是创建一个列表的备份，然后对这个备份进行遍历，从而避免了上述情形。例如：</p><pre><code>In [20]: In [10]: ls = [&#39;hello&#39;, &#39;world&#39;, &#39;bugggggggg&#39;]In [21]: for item in ls[:]:   ....:     if len(item) &gt; 5:   ....:         ls.insert(0, item)   ....:         In [22]: print(ls)[&#39;bugggggggg&#39;, &#39;hello&#39;, &#39;world&#39;, &#39;bugggggggg&#39;]</code></pre>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python中的参数传递与解析</title>
      <link href="/2017/02/09/Python%E4%B8%AD%E7%9A%84%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92%E4%B8%8E%E8%A7%A3%E6%9E%90/"/>
      <url>/2017/02/09/Python%E4%B8%AD%E7%9A%84%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92%E4%B8%8E%E8%A7%A3%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="Python传递命令行参数"><a href="#Python传递命令行参数" class="headerlink" title="Python传递命令行参数"></a>Python传递命令行参数</h1><p>Python的命令行参数传递和C语言类似，都会把命令行参数保存到argv的变量中。对于python而言，argv是sys模块中定义的一个list。与C语言不同的是，python中并没有定义argc，要获得参数的个数，需要使用len(sys.argv)</p><p>当用户使用’python -c “command” ‘来运行一条python语句时，argv中保存的是[‘-c’]及”command”后面的参数，例如：</p><pre><code>$ python -c &#39;import sysprint sys.argv&#39; hello world[&#39;-c&#39;, &#39;hello&#39;, &#39;world&#39;]</code></pre><p>当用户使用’python -m “module” ‘来运行一个模块时，argv中保存的是模块名及”module”后面的参数，例如：</p><pre><code>$ python -m &#39;show_args&#39; hello world[&#39;/home/kelvin/tmp/show_args.py&#39;, &#39;hello&#39;, &#39;world&#39;]</code></pre><p>当运行python脚本时，argv中保存的是脚本名及其后面的参数：</p><pre><code>$ python show_args.py hello world[&#39;show_args.py&#39;, &#39;hello&#39;, &#39;world&#39;]length of argv: 3$ cat show_args.py #!/bin/env pythonimport sysprint sys.argvprint &quot;length of argv: &quot; + str(len(sys.argv))</code></pre><h1 id="使用标准库getopt解析选项和参数"><a href="#使用标准库getopt解析选项和参数" class="headerlink" title="使用标准库getopt解析选项和参数"></a>使用标准库getopt解析选项和参数</h1><p>getopt模块和C语言中的getopt函数有着一样的API，熟悉C语言的同学可快速上手。</p><pre><code># -*- coding: utf-8 -*-#!/bin/env pythonimport getoptimport sysdef usage():    print(&quot;Usage:&quot;)    print(sys.argv[0] + &#39; -i input_file -o output_file&#39;)def main():    try:        opts, args = getopt.getopt(sys.argv[1:], &quot;ho:i:&quot;, [&quot;help&quot;, &quot;output=&quot;, &quot;input=&quot;])    except getopt.GetoptError as err:        # print help information and exit:        print(&quot;[&quot; + err.opt + &quot;]&quot; + err.msg)        usage()        sys.exit(2)    output = None    input = None    for o, a in opts:        if o in (&quot;-i&quot;, &quot;--input&quot;):            input = a        elif o in (&quot;-h&quot;, &quot;--help&quot;):            usage()            sys.exit()        elif o in (&quot;-o&quot;, &quot;--output&quot;):            output = a        else:            assert False, &quot;unhandled option&quot;    print(&quot;Input file: %s&quot; % (input))    print(&quot;Output file: %s&quot; % (output))if __name__ == &quot;__main__&quot;:    main()</code></pre><p>getopt需要传入3个参数：</p><p>1.  需要解析的字符串，即sys.argv[1:]</p><p>2. 短选项集合。其中跟冒号的短选项需要后接参数，如’o:’表示’-o’选项需要接参数。</p><p>3. 长选项列表。其中跟等号的长选项需要后接参数。</p><p>getopt返回一个元组，元组包括两个列表opts和args。opts的元素是一个元组，保存了解析好的选项和参数对。args保存了除去所有选项和选项的参数之外，剩下的所有参数。</p><p>如果解析出错则会抛出GetoptError异常，该异常有一个参数err。err.opt是出错时正在解析的选项，err.msg是错误消息。</p><p>出错的情况包括：</p><p>1. 选项没有在传入参数中的短选项或者长选项列表定义。</p><p>2. 需要带参数的选项没有跟参数。</p><p>3. 不需要带参数的长选项带了参数。</p><p>4. 其他。</p><pre><code>kelvin@kvm:~/tmp$ python parse_args.py --help=out[help]option --help must not have an argumentUsage:parse_args.py -i input_file -o output_filekelvin@kvm:~/tmp$ python parse_args.py -i input_file.txt Input file: input_file.txtOutput file: Nonekelvin@kvm:~/tmp$ python parse_args.py -i input_file.txt --output=&quot;hello_world.txt&quot;Input file: input_file.txtOutput file: hello_world.txtkelvin@kvm:~/tmp$ python parse_args.py -i input_file.txt -o &quot;output.txt&quot;Input file: input_file.txtOutput file: output.txt</code></pre><h1 id="使用标准库argparse来解析选项和参数"><a href="#使用标准库argparse来解析选项和参数" class="headerlink" title="使用标准库argparse来解析选项和参数"></a>使用标准库argparse来解析选项和参数</h1><p>argparse模块功能更加强大，例如可以自动生成help文档等，使用起来也更加简便，只需要三个步骤即可。第一步，创建一个ArgumentParser对象：</p><pre><code>parser = argparse.ArgumentParser(description=&#39;Description of the program&#39;)</code></pre><p>第二步，添加需要解析的选线和参数：</p><pre><code>parser.add_argument(&#39;integers&#39;, metavar=&#39;N&#39;, type=int, nargs=&#39;+&#39;,                    help=&#39;an integer for the accumulator&#39;)parser.add_argument(&#39;--sum&#39;, dest=&#39;accumulate&#39;, action=&#39;store_const&#39;,                    const=sum, default=max,                    help=&#39;sum the integers (default: find the max)&#39;)</code></pre><p>第三部，开始解析：</p><pre><code>args = parser.parse_args()</code></pre><h2 id="ArgumentParser"><a href="#ArgumentParser" class="headerlink" title="ArgumentParser"></a>ArgumentParser</h2><pre><code> class argparse.ArgumentParser(prog=None, usage=None, description=None, epilog=None, parents=[], formatter_class=argparse.HelpFormatter, prefix_chars=&#39;-&#39;, fromfile_prefix_chars=None, argument_default=None, conflict_handler=&#39;error&#39;, add_help=True, allow_abbrev=True)</code></pre><p>常用的参数解释如下：</p><p>prog: 指定程序的名字，默认为sys.argv[0].</p><p>usage: 描述程序该如何使用的字符串，默认会根据添加的参数和选项自动生成</p><p>description: 描述程序的功能，默认为空</p><p>epilog: epilog指定的字符串将会显示在帮助文档的最后</p><p>parents: 一个 ArgumentParser对象的列表，这些对象的选项和参数也会被继承</p><p>add_help: 添加-h/–help选项，默认为True</p><p>allow_abbrev: 允许长选项的缩写，默认为True</p><h2 id="add-argument"><a href="#add-argument" class="headerlink" title="add_argument"></a>add_argument</h2><pre><code> ArgumentParser.add_argument(name or flags...[, action][, nargs][, const][, default][, type][, choices][, required][, help][, metavar][, dest])</code></pre><p><strong>name</strong>将会作为解析后返回的对象args的属性，存储参数的值，flags定义指定的选项，flag的名字也会作为解析后返回的对象的属性，存储该选项的参数。例如：</p><pre><code>parser.add_argument(&#39;-f&#39;, &#39;--foo&#39;)parser.add_argument(&#39;arg0&#39;)args = parser.parse_args()print(args.foo)print(args.arg0)</code></pre><p>执行结果如下：</p><pre><code>$./arg_parse.py --foo hello worldhelloworld</code></pre><p><strong>nargs</strong>指定选项参数或者参数本身的个数。例如：</p><pre><code>parser.add_argument(&#39;-f&#39;, &#39;--foo&#39;, nargs=2)args = parser.parse_args()print(args.foo)</code></pre><p>执行结果如下：</p><pre><code>$./arg_parse.py --foo hello world[&#39;hello&#39;, &#39;world&#39;]</code></pre><p>argparse会将–foo选项后面的两个参数都作为–foo的参数处理。</p><p><strong>action</strong>指定argparse如何处理该选项的参数，共有8个值可选。</p><ol><li> ‘store’: 默认值，表示存储参数，如上面例子中的args.foo存储hello world.</li><li>‘store_const’: 存储常量，常量的值位于const参数中。如：<pre><code> $ cat arg_parse.py  #!/usr/bin/env python  import argparse  parser = argparse.ArgumentParser() parser.add_argument(&#39;-f&#39;, &#39;--foo&#39;, action=&#39;store_const&#39;, const=1024) args = parser.parse_args() print(args.foo)  $ ./arg_parse.py -f 1024 </code></pre></li><li>‘store_true’或者’store_false’：和’store_const’类似，存储的值为True或者False</li><li>‘append’：连个同样的选项的参数会被放到同一个list里面，例如：    <pre><code> $ cat arg_parse.py  #!/usr/bin/env python  import argparse  parser = argparse.ArgumentParser() parser.add_argument(&#39;-f&#39;, &#39;--foo&#39;, action=&#39;append&#39;) args = parser.parse_args() print(args.foo)  $ ./arg_parse.py --foo 1 --foo 2 -f 3 [&#39;1&#39;, &#39;2&#39;, &#39;3&#39;]</code></pre></li><li>‘append_const’: 可将多个常量存放到一个list中，选项出现几次，list中的常量就出现几次，例如：    <pre><code> $ cat arg_parse.py  #!/usr/bin/env python  import argparse  parser = argparse.ArgumentParser() parser.add_argument(&#39;-f&#39;, &#39;--foo&#39;, action=&#39;append_const&#39;, const=&quot;1024&quot;) args = parser.parse_args() print(args.foo)  $ ./arg_parse.py --foo --foo -f [&#39;1024&#39;, &#39;1024&#39;, &#39;1024&#39;]</code></pre></li><li>‘count’:  存储选项出现的次数。例如：    <pre><code> $ cat arg_parse.py  #!/usr/bin/env python  import argparse  parser = argparse.ArgumentParser() parser.add_argument(&#39;-v&#39;, &#39;--verbose&#39;, action=&#39;count&#39;) args = parser.parse_args() print(args.verbose)  $ ./arg_parse.py -vvv 3  $ ./arg_parse.py -v --verbose -v 3</code></pre></li><li>‘help’: 当出现这个选项时，程序打印help文档然后退出。</li><li>‘version’: 当出现这个选项时，程序打印版本信息然后退出，版本信息可通过version定义，例如：    <pre><code> $cat arg_parse.py #!/usr/bin/env python  import argparse  parser = argparse.ArgumentParser(prog=&quot;wchat&quot;) parser.add_argument(&#39;-v&#39;, &#39;--version&#39;, action=&#39;version&#39;, version=&#39;%(prog)s 3.8.5&#39;) args = parser.parse_args()  $ ./arg_parse.py --version wchat 3.8.5</code></pre></li></ol><p><strong>required</strong>指定该参数或者选项是必须提供的，否则会报错退出。</p><p><strong>type</strong>指定参数的类型，可以是任何python内建的数据类型如int等，也可以是自定义的类型转换函数的函数名。例如：</p><pre><code>$ cat ./arg_parse.py #!/usr/bin/env pythonimport argparseparser = argparse.ArgumentParser()parser.add_argument(&#39;-f&#39;, &#39;--foo&#39;, type=int)args = parser.parse_args()print(args.foo)$ ./arg_parse.py -f 1212$ ./arg_parse.py -f &#39;12&#39;12$ ./arg_parse.py -f hellousage: arg_parse.py [-h] [-f FOO]arg_parse.py: error: argument -f/--foo: invalid int value: &#39;hello&#39;</code></pre><p><strong>choices</strong>指定一组参数，选项的参数必须从这组参数中来选取。例如：</p><pre><code>$ cat arg_parse.py #!/usr/bin/env pythonimport argparseparser = argparse.ArgumentParser()parser.add_argument(&#39;-f&#39;, &#39;--foo&#39;, type=int, choices=range(1, 4))args = parser.parse_args()print(args.foo)$ ./arg_parse.py -f33$ ./arg_parse.py -f19usage: arg_parse.py [-h] [-f &#123;1,2,3&#125;]arg_parse.py: error: argument -f/--foo: invalid choice: 19 (choose from 1, 2, 3)</code></pre><p><strong>help</strong>指定参数或者选项的帮助信息，会出现在help文档里。</p><p>metavar可以改变帮助文档中选项的参数占位字符串，例如，–foo默认的占位字符串为FOO，可以通过metavar改为foo_arg：</p><pre><code>$ cat arg_parse.py #!/usr/bin/env pythonimport argparseparser = argparse.ArgumentParser()parser.add_argument(&#39;-f&#39;, &#39;--foo&#39;)args = parser.parse_args()print(args.foo)$ ./arg_parse.py -husage: arg_parse.py [-h] [-f FOO]optional arguments:  -h, --help         show this help message and exit  -f FOO, --foo FOO$ cat arg_parse.py #!/usr/bin/env pythonimport argparseparser = argparse.ArgumentParser()parser.add_argument(&#39;-f&#39;, &#39;--foo&#39;, metavar=&#39;foo_arg&#39;)args = parser.parse_args()print(args.foo)$ ./arg_parse.py -husage: arg_parse.py [-h] [-f foo_arg]optional arguments:  -h, --help            show this help message and exit  -f foo_arg, --foo foo_arg</code></pre><p>dest可以修改存储参数的属性名，例如：</p><pre><code>$ cat arg_parse.py #!/usr/bin/env pythonimport argparseparser = argparse.ArgumentParser()parser.add_argument(&#39;-f&#39;, &#39;--foo&#39;, dest=&#39;bar&#39;)args = parser.parse_args()print(args.bar)$ ./arg_parse.py -f hellohello</code></pre><h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>getopt虽然提供了接近Unix C的用户接口，方便了熟悉Unix C的程序猿/媛们，但argparse模块功能更为强大，使用起来也更为简洁，所以大多数的python项目都采用argparse来解析参数。</p>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于web技术的操作系统安装器的设计</title>
      <link href="/2016/11/17/%E5%9F%BA%E4%BA%8Eweb%E6%8A%80%E6%9C%AF%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E5%99%A8%E7%9A%84%E8%AE%BE%E8%AE%A1/"/>
      <url>/2016/11/17/%E5%9F%BA%E4%BA%8Eweb%E6%8A%80%E6%9C%AF%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E5%99%A8%E7%9A%84%E8%AE%BE%E8%AE%A1/</url>
      
        <content type="html"><![CDATA[<h3 id="什么是基于web技术的安装器-web-based-installer-？"><a href="#什么是基于web技术的安装器-web-based-installer-？" class="headerlink" title="什么是基于web技术的安装器(web-based installer)？"></a>什么是基于web技术的安装器(web-based installer)？</h3><p>传统的Linux操作系统安装需要启动一个LiveOS，然后在LiveOS中运行一个本地安装程序，如Fedora下的Anaconda. LiveOS除了让用户在安装操作系统之前能预先体验之外，也为安装器提供了运行环境。这对于桌面操作系统已然足够，因为PC、笔记本电脑自带终端设备——键盘、显示器、鼠标。然而，如果要给一台服务器安装操作系统则稍微复杂了一点，因为服务器通常没有这些终端设备。这就需要利用网络和VNC将服务器端的图像传送出来。这样做的缺点在于，网络负载很大，在网络条件不好的环境下会带给用户非常差的安装体验。另外，本地安装器也会依赖很多的图形软件包，不仅会增加ISO的大小，也会带来很多版权及法律上的工作量。</p><p>基于web技术的安装器则利用web开发技术——HTML5,Javascript,CSS,web server等，让用户可以通过浏览器直接安装操作系统。目前，”KVM for IBM z Systems”已经采用这种安装方式。</p><h3 id="基于web技术安装器的优势"><a href="#基于web技术安装器的优势" class="headerlink" title="基于web技术安装器的优势"></a>基于web技术安装器的优势</h3><ul><li>  依赖更少的软件包</li><li>  非常小的网络负载，网页加载后只需要通过Ajax来与服务器通信</li><li>  可通过浏览器跨平台访问</li><li>  对于服务器及集群安装非常方便</li><li>  易于与其他软件集成，提供RESTful API</li><li>  满足可访问性，方便残障人士使用</li></ul><h3 id="使用web安装器的安装流程"><a href="#使用web安装器的安装流程" class="headerlink" title="使用web安装器的安装流程"></a>使用web安装器的安装流程</h3><p>使用web安装器来安装操作系统的流程非常简单，只需要如下几个步骤：</p><ol><li> 加载ISO</li><li> 用https://{IP_OF_SERVER}作为URL来访问安装器</li><li> 按照安装器的引导完成安装</li><li> 点击安装器的重启按钮重启服务器，安装完成</li></ol><h3 id="Web安装器实现的功能"><a href="#Web安装器实现的功能" class="headerlink" title="Web安装器实现的功能"></a>Web安装器实现的功能</h3><ul><li>  国际化及多语言支持，选择安装语言与系统语言</li><li>  版权声明</li><li>  磁盘列表及选择安装磁盘</li><li>  添加SCSI磁盘</li><li>  添加DASD磁盘</li><li>  Swap分区加密</li><li>  自动分区</li><li>  手动分区</li><li>  分区操作列表</li><li>  激活网卡</li><li>  IPv4配置</li><li>  IPv6配置</li><li>  主机名及搜索域配置</li><li>  NTP配置</li><li>  Kdump配置</li><li>  时区设置</li><li>  Root密码设置</li><li>  添加、删除用户</li><li>  配置总结列表</li><li>  无人值守安装</li><li>  安装日志下载</li></ul><h3 id="Web安装器的架构设计"><a href="#Web安装器的架构设计" class="headerlink" title="Web安装器的架构设计"></a><strong>Web安装器的架构设计</strong></h3><p>Web安装器分为前端和后端两部分实现：前端负责UI展示及用户交互，后端负责给前端提供RESTful API并根据前端的API调用来存储用户配置数据，执行分区、安装、配置目标系统等操作。</p><p>Web安装器由4个HTML页面组成：</p><ul><li>  欢迎页：介绍操作系统，提供选择安装语言的下拉框，点击下一步可进入到版权声明页</li><li>  版权声明页：显示版权文件，在用户同意后可跳转到配置页面</li><li>  配置页：引导用户进行系统配置</li><li>  安装页：展示安装进度，安装完成后可点击重启按钮重启系统</li></ul><p>UI是基于HTML5、CSS3及Javascript等网页开发技术，并利用如下工具：</p><ul><li>  jQuery：一个快速、小巧且功能丰富的js库，可用来操作DOM，处理事件及Ajax请求</li><li>  Bootstrap：最流行的前端开发框架之一，多用于开发响应式、移动优先的web项目</li><li>  Bootstrap-select： jQuery 插件，利用Bootstrap，但提供了功能更加丰富的下拉选择框控件</li><li>  Jquery Validation ：jQuery插件，用来检验表单的合法性</li></ul><p>后端由以下几个模块组成：</p><ul><li>  CherryPy：一个轻量级的python web发布器</li><li>  Model：存储用户的配置数据</li><li>  RESTful API：为前端提供API接口</li><li>  子功能模块：提供安装器的各个子功能</li></ul>]]></content>
      
      
      <categories>
          
          <category> 系统开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kvm </tag>
            
            <tag> virtualization </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>QEMU3 - 使用ceph来存储QEMU镜像</title>
      <link href="/2016/09/30/QEMU3%E4%BD%BF%E7%94%A8ceph%E6%9D%A5%E5%AD%98%E5%82%A8QEMU%E9%95%9C%E5%83%8F/"/>
      <url>/2016/09/30/QEMU3%E4%BD%BF%E7%94%A8ceph%E6%9D%A5%E5%AD%98%E5%82%A8QEMU%E9%95%9C%E5%83%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="ceph简介"><a href="#ceph简介" class="headerlink" title="ceph简介"></a>ceph简介</h1><p>Ceph是一个PB级别的分布式软件定义存储系统，为用户提供了块存储、对象存储以及符合POSIX标准的文件系统接口。目前，Ceph已经成为Openstack最受欢迎的后端存储系统。下图为ceph的架构图。</p><p>RADOS本身是一个对象存储系统，实现了ceph的核心功能。Librados是ceph提供给各种编程语言的接口。RADOSGW,RBD,CEPH FS分别为用户提供了对象存储、块存储及文件系统的功能。Ceph集群及客户端的安装配置请参考<a href="http://docs.ceph.com/docs/master/install/">Ceph官方文档</a>。</p><h1 id="使用Ceph来存储QEMU镜像"><a href="#使用Ceph来存储QEMU镜像" class="headerlink" title="使用Ceph来存储QEMU镜像"></a>使用Ceph来存储QEMU镜像</h1><p>QEMU会假定ceph配置文件存放在默认位置/etc/ceph/$cluster.conf，也会使用client.admin作为默认的ceph用户。如果要指定其他的配置文件或者用户，可以在ceph RBD的选项中添加conf=/home/ceph.conf或者id=admin选项。qemu-img使用ceph块存储RBD时，需要使用下面的格式：</p><pre><code>qemu-img &#123;command&#125; [options] rbd:&#123;pool-name&#125;/&#123;image-name&#125;[@snapshot-name][:option1=value1][:option2=value2...] </code></pre><p>例如：</p><pre><code>qemu-img &#123;command&#125; [options] rbd:glance-pool/maipo:id=glance:conf=/etc/ceph/ceph.conf </code></pre><h2 id="创建一个镜像"><a href="#创建一个镜像" class="headerlink" title="创建一个镜像"></a>创建一个镜像</h2><p>可以使用qemu-img命令在ceph集群中创建一个虚拟机镜像。需要指定rbd, pool,以及镜像名。</p><pre><code>qemu-img create -f raw rbd:&#123;pool-name&#125;/&#123;image-name&#125; &#123;size&#125; </code></pre><p>例如：</p><pre><code>[root@ltczhp20 ~]# qemu-img create -f raw rbd:rbd/vmdisk1 4GFormatting &#39;rbd:rbd/vmdisk1&#39;, fmt=raw size=4294967296[root@ltczhp20 ~]# rbd lsvmdisk1</code></pre><p>qemu-img通常会指定RBD存储的镜像格式是RAW，这样可以减少其他格式带来的性能开销，也会防止虚拟机热迁移时缓存带来的问题。</p><h2 id="调整镜像的大小"><a href="#调整镜像的大小" class="headerlink" title="调整镜像的大小"></a><strong>调整镜像的大小</strong></h2><p>要调整镜像大小，必须指定rbd,pool name,以及镜像名。</p><pre><code>qemu-img resize rbd:&#123;pool-name&#125;/&#123;image-name&#125; &#123;size&#125; </code></pre><p>例如：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">root@ltczhp20 ~</span>]<span class="meta"># qemu-img resize -f raw rbd:rbd/vmdisk1 2G</span></span><br><span class="line"></span><br><span class="line">Image resized.</span><br><span class="line">[<span class="meta">root@ltczhp20 ~</span>]<span class="meta"># rbd ls</span></span><br><span class="line">vmdisk1</span><br><span class="line">[<span class="meta">root@ltczhp20 ~</span>]<span class="meta"># rbd info vmdisk1</span></span><br><span class="line">rbd image <span class="string">&#x27;vmdisk1&#x27;</span>:</span><br><span class="line">    size <span class="number">2048</span> MB <span class="keyword">in</span> <span class="number">512</span> objects</span><br><span class="line">    order <span class="number">22</span> (<span class="number">4096</span> kB objects)</span><br><span class="line">    block_name_prefix: rbd_data.fa802ae8944a</span><br><span class="line">    format: <span class="number">2</span></span><br><span class="line">    features: layering, exclusive-<span class="keyword">lock</span>, <span class="built_in">object</span>-map, fast-diff, deep-flatten</span><br><span class="line">    flags:</span><br></pre></td></tr></table></figure><p>如果不指定镜像格式(-f raw)，qemu会给出警告信息：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@ltczhp20 ~]# qemu-img resize rbd:rbd/vmdisk1 4G</span><br><span class="line"><span class="symbol">WARNING: </span>Image format was not specified for <span class="emphasis">&#x27;rbd:rbd/vmdisk1&#x27;</span> and probing guessed raw.</span><br><span class="line"><span class="code">         Automatically detecting the format is dangerous for raw images, write operations on block 0 will be restricted.</span></span><br><span class="line"><span class="code">         Specify the &#x27;raw&#x27; format explicitly to remove the restrictions.</span></span><br><span class="line">Image resized.</span><br></pre></td></tr></table></figure><h2 id="获取镜像信息"><a href="#获取镜像信息" class="headerlink" title="获取镜像信息"></a><strong>获取镜像信息</strong></h2><p>获取镜像信息同样需要指定rbd,pool name以及镜像名：</p><pre><code>qemu-img info rbd:&#123;pool-name&#125;/&#123;image-name&#125;</code></pre><p>例如：</p><pre><code>[root@ltczhp20 ~]# qemu-img info rbd:rbd/vmdisk1image: rbd:rbd/vmdisk1file format: rawvirtual size: 4.0G (4294967296 bytes)disk size: unavailablecluster_size: 4194304</code></pre><h2 id="使用qemu命令运行虚拟机"><a href="#使用qemu命令运行虚拟机" class="headerlink" title="使用qemu命令运行虚拟机"></a><strong>使用qemu命令运行虚拟机</strong></h2><p>从QEMU0.15后，虚拟机使用ceph块设备就不需要使用rbd map命令将RBD镜像映射到本地了，QEMU可以通过librados直接访问一个虚拟块设备。这样避免了额外的上下文切换，也充分利用了RBD的缓存功能。</p><p>在运行虚拟机之前，我们可以把一个已经存在的虚拟机镜像转化为ceph RBD存储，然后直接从RBD启动虚拟机。</p><pre><code>qemu-img convert -c -f fmt -O out\_fmt -o options  fname out\_fname </code></pre><p>例如：</p><pre><code>[root@ltczhp20 ~]# qemu-img convert -f qcow2 -O raw /srv/fedora24/fedora24.qcow2 rbd:rbd/fedora</code></pre><p>然后使用qemu命令运行虚拟机。</p><pre><code>[root@ltczhp20 ~]# qemu-system-s390x -nographic -enable-kvm -m 4G -drive format=raw,file=rbd:rbd/fedora</code></pre><p>RBD缓存会极大的提高虚拟机的性能。QEMU1.2之后，cache选项可以直接控制librbd：</p><pre><code>[root@ltczhp20 ~]# qemu-system-s390x -nographic -enable-kvm -m 4G -drive format=raw,file=rbd:rbd/fedora,cache=writeback</code></pre><p>在QEMU1.2之前，如果要使用RBD缓存，需要额外添加rbd_cache=true选项：</p><pre><code>[root@ltczhp20 ~]# qemu-system-s390x -nographic -enable-kvm -m 4G -drive format=raw,file=rbd:rbd/fedora,cache=writeback,rbd_cache=true</code></pre><p>如果指定了rbd_cache=true，一定要指定cache=writeback，否则QEMU不会给librbd发送flush请求，RBD之上的文件系统可能会被破坏。</p><h2 id="使用ceph-RBD的快照功能"><a href="#使用ceph-RBD的快照功能" class="headerlink" title="使用ceph RBD的快照功能"></a><strong>使用ceph RBD的快照功能</strong></h2><p>创建一个镜像快照sp0：</p><pre><code>[root@ltczhp20 ~]# qemu-img snapshot -l rbd:rbd/fedora[root@ltczhp20 ~]# qemu-img snapshot -c sp0 rbd:rbd/fedoraWARNING: Image format was not specified for &#39;rbd:rbd/fedora&#39; and probing guessed raw.         Automatically detecting the format is dangerous for raw images, write operations on block 0 will be restricted.         Specify the &#39;raw&#39; format explicitly to remove the restrictions.[root@ltczhp20 ~]# qemu-img snapshot -l rbd:rbd/fedoraSnapshot list:ID        TAG                 VM SIZE                DATE       VM CLOCKsp0       sp0                     20G 1970-01-01 01:00:00   00:00:00.000</code></pre><p>启动虚拟机，创建文件/root/hello.txt并写入字符串”hello world”，然后关闭虚拟机。</p><pre><code>[root@ltczhp20 ~]# qemu-system-s390x -nographic -enable-kvm -m 4G -drive format=raw,file=rbd:rbd/fedoraIn VM:[root@localhost ~]# echo &quot;hello world&quot; &gt;&gt; /root/hello.txt[root@localhost ~]# cat /root/hello.txthello world[root@localhost ~]# halt</code></pre><p>将虚拟机回滚到快照sp0，然后检查是否存在/root/hello.txt文件，如果不存在则说明快照已经成功回滚。</p><pre><code>[root@ltczhp20 ~]# qemu-img snapshot -a sp0 rbd:rbd/fedora[root@ltczhp20 ~]# qemu-system-s390x -nographic -enable-kvm -m 4G -drive format=raw,file=rbd:rbd/fedoraIn VM:[root@localhost ~]# ls /root/hello.txtls: cannot access &#39;/root/hello.txt&#39;: No such file or directory[root@localhost ~]# halt</code></pre><p>删除快照：</p><pre><code>[root@ltczhp20 ~]# rbd snap ls rbd/fedoraSNAPID NAME     SIZE    22 sp0  20480 MB[root@ltczhp20 ~]# qemu-img snapshot -d sp0 rbd:rbd/fedoraWARNING: Image format was not specified for &#39;rbd:rbd/fedora&#39; and probing guessed raw.         Automatically detecting the format is dangerous for raw images, write operations on block 0 will be restricted.         Specify the &#39;raw&#39; format explicitly to remove the restrictions.[root@ltczhp20 ~]# rbd snap ls rbd/fedora[root@ltczhp20 ~]# qemu-img snapshot -l rbd:rbd/fedora</code></pre>]]></content>
      
      
      <categories>
          
          <category> 云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> qemu </tag>
            
            <tag> virtualization </tag>
            
            <tag> ceph </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>顺序存储线性表的实现</title>
      <link href="/2016/06/06/%E9%A1%BA%E5%BA%8F%E5%AD%98%E5%82%A8%E7%BA%BF%E6%80%A7%E8%A1%A8%E7%9A%84%E5%AE%9E%E7%8E%B0/"/>
      <url>/2016/06/06/%E9%A1%BA%E5%BA%8F%E5%AD%98%E5%82%A8%E7%BA%BF%E6%80%A7%E8%A1%A8%E7%9A%84%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>最近复习数据结构，写了一个顺序存储的线性表，代码粘在这里：）</p><p><a href="mailto:代码下载：git@github.com">代码下载：git@github.com</a>:Wang-Sen/algorithm.git</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    * Simple array implementation.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_SIZE 50</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> data_t int</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> array_length_t int</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ERR_OUT_OF_RANGE -1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ERR_EMPTY_ARRAY -2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ERR_INVALID_ARGS -3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">data_t</span> data[MAX_SIZE];</span><br><span class="line">    <span class="keyword">array_length_t</span> length;</span><br><span class="line">&#125; <span class="built_in">array</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">array_init</span><span class="params">(<span class="built_in">array</span> *arr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAX_SIZE; i++) &#123;</span><br><span class="line">        arr-&gt;data[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    arr-&gt;length = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">show_array</span><span class="params">(<span class="built_in">array</span> *arr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; arr-&gt;length; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, arr-&gt;data[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">is_array_empty</span><span class="params">(<span class="built_in">array</span> *arr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!arr) &#123;</span><br><span class="line">        <span class="keyword">return</span> ERR_INVALID_ARGS;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> !arr-&gt;length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">array_length_t</span> <span class="title">len</span><span class="params">(<span class="built_in">array</span> *arr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!arr) &#123;</span><br><span class="line">        <span class="keyword">return</span> ERR_INVALID_ARGS;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr-&gt;length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">locate_entry</span><span class="params">(<span class="built_in">array</span> *arr, <span class="keyword">data_t</span> entry)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!arr) &#123;</span><br><span class="line">        <span class="keyword">return</span> ERR_INVALID_ARGS;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAX_SIZE; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr-&gt;data[i] == entry) &#123;</span><br><span class="line">            ret = i;</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">array_push</span><span class="params">(<span class="built_in">array</span> *arr, <span class="keyword">data_t</span> entry)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!arr) &#123;</span><br><span class="line">        <span class="keyword">return</span> ERR_INVALID_ARGS;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((arr-&gt;length + <span class="number">1</span>) &gt; MAX_SIZE) &#123;</span><br><span class="line">        <span class="keyword">return</span> ERR_OUT_OF_RANGE;</span><br><span class="line">    &#125;</span><br><span class="line">    arr-&gt;data[arr-&gt;length] = entry;</span><br><span class="line">    (arr-&gt;length)++;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">array_pop</span><span class="params">(<span class="built_in">array</span> *arr, <span class="keyword">data_t</span> *p_entry)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (arr-&gt;length &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> ERR_EMPTY_ARRAY;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!p_entry || !arr) &#123;</span><br><span class="line">        <span class="keyword">return</span> ERR_INVALID_ARGS;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    *p_entry = arr-&gt;data[arr-&gt;length - <span class="number">1</span>];</span><br><span class="line">    (arr-&gt;length)--;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">array_insert</span><span class="params">(<span class="built_in">array</span> *arr, <span class="keyword">int</span> loc, <span class="keyword">data_t</span> entry)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!arr) &#123;</span><br><span class="line">        <span class="keyword">return</span> ERR_INVALID_ARGS;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((arr-&gt;length + <span class="number">1</span>) &gt; MAX_SIZE || loc &lt; <span class="number">0</span> || loc &gt;= MAX_SIZE) &#123;</span><br><span class="line">        <span class="keyword">return</span> ERR_OUT_OF_RANGE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = arr-&gt;length; i &gt; loc; i--) &#123;</span><br><span class="line">        arr-&gt;data[i] = arr-&gt;data[i - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    arr-&gt;data[loc] = entry;</span><br><span class="line">    (arr-&gt;length)++;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">array_delete</span><span class="params">(<span class="built_in">array</span> *arr, <span class="keyword">int</span> loc, <span class="keyword">data_t</span> *entry)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!arr || !entry) &#123;</span><br><span class="line">        <span class="keyword">return</span> ERR_INVALID_ARGS;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (loc &lt; <span class="number">0</span> || loc &gt;= arr-&gt;length) &#123;</span><br><span class="line">        <span class="keyword">return</span> ERR_OUT_OF_RANGE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    *entry = arr-&gt;data[loc];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = loc; i &lt; (arr-&gt;length) - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        arr-&gt;data[i] = arr-&gt;data[i + <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    (arr-&gt;length)--;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">array_update</span><span class="params">(<span class="built_in">array</span> *arr, <span class="keyword">int</span> loc, <span class="keyword">data_t</span> entry)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!arr) &#123;</span><br><span class="line">        <span class="keyword">return</span> ERR_INVALID_ARGS;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!arr-&gt;length) &#123;</span><br><span class="line">        <span class="keyword">return</span> ERR_EMPTY_ARRAY;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (loc &lt; <span class="number">0</span> || loc &gt;= arr-&gt;length) &#123;</span><br><span class="line">        <span class="keyword">return</span> ERR_OUT_OF_RANGE;</span><br><span class="line">    &#125;</span><br><span class="line">    arr-&gt;data[loc] = entry;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">array_reverse</span><span class="params">(<span class="built_in">array</span> *arr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!arr) &#123;</span><br><span class="line">        <span class="keyword">return</span> ERR_INVALID_ARGS;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> i, j, tmp;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>, j = (arr-&gt;length - <span class="number">1</span>); j - i &gt; <span class="number">0</span>; i++, j--) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr-&gt;data[i] == arr-&gt;data[j]) &#123;</span><br><span class="line">            tmp = arr-&gt;data[i];</span><br><span class="line">            arr-&gt;data[i] = arr-&gt;data[j];</span><br><span class="line">            arr-&gt;data[j] = tmp;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            arr-&gt;data[i] ^= arr-&gt;data[j];</span><br><span class="line">            arr-&gt;data[j] ^= arr-&gt;data[i];</span><br><span class="line">            arr-&gt;data[i] ^= arr-&gt;data[j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;array.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>, i;</span><br><span class="line">    <span class="built_in">array</span> <span class="built_in">list</span>;</span><br><span class="line">    array_init(&amp;<span class="built_in">list</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* test is_empty_array */</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Empty array: %d\n&quot;</span>, is_array_empty(&amp;<span class="built_in">list</span>));</span><br><span class="line">    <span class="built_in">list</span>.data[<span class="number">0</span>] = <span class="number">2400</span>;</span><br><span class="line">    <span class="built_in">list</span>.length += <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Empty array: %d\n&quot;</span>, is_array_empty(&amp;<span class="built_in">list</span>));</span><br><span class="line">    <span class="comment">/* end test is_empty_array */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* test push */</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="built_in">list</span>.length; i &lt; MAX_SIZE; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((ret = array_push(&amp;<span class="built_in">list</span>, i))) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Err: %d\n&quot;</span>, ret);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;length: %d\n&quot;</span>, <span class="built_in">list</span>.length);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Entry: %d\n&quot;</span>, i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    show_array(&amp;<span class="built_in">list</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((ret = array_push(&amp;<span class="built_in">list</span>, <span class="number">20</span>))) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Err: %d\n&quot;</span>, ret);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;length: %d\n&quot;</span>, <span class="built_in">list</span>.length);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Entry: %d\n&quot;</span>, <span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* end test push */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* test insert */</span></span><br><span class="line">    array_init(&amp;<span class="built_in">list</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="built_in">list</span>.length; i &lt; MAX_SIZE<span class="number">-1</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((ret = array_push(&amp;<span class="built_in">list</span>, i))) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Err: %d\n&quot;</span>, ret);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;length: %d\n&quot;</span>, <span class="built_in">list</span>.length);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Entry: %d\n&quot;</span>, i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    array_insert(&amp;<span class="built_in">list</span>, <span class="number">3</span>, <span class="number">5</span>);</span><br><span class="line">    show_array(&amp;<span class="built_in">list</span>);</span><br><span class="line"></span><br><span class="line">    array_insert(&amp;<span class="built_in">list</span>, <span class="number">3</span>, <span class="number">6</span>);</span><br><span class="line">    show_array(&amp;<span class="built_in">list</span>);</span><br><span class="line"></span><br><span class="line">    array_init(&amp;<span class="built_in">list</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="built_in">list</span>.length; i &lt; MAX_SIZE<span class="number">-1</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((ret = array_push(&amp;<span class="built_in">list</span>, i))) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Err: %d\n&quot;</span>, ret);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;length: %d\n&quot;</span>, <span class="built_in">list</span>.length);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Entry: %d\n&quot;</span>, i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    array_insert(&amp;<span class="built_in">list</span>, MAX_SIZE, <span class="number">5</span>);</span><br><span class="line">    show_array(&amp;<span class="built_in">list</span>);</span><br><span class="line">    <span class="comment">/* end test insert */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* test locate_entry */</span></span><br><span class="line">    array_init(&amp;<span class="built_in">list</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="built_in">list</span>.length; i &lt; MAX_SIZE; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((ret = array_push(&amp;<span class="built_in">list</span>, i))) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Err: %d\n&quot;</span>, ret);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;length: %d\n&quot;</span>, <span class="built_in">list</span>.length);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Entry: %d\n&quot;</span>, i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;location of 5 is: %d\n&quot;</span>, locate_entry(&amp;<span class="built_in">list</span>, <span class="number">5</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;location of 10 is: %d\n&quot;</span>, locate_entry(&amp;<span class="built_in">list</span>, <span class="number">10</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;location of 100 is: %d\n&quot;</span>, locate_entry(&amp;<span class="built_in">list</span>, <span class="number">100</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;location of -100 is: %d\n&quot;</span>, locate_entry(&amp;<span class="built_in">list</span>, <span class="number">-100</span>));</span><br><span class="line">    <span class="comment">/* end test locate_entry */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* test len*/</span></span><br><span class="line">    array_init(&amp;<span class="built_in">list</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">38</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((ret = array_push(&amp;<span class="built_in">list</span>, i))) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Err: %d\n&quot;</span>, ret);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;length: %d\n&quot;</span>, <span class="built_in">list</span>.length);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Entry: %d\n&quot;</span>, i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;len : %d\n&quot;</span>, len(&amp;<span class="built_in">list</span>));</span><br><span class="line">    <span class="comment">/* end test len */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* test pop */</span></span><br><span class="line">    array_init(&amp;<span class="built_in">list</span>);</span><br><span class="line">    <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) &#123;</span><br><span class="line">        array_push(&amp;<span class="built_in">list</span>, j);</span><br><span class="line">        j += <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    show_array(&amp;<span class="built_in">list</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">27</span>; i++) &#123;</span><br><span class="line">        array_pop(&amp;<span class="built_in">list</span>, &amp;j);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Pop Entry: %d\n&quot;</span>, j);</span><br><span class="line">        show_array(&amp;<span class="built_in">list</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* end test pop */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* test delete*/</span></span><br><span class="line">    array_init(&amp;<span class="built_in">list</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) &#123;</span><br><span class="line">        array_push(&amp;<span class="built_in">list</span>, j);</span><br><span class="line">        j += <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    show_array(&amp;<span class="built_in">list</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">27</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (array_delete(&amp;<span class="built_in">list</span>, i, &amp;j) != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Delete %dth entry error!\n&quot;</span>, i);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Deleted Entry: %d\n&quot;</span>, j);</span><br><span class="line">        show_array(&amp;<span class="built_in">list</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* end test delete */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* test update*/</span></span><br><span class="line">    array_init(&amp;<span class="built_in">list</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) &#123;</span><br><span class="line">        array_push(&amp;<span class="built_in">list</span>, j);</span><br><span class="line">        j += <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    show_array(&amp;<span class="built_in">list</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">28</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (array_update(&amp;<span class="built_in">list</span>, i, <span class="number">99</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Update %dth entry error!\n&quot;</span>, i);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Updated %dth Entry: %d\n&quot;</span>, i, j);</span><br><span class="line">        show_array(&amp;<span class="built_in">list</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* end test update */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* test reverse*/</span></span><br><span class="line">    array_init(&amp;<span class="built_in">list</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; MAX_SIZE; i++) &#123;</span><br><span class="line">        array_push(&amp;<span class="built_in">list</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">    show_array(&amp;<span class="built_in">list</span>);</span><br><span class="line">    array_reverse(&amp;<span class="built_in">list</span>);</span><br><span class="line">    show_array(&amp;<span class="built_in">list</span>);</span><br><span class="line">    <span class="comment">/* end test reverse */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在fedora下使用搜狗拼音输入法</title>
      <link href="/2016/04/07/%E5%9C%A8fedora%E4%B8%8B%E4%BD%BF%E7%94%A8%E6%90%9C%E7%8B%97%E6%8B%BC%E9%9F%B3%E8%BE%93%E5%85%A5%E6%B3%95/"/>
      <url>/2016/04/07/%E5%9C%A8fedora%E4%B8%8B%E4%BD%BF%E7%94%A8%E6%90%9C%E7%8B%97%E6%8B%BC%E9%9F%B3%E8%BE%93%E5%85%A5%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>Linux下的拼音输入法实在是不敢恭维，还好有人把搜狗拼音输入法制作成了RPM包．安装此rpm包就可以在Linux下面使用搜狗拼音输入法及其字库了．</p><p>第一步，下载RPM包．</p><p>百度网盘地址：<a href="http://pan.baidu.com/s/1bpblFoN">http://pan.baidu.com/s/1bpblFoN</a></p><p>第二步，安装RPM包.</p><pre><code>$sudo yum install  fcitx-sogoupinyin-0.0.4-1.fc20.x86_64.rpm  //注意输入正确的路径</code></pre><p>第三步，卸载ibus.</p><pre><code>$sudo yum remove ibus</code></pre><p>第四步，设置fcitx开机自动启动.</p><pre><code>$sudo yum install gnome-tweak-tool$gnome-tweak-tool  //在开机启动一项中添加fcitx即可</code></pre><p>第五步，重启gnome</p><pre><code>$gnome-session-quit</code></pre><p>最后，使用Ctrl+space愉快的玩耍.</p>]]></content>
      
      
      <categories>
          
          <category> 开发工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fcitx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用jQuery Validation插件来验证表单</title>
      <link href="/2016/04/01/%E4%BD%BF%E7%94%A8jQueryValidation%E6%8F%92%E4%BB%B6%E6%9D%A5%E9%AA%8C%E8%AF%81%E8%A1%A8%E5%8D%95/"/>
      <url>/2016/04/01/%E4%BD%BF%E7%94%A8jQueryValidation%E6%8F%92%E4%BB%B6%E6%9D%A5%E9%AA%8C%E8%AF%81%E8%A1%A8%E5%8D%95/</url>
      
        <content type="html"><![CDATA[<p><a href="http://jqueryvalidation.org/">jQuery Validation</a>是一个用于验证表单的jQuery插件，简单易用，已经包含了16种内置的验证规则．<a href="https://github.com/jzaefferer/jquery-validation/tree/master/src/additional">Github</a>上也有更多的验证规则可以使用．这都不是重点，重点是你可以轻松的定制自己的规则．</p><p>内置规则：</p><ul><li>  required – Makes the element required.</li><li>  remote – Requests a resource to check the element for validity.</li><li>  minlength – Makes the element require a given minimum length.</li><li>  maxlength – Makes the element require a given maximum length.</li><li>  rangelength – Makes the element require a given value range.</li><li>  min – Makes the element require a given minimum.</li><li>  max – Makes the element require a given maximum.</li><li>  range – Makes the element require a given value range.</li><li>  step – Makes the element require a given step.</li><li>  email – Makes the element require a valid email</li><li>  url – Makes the element require a valid url</li><li>  date – Makes the element require a date.</li><li>  dateISO – Makes the element require an ISO date.</li><li>  number – Makes the element require a decimal number.</li><li>  digits – Makes the element require digits only.</li><li>  equalTo – Requires the element to be the same as another one</li></ul><p><strong><em>内置规则的使用</em></strong></p><p>内置规则的使用非常简单：</p><p>首先将该插件的js文件包含进html文件：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/static/js/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/static/js/jquery.validate.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后用jQuery选择需要验证的表单，执行validate()函数即可：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    $(<span class="string">&quot;#form_id&quot;</span>).validate();</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> ```   </span><br><span class="line"></span><br><span class="line">jQuery Validation官网上的例子：</span><br></pre></td></tr></table></figure><pre><code>    &lt;!DOCTYPE HTML&gt;    &lt;html&gt;    &lt;head&gt;    &lt;script src=&quot;jquery.min.js&quot;&gt;&lt;/script&gt;    &lt;/head&gt;    &lt;body&gt;    &lt;form class=&quot;cmxform&quot; id=&quot;commentForm&quot; method=&quot;get&quot; action=&quot;&quot;&gt;    &lt;fieldset&gt;    &lt;legend&gt;Please provide your name, email address (won&#39;t be published) and a comment&lt;/legend&gt;    &lt;p&gt;    &lt;label for=&quot;cname&quot;&gt;Name (required, at least 2 characters)&lt;/label&gt;    &lt;input id=&quot;cname&quot; name=&quot;name&quot; minlength=&quot;2&quot; type=&quot;text&quot; required&gt;    &lt;/p&gt;    &lt;p&gt;    &lt;label for=&quot;cemail&quot;&gt;E-Mail (required)&lt;/label&gt;    &lt;input id=&quot;cemail&quot; type=&quot;email&quot; name=&quot;email&quot; required&gt;    &lt;/p&gt;    &lt;p&gt;    &lt;label for=&quot;curl&quot;&gt;URL (optional)&lt;/label&gt;    &lt;input id=&quot;curl&quot; type=&quot;url&quot; name=&quot;url&quot;&gt;    &lt;/p&gt;    &lt;p&gt;    &lt;label for=&quot;ccomment&quot;&gt;Your comment (required)&lt;/label&gt;    &lt;textarea id=&quot;ccomment&quot; name=&quot;comment&quot; required&gt;&lt;/textarea&gt;    &lt;/p&gt;    &lt;p&gt;    &lt;input class=&quot;submit&quot; type=&quot;submit&quot; value=&quot;Submit&quot;&gt;    &lt;/p&gt;    &lt;/fieldset&gt;    &lt;/form&gt;    &lt;script&gt;    $(&quot;#commentForm&quot;).validate();    &lt;/script&gt;    &lt;/body&gt;    &lt;/html&gt;</code></pre> <figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">jQuery <span class="symbol">Validation</span>会根据表单设置的type和属性自动为他们分配内置的规则，比如email,url,required等．</span><br><span class="line"></span><br><span class="line">运行一下看看：</span><br><span class="line"></span><br><span class="line">什么都不输入，直接点提交</span><br><span class="line"></span><br><span class="line">输入错误的<span class="symbol">Email</span>地址，改正后错误提示自动消失</span><br><span class="line"></span><br><span class="line">**<span class="symbol">_</span>添加自定义规则<span class="symbol">_</span>**</span><br><span class="line"></span><br><span class="line">jQuery <span class="symbol">Validation</span>最吸引人的feature，它可以轻松的加入自定义的规则：</span><br><span class="line"></span><br><span class="line">第一步，在js中调用jQuery.validator.addMethod函数来添加规则，例如添加<span class="symbol">IP</span>格式检查的规则：</span><br><span class="line"></span><br><span class="line">    $.validator.addMethod( <span class="string">&quot;ipv4&quot;</span>, function( value, element ) &#123;return this.optional( element ) || /^(<span class="number">25</span>[<span class="number">0</span><span class="number">-5</span>]|<span class="number">2</span>[<span class="number">0</span><span class="number">-4</span>]\d|[<span class="number">01</span>]?\d\d?)\.(<span class="number">25</span>[<span class="number">0</span><span class="number">-5</span>]|<span class="number">2</span>[<span class="number">0</span><span class="number">-4</span>]\d|[<span class="number">01</span>]?\d\d?)\.(<span class="number">25</span>[<span class="number">0</span><span class="number">-5</span>]|<span class="number">2</span>[<span class="number">0</span><span class="number">-4</span>]\d|[<span class="number">01</span>]?\d\d?)\.(<span class="number">25</span>[<span class="number">0</span><span class="number">-5</span>]|<span class="number">2</span>[<span class="number">0</span><span class="number">-4</span>]\d|[<span class="number">01</span>]?\d\d?)$/i.test( value );&#125;, <span class="string">&quot;Invalid IP v4 address.&quot;</span> );　//自定义其他规则只需要替换规则名<span class="string">&quot;ipv4&quot;</span>,正则表达式//之间的内容,以及出错后显示的字符串<span class="string">&quot;Invalid IP v4 address.&quot;</span>即可．</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">第二步，把规则应用到指定的表单项，即在执行$(<span class="string">&quot;#form_id&quot;</span>).validate()函数的时候加入rules参数：</span><br></pre></td></tr></table></figure><pre><code>    23 $(&quot;#ip_form&quot;).validate(&#123;    24     rules: &#123;    25         ip: &#123;    26             required: true,    27             ipv4: true,    28         &#125;,    29         netmask: &#123;    30             required: true,    31             ipv4: true,    32         &#125;,    33         gateway: &#123;    34             required: true,    35             ipv4: true,    36         &#125;,    37     &#125;,    38 &#125;); //其中ip,netmask,gateway为表单项的name属性．required和ipv4是规则名．</code></pre><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">生效后的样子，可以添加如下css来修改错误信息的样式：</span><br></pre></td></tr></table></figure><pre><code>    label.error &#123;        margin-left: 10px;        padding-left: 5px;        padding-right: 5px;        color: #E2303A;        font-style: italic;        font: Helvetica Neue, 12px, #E2303A;        border: 1px solid #F2A9AE;    &#125;</code></pre><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**_使用json提交数据_**</span><br><span class="line"></span><br><span class="line">表单验证通过后，提交动作默认是使用form本身的提交动作，即指定form的action和<span class="function"><span class="keyword">method</span>属性：</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">` <span class="title">method</span>=&quot;<span class="title">get</span>&quot; <span class="title">action</span>=&quot;&quot;`</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">可以在<span class="title">validate</span><span class="params">()</span>函数中添加<span class="title">submitHandler</span>参数来指定点击提交后执行的函数，我们可以在该函数中使用$.<span class="title">json</span>来提交数据：</span></span><br></pre></td></tr></table></figure><pre><code>    23 $(&quot;#ip_form&quot;).validate(&#123;    24     rules: &#123;    25         ip: &#123;    26             required: true,    27             ipv4: true,    28         &#125;,    29         netmask: &#123;    30             required: true,    31             ipv4: true,    32         &#125;,    33         gateway: &#123;    34             required: true,    35             ipv4: true,    36         &#125;,    37         dns: &#123;    38             dns: true,    39         &#125;    40     &#125;,    41     submitHandler: function(form) &#123;    42         ip_ok();    43         $(&quot;#ip-conf&quot;).modal(&#39;hide&#39;);    44     &#125;    45 &#125;);</code></pre><p>```    </p>]]></content>
      
      
      <categories>
          
          <category> 应用开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jquery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>迁移宁强在线步骤</title>
      <link href="/2015/11/18/%E8%BF%81%E7%A7%BB%E5%AE%81%E5%BC%BA%E5%9C%A8%E7%BA%BF%E6%AD%A5%E9%AA%A4/"/>
      <url>/2015/11/18/%E8%BF%81%E7%A7%BB%E5%AE%81%E5%BC%BA%E5%9C%A8%E7%BA%BF%E6%AD%A5%E9%AA%A4/</url>
      
        <content type="html"><![CDATA[<h3 id="配置ssh"><a href="#配置ssh" class="headerlink" title="配置ssh"></a>配置ssh</h3><pre><code>#mkdir /root/.ssh &amp;&amp; cp id_rsa* /root/.ssh/</code></pre><h3 id="下载配置脚本"><a href="#下载配置脚本" class="headerlink" title="下载配置脚本"></a>下载配置脚本</h3><pre><code>#git clone git@git.oschina.net:wangsen/auto_conf_fc.git</code></pre><h3 id="安装基础软件"><a href="#安装基础软件" class="headerlink" title="安装基础软件"></a>安装基础软件</h3><pre><code>#cd auto_conf_fc &amp;&amp; bash -x ./conf.sh</code></pre><h3 id="安装web软件"><a href="#安装web软件" class="headerlink" title="安装web软件"></a>安装web软件</h3><pre><code>#yum install net-tools httpd python-django                                   #yum install python python-pip  python-devel  python-wsgi  mod_wsgi   mariadb-server python-mysql mariadb-devel.x86_64 MySQL-python python-html5lib</code></pre><h3 id="克隆网站代码"><a href="#克隆网站代码" class="headerlink" title="克隆网站代码"></a>克隆网站代码</h3><pre><code>#cd /var/www/html &amp;&amp; git clone git@git.oschina.net:wangsen/TownInfo-.git#mvTownInfo- nqys#cd nqys &amp;&amp; cp httpd.conf /etc/httpd/conf/httpd.conf</code></pre><h3 id="安装pip"><a href="#安装pip" class="headerlink" title="安装pip"></a>安装pip</h3><pre><code>#cd ~/auto_conf_fc/nqzx/ &amp;&amp; tar xzvf pip-1.5.6.tar.gz &amp;&amp; cd pip-1.5.6 &amp;&amp; python get-pip.py</code></pre><h3 id="安装Python包"><a href="#安装Python包" class="headerlink" title="安装Python包"></a>安装Python包</h3><pre><code># cds &amp;&amp; pip install -r ../requirements.txt</code></pre><h3 id="启动数据库"><a href="#启动数据库" class="headerlink" title="启动数据库"></a>启动数据库</h3><pre><code>#vim /etc/my.cnf# ## character_set_server=utf8# systemctl enable mariadb# systemctl restart mariadb# mysqladmin -u root password# mysqladmin -u root -p create nqysdb# mysql -u root -p##GRANT ALL PRIVILEGES ON nqysdb.* TO &#39;django_user&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;passw0rd&#39;; </code></pre><h3 id="替换django和registration"><a href="#替换django和registration" class="headerlink" title="替换django和registration"></a>替换django和registration</h3><pre><code># cd /usr/lib/python2.7/site-packages &amp;&amp; rm -rf django# git clone git@git.oschina.net:wangsen/django.git# git clone git@git.oschina.net:wangsen/registration.git</code></pre><h3 id="解决头像上传问题"><a href="#解决头像上传问题" class="headerlink" title="解决头像上传问题"></a>解决头像上传问题</h3><pre><code># cd ~/auto_conf_fc/nqzx &amp;&amp; tar xzvf Imaging-1.1.7.tar.gz# yum install zlib zlib-devel libjpeg libjpeg-devel freetype freetype-devel# cd Imaging-1.1.7 &amp;&amp; vim setup.py修改setup.py：TCL_ROOT = &quot;/usr/lib64/&quot;JPEG_ROOT = &quot;/usr/lib64/&quot;ZLIB_ROOT = &quot;/usr/lib64/&quot;TIFF_ROOT = &quot;/usr/lib64/&quot;FREETYPE_ROOT = &quot;/usr/lib64/&quot;LCMS_ROOT = &quot;/usr/lib64/&quot;# pip uninstall pillow PIL# python setup.py install</code></pre><h3 id="导入备份数据库"><a href="#导入备份数据库" class="headerlink" title="导入备份数据库"></a>导入备份数据库</h3><ol><li><p>备份数据库</p><h1 id="mysqldump-u-root-p-nqysdb-gt-nqzx-db"><a href="#mysqldump-u-root-p-nqysdb-gt-nqzx-db" class="headerlink" title="mysqldump -u root -p nqysdb &gt; nqzx.db"></a>mysqldump -u root -p nqysdb &gt; nqzx.db</h1></li><li><p>导入数据库</p><h1 id="mysql-u-root-p-nqysdb-lt-nqzx-db"><a href="#mysql-u-root-p-nqysdb-lt-nqzx-db" class="headerlink" title="mysql -u root -p nqysdb &lt; nqzx.db"></a>mysql -u root -p nqysdb &lt; nqzx.db</h1></li></ol><h3 id="启动web服务"><a href="#启动web服务" class="headerlink" title="启动web服务"></a>启动web服务</h3><pre><code># cds &amp;&amp; ../manage.py collectstatic# ../manage.py syncdb# service httpd restart</code></pre>]]></content>
      
      
      <categories>
          
          <category> 应用开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网站迁移 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JQuery 摘要</title>
      <link href="/2015/09/06/JQuery%E6%91%98%E8%A6%81/"/>
      <url>/2015/09/06/JQuery%E6%91%98%E8%A6%81/</url>
      
        <content type="html"><![CDATA[<h3 id="选择符与遍历"><a href="#选择符与遍历" class="headerlink" title="选择符与遍历"></a>选择符与遍历</h3><ol><li>$(): $函数接受css选择符作为参数，充当一个工厂函数，返回对应元素的JQuery对象。</li><li>3种基本的选择符:<ul><li>  标签名 $(‘p’)</li><li>  ID $(‘#myid’)</li><li>  类 $(‘.myClass’)</li></ul></li><li>子元素组合符&gt;: $(‘#myid &gt; li’)选择id为myid的元素的所有列表项(li).</li><li>否定式伪类: $(‘#myid li:not(.myClass)’)选择id为myid的元素中不属于myClass类的所有列表项(li).</li><li>属性选择符$(‘img[alt]‘): 选择所有带有alt属性的img元素.</li><li>属性选择符+类正则匹配：<ul><li>  $(‘a[href^=”mailto:”]‘): 选择所有URL以mailto:开头的超链接.</li><li>  $(‘a[href$=”.pdf”]‘): 选择所有URL以.pdf结尾的超链接.</li><li>  $(‘a[href*=”rose”]‘): 选择所有URL中包含rose的超链接.</li></ul></li><li>自定义选择符:<ul><li>  $(‘li:eq(1)’): 选择第二个列表项</li><li>  $(‘li:odd’): 选择奇数的列表项</li><li>  $(‘li:even’): 选择偶数的列表项</li><li>  $(‘li:nth-child(odd)’): 选择从父元素的第一个元素开始计算的所有奇数列表项</li><li>  $(‘li:contain(string)’): 选择包含string的列表项</li></ul></li><li>表单选择符:<ul><li>  :input</li><li>  :button</li><li>  :checked</li><li>  :selected</li><li>  :enabled</li><li>  :disabled</li></ul></li><li>filter: 过滤器，可接选择器和lambda函数<ul><li>  $(‘li’).filter(‘:even’)</li><li>  $(‘li’).filter(function(){return this.hostname &amp;&amp; this.hostname!=location.hostname})</li></ul></li><li>next,nextALL,prev,prevAll,andSelf,siblings:选择所选元素的下一个元素等</li><li> 连缀(chaining)</li></ol><pre><code>$(&#39;tr:contains(Henry)&#39;).parent().find(&#39;td:eq(1)&#39;).addClass(&#39;myClass&#39;).end().find(&#39;td:eq(2)&#39;).addClass(&#39;myClass&#39;);</code></pre><ol start="12"><li>$(‘#myId’).get(0) 等价于 $(‘myId’)[0]</li></ol><h3 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h3><ol><li>window.onload vs $(document).ready<ul><li>  window.onload 是在页面的全部元素都下载好了之后才能执行，而$(document).ready()则是在DOM树准备好就可以执行了。</li><li>  window.onload只能指定一个函数，而$(document).ready()指定的所有函数都会按顺序执行。</li><li>  $(document).ready(func)可以简写为$(func);</li></ul></li><li>bind(event, func)函数可以为DOM节点绑定事件，以及事件发生时所执行的函数。event可以是：<ul><li>  blur</li><li>  change</li><li>  click</li><li>  dbclick</li><li>  error</li><li>  focus</li><li>  keydown</li><li>  keypress</li><li>  keyup</li><li>  load</li><li>  mousedown</li><li>  mousemove</li><li>  mouseout</li><li>  mouseover</li><li>  mouseup</li><li>  resize</li><li>  scroll</li><li>  select</li><li>  submit</li><li>  unload</li></ul></li><li>toggle(func1, func2): 单击时轮流执行func1和func2</li><li>toggleClass(“someclass”): 单击时轮流添加或删除someclass.</li><li>事件捕获和事件冒泡：事件捕获是从父节点开始将事件传递给子节点，而事件冒泡则正好相反。JQuery采取事件冒泡的策略。</li><li>事件对象：事件发生时执行的函数可以把事件对象作为参数。<ul><li>  event.target属性：保存发生事件的目标元素</li><li>  event.stopPropagation(): 阻止事件继续冒泡</li><li>  event.preventDefault(): 阻止事件的默认操作</li></ul></li><li>$(event.target).is(): 接收一个选择符表达式作为参数，并验证JQuery对象是否满足它。</li><li>unbind(): 移除事件处理</li><li>事件命名空间：bind(‘click.sometag’, func) 可以在unbind的时候只解绑指定名字的事件。</li><li>trigger(): 使用javascript去触发某个事件</li></ol><h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><ol><li> .css(): 参数可以是(“attr”, “value”)，也可以是({“attr”: “value”, “attr”: “value”})，修改JQuery对象的css</li><li> .hide(): 将JQuery对象的内联css属性”display”设置为”none”</li><li> .show(): 将JQuery对象的内联css属性”display”恢复成hide之前的值。hide和show可以传入速度作为参数：”slow”, “normal”, “fast”</li><li> fadeIn()和fadeOut(): 淡入和淡出，可传入速度参数。</li><li> slideDown()和slideUp(): 滑下和滑上，可传入速度参数。</li><li> toggle(): 相当于轮流执行show()和hide()方法，可传入速度参数。</li><li> slideToggle(): 相当于轮流执行slideUp()和slideDown()，可传入速度参数。</li><li>animate(): 自定义动画。有两种传入参数的方式：<ul><li>  ({“attr”: “value”, “attr”, “value}, speed, easing, func):第一个参数是css属性，第二个是速度，第三个是缓动，第四个是动画完成后的回调函数。</li><li>  ({“attr”: “value”, “attr”: “value”}, {duration: “value”, easing: “value”, complete: functiong(){}, queue: true…})</li></ul></li><li> outerWidth(true): 返回width+padding+border+margin的值</li><li> outerWidth(), outerWidth(false): 返回width+padding+border的值</li><li> innerWidth(): 返回width+padding的值</li><li> outerHeight(), innerHeight()与outerWidth(), innerWidth()类似</li><li> animate()中指定多个css属性变化可以让动画并发，而用多个效果方法如animate,fadeIn等连缀则可以让动画排队显示。设置queue参数为false则可以让该动画不用排队。</li><li> css()方法不属于效果方法，不能排队，但可以用queue()方法将其加入队列，例如：    *   .fadeTo().queue(function(next){$(xxx).css(); next();})</li><li> JQuery为每个效果方法都提供了回调函数，可以用来让多个JQuery对象的动画排队执行。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 应用开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jquery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用gerrit作为代码评审工具</title>
      <link href="/2015/06/11/%E4%BD%BF%E7%94%A8gerrit%E4%BD%9C%E4%B8%BA%E4%BB%A3%E7%A0%81%E8%AF%84%E5%AE%A1%E5%B7%A5%E5%85%B7/"/>
      <url>/2015/06/11/%E4%BD%BF%E7%94%A8gerrit%E4%BD%9C%E4%B8%BA%E4%BB%A3%E7%A0%81%E8%AF%84%E5%AE%A1%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<h3 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h3><p>其实作为项目代码的maintainer，一直习惯于mailing list + git的代码评审及管理，无奈公司主推敏捷+devops，老板让改用gerrit。硬着头皮切换到gerrit，在这里记录下安装配置的过程及踩过的许多坑，以便网友们以后配置gerrit留作参考。</p><p>需求其实很简单，我们项目一直使用公司内部一个类似于github的代码托管网站来托管项目代码，使用邮件列表来评审代码。代码通过评审通过后，我再将patch push到代码托管服务器上去。整个开发流程如下图所示：</p><p>现在需要切换到gerrit来作为代码评审工具，以便于能够和jenkins集成，搭建一个集开发、构建、测试、部署为一体的devops系统，结构如下图所示。本文只关注gerrit的搭建。</p><h3 id="Gerrit简介"><a href="#Gerrit简介" class="headerlink" title="Gerrit简介"></a>Gerrit简介</h3><h3 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h3><p>1 . 安装Java.</p><p>网上有很多安装java的博客和文章，因此在这里不再赘述，可以参考下面这篇文章：</p><p><a href="http://tonyty163.blog.51cto.com/721698/463052">Linux下安装java</a></p><p>2 . 给Gerrit单独创建一个账户</p><pre><code>#useradd gerrit#passwd gerrit#su gerrit</code></pre><p>3 . 下载gerrit</p><p>gerrit是在google上托管的项目，翻墙下载比较麻烦，可以在这里下载2.11版本的gerrit：</p><p><a href="http://pan.baidu.com/s/1i3rfNDz">百度网盘下载Gerrit</a></p><p>将网盘中的两个文件gerrit-2.11.war以及bcpkix-jdk15on-151.jar下载到gerrit用户的家目录/home/gerrit下。</p><p>4 . 按下面的步骤安装gerrit，其中的问题大部分可以敲回车选择默认设置。</p><pre><code>[gerrit@linux ~]$ java -jar ./gerrit-2.11.war init -d gerrit     //-d指定gerrit的安装目录Using secure store: com.google.gerrit.server.securestore.DefaultSecureStore*** Gerrit Code Review 2.11*** Create &#39;/home/gerrit/gerrit&#39;   [Y/n]? y*** Git Repositories*** Location of Git repositories   [git]:  *** SQL Database*** Database server type           [h2]: *** Index*** Type                           [LUCENE/?]: *** User Authentication*** Authentication method          [OPENID/?]: http    //为了不依赖于openid我们这里要设置成httpGet username from custom HTTP header [y/N]? yUsername HTTP header           [SM_USER]: SSO logout URL                 : *** Review Labels*** Install Verified label         [y/N]? *** Email Delivery*** SMTP server hostname           [localhost]: SMTP server port               [(default)]: SMTP encryption                [NONE/?]: SMTP username                  : *** Container Process*** Run as                         [gerrit]: Java runtime                   [/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.45-38.b14.fc21.x86_64/jre]: Copy gerrit-2.11.war to /home/gerrit/gerrit/bin/gerrit.war [Y/n]? Copying gerrit-2.11.war to /home/gerrit/gerrit/bin/gerrit.war*** SSH Daemon*** Listen on address              [*]: Listen on port                 [29418]: Gerrit Code Review is not shipped with Bouncy Castle Crypto SSL v151  If available, Gerrit can take advantage of features  in the library, but will also function without it.Download and install it now [Y/n]? n  //选择n,因为这个文件已经下载好了，安装完手动拷贝进去就行Generating SSH host key ... rsa(simple)... done*** HTTP Daemon*** Behind reverse proxy           [y/N]? y  //需要配置反向代理来满足http认证Proxy uses SSL (https://)      [y/N]? NSubdirectory on proxy server   [/]: Listen on address              [*]: Listen on port                 [8081]: Canonical URL                  [http://null/]: *** Plugins*** Installing plugins.Install plugin download-commands version v2.11 [y/N]? Install plugin reviewnotes version v2.11 [y/N]? Install plugin singleusergroup version v2.11 [y/N]? Install plugin replication version v2.11 [y/N]? Install plugin commit-message-length-validator version v2.11 [y/N]? Initializing plugins.No plugins found with init steps.Initialized /home/gerrit/gerritExecuting /home/gerrit/gerrit/bin/gerrit.sh startStarting Gerrit Code Review: OK</code></pre><p>安装完成后需要将下载好的bcpkix-jdk15on-151.jar文件拷贝到安装目录中去：</p><pre><code>cp bcpkix-jdk15on-151.jar /home/gerrit/gerrit/lib/bcpkix-jdk15on-151.jar</code></pre><p>5 . 配置Apache反向代理</p><p>修改httpd的配置文件，在其末尾加入：</p><pre><code>    &lt;VirtualHost *&gt;      ServerName gerrit.example.com          ProxyRequests Off      ProxyVia Off      ProxyPreserveHost On          &lt;Proxy *&gt;        Order deny,allow        Allow from all      &lt;/Proxy&gt;      &lt;Location /login/&gt;        AuthType Basic        AuthName &quot;Gerrit Code Review&quot;        AuthBasicProvider file        AuthUserFile /home/gerrit/gerrit/etc/passwords        Require valid-user      &lt;/Location&gt;      ProxyPass / http://9.181.129.109:8081/    &lt;/VirtualHost&gt;</code></pre><p>需要将IP地址替换成你自己的IP.修改/etc/hosts，加入gerrit.example.com的解析：</p><pre><code>9.181.129.109    gerrit.example.com</code></pre><p>这里也需要替换IP地址。</p><p>6 . 创建管理员账户，Gerrit把第一个被创建的用户当做是管理员账户：</p><pre><code>$htpassword /home/gerrit/gerrit/etc/passwords $username</code></pre><p>$username替换成你要设置的用户名。</p><p>7 . 重启服务</p><pre><code>$./gerrit/bin/gerrit.sh restart$sudo service httpd restart</code></pre><h3 id="问题总结"><a href="#问题总结" class="headerlink" title="问题总结"></a>问题总结</h3><p>1 . Could not open password file.</p><p>症状：web浏览器提示服务器端错误，查看httpd日志文件/var/log/httpd/error_log，发现如下错误信息：</p><pre><code>Permission denied:......Could not open password file: /home/gerrit/gerrit/etc/passwords</code></pre><p>原因：该问题是由于passwords文件的路径上权限设置阻挡了httpd的访问。 解决方法：将/home/gerrit目录及passwords文件的权限设置为755</p><pre><code>$chmod 755 /home/gerrit$chmod 755 /home/gerrit/gerrit/etc/passwords</code></pre><p>2 . Proxy Error</p><p>症状：输入用户名和密码登陆后，web浏览器提示代理错误。</p><pre><code>Proxy ErrorThe proxy server received an invalid response from an upstream server.The proxy server could not handle the request GET /login/.Reason: DNS lookup failure for: 9.181.129.109:8081login</code></pre><p>原因：最后发现是httpd的配置文件中在ProxyPass一行的IP地址后少写了一个/</p><pre><code>ProxyPass / http://9.181.129.109:8081---&gt;ProxyPass / http://9.181.129.109:8081/</code></pre><h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><ol><li><a href="https://gerrit-documentation.storage.googleapis.com/Documentation/2.11/index.html">Gerrit官方文档</a> </li><li><a href="http://my.oschina.net/zhongl/blog/33017">Gerrit简易安装入门</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 开发工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> devops </tag>
            
            <tag> gerrit </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>apache配置https服务</title>
      <link href="/2015/02/16/apache%E9%85%8D%E7%BD%AEhttps%E6%9C%8D%E5%8A%A1/"/>
      <url>/2015/02/16/apache%E9%85%8D%E7%BD%AEhttps%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<p>1、创建自己签名的证书</p><pre><code>#创建CA签名的证书,需要用到opensslyum install openssl    #创建key   openssl genrsa -des3 -out server.key 1024     #创建csr(证书签发请求) openssl req -new -key server.key -out server.csr      #生成自己签名的证书openssl x509 -req  -in server.csr  -signkey server.key -out server.crt       #安装证书cp  server.crt /etc/ssl/certscp  server.key /etc/ssl/private</code></pre><p>2、编辑ssl配置文件</p><pre><code>vim /etc/httpd/conf.d/ssl.confSSLEngine onSSLCertificateFile    /etc/ssl/certs/server.crtSSLCertificateKeyFile /etc/ssl/private/server.key</code></pre><p>3、重启apache服务</p><pre><code>#systemctl restart httpd</code></pre>]]></content>
      
      
      <categories>
          
          <category> 应用开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> apache </tag>
            
            <tag> ssl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql数据库及django用户名启用中文的方法</title>
      <link href="/2014/12/18/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8F%8Adjango%E7%94%A8%E6%88%B7%E5%90%8D%E5%90%AF%E7%94%A8%E4%B8%AD%E6%96%87%E7%9A%84%E6%96%B9%E6%B3%95/"/>
      <url>/2014/12/18/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8F%8Adjango%E7%94%A8%E6%88%B7%E5%90%8D%E5%90%AF%E7%94%A8%E4%B8%AD%E6%96%87%E7%9A%84%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p><strong>mysql数据库启用中文</strong></p><p>在mysql的配置文件/etc/my.cnf的[mysqld]下加入</p><pre><code>character_set_server=utf8</code></pre><p><strong>Django启用中文用户名</strong></p><p>Django默认只能以字母、数字、下划线组成用户名，修改检验用户名的正则表达式可以绕过这一规则：</p><p>/usr/lib/python2.7/site-packages/django/contrib/auth/models.py:</p><pre><code>class AbstractUser(AbstractBaseUser, PermissionsMixin):...validators.RegexValidator(re.compile(&#39;^[\w.@+-]+$&#39;), _(&#39;Enter a valid username.&#39;), &#39;invalid&#39;)...</code></pre><p>把正则表达式从^[\w.@+-]+$ 改为 ^[\S.@+-]+$即可</p>]]></content>
      
      
      <categories>
          
          <category> 数据库技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> django </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于Jenkins和Koji的代码管理及构建系统</title>
      <link href="/2014/10/16/%E5%9F%BA%E4%BA%8EJenkins%E5%92%8CKoji%E7%9A%84%E4%BB%A3%E7%A0%81%E7%AE%A1%E7%90%86%E5%8F%8A%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/"/>
      <url>/2014/10/16/%E5%9F%BA%E4%BA%8EJenkins%E5%92%8CKoji%E7%9A%84%E4%BB%A3%E7%A0%81%E7%AE%A1%E7%90%86%E5%8F%8A%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<h1>Summary</h1><p>Currently, we KVM team are maintaining the code repository of the virtualization software(such as QEMU, Libvirt, Kimchi, Linux, etc.) for PowerKVM development team and delivering corresponding RPM packages. We collect patches from mailing list and build update RPM packages every workday. The work load is extremely heavy if we manually download the patches from mailing list, apply them to the repository, and build RPM packages covering all the supported platforms.</p><p>This environment, based on Jenkins and Koji, can automatically manage the code(apply the patches from mailing lists to the appropriate repository and branch) and build the required RPM packages covering all supported platforms nightly or triggered manually. By using this automation environment, developers can easily get the updated RPM packages just by sending the patches to the given e-mail address or mailing list. Furthermore, the time cost for daily routine work is dramatically reduced and the quality of the packages will be improved by eliminating human errors. This environment also can be used to other projects by making few changes to configure files.</p><h1>Challenges</h1><p>In PowerKVM development, we have to ship all the significant bug fixes frequently, usually a couple days. All the fix patches of QEMU, Libvirt, Linux, Kimchi will be sent to a certain mailing list. After the code cut-off day, we download all the patches from the mailing list and manually apply them to different git repositories accordingly. Then copy all the git repositories to different platform(RHEL,Fedora,etc) and do build. Last step, copy all the output RPM packages to different RPM repositories accordingly. Sometimes, we can not deliver the packages on time because the workload is extremely heavy. Furthermore, errors occur frequently such as some patches may get lost during the process due to lack of time. In order to solve these problems, we decided to make use of Jenkins and Koji to establish the CI environment.</p><p>During the construction of this environment, we have to resolve the following problems:</p><ul><li>  Define the rules of sending patches for developers in order to make the CI know where the patches should go.</li><li>  Define the regular expression to distinguish patches from other e-mails.</li><li>  How to handle exceptions.</li></ul><h1>Experience</h1><p>&lt;1&gt;. Tools and Framework Overview</p><p>In order to implement this automation environment, several tools are needed:</p><ul><li>  Jenkins: Jenkins is a software that monitors executions of repeated jobs. This automation environment use Jenkins as the user interface and the manager of all the underlying jobs.</li><li>  Koji: Koji can build RPMs packages for multiple platforms. This automation environment make use of Koji to build RPMs for all supported platform.</li><li>  Python scripts: implement the function that collect patches from mailing list, organize and archive these patches.</li><li>  Shell scripts: Apply the patches to the appropriate git repositories, process build and release the output RPM packages via web server.</li><li>  Apache HTTP server: Release the RPMs via web page. Below is the chart about the framework overview of this automation environment and the relationship among these tools.</li></ul><p>&lt;2&gt;. User Interface</p><p>The automation environment runs nightly. However, if the developer want to get the RPM packages immediately, he or she can simply click the start button of Jenkins. See below chart.</p><p>&lt;3&gt;. Execution flow</p><p>After the developers click the first run button, jenkins will call python scripts to collect emails matching certain regular expression(We advise developers send patches to mailing list in fixed forms, such as [branch_name PATCH repo_name]xxx) and archive all the patches by date. Then, Jenkins will call shell scripts to apply these patches to the appropriate git repositories. After that, Koji will be noticed to build the RPM packages of all the supported platforms. Finally, Jenkins will call the shell scripts to copy all the RPM packages to certain directory of Apache web server.</p><p>&lt;4&gt;. Handle exception</p><p>The automation environment will send report containing how many patches received and where the RPM packages are published to the mailing list if all the jobs are successfully executed. If a certain job failed, it also sends report to the mailing list or email boxes configured in the configuration file. Different job has different error report message. For example, when the job who collects patches from mailing list fails, it will send out the failed patches’ name, but when the job who builds RPM packages fails, it will send out the build log.</p><h1>Benefit</h1><p>For the repositories maintainers, this automation environment can save much time costs for their daily routing work. What they need to do is just check reports via email clients if this automation environment start to work. The time costs dramatically reduce from several hours to a few minutes.</p><p>For the developers, they can get the RPM packages by themselves whenever they want to build one, instead of asking the maintainers spend much time to build for them. What they need to do is simply click a button.</p><p>Furthermore, the quality of the RPM packages will be improved because this automation environment can eliminate human errors effectively.</p><h1>Next Steps and Recommendations</h1><p>Currently, this automation environment is just used for code management and RPM packages build. Since it can save much time cost for developers and repository maintainers, we are planing to involve test cases. We can make use of automation test technology and integrate the test cases into this automation environment. After that, test engineers will be set free from burdensome test work.</p>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> devops </tag>
            
            <tag> jenkins </tag>
            
            <tag> koji </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>发行版制作及Anaconda基础</title>
      <link href="/2014/07/30/%E5%8F%91%E8%A1%8C%E7%89%88%E5%88%B6%E4%BD%9C%E5%8F%8AAnaconda%E5%9F%BA%E7%A1%80/"/>
      <url>/2014/07/30/%E5%8F%91%E8%A1%8C%E7%89%88%E5%88%B6%E4%BD%9C%E5%8F%8AAnaconda%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<p>Anaconda是用于Fedora, RHEL等Linux发行版的安装程序，可以实现通过LiveCD,PXE,NFS等方式安装Linux系统以及利用kickstart文件实现无人值守的无交互安装。</p><h2 id="发行版制作-Fedoran系统环境"><a href="#发行版制作-Fedoran系统环境" class="headerlink" title="发行版制作(Fedoran系统环境)"></a>发行版制作(Fedoran系统环境)</h2><ol><li> 选择所需的软件包。</li></ol><p>制作自己的发行版首先要确定你的发行版需要安装哪些软件。决定之后需要把这些软件相应的RPM包拷贝到某个目录，然后在这个目录下执行createrepo命令来创建RPM软件源。</p><ol><li> 创建ks文件。</li></ol><p>ks文件用于指定制作发行版时用到的软件源及软件包，具体语法可参考 <a href="http://fedoraproject.org/wiki/Anaconda/Kickstart">kickstart语法</a>，下面是一个简单的例子：</p><h2 id="编译及安装"><a href="#编译及安装" class="headerlink" title="编译及安装"></a>编译及安装</h2><ul><li>  获取源码：git clone git://git.fedorahosted.org/git/anaconda.git</li><li>  安装依赖包： sudo yum install libtool $(grep ^BuildRequires: anaconda.spec.in | awk ‘{print $2}’)</li><li>  安装、配置transifex：sudo yum install transifex-client；tx init /tmp</li><li>  ./autogen.sh &amp;&amp; ./configure &amp;&amp; make po-pull &amp;&amp; make</li></ul><h2 id="源码目录结构"><a href="#源码目录结构" class="headerlink" title="源码目录结构"></a>源码目录结构</h2><ol><li>接口：pyanaconda/ui/<ul><li>  gui/：图形界面接口实现代码。</li><li>  tui/：字符界面及命令行界面实现代码。</li><li>  <strong>init</strong>.py 及 common.py：定义了gui和tui通用的基类(base class)</li><li>  communication.py：负责UI中类的通信。</li></ul></li><li>自定义组件：widgets/<ul><li>  data/：存放时区地图组件的图片。</li><li>  glade/及python/：让用户接口构建器知道组件的存在及实现python的自省。</li><li>  src/：实现各组件。</li></ul></li><li>分区：python-blivet包</li><li>Bootloader： pyanaconda/bootloader.py</li><li>各个步骤的配置：<ul><li>  pyanaconda/desktop.py</li><li>  pyanaconda/keyboard.py</li><li>  pyanaconda/localization.py</li><li>  pyanaconda/network.py</li><li>  pyanaconda/ntp.py</li><li>  pyanaconda/timezone.py</li><li>  pyanaconda/users.py</li></ul></li><li>安装软件包：<ul><li>  pyanaconda/packaging/</li><li>  scripts/anaconda-yum</li></ul></li><li>安装类： 不同的发行版可以定义不同的安装类。<ul><li>  pyanaconda/installclass.py</li><li>  pyanaconda/installclasses/</li><li>  pyanaconda/product.py</li></ul></li><li>无人值守安装：pyanaconda/kickstart.py</li><li>liveCD：<ul><li>  data/icons/</li><li>  data/liveinst/</li></ul></li><li>错误处理：<pre><code>*   pyanaconda/errors.py    *   pyanaconda/exception.py</code></pre></li><li>安装控制库<pre><code>*   pyanaconda/install.py：控制安装步骤。    *   pyanaconda/progress.py：控制进度条。    *   pyanaconda/queue.py：控制通信队列。    *   pyanaconda/threads.py：多线程支持。</code></pre></li><li>库：提供一些工具如获得用户位置，安装日志等。<pre><code>*   pyanaconda/**init**.py    *   pyanaconda/addons.py    *   pyanaconda/anaconda_log.py    *   pyanaconda/anaconda_optparse.py    *   pyanaconda/constants.py    *   pyanaconda/flags.py    *   pyanaconda/geoloc.py    *   pyanaconda/i18n.py    *   pyanaconda/image.py    *   pyanaconda/indexed_dict.py    *   pyanaconda/isys/    *   pyanaconda/iutil.py    *   pyanaconda/nm.py    *   pyanaconda/safe_dbus.py    *   pyanaconda/simpleconfig.py    *   pyanaconda/sitecustoimze.py</code></pre></li><li>主程序anaconda：由systemd在系统启动后调用，设置环境、VNC等。</li><li>启动<pre><code>*   data/systemd/    *   dracut/</code></pre></li><li>内存监控<pre><code>*   scripts/anaconda-cleanup：监控安装过程中的内存状态，并记录到/tmp/memory.dat文件中。    *   scripts/instperf及scripts/instperf.p：利用memory.dat文件生成相应的图表。</code></pre></li><li>升级工具<pre><code>*   scripts/makebumpver    *   scripts/makeupdates</code></pre></li></ol>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>QEMU 2: 参数解析</title>
      <link href="/2014/07/24/QEMU2%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90/"/>
      <url>/2014/07/24/QEMU2%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>#<strong>一、使用gdb分析QEMU代码</strong>#</p><p>使用gdb不仅可以很好地调试代码，也可以利用它来动态地分析代码。使用gdb调试QEMU需要做一些准备工作：</p><p>1, 编译QEMU时需要在执行configure脚本时的参数中加入–enable-debug。</p><p>2, 从QEMU官方网站上下载一个精简的镜像——linux-0.2.img。linux-0.2.img只有8MB大小，启动后包含一些常用的shell命令，用于QEMU的测试。</p><pre><code>$wget http://wiki.qemu.org/download/linux-0.2.img.bz2$bzip2 -d ./linux-0.2.img.bz2</code></pre><p>3, 启动gdb调试QEMU：</p><p><code>gdb --args qemu-system-x86_64 -enable-kvm -m 4096 -smp 4 linux-0.2.img</code></p><p>-smp指定处理器个数。</p><p>#<strong>二、参数解析用到的数据结构</strong>#</p><p>QEMU系统模拟的主函数位于vl.c文件，无论是qemu-system-x86_64还是qemu-system-ppc64，都是从vl.c中的main函数开始执行。下面先介绍main函数涉及到的一些数据结构。</p><p>###<strong>QEMU链表</strong></p><p>QEMU的链表在include/qemu/queue.h文件中定义，分为四种类型：</p><ul><li>  单链表(singly-linked list)：单链表适用于大的数据集，并且很少有删除节点或者移动节点的操作，也适用于实现后进先出的队列。</li><li>  链表(list)：即双向链表，除了头节点之外每个节点都会同时指向前一个节点和后一个节点。</li><li>  简单队列(simple queue)：简单队列类似于单链表，只是多了一个指向链表尾的一个表头，插入节点的时候不仅可以像单链表那样将其插入表头或者某节点之后，还可以插入到链表尾。</li><li>  尾队列(tail queue)：类似于简单队列，但节点之间是双向指向的。</li></ul><p>这里不一一介绍各种链表的用法，只通过NotifierList的定义来说明QEMU链表(list)的用法。在main函数的开头定义的DisplayState结构体使用到了NotifiereList，NotifierList就用到了链表。</p><p><strong>a. 表头及节点的定义</strong></p><p>定义表头需要用到QLIST_HEAD，定义如下：</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">86 </span>#define QLIST_HEAD(<span class="keyword">name</span>, type)                                          \</span><br><span class="line"><span class="symbol">87 </span>struct <span class="keyword">name</span> &#123;                                                           \</span><br><span class="line"><span class="symbol">88 </span>        struct type *lh_first;  /* first element */                     \</span><br><span class="line"><span class="symbol">89 </span>&#125;</span><br></pre></td></tr></table></figure><p>NotifierList就采用了QLIST_HEAD来定义表头：</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    <span class="number"> 27 </span>typedef struct NotifierList</span><br><span class="line">    <span class="number"> 28 </span>&#123;</span><br><span class="line">    <span class="number"> 29 </span>    QLIST_HEAD(, Notifier) notifiers;</span><br><span class="line">    <span class="number"> 30 </span>&#125; NotifierList;</span><br><span class="line">  ```  </span><br><span class="line"></span><br><span class="line">定义节点需要用到QLIST_ENTRY，定义如下：</span><br></pre></td></tr></table></figure><pre><code> 94 #define QLIST_ENTRY(type)                                               \ 95 struct &#123;                                                                \ 96         struct type *le_next;   /* next element */                      \ 97         struct type **le_prev;  /* address of previous next element */  \ 98 &#125;</code></pre> <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Notifier的节点定义如下：</span><br></pre></td></tr></table></figure><pre><code> 21 struct Notifier 22 &#123; 23     void (*notify)(Notifier *notifier, void *data); 24     QLIST_ENTRY(Notifier) node; 25 &#125;;</code></pre> <figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="strong">**b. 初始化表头**</span></span><br><span class="line"></span><br><span class="line">初始化表头用到QLIST_INIT：</span><br></pre></td></tr></table></figure><pre><code>103 #define QLIST_INIT(head) do &#123;                                           \104         (head)-&gt;lh_first = NULL;                                        \105 &#125; while (/*CONSTCOND*/0)</code></pre><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">初始化NotifierList就可以这样进行：</span><br></pre></td></tr></table></figure><pre><code> 19 void notifier_list_init(NotifierList *list) 20 &#123; 21     QLIST_INIT(&amp;list-&gt;notifiers); 22 &#125;</code></pre> <figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="strong">**c. 在表头插入节点**</span></span><br><span class="line"></span><br><span class="line">将节点插入到表头使用QLIST\_INSERT\_HEAD：</span><br></pre></td></tr></table></figure><pre><code>122 #define QLIST_INSERT_HEAD(head, elm, field) do &#123;                        \123         if (((elm)-&gt;field.le_next = (head)-&gt;lh_first) != NULL)          \124                 (head)-&gt;lh_first-&gt;field.le_prev = &amp;(elm)-&gt;field.le_next;\125         (head)-&gt;lh_first = (elm);                                       \126         (elm)-&gt;field.le_prev = &amp;(head)-&gt;lh_first;                       \127 &#125; while (/*CONSTCOND*/0)</code></pre><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">插入Notifier到NotifierList：</span><br></pre></td></tr></table></figure><pre><code> 24 void notifier_list_add(NotifierList *list, Notifier *notifier) 25 &#123; 26     QLIST_INSERT_HEAD(&amp;list-&gt;notifiers, notifier, node); 27 &#125;</code></pre><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="strong">**d. 遍历节点**</span></span><br><span class="line"></span><br><span class="line">遍历节点使用QLIST\_FOREACH或者QLIST\_FOREACH\_SAFE，QLIST\_FOREACH\_SAFE是为了防止遍历过程中删除了节点，从而导致le\_next被释放掉，中断了遍历。</span><br></pre></td></tr></table></figure><pre><code>147 #define QLIST_FOREACH(var, head, field)                                 \148         for ((var) = ((head)-&gt;lh_first);                                \149                 (var);                                                  \150                 (var) = ((var)-&gt;field.le_next))151 152 #define QLIST_FOREACH_SAFE(var, head, field, next_var)                  \153         for ((var) = ((head)-&gt;lh_first);                                \154                 (var) &amp;&amp; ((next_var) = ((var)-&gt;field.le_next), 1);      \155                 (var) = (next_var))</code></pre><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">NotifierList在执行所有的回调函数时就用到了QLIST\_FOREACH\_SAFE：</span><br></pre></td></tr></table></figure><pre><code> 34 void notifier_list_notify(NotifierList *list, void *data) 35 &#123; 36     Notifier *notifier, *next; 37  38     QLIST_FOREACH_SAFE(notifier, &amp;list-&gt;notifiers, node, next) &#123; 39         notifier-&gt;notify(notifier, data); 40     &#125; 41 &#125;</code></pre><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">###**Error和QError**</span><br><span class="line"></span><br><span class="line">为了方便的处理错误信息，QEMU定义了Error和QError两个数据结构。Error在qobject/qerror.c中定义：</span><br></pre></td></tr></table></figure><pre><code>101 struct Error102 &#123;103     char *msg;104     ErrorClass err_class;105 &#125;;</code></pre><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">包含了错误消息字符串和枚举类型的错误类别。错误类别有下面几个：</span><br></pre></td></tr></table></figure><pre><code> 139 typedef enum ErrorClass 140 &#123; 141     ERROR_CLASS_GENERIC_ERROR = 0, 142     ERROR_CLASS_COMMAND_NOT_FOUND = 1, 143     ERROR_CLASS_DEVICE_ENCRYPTED = 2, 144     ERROR_CLASS_DEVICE_NOT_ACTIVE = 3, 145     ERROR_CLASS_DEVICE_NOT_FOUND = 4, 146     ERROR_CLASS_K_V_M_MISSING_CAP = 5, 147     ERROR_CLASS_MAX = 6, 148 &#125; ErrorClass;</code></pre> <figure class="highlight monkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">QEMU在util/<span class="built_in">error</span>.c中定义了几个函数来对<span class="built_in">Error</span>进行操作：</span><br></pre></td></tr></table></figure><pre><code>error_set  //根据给定的ErrorClass以及格式化字符串来给Error分配空间并赋值error_set_errno  //除了error_set的功能外，将指定errno的错误信息追加到格式化字符串的后面error_copy  //复制Error           error_is_set   //判断Error是否已经分配并设置error_get_class  //获取Error的ErrorClass      error_get_pretty  //获取Error的msgerror_free  //释放Error及msg的空间</code></pre><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">另外，QEMU定义了QError来处理更为细致的错误信息：</span><br></pre></td></tr></table></figure><pre><code> 22 typedef struct QError &#123;  23     QObject_HEAD; 24     Location loc; 25     char *err_msg; 26     ErrorClass err_class; 27 &#125; QError;</code></pre> <figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">QError可以通过一系列的宏来给err\_msg及err\_class赋值：</span><br></pre></td></tr></table></figure><pre><code> 39 #define QERR_ADD_CLIENT_FAILED \ 40     ERROR_CLASS_GENERIC_ERROR, &quot;Could not add client&quot; 41  42 #define QERR_AMBIGUOUS_PATH \ 43     ERROR_CLASS_GENERIC_ERROR, &quot;Path &#39;%s&#39; does not uniquely identify an object&quot; 44  45 #define QERR_BAD_BUS_FOR_DEVICE \ 46     ERROR_CLASS_GENERIC_ERROR, &quot;Device &#39;%s&#39; can&#39;t go on a %s bus&quot; 47  48 #define QERR_BASE_NOT_FOUND \ 49     ERROR_CLASS_GENERIC_ERROR, &quot;Base &#39;%s&#39; not found&quot;...</code></pre><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">Location</span>记录了出错的位置，定义如下：</span><br></pre></td></tr></table></figure><pre><code> 20 typedef struct Location &#123; 21     /* all members are private to qemu-error.c */ 22     enum &#123; LOC_NONE, LOC_CMDLINE, LOC_FILE &#125; kind; 23     int num; 24     const void *ptr; 25     struct Location *prev; 26 &#125; Location;</code></pre><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">###**GMainLoop**</span></span><br><span class="line"></span><br><span class="line">QEMU使用glib中的GMainLoop来实现IO多路复用，关于GMainLoop可以参考博客[GMainLoop的实现原理和代码模型](http:<span class="regexp">//</span>blog.csdn.net<span class="regexp">/jack0106/</span>article<span class="regexp">/details/</span><span class="number">6258422</span>)。由于GMainLoop并非QEMU本身的代码，本文就不重复赘述。</span><br><span class="line"></span><br><span class="line"><span class="comment">#**三、QEMUOption、QemuOpt及QEMU参数解析**</span></span><br><span class="line"></span><br><span class="line">QEMU定义了QEMUOption来表示执行qemu-system-x86_64等命令时用到的选项。在vl.c中定义如下：</span><br></pre></td></tr></table></figure><pre><code>2123 typedef struct QEMUOption &#123;2124     const char *name;   //选项名，如 -device, name的值就是device2125     int flags;  //标志位，表示选项是否带参数，可以是0，或者HAS_ARG(值为0x0001)2126     int index;  //枚举类型的值，如-device，该值就是QEMU_OPTION_device2127     uint32_t arch_mask;  //  选项支持架构的掩码2128 &#125; QEMUOption;</code></pre> <figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">vl.c中维护了一个QEMUOption数组qemu_options来存储所有可用的选项，并利用qemu-<span class="keyword">options</span>-<span class="keyword">wrapper</span>.h和qemu-<span class="keyword">options</span>.def来给该数组赋值。赋值语句如下：</span><br></pre></td></tr></table></figure><pre><code>2130 static const QEMUOption qemu_options[] = &#123;2131     &#123; &quot;h&quot;, 0, QEMU_OPTION_h, QEMU_ARCH_ALL &#125;,2132 #define QEMU_OPTIONS_GENERATE_OPTIONS2133 #include &quot;qemu-options-wrapper.h&quot;2134     &#123; NULL &#125;,2135 &#125;;</code></pre><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">`#define QEMU\_OPTIONS\_GENERATE_OPTIONS`选择qemu-<span class="keyword">options</span>-<span class="keyword">wrapper</span>.h的操作，qemu-<span class="keyword">options</span>-<span class="keyword">wrapper</span>.h可以进行三种操作：</span><br><span class="line"></span><br><span class="line">    QEMU_OPTIONS_GENERATE_ENUM: 利用qemu-<span class="keyword">options</span>.def生成一个枚举值列表，就是上面提到的QEMU_OPTION_device等</span><br><span class="line">    QEMU_OPTIONS_GENERATE_HELP: 利用qemu-<span class="keyword">options</span>.def生成帮助信息并输出到标准输出</span><br><span class="line">    QEMU_OPTIONS_GENERATE_OPTIONS: 利用qemu-<span class="keyword">options</span>.def生成一组选项列表</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">可以通过下面的方法来展开qemu-<span class="keyword">options</span>-<span class="keyword">wrapper</span>.h来查看上述操作的结果，以生成选项为例。</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>  在qemu-<span class="keyword">options</span>-<span class="keyword">wrapper</span>.h第一行写入#define QEMU\_OPTIONS\_GENERATE_OPTIONS.</span><br><span class="line"><span class="number">2.</span>  执行命令`gcc -E -o <span class="keyword">options</span>.txt qemu-<span class="keyword">options</span>-<span class="keyword">wrapper</span>.h`</span><br><span class="line"><span class="number">3.</span>  查看文件<span class="keyword">options</span>.txt即可</span><br><span class="line"></span><br><span class="line">给qemu_options数组赋值后，QEMU就有了一个所有可用选项的集合。之后在vl.c中main函数的一个<span class="keyword">for</span>循环根据这个集合开始解析命令行。<span class="keyword">for</span>循环的框架大致如下：</span><br></pre></td></tr></table></figure><pre><code>  1     for(;;) &#123;  2         if (optind &gt;= argc)  3             break;  4         if (argv[optind][0] != &#39;-&#39;) &#123;  5         hda_opts = drive_add(IF_DEFAULT, 0, argv[optind++], HD_OPTS);  6         &#125; else &#123;  7             const QEMUOption *popt;  8   9             popt = lookup_opt(argc, argv, &amp;optarg, &amp;optind); 10             if (!(popt-&gt;arch_mask &amp; arch_type)) &#123; 11                 printf(&quot;Option %s not supported for this target\n&quot;, popt-&gt;name); 12                 exit(1); 13             &#125; 14             switch(popt-&gt;index) &#123; 15             case QEMU_OPTION_M: 16             ...... 17             case QEMU_OPTION_hda: 18             ......   19             case QEMU_OPTION_watchdog: 20             ...... 21             default: 22                 os_parse_cmd_args(popt-&gt;index, optarg); 23             &#125;    24         &#125; 25     &#125;</code></pre> <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">QEMU会把argv中以<span class="string">&#x27;-&#x27;</span>开头的字符串当作选项，然后调用lookup\_opt函数到qemu\_options数组中查找该选项，如果查找到的选项中flags的值是HAS\_ARG，lookup\_opt也会将参数字符串赋值给optarg。找到选项和参数之后，QEMU便根据选项中的index枚举值来执行不同的分支。</span><br><span class="line"></span><br><span class="line">对于一些开关性质的选项，分支执行时仅仅是把相关的标志位赋值而已，如：</span><br><span class="line"></span><br><span class="line">    <span class="number">3712</span>             case QEMU_OPTION_old_param:</span><br><span class="line">    <span class="number">3713</span>                 old_param = <span class="number">1</span>;</span><br><span class="line">    <span class="number">3714</span>                 <span class="keyword">break</span>;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">也有一些选项没有子选项，分支执行时就直接把optarg的值交给相关变量：</span><br><span class="line"></span><br><span class="line">    <span class="number">3822</span>             case QEMU_OPTION_qtest:</span><br><span class="line">    <span class="number">3823</span>                 qtest_chrdev = optarg;</span><br><span class="line">    <span class="number">3824</span>                 <span class="keyword">break</span>;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">对于那些拥有子选项的选项，如<span class="string">&quot;-drive if=none,id=DRIVE-ID&quot;</span>，QEMU的处理会更为复杂一些。它会调用qemu\_opts\_parse来解析子选项，如realtime选项的解析：</span><br><span class="line"></span><br><span class="line">    <span class="number">3852</span>             case QEMU_OPTION_realtime:</span><br><span class="line">    <span class="number">3853</span>                 opts = qemu_opts_parse(qemu_find_opts(<span class="string">&quot;realtime&quot;</span>), optarg, <span class="number">0</span>);</span><br><span class="line">    <span class="number">3854</span>                 <span class="keyword">if</span> (!opts) &#123;</span><br><span class="line">    <span class="number">3855</span>                     <span class="keyword">exit</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="number">3856</span>                 &#125;</span><br><span class="line">    <span class="number">3857</span>                 configure_realtime(opts);</span><br><span class="line">    <span class="number">3858</span>                 <span class="keyword">break</span>;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">对子选项的解析涉及到<span class="number">4</span>个数据结构：QemuOpt, QemuDesc, QemuOpts, QemuOptsList. 它们的关系如下图所示：</span><br><span class="line"></span><br><span class="line">QemuOpt存储子选项，每个QemuOpt有一个QemuOptDesc来描述该子选项名字、类型、及帮助信息。两个结构体定义如下：</span><br></pre></td></tr></table></figure><pre><code> 32 struct QemuOpt &#123; 33     const char   *name;  //子选项的名字 34     const char   *str;  //字符串值 35  36     const QemuOptDesc *desc;   37     union &#123; 38         bool boolean;  //布尔值 39         uint64_t uint;  //数字或者大小 40     &#125; value;  41  42     QemuOpts     *opts;   43     QTAILQ_ENTRY(QemuOpt) next; 44 &#125;; 95 typedef struct QemuOptDesc &#123; 96     const char *name; 97     enum QemuOptType type; 98     const char *help; 99 &#125; QemuOptDesc;</code></pre><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">子选项的类型可以是：</span><br></pre></td></tr></table></figure><pre><code> 88 enum QemuOptType &#123; 89     QEMU_OPT_STRING = 0,   // 字符串 90     QEMU_OPT_BOOL,       // 取值可以是on或者off 91     QEMU_OPT_NUMBER,     // 数字 92     QEMU_OPT_SIZE,       // 大小，可以有K, M, G, T等后缀 93 &#125;;</code></pre> <figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">QEMU维护了一个QemuOptsList*的数组，在util/qemu-config.c中定义：</span><br><span class="line"></span><br><span class="line">    <span class="number">10</span> static QemuOptsList *vm_config_groups<span class="literal">[<span class="number">32</span>]</span>;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">在main函数中由qemu\_add\_opts将各种QemuOptsList写入到数组中：</span><br><span class="line"></span><br><span class="line">    <span class="number">2944</span>     qemu<span class="constructor">_add_opts(&amp;<span class="params">qemu_drive_opts</span>)</span>;</span><br><span class="line">    <span class="number">2945</span>     qemu<span class="constructor">_add_opts(&amp;<span class="params">qemu_chardev_opts</span>)</span>;</span><br><span class="line">    <span class="number">2946</span>     qemu<span class="constructor">_add_opts(&amp;<span class="params">qemu_device_opts</span>)</span>; </span><br><span class="line">    <span class="number">2947</span>     qemu<span class="constructor">_add_opts(&amp;<span class="params">qemu_netdev_opts</span>)</span>;</span><br><span class="line">    <span class="number">2948</span>     qemu<span class="constructor">_add_opts(&amp;<span class="params">qemu_net_opts</span>)</span>;</span><br><span class="line">    <span class="number">2949</span>     qemu<span class="constructor">_add_opts(&amp;<span class="params">qemu_rtc_opts</span>)</span>;</span><br><span class="line">    <span class="number">2950</span>     qemu<span class="constructor">_add_opts(&amp;<span class="params">qemu_global_opts</span>)</span>;</span><br><span class="line">    <span class="number">2951</span>     qemu<span class="constructor">_add_opts(&amp;<span class="params">qemu_mon_opts</span>)</span>;</span><br><span class="line">    <span class="number">2952</span>     qemu<span class="constructor">_add_opts(&amp;<span class="params">qemu_trace_opts</span>)</span>;</span><br><span class="line">    <span class="number">2953</span>     qemu<span class="constructor">_add_opts(&amp;<span class="params">qemu_option_rom_opts</span>)</span>;</span><br><span class="line">    <span class="number">2954</span>     qemu<span class="constructor">_add_opts(&amp;<span class="params">qemu_machine_opts</span>)</span>;</span><br><span class="line">    <span class="number">2955</span>     qemu<span class="constructor">_add_opts(&amp;<span class="params">qemu_smp_opts</span>)</span>;</span><br><span class="line">    <span class="number">2956</span>     qemu<span class="constructor">_add_opts(&amp;<span class="params">qemu_boot_opts</span>)</span>;</span><br><span class="line">    <span class="number">2957</span>     qemu<span class="constructor">_add_opts(&amp;<span class="params">qemu_sandbox_opts</span>)</span>;</span><br><span class="line">    <span class="number">2958</span>     qemu<span class="constructor">_add_opts(&amp;<span class="params">qemu_add_fd_opts</span>)</span>;</span><br><span class="line">    <span class="number">2959</span>     qemu<span class="constructor">_add_opts(&amp;<span class="params">qemu_object_opts</span>)</span>;</span><br><span class="line">    <span class="number">2960</span>     qemu<span class="constructor">_add_opts(&amp;<span class="params">qemu_tpmdev_opts</span>)</span>;</span><br><span class="line">    <span class="number">2961</span>     qemu<span class="constructor">_add_opts(&amp;<span class="params">qemu_realtime_opts</span>)</span>;</span><br><span class="line">    <span class="number">2962</span>     qemu<span class="constructor">_add_opts(&amp;<span class="params">qemu_msg_opts</span>)</span>;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">每个QemuOptsList存储了大选项所支持的所有小选项，如-realtime大选项QemuOptsList的定义：</span><br></pre></td></tr></table></figure><pre><code> 507 static QemuOptsList qemu_realtime_opts = &#123; 508     .name = &quot;realtime&quot;, 509     .head = QTAILQ_HEAD_INITIALIZER(qemu_realtime_opts.head), 510     .desc = &#123; 511         &#123; 512             .name = &quot;mlock&quot;, 513             .type = QEMU_OPT_BOOL, 514         &#125;, 515         &#123; /* end of list */ &#125; 516     &#125;, 517 &#125;;</code></pre><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-<span class="strong">**realtime只支持1个子选项**</span>，且值为bool类型，即只能是on或者off。</span><br><span class="line"></span><br><span class="line">在调用qemu\_opts\_parse解析子选项之前，QEMU会调用qemu\_find\_opts(&quot;realtime&quot;)，把QemuOptsList *从qemu\_add\_opts中找出来，和optarg一起传递给qemu\_opts\_parse去解析。QEMU可能会多次使用同一个大选项来指定多个相同的设备，在这种情况下，需要用id来区分。QemuOpts结构体就表示同一id下所有的子选项，定义如下：</span><br></pre></td></tr></table></figure><pre><code> 46 struct QemuOpts &#123; 47     char *id; 48     QemuOptsList *list; 49     Location loc; 50     QTAILQ_HEAD(QemuOptHead, QemuOpt) head; 51     QTAILQ_ENTRY(QemuOpts) next; 52 &#125;;</code></pre><p>```</p><p>其中list是同一个大选项下不同id的QemuOpts链表。</p>]]></content>
      
      
      <categories>
          
          <category> 云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> qemu </tag>
            
            <tag> virtualization </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>QEMU 1: 使用QEMU创建虚拟机</title>
      <link href="/2014/05/15/QEMU1%E4%BD%BF%E7%94%A8QEMU%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA/"/>
      <url>/2014/05/15/QEMU1%E4%BD%BF%E7%94%A8QEMU%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="一、QEMU简介"><a href="#一、QEMU简介" class="headerlink" title="一、QEMU简介"></a><strong>一、QEMU简介</strong></h1><p>QEMU是一款开源的模拟器及虚拟机监管器(Virtual Machine Monitor, VMM)。QEMU主要提供两种功能给用户使用。一是作为用户态模拟器，利用动态代码翻译机制来执行不同于主机架构的代码。二是作为虚拟机监管器，模拟全系统，利用其他VMM(Xen, KVM, etc)来使用硬件提供的虚拟化支持，创建接近于主机性能的虚拟机。</p><p>用户可以通过不同Linux发行版所带有的软件包管理器来安装QEMU。如在Debian系列的发行版上可以使用下面的命令来安装：</p><p><code>sudo apt-get install qemu</code></p><p>或者在红帽系列的发行版上使用如下命令安装：</p><p><code>sudo yum install qemu -y</code></p><p>除此之外，也可以选择从源码安装。</p><p>##<strong>获取QEMU源码</strong>##</p><p>可以从<a href="http://wiki.qemu.org/Download">QEMU官网</a>上下载QEMU源码的tar包，以命令行下载2.0版本的QEMU为例：</p><pre><code>$wget http://wiki.qemu-project.org/download/qemu-2.0.0.tar.bz2$tar xjvf qemu-2.0.0.tar.bz2</code></pre><p>如果需要参与到QEMU的开发中，最好使用Git获取源码：</p><p><code>$git clone git://git.qemu-project.org/qemu.git</code></p><p>##<strong>编译及安装</strong>##</p><p>获取源码后，可以根据需求来配置和编译QEMU。</p><pre><code>$cd qemu-2.0.0 //如果使用的是git下载的源码，执行cd qemu$./configure --enable-kvm --enable-debug --enable-vnc --enable-werror  --target-list=&quot;x86_64-softmmu&quot;$make -j8$sudo make install</code></pre><p>configure脚本用于生成Makefile，其选项可以用<code>./configure --help</code>查看。这里使用到的选项含义如下：</p><pre><code>--enable-kvm：编译KVM模块，使QEMU可以利用KVM来访问硬件提供的虚拟化服务。--enable-vnc：启用VNC。--enalbe-werror：编译时，将所有的警告当作错误处理。--target-list：选择目标机器的架构。默认是将所有的架构都编译，但为了更快的完成编译，指定需要的架构即可。</code></pre><p>#<strong>二、基本原理</strong>#</p><p>QEMU作为系统模拟器时，会模拟出一台能够独立运行操作系统的虚拟机。如下图所示，每个虚拟机对应主机(Host)中的一个QEMU进程，而虚拟机的vCPU对应QEMU进程的一个线程。</p><p>系统虚拟化最主要是虚拟出CPU、内存及I/O设备。虚拟出的CPU称之为vCPU，QEMU为了提升效率，借用KVM、XEN等虚拟化技术，直接利用硬件对虚拟化的支持，在主机上安全地运行虚拟机代码(需要硬件支持)。虚拟机vCPU调用KVM的接口来执行任务的流程如下(代码源自QEMU开发者Stefan的<a href="http://blog.vmsplice.net/2011/03/qemu-internals-overall-architecture-and.html">技术博客</a>)：</p><pre><code>open(&quot;/dev/kvm&quot;)ioctl(KVM_CREATE_VM)ioctl(KVM_CREATE_VCPU)for (;;) &#123;     ioctl(KVM_RUN)     switch (exit_reason) &#123;     case KVM_EXIT_IO:  /* ... */     case KVM_EXIT_HLT: /* ... */     &#125;&#125;</code></pre><p>QEMU发起ioctrl来调用KVM接口，KVM则利用硬件扩展直接将虚拟机代码运行于主机之上，一旦vCPU需要操作设备寄存器，vCPU将会停止并退回到QEMU，QEMU去模拟出操作结果。</p><p>虚拟机内存会被映射到QEMU的进程地址空间，在启动时分配。在虚拟机看来，QEMU所分配的主机上的虚拟地址空间为虚拟机的物理地址空间。</p><p>QEMU在主机用户态模拟虚拟机的硬件设备，vCPU对硬件的操作结果会在用户态进行模拟，如虚拟机需要将数据写入硬盘，实际结果是将数据写入到了主机中的一个镜像文件中。</p><p>#<strong>三、创建及使用虚拟机</strong>#</p><p>##<strong>命令行创建及启动虚拟机</strong>##</p><p>成功安装QEMU之后便可创建自己的虚拟机。具体步骤如下：</p><p>1, 使用qemu-img创建虚拟机镜像。虚拟机镜像用来模拟虚拟机的硬盘，在启动虚拟机之前需要创建镜像文件。</p><pre><code>[kelvin@kelvin tmp]$ qemu-img create -f qcow2 fedora.img 10GFormatting &#39;fedora.img&#39;, fmt=qcow2 size=10737418240 encryption=off cluster_size=65536 lazy_refcounts=off [kelvin@kelvin tmp]$ lsfedora.img</code></pre><p>-f选项用于指定镜像的格式，qcow2格式是QEMU最常用的镜像格式，采用写时复制技术来优化性能。fedora.img是镜像文件的名字，10G是镜像文件大小。镜像文件创建完成后，可使用qemu-system-x86来启动x86架构的虚拟机：</p><p><code>qemu-system-x86_64 fedora.img</code></p><p>此时会弹出一个窗口来作为虚拟机的显示器.</p><p>因为fedora.img中并未给虚拟机安装操作系统，所以会提示“No bootable device”，无可启动设备。</p><p>2, 准备操作系统镜像。</p><p>可以从不同Linux发行版的官方网站上获取安装镜像，以fedora20为例：</p><p><code>[kelvin@kelvin tmp]$ wget http://ftp6.sjtu.edu.cn/fedora/linux/releases/20/Live/x86_64/Fedora-Live-Desktop-x86_64-20-1.iso</code></p><p>3, 检查KVM是否可用。</p><p>QEMU使用KVM来提升虚拟机性能，如果不启用KVM会导致性能损失。要使用KVM，首先要检查硬件是否有虚拟化支持：</p><p><code>[kelvin@kelvin ~]$ grep -E &#39;vmx|svm&#39; /proc/cpuinfo</code></p><p>如果有输出则表示硬件有虚拟化支持。其次要检查kvm模块是否已经加载：</p><pre><code>[kelvin@kelvin ~]$ lsmod | grep kvmkvm_intel             142999  0 kvm                   444314  1 kvm_intel</code></pre><p>如果kvm_intel/kvm_amd、kvm模块被显示出来，则kvm模块已经加载。最后要确保qemu在编译的时候使能了KVM，即在执行configure脚本的时候加入了–enable-kvm选项。</p><p>4, 启动虚拟机安装操作系统。</p><p>执行下面的命令启动带有cdrom的虚拟机：</p><p><code>[kelvin@kelvin tmp]$ qemu-system-x86_64 -m 2048 -enable-kvm fedora.img -cdrom ./Fedora-Live-Desktop-x86_64-20-1.iso</code></p><p>-m 指定虚拟机内存大小，默认单位是MB， -enable-kvm使用KVM进行加速，-cdrom添加fedora的安装镜像。可在弹出的窗口中操作虚拟机，安装操作系统，安装完成后重起虚拟机便会从硬盘(fedora.img)启动。之后再启动虚拟机只需要执行：</p><p><code>[kelvin@kelvin tmp]$ qemu-system-x86_64 -m 2048 -enable-kvm fedora.img</code></p><p>即可。</p><p>##<strong>图形界面创建及启动虚拟机</strong>##</p><p>命令行启动虚拟机比较繁琐，适合开发者，但对于普通用户来说，采用图形界面管理虚拟机则更为方便。采用图形界面管理QEMU虚拟机需要安装virt-manager，红帽系列的发行版只需要执行命令：</p><p><code>$sudo yum install virt-manager -y</code></p><p>安装完成后用root用户启动virt-manager：</p><pre><code>$su -#virt-manager</code></pre><p>点击左上角电脑图标即可创建虚拟机。按照步骤操作即可完成对虚拟机的创建。</p>]]></content>
      
      
      <categories>
          
          <category> 云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> qemu </tag>
            
            <tag> virtualization </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux系统中的信号量机制</title>
      <link href="/2014/04/24/Linux%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E4%BF%A1%E5%8F%B7%E9%87%8F%E6%9C%BA%E5%88%B6/"/>
      <url>/2014/04/24/Linux%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E4%BF%A1%E5%8F%B7%E9%87%8F%E6%9C%BA%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<p>1、信号量的定义：</p><pre><code>struct semaphore &#123;    spinlock_t lock;    unsigned int count;    struct list_head wait_list;&#125;;</code></pre><p>在linux中，信号量用上述结构体表示，我们可以通过该结构体定义一个信号量。</p><p>2、信号量的初始化：</p><p>可用void sema_init(struct semaphore *sem, int val);直接创建，其中val为信号量初值。也可以用两个宏来定义和初始化信号量的值为1或0：</p><pre><code>DECLARE_MUTEX(name)    :    定义信号量name并初始化为1DECLARE_MUTEX_LOCKED(name)    :    定义信号量name并初始化为0</code></pre><p>还可以用下面的函数初始化：</p><pre><code>void init_MUTEX(struct semaphore *sem);     //初始化信号量的值为1void init_MUTEX_LOCKED(struct semaphore *sem);    //初始化信号量的值为0</code></pre><p>3、信号量的原子操作：</p><p>p操作：</p><ul><li>  void down(struct semaphore *sem); //用来获取信号量，如果信号量值大于或等于0，获取信号量，否则进入睡眠状态，睡眠状态不可唤醒</li><li>  void down_interruptible(struct semephore *sem); //用来获取信号量，如果信号量大于或等于0，获取信号量，否则进入睡眠状态，等待信号量被释放后，激活该程。</li><li>  void down_trylock(struct semaphore *sem); //试图获取信号量，如果信号量已被其他进程获取，则立刻返回非零值，调用者不会睡眠</li></ul><p>v操作：</p><ul><li>  void up(struct semaphore *sem); //释放信号量，并唤醒等待该资源进程队列的第一个进程</li></ul><p>4、经典同步问题的解决方案：</p><ul><li>  生产者和消费者问题：</li></ul><p>a、单缓冲区问题描述：生产者向消费者提供产品，它们共享一个有界缓冲区，生产者向其中投放产品，消费者从中取得产品。同时，每个进程都互斥的占用CPU。假定生产者和消费者是互相等效的，只要缓冲区未满，生产者就可以把产品送入缓冲区，类似的，只要缓冲区未空，消费者便可以从缓冲区中取走产品并消费它。生产者—消费者的同步关系将禁止生产者向已满的缓冲区中放入产品，也禁止消费者从空的缓冲区中获取产品</p><p>问题分析： 需要定义两个信号量，一个用于互斥访问缓冲区，另一个用于生产者与消费者之间的同步。s1=1; s2=0;</p><p>伪代码：</p><pre><code>生产者进程            while(1)                                         &#123;                                           printf(“I&#39;m producing!\n”);                                            down_interruptible(&amp;s1);                                             printf(“I&#39;m putting a product into the buffer\n”);              up(&amp;s1);                       up(&amp;s2);                &#125;               </code></pre><p>消费者进程</p><pre><code>while(1)  &#123;    down_interruptible(&amp;s2);    down_interruptible(&amp;s1);    printf(“I&#39;m getting a product\n”);    up(&amp;s1);    printf(“I&#39;m consuming a product\n”);&#125;</code></pre><p>b、多生产者、多消费者、n个缓冲区</p><p>问题描述：有一群生产者进程在生产产品，并将这些产品提供给消费者进程去消费。为使生产者进程与消费者进程并发执行，在两者之间设置了n个缓冲区，生产者将产品放入一个缓冲区中，消费者可以从一个缓冲区中取走产品去消费。要求生产者进程与消费者进程必须保持同步，即不允许生产者进程向一个满的缓冲区放产品，也不允许消费者从一个空的缓冲区取产品。</p><p>问题分析：该问题貌似比a问题复杂的多，首先我们定义一个数组buffer[n]，来表示n个缓冲区，还需要定义两个变量：in 表示要存入的缓冲区的下标，out表示要取产品的缓冲区的下标。定义三个信号量：s1用于实现对缓冲池的互斥操作，empty表示空缓冲区的个数，full表示满缓冲区的个数。初值：in=out=0; s1=1; full=0; empty=n;</p><p>伪代码如下：</p><pre><code>生产者进程                                                                  while(1)                                                                          &#123;                                                                                          printf(“I&#39;m producing!\n”);                                                       down_interruptible(&amp;empty);                                               down_interruptible(&amp;s1);                                                       printf(“I&#39;m putting a product into the buffer[in]\n”);                                                                                                                               in = (in+1)%n;                                                                                    up(&amp;s1);                                                                                          up(&amp;full);                                                                     &#125;                                                                                       </code></pre><p>消费者进程</p><ul><li>哲学家进餐问题  while(1) { down_interruptible(&amp;full); down_interruptible(&amp;s1); printf(“I’m getting a product from buffer[out]\n”); out = (out+1)%n; up(&amp;empty); printf(“I’m consuming a product\n”); }</li></ul><p>问题描述：五个哲学家共用一个圆桌，分别坐在周围的五张椅子上，在圆桌上有五只碗和五只筷子，他们交替进行思考和进餐。哲学家饥饿时便试图取最靠近他的两只筷子，当同时获得两只筷子时便可用餐，用餐完毕后放下筷子。</p><p>问题分析： 五只筷子为临界资源，定义包含五个元素的信号量数组来实现对筷子的互斥使用。chopstick[5]，五个信号量的初值都为1。</p><p>伪代码：</p><p>第i（i=0,1,2,3,4）个哲学家进程：</p><pre><code>while(1)&#123;          down_interruptible(&amp;chopstick[i]);          down_interruptible(&amp;chopstick[(i+1)%5]);          printf(“I&#39;m eating!\n”);          up(&amp;chopstick[i]);          up(&amp;chopstick[(i+1)%5);&#125;</code></pre><ul><li>  读者写者问题：</li></ul><p>问题描述：一个文件可被多个进程共享，reader进程读取该文件，而writer进程负责写文件，允许多个reader进程同时读取文件，但不允许一个writer进程和其他reader进程或writer进程同时访问文件。</p><p>问题分析：进程对文件互斥访问的实现可借助一个信号量就可以搞定，但是我们需要引入一个count变量来记录reader进程的个数，对这个变量的访问也是互斥的，所以也需要引入一个信号量。定义信号量rs实现对count的互斥访问，定义ws实现对文件的互斥访问。两信号量初值都为1</p><p>伪代码：</p><pre><code>reader进程                                 &#123;                                                                                                  down_interruptible(&amp;rs);                                                                                                                                                                                                           count++;        up(&amp;rs);          printf(“I&#39;m reading!\n”);          down_interruptible(&amp;rs);       count--;       if(count == 0)&#123;               up(&amp;ws);        &#125;        up(&amp;rs);&#125;        writer进程 &#123;    down_interruptible(&amp;ws);               if (count == 0)&#123;         printf(“I&#39;m writing!\n”);        down_interruptible(&amp;ws);                                         &#125;     up(&amp;ws);&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于Linux与lpc3250开发板的交叉开发环境搭建</title>
      <link href="/2014/04/24/%E5%9F%BA%E4%BA%8ELinux%E4%B8%8Elpc3250%E5%BC%80%E5%8F%91%E6%9D%BF%E7%9A%84%E4%BA%A4%E5%8F%89%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
      <url>/2014/04/24/%E5%9F%BA%E4%BA%8ELinux%E4%B8%8Elpc3250%E5%BC%80%E5%8F%91%E6%9D%BF%E7%9A%84%E4%BA%A4%E5%8F%89%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<p>###<strong>一、Bootloader的安装（在windows下进行）</strong></p><p>1、什么是Bootloader:</p><p>要想弄明白什么是Bootloader，我们先从PC上的bootloader说起。PC上的BIOS和硬盘上的引导记录有着和嵌入式开发板中的bootloader类似的作用。PC的Bootloader由BIOS和MBR组成，BIOS固化在主板的一个芯片上，MBR则是硬盘的主引导扇区的缩写。PC启动后，首先执行BIOS的启动程序，根据用户的COMS设置，BOIS加载硬盘MBR的启动数据，并把系统的控制权交给保存在MBR中的OS Loader（如grub），最后再由OS Loader将控制权交给OS内核。</p><p>了解了什么是PC中的Bootloader，我们再来看什么是嵌入式系统中的Bootloader。嵌入式系统中没有与BIOS类似的芯片，这就需要开发人员自己设计Boootloader。不过，我们不必从零开始写这些代码，已经有公司和组织为大多数嵌入式系统写好了Bootloader。</p><p>2、lpc3250的Bootloader组成：</p><ul><li>  kickstart：位于Flash的Block0，负责加载从Flash Block1开始的程序，这里只的是S1L。开发板上电后，kickstart被内部的IROM加载并执行。IROM只能加载Block1以内的映像，而kickstart被加载后将被允许加载从Flash Block1开始的多个Block的映像文件。所以，kickstart上电后，kickstart加载S1L，也可以直接加载放在Block1的应用程序。</li><li>  S1L：对芯片和板子进行初始化，并提供一个用于应用程序开发和执行控制的监控程序。其常用功能如下： @擦写nandFlash @串口下载，SD卡下载 @设置CPU频率 @设置从SD卡，NandFlash启动 @加载引导Eboot</li><li>  Eboot：设置内核在NandFlash中的位置，内核复制到RAM的位置，以及内核的大小；网络下载</li><li>  Uboot：操作系统引导。Uboot的具体分析留到以后再说。</li></ul><p>3、安装步骤：</p><ul><li>  由于笔记本不带串口，所以第一步是找个usb串口连接线，并安装好驱动。</li><li>  将开发板的电源线连接好，然后连接开发板串口与PC上的usb串口。</li><li>  利用开发板所带光盘中的smartARM3250_boot.exe安装kickstart和S1L：进入到光盘中smartARM3250_boot.exe所在的目录，确保kickstart.bin和stage1.bin也在该目录下。运行smartARM3250_boot.exe。首先选择好串口，我的是com3。如果你不知道你的串口是多少的话，可以在右键单击我的电脑——》管理——》设备管理器。查看到自己的串口位置后，点击打开串口。点击装载Bootloader，软件会提示你短接jp6，点击确定，短接jp6后reset开发板，过几秒钟便提示装载成功。这儿的bootloader不是我们上面所讲的bootloader，它指的是bootloader.bin，我们</li></ul><p>执行了上面过程后，smartARM3250_boot.exe就将bootloader.bin拷贝到开发板执行，其实我们可以把bootloader理解成smartARM3250_boot.exe的客户端软件。</p><p>装载bootloader.bin后，我们下来就正式安装kickstart了。在右下脚的Flash擦出中选择编程NandFlash， 块地址设为0，点击选择文件，选择kickstart.bin。点击编程。这样我们就把kickstart.bin装载到了NandFlash的Block0。用同样的方法我们可以装载S1L，只是要将块地址改为1。</p><ul><li>  安装U-boot或Eboot:</li></ul><p>a. 打开windows的超级终端，配置好参数后连接。reset开发板，进入到SmartArm3250的工作台，将光盘中的u-boot.bin或eboot.nb0拷贝到一张SD卡上，然后将SD卡插入到开发板的SD插槽中，在超级终端中输入命令：load blk u-boot.bin(eboot.nb0) raw 0x83fc0000，将u-boot.bin或eboot.nb0加载到SDRAM中。 b. 在超级终端中敲入命令：nsave。将u-boot.bin(eboot.nb0)写入到NANDFlash。 c. 最后输入命令：aboot flash raw 0x83fc0000，设置从NANDFlash启动U-boot(Eboot）。</p><p>###<strong>二、Linux系统（Ubuntu）下所需要的软件的安装步骤：</strong></p><p>1、交叉工具链的安装：</p><p>a、什么是交叉工具链：在PC机上开发嵌入式软件所需要的编译器、make等工具的集合。</p><p>b、安装步骤：</p><ul><li>将光盘中的tc-nxp-lnx-armvfp-4.3.2-1.i386.rpm拷贝到PC机的桌面。</li><li>打开终端，输入sudo rpm –force-debian -ivh tc-nxp-lnx-armvfp-4.3.2.1-1.i386.rpm命令。</li><li>执行上述命令后，就将交叉工具链安装到/opt/nxp目录中了，现在我们将安装路径加入到PATH变量中去。在终端中输入命令：  gedit ~/.bashrc</li></ul><p>在打开的.bashrc文件的末尾添加如下语句：</p><pre><code>export PATH=&quot;$PATH:/$HOME/bin:/opt/nxp/gcc-4.3.2-glibc-2.7/bin&quot;</code></pre><p>保存关闭，注销当前用户，重新登录</p><ul><li>  检测是否安装好交叉工具链：在终端中输入arm-vfp-linux-gnu-并按TAB键，如果能看到很多arm-vfp-linux-gnu-为前缀的命令，则说明交叉开发工具链已经安装好了。</li></ul><p>2、NFS服务器的安装：</p><p>(NFS的详细介绍请参考<a href="http://blog.csdn.net/sailor_8318/archive/2008/04/15/2295495.aspx">NFS</a>)</p><p>a、NFS的功能：</p><p>NFS是网络文件系统的缩写，它的功能是把NFS服务器（即Linux主机）的某个目录挂载到开发板的文件系统上（开发板上Linux系统的安装我们在后面会讲到），这样，开发板就可以执行该目录中的可执行程序。这样做的优点在于，不用将程序写入开发板的Flash，减少了对Flash的损害。</p><p>b、NFS的安装：</p><p>在Ubuntu下的安装很easy：　sudo　apt-get install nfs-sever</p><p>3、TFTP服务器的安装：</p><p>a、什么是tptp：TFTP是远程文件传输协议的缩写，其作用是将主机中设定目录下的文件拷贝到开发板的文件系统中，它与NFS的区别显而意见。</p><p>b、安装：还是很easy：sudo apt-get install tftp-hpa tftpd-hpa xinetd。第一个是客户端程序，第二个是服务器端程序，第三个是守护进程。</p><p>c、Ubuntu系统在安装完成后自动启动tftp服务，也可以通过命令：</p><pre><code>sudo service xinetd start或restart命令启动。</code></pre><p>d、然后进入xinetd.d文件夹（cd /etc/xinetd.d），查看是否有一个tftp文件，如果没有就新建一个，如果有的话就查看内容是否与下面的一致，不一致则修改，内容如下：</p><pre><code>service tftp  &#123;      socket_type = dgram      wait = yes      disable = no      user = root      protocol = udp      server = /usr/sbin/in.tftpd      server_args = -s /home/tftpboot      log_on_success += PID HOST DURATION      log_on_failure += HOST  &#125;  </code></pre><p>e、然后保存关闭。输入命令：sudo /etc/init.d/xinetd restart重启服务。</p><p>TFTP的使用我们到后面在介绍。</p><p>4、minicom的安装和配置：</p><p>a、minicom的功能：就四个字，超级终端</p><p>b、安装：sudo apt-get install minicom</p><p>c、配置：在终端输入：sudo minicom -s选择串口设置，串口设备设为/dev/ttyUSB0（也许你的不一样，可以在dev目录下查看）,波特率设为115200，硬件流和软件流控制都设为No。回车退回到刚进入时的界面，选择save setup as dfl。</p><p>###<strong>三、Linux内核，安全文件系统和根文件系统的安装：</strong></p><p>1、连接好串口线和网线。</p><p>2、插入光盘，将光盘中的uImage文件拷贝到/var/lib/tftpboot目录下。</p><p>3、在主机终端中输入：sudo chmod -R 777 /var/lib/tftpboot 命令来改变该目录权限。（这个目录是tftp服务器默认存放要传输文件的目录）</p><p>4、打开另一个终端，输入命令：sudo minicom</p><p>5、reset开发板，这时终端就进入了U-boot的工作台。</p><p>5、在工作台中输入命令：tftp 80008000 uImage将内核镜像文件拷贝到开发板内存中。</p><p>6、在工作台中输入命令：nand write.jffs2 0x80008000 0x00200000 $(filesize)将镜像文件从内存中拷贝到NANDFlash相应的位置。</p><p>7、在工作台中输入命令：setenv kernelsize $(filesize) 设置内核大小为镜像文件大小。</p><p>8、在工作台中输入命令：saveenv 保存设置</p><p>9、安装安全文件系统：</p><ul><li>将光盘中的safefs.cramfs文件放到/var/lib/tftpboot目录下。</li><li>在工作台中输入命令：  tftp 80008000 safefs.cramfs nand erase clean 0x00600000 $(filesize)<br>  nand write.jffs2 0x80008000 0x00600000 $(filesize)</li></ul><p>10、将光盘中的rootfs.tar.bz2文件和burn文件拷贝到一张SD卡上。</p><p>11、将SD卡插入开发板插槽中，在工作台输入命令：run safemode。</p><p>12、坐等烧写完成，reset开发板。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ls命令实现分析</title>
      <link href="/2014/04/24/ls%E5%91%BD%E4%BB%A4%E5%AE%9E%E7%8E%B0%E5%88%86%E6%9E%90/"/>
      <url>/2014/04/24/ls%E5%91%BD%E4%BB%A4%E5%AE%9E%E7%8E%B0%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>###<strong>一、ls命令的功能分析</strong></p><p>使用man ls命令查看ls命令手册（功能描述和主要选项摘录如下）：</p><p>List information about the FILEs (the current directory by default).Sort entries alphabetically if none of -cftuvSUX nor –sort.</p><p>列出文件（默认当前目录）信息，如果没有-cftuvSUX和–sort选项，就按照字母顺序排序。</p><pre><code>-a, --all   do not ignore entries starting with .：不忽略以.开始的隐藏文件-A, --almost-all   do not list implied . and ..：不列出 .（当前目录）和..（上级目录）-B, --ignore-backups  do not list implied entries ending with ~：忽略以～结尾的备份文件-c with -lt: sort by, and show, ctime (time of last modification of file status information) with -l: show ctime and  sort  by  name otherwise: sort by ctime：和-lt一起使用，则显示ctime（最后修改文件信息的时间），并按ctime排序显示；和-l一起使用，则显示ctime，但只按文件名的字母顺序排序；其他，按ctime排序显示。/*该选项和-t选项在单独使用的时候是等价的，但在和-l选项配合使用的时候，-c的功能会被屏蔽，而-t选项不会*/-d, --directory   list directory entries instead of contents, and do not  dereference symbolic links：不是列出该目录的文件信息，而是列出该目录项。不追踪符号链接的实际位置。-F, --classify   append indicator (one of */=&gt;@|) to entries：在每个entry后面加上标识文件内容的符号:         * : 标识可执行文件     / : 标识目录          = : 套接字文件         @ : 符号链接文件       | : 管道文件-l     use a long listing format：以长格式显示。</code></pre><p>###<strong>二、ls所用到的系统调用：</strong></p><p>使用strace ls命令我们可以查看ls命令使用到的系统调用，其中最重要的几个为：</p><pre><code>open(&quot;.&quot;, O_RDONLY|O_NONBLOCK|O_LARGEFILE|O_DIRECTORY|O_CLOEXEC) = 3getdents64(3, /* 68 entries */, 32768)  = 2240getdents64(3, /* 0 entries */, 32768)   = 0close(3)                                = 0</code></pre><p>1、open系统调用：</p><p>打开当前目录文件，返回获得的文件描述符。</p><ul><li>  O_RDONLY：只读 O_NONBLOCK：以非阻塞的方式打开文件 O_LARGEFILE：允许打开大文件</li><li>  O_DIRECTORY：如果路径不是目录，则打开错误 O_CLOEXEC：在创建新的进程后关闭文件描述符</li></ul><p>2、close系统调用：</p><p>关闭文件描述符。</p><p>3、getdents64：</p><p>读取当前目录下的文件。</p><p>三、getdents64的系统调用服务例程：</p><p>由于getdents64实现了ls核心功能，下面着重分析getdents64系统调用在内核态下的实现。getdents64在fs/readdir.c中定义如下：</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">275</span>SYSCALL_DEFINE3(getdents64, unsigned <span class="keyword">int</span>, fd,</span><br><span class="line"><span class="symbol">276 </span>               struct linux_dirent64 __user *, dirent, unsigned <span class="keyword">int</span>, count)</span><br><span class="line"><span class="number">277</span>&#123;</span><br><span class="line"><span class="symbol">278 </span>       struct file * file;</span><br><span class="line"><span class="symbol">279 </span>       struct linux_dirent64 __user * lastdirent;</span><br><span class="line"><span class="symbol">280 </span>       struct getdents_callback64 buf;</span><br><span class="line"><span class="symbol">281 </span>       <span class="keyword">int</span> <span class="keyword">error</span>;</span><br><span class="line"><span class="number">282</span></span><br><span class="line"><span class="symbol">283 </span>       <span class="keyword">error</span> = -EFAULT;</span><br><span class="line"><span class="symbol">284 </span>       <span class="keyword">if</span> (!access_ok(VERIFY_WRITE, dirent, count))</span><br><span class="line"><span class="symbol">285 </span>               <span class="keyword">goto</span> <span class="keyword">out</span>;</span><br><span class="line"><span class="number">286</span></span><br><span class="line"><span class="symbol">287 </span>       <span class="keyword">error</span> = -EBADF;</span><br><span class="line"><span class="symbol">288 </span>       file = fget(fd);</span><br><span class="line"><span class="symbol">289 </span>       <span class="keyword">if</span> (!file)</span><br><span class="line"><span class="symbol">290 </span>               <span class="keyword">goto</span> <span class="keyword">out</span>;</span><br><span class="line"><span class="number">291</span></span><br><span class="line"><span class="symbol">292 </span>       buf.current_dir = dirent;</span><br><span class="line"><span class="symbol">293 </span>       buf.previous = NULL;</span><br><span class="line"><span class="symbol">294 </span>       buf.count = count;</span><br><span class="line"><span class="symbol">295 </span>       buf.<span class="keyword">error</span> = <span class="number">0</span>;</span><br><span class="line"><span class="number">296</span></span><br><span class="line"><span class="symbol">297 </span>       <span class="keyword">error</span> = vfs_readdir(file, filldir64, &amp;buf);</span><br><span class="line"><span class="symbol">298 </span>       <span class="keyword">if</span> (<span class="keyword">error</span> &gt;= <span class="number">0</span>)</span><br><span class="line"><span class="symbol">299 </span>               <span class="keyword">error</span> = buf.<span class="keyword">error</span>;</span><br><span class="line"><span class="symbol">300 </span>       lastdirent = buf.previous;</span><br><span class="line"><span class="symbol">301 </span>       <span class="keyword">if</span> (lastdirent) &#123;</span><br><span class="line"><span class="symbol">302 </span>               typeof(lastdirent-&gt;d_off) d_off = file-&gt;f_pos;</span><br><span class="line"><span class="symbol">303 </span>               <span class="keyword">if</span> (__put_user(d_off, &amp;lastdirent-&gt;d_off))</span><br><span class="line"><span class="symbol">304 </span>                       <span class="keyword">error</span> = -EFAULT;</span><br><span class="line"><span class="symbol">305 </span>               <span class="keyword">else</span></span><br><span class="line"><span class="symbol">306 </span>                       <span class="keyword">error</span> = count - buf.count;</span><br><span class="line"><span class="symbol">307 </span>       &#125;</span><br><span class="line"><span class="symbol">308 </span>       fput(file);</span><br><span class="line"><span class="number">309</span><span class="keyword">out</span>:</span><br><span class="line"><span class="symbol">310 </span>       <span class="keyword">return</span> <span class="keyword">error</span>;</span><br><span class="line"><span class="number">311</span>&#125;</span><br></pre></td></tr></table></figure><p>getdents64首先调用fget函数得到目录文件的file结构体，再调用虚拟文件系统提供的vfs_readdir函数，读取目录项，该函数的定义也在fs/readdir64中：</p><pre><code>    int vfs_readdir(struct file *file, filldir_t filler, void *buf)      24&#123;      25        struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;      26        int res = -ENOTDIR;      27        if (!file-&gt;f_op || !file-&gt;f_op-&gt;readdir)      28                goto out;      29      30        res = security_file_permission(file, MAY_READ);      31        if (res)      32                goto out;      33      34        res = mutex_lock_killable(&amp;inode-&gt;i_mutex);      35        if (res)      36                goto out;      37      38        res = -ENOENT;      39        if (!IS_DEADDIR(inode)) &#123;      40                res = file-&gt;f_op-&gt;readdir(file, buf, filler);      41                file_accessed(file);      42        &#125;      43        mutex_unlock(&amp;inode-&gt;i_mutex);      44out:      45        return res;      46&#125;</code></pre><p>该函数首先通过file结构体得到inode，然后从inode中获得并执行file_operations结构体中的读取目录函数（底层文件系统提供）file-&gt;f_op-&gt;readdir(file, buf, filler)。</p><p>综上所述，实际上对文件进行操作的是底层文件系统提供的函数，它通过file_operations结构体可被上层的虚拟文件系统调用，而用户程序又可通过系统调用进入内核态，调用虚拟文件系统提供的接口函数。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FUSE分析总结</title>
      <link href="/2014/04/24/FUSE%E5%88%86%E6%9E%90%E6%80%BB%E7%BB%93/"/>
      <url>/2014/04/24/FUSE%E5%88%86%E6%9E%90%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>###<strong>FUSE简介及原理</strong></p><p>FUSE（Filesystem in Userspace）是sourceforge上的一个开源项目，它可以为用户提供编写用户态文件系统的接口。使用FUSE，用户可以不必熟悉Kernel代码，使用标准C库、FUSE库以及GNU C库便可设计出自己需要的文件系统。</p><p>FUSE由三个部分组成：FUSE内核模块、FUSE库以及一些挂载工具。</p><p>FUSE内核模块实现了和VFS的对接，它看起来像一个普通的文件系统模块；另外，FUSE内核模块实现了一个可以被用户空间进程打开的设备，当VFS发来文件操作请求之后，它将该请求转化为特定格式，并通过设备传递给用户空间进程，用户空间进程在处理完请求后，将结果返回给FUSE内核模块，内核模块再将其还原为Linux kernel需要的格式，并返回给VFS。</p><p>FUSE库负责和内核空间的通信，它接收来自/dev/fuse的请求，并将其转化为一系列的函数调用，并将结果写回到/dev/fuse。</p><p>挂载工具用以实现对用户态文件系统的挂载。</p><p>当系统用户在输入ls /home/kelvin命令之后，最终会调用到Ext4文件系统内的相关函数来对文件进行处理，并将结果返回。</p><p>系统用户在该文件系统（/tmp/fuse为tfs的挂载点）内所执行的ls –l /tmp/fuse命令通过FUSE最终会调用到tfs里所写的钩子函数。这样，通过FUSE，可以在用户态设计并实现自己的文件系统，而不必了解kernel的代码编写规范。</p><p>###<strong>FUSE代码编写规范</strong></p><p>FUSE给用户提供了fuse_operations结构体，用户可实现具体的钩子函数，然后将这些钩子函数挂载到该结构体。main()函数只需调用fuse_main()就可以了，其他的工作交给FUSE去做。</p><p>###<strong>fuse_main()的处理流程</strong></p><p>fuse_main()被调用后，它调用fuse_mount()，创建新的进程fusermount，来检查FUSE内核模块是否加载，并返回文件描述符给fuse_main()。fuse_new()为文件系统分配数据空间。fuse_loop()从/dev/fuse 读取文件系统调用，调用fuse_operations结构中的处理函数，返回调用结果给/dev/fuse。</p><h3 id="使用FUSE的注意事项"><a href="#使用FUSE的注意事项" class="headerlink" title="使用FUSE的注意事项"></a><strong>使用FUSE的注意事项</strong></h3><ul><li>FUSE的作用在于使用户能够绕开内核代码来编写文件系统，可文件系统如果要实现对具体的设备的操作的话必须要使用设备驱动提供的接口，而设备驱动位于内核空间，FUSE便无法将文件系统挂载到具体设备上去。所以，基于FUSE所写的文件系统通常是将文件当做虚拟的磁盘，并使用C所提供的文件操作接口；或者是映射一个目录到文件系统。</li><li>  FUSE给各钩子函数传递的path参数的/指的是文件系统的/目录。</li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fuse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NBD-网络块设备[翻译]</title>
      <link href="/2014/04/24/NBD%E7%BD%91%E7%BB%9C%E5%9D%97%E8%AE%BE%E5%A4%87/"/>
      <url>/2014/04/24/NBD%E7%BD%91%E7%BB%9C%E5%9D%97%E8%AE%BE%E5%A4%87/</url>
      
        <content type="html"><![CDATA[<p>1997年4月，Pavel Machek 写了他的网络块设备代码，并被当时的Linux Kernel 2.1.55接受。Pavel 在随后的四个发行版（对应的内核版本为55、101、111、132）中维护并升级了他的代码。Andrzej M. Krzysztofowicz贡献了64位机上运行的版本，随后Stephen Tweedie 为其提出了许多的专业建议，尤其是引入了基于信号量的锁机制，使得代码在对称多处理器系统中能够安全的运行。作者们已将其增强以便于运用于工业环境之中。本文描述了网络块设备、驱动、以及它的开发历史。</p><p>NBD的驱动程序提供了一种在这个面向网络的世界中更为普遍的访问模型。它在本地客户端模拟了一个块设备，比如一个磁盘或者是一块磁盘分区，但实际提供物理支持的却是通过网络连接的远程服务器。在本地，该设备看起来是一个磁盘分区，但那只是远程服务器的表面。远程服务器是一段轻量级的守护进程代码，它提供对远程设备的访问，而且该守护进程并不需要运行在linux平台之上。本地操作系统必须是linux，而且要支持Linux内核NBD驱动，并且能够运行本地客户端进程。安装NBD可被用来进行远程存储和备份，而且能用来在地球的任意一个角落虚拟地传送物理设备。</p><p>NBD有一些UNIX系统组件的经典特征：简单、小巧、多功能。文件系统能被挂载到NBD上（图1），而且NBD设备也能够用来组成冗余磁盘阵列（RAID）。在本地Linux上挂载一个EXT2文件系统到NBD，其传输率要比在同样的远程机器上挂载一个NFS快（表1是接近Pavel最初写的驱动代码的计时）。</p><pre><code>write cmd.    dd=if=/dev/zero of=/dev/nd0 bs=1024 count=32000    NBD bs=1K    0.04user 5.54system 0:26:67elapsed 20.9%CPU    1.23MBpswrite cmd.    dd=if=/dev/zero of=/dev/nfs bs=1024 count=32000    NFS r/wsize=1K    0.15user 7.46system 0:43.58elapsed 17.0%CPU    0.75MBpswrite cmd.    dd=if=/dev/zero of=/dev/nfs bs=4096 count=8000    NFS r/wsize=4K    0.03user 3.94system 0:35.18elapsed 11.0%CPU    0.93MBps</code></pre><p>挂载到NBD上的Linux EXT2文件系统，缓冲区大小接近1.5KB，其性能赶得上默认条件下的NFS。也就是说，它的大小是以太网默认传输单元（MTU/MRU）的大小——1.5KB。这恰好是NFS默认缓冲区大小（1KB）的1.5倍。NBD因为使用TCP而不是UDP作为传输协议而具有很好的恢复力。TCP包含它固有的一致性以及恢复机制，因而比UDP协议庞大。但对NBD来说，TCP的开销会被它节省的重新传输和校正码所需带宽抵消。</p><p>NBD能够被用作一个中型邮件服务器A的实时镜像。故障转移可以通过在另一个房间里放置一台用100BT网络连接的备份服务器B来实现。NBD设备将主服务器和备份服务器连接，并提供了主服务器RAID-1镜像的一半（Y），另一般是主服务器自己的用于存放邮件的分区（X）。组合成的设备XY将作为mail spool被挂载。</p><p>当服务器A失效时，运行在B上的一个守护进程能够探测到NBD连接的断开，然后检查镜像Y的mail spool， 校验最小的不完整性，并将其在本地作为mail spool挂载，最后在B上启动A广播的邮件交换IP地址的别名。当A修复之后，会被守护进程检测到，别名将会被丢弃。NBD连接随后会被重新修复，A上的分区X将会重新和NBD镜像Y保持同步。主服务器RAID-1设备会被重新调度，NBD镜像也会重新从属于它。邮件服务将会以默认的配置恢复。使主从服务器设置对称是可能的，但不适宜在这里描述细节。</p><p>与其他备选方案相比，这种方法具有许多优点。其一，比如说，维护一个空的邮件服务器，在主服务器宕机的时候将其唤醒。这会使得许多已经放到spool中的邮件在停机期间不可被使用。但重新整合是很容易的，将相关的文件连接到恢复后的服务器也很简单。但主服务器上的某些邮件可能会丢失。</p><p>另一种解决办法是将邮件服务器分散到一些不同的机器上，这些机器通过NFS挂载同样的spool区域。然而，NFS的文件锁过去从未被证明是完全可靠的，NFS也从未令人满意的支持由于多个用户同时选择下载50MB的邮件目录引起的事件的激增。传输率也会随着文件尺寸成指数地变慢。在不利的网络条件下，软模式的传输率极有可能崩溃。如果NFS在服务启动的时候为了追求高的可靠性而以同步（硬）模式挂载，一旦NFS服务失效，将会导致所有客户端停机。NFS服务不得不独立地建立镜像。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nbd </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>内核源码编译</title>
      <link href="/2014/04/24/%E5%86%85%E6%A0%B8%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/"/>
      <url>/2014/04/24/%E5%86%85%E6%A0%B8%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/</url>
      
        <content type="html"><![CDATA[<p>编译内核的目的在于把纷繁复杂的内核源码编译成一个可执行的镜像文件。当然，内核功能复杂，并不是所有的 功能都需要用到，所以，我们在使用make对其编译前，要做一件事——配置。kconfig和make就好比将军和士兵。kconfig是指导方向的，make是干活的。kconfig对内核进行配置，告诉make，哪些功能需要编译进内核，哪些功能要作为模块编译，make便根据配置文件来进行编译。</p><p>###<strong>编译步骤</strong></p><p><strong>获取内核源码（这几天kernel.org被黑了，该步骤方法暂时用不了）：</strong></p><p>1、使用git工具：</p><p>ubuntu下安装git：</p><pre><code>sudo apt-get install git</code></pre><p>使用git检出Linus分支的版本：</p><pre><code>git clone git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux-2.t.git</code></pre><p>检出之后便可以通过下列命令进行升级：</p><pre><code>git pull</code></pre><p>使用上述两个命令便可以获得内核源码的最新版本。</p><p>2、直接从kernel.org上下载源码包：</p><p>源码包有两种格式：</p><pre><code>linux-x.y.z.tar.bz2和linux-x.y.z.tar.gz</code></pre><p>bz2结尾的压缩包使用的是bzip2压缩格式，而gz结尾的压缩包使用的是gzip压缩格式。你可以任选一种，只是解压所用的命令不同罢了。一般来说，使用的是bz2格式，因为它具有较好的压缩效率。解压命令对应如下：</p><p>bz2:</p><p>tar xjvf linux-x.y.z.tar.bz2</p><p>gz:</p><p>tar xzvf linux-x.y.z.tar.gz</p><ul><li>  <strong>配置内核</strong></li></ul><p>配置内核的工具有下面几种：</p><ul><li>  make menuconfig ： 终端图形界面，依赖于ncurses库</li><li>  make config : 纯文本界面</li><li>  make xconfig ： X-window界面</li><li>  make gconfig ： 和xconfig类似，不过依赖于GTK库</li><li>  make allyesconfig ：编译内核尽可能多的功能</li><li>  make allmodconfig ：尽可能多地编译成内核模块配置的结果是产生.config文件</li><li>  make oldconfig ：如果你有.config文件，你就可以使用。和make config类似，但只询问新特性的配置</li><li>  make defconfg ：按照默认的配置文件arch/i386/defconfig进行配置。可再使用make menuconfig进行配置</li></ul><p>我一般使用的是make menuconfig，因为它是比较折中的方案。使用make menuconfig前要安装ncurses库：</p><pre><code>sudo apt-get install libncurses5-dev</code></pre><p>安装完成后在源码目录下执行命令：</p><pre><code>make menuconfig</code></pre><p>根据需要，进行适当的配置后，便可进行编译操作了。</p><ul><li>  <strong>编译</strong></li></ul><p>生成.config命令后在源码目录下执行：</p><pre><code>make bzimage -j8</code></pre><p>完成后会在arch/i386/boot/下生成bzimage压缩镜像。</p><ul><li>  <strong>安装</strong></li></ul><p>make module_install：将编译生成的内核模块复制到/lib/modules/<kernel-version>目录中去。</p><p>make install：复制内核镜像到/boot目录中并重命名为vmlinuz-x.y.z；生成initrd-<kernel-version>.img;配置引导文件。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux基础知识总结</title>
      <link href="/2014/04/24/Linux%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/"/>
      <url>/2014/04/24/Linux%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h3 id="一：什么是Linux"><a href="#一：什么是Linux" class="headerlink" title="一：什么是Linux?"></a>一：什么是Linux?</h3><p>Linux被称为类Unix操作系统，遵循POSIX标准。Linux与Unix的最大不同在于源代码的开放性和自由性。</p><p>Linux的发音：<a href="ftp://FTP_hllinux:123456@211.95.73.26/sp/Linux%E6%A0%87%E5%87%86%E5%8F%91%E9%9F%B3.rar">Linux发音</a></p><p>Linux的发展历史：1991年9月17日，Linus Torvalds 在网上发布了Linux的0.01版本。</p><ul><li>  1994年3月13日，在众多程序员的努力下，Linux 1.0版本正式发布。呵呵，人多力量大，要学会分享知识。</li><li>  1996年，Linux 2.0发布，其重要特点是开始支持对称多处理器。</li><li>  2004年12月18日，Linux2.6.0版本发布。</li></ul><h3 id="二：Linux所遵循的标准"><a href="#二：Linux所遵循的标准" class="headerlink" title="二：Linux所遵循的标准"></a>二：Linux所遵循的标准</h3><p>1、POSIX（Portable Oprating System Interface of Unix）：即可移植操作系统接口，由IEEE于1988年发布。其作用是使在某一Unix版本下开发的应用程序也能应用于其他Unix版本，以此保证了软件代码的可移植性。</p><p>2、LSB（Linux Standard Base）：由于Linux遵循POSIX标准，不同Linux发行版之间的源代码级有很好的兼容性，但二进制文件的兼容性不足，为解决这一问题，Linux Standard Base 项目应运而生，其主要目的是开发一系列标准，保证Linux不同发行版间的兼容性。</p><p>3、FHS(Filesystem Hierarchy Standard)：即文件系统分级结构标准，是LSB标准的一部分，详细规定了类Unix操作系统中各种应用软件、管理工具、脚本和帮助文件所处的位置。</p><h3 id="三：GNU和GPL"><a href="#三：GNU和GPL" class="headerlink" title="三：GNU和GPL"></a>三：GNU和GPL</h3><p>GNU（GNU is not Unix）:项目名称，该项目旨在实现一个自由并完整的类Unix操作系统，是自由软件发展的重要组成部分。</p><p>GPL（General Public License）:该授权模式下的软件需满足以下条件：</p><ul><li>  自由软件指的是软件开发者有发布软件的自由</li><li>  用户可获得源程序</li><li>  用户能修改软件或将它的一部分用于新的自由软件</li><li>  禁止任何人不承认软件开发者的权利。如果用户修改了自由软件，这些规定转化为该用户的责任。</li></ul><h3 id="四：Linux目录结构"><a href="#四：Linux目录结构" class="headerlink" title="四：Linux目录结构"></a>四：Linux目录结构</h3><ul><li>  /bin：存放对系统运行极为重要的二进制文件，也包括/usr/bin目录中文件的符号链接，同时还有一些用户命令。</li><li>  /etc：存放系统配置文件。（只能存放静态文件）</li><li>  /home:存放与各个用户相关的文件。</li><li>  /tmp：临时目录，很多程序要在该目录下创建临时文件。</li><li>  /var：存放经常变化的信息，如邮件、日志等。</li><li>  /proc:伪目录，系统将当前运行的进程映射为文件，通过修改该目录的文件值可以完成对内核运行参数的修改。</li><li>  /boot:存放启动所需文件。</li><li>  /dev：存放特殊文件和设备文件。</li><li>  /usr：存放与用户相关的程序和库文件。</li><li>  /sbin:存放与系统相关的可执行程序。</li></ul><h3 id="五：Linux系统组成"><a href="#五：Linux系统组成" class="headerlink" title="五：Linux系统组成"></a>五：Linux系统组成</h3><p>用户进程、系统调用接口、Linux内核、硬件</p><h3 id="六：内核结构"><a href="#六：内核结构" class="headerlink" title="六：内核结构"></a>六：内核结构</h3><ul><li>  进程调度：控制进程对cpu的访问，也就是根据一定的进程调度算法选择合适的进程运行。</li><li>  内存管理：用于控制多个进程安全地访问内存。Linux支持虚拟内存管理。</li><li>  虚拟文件系统：隐藏了各个不同文件系统实现的具体细节，为外界使用文件提供统一的接口。</li><li>  网络接口：提供了对各种标准协议的存取和各种网络硬件的支持。</li><li>  进程间通信：支持进程间各种通信机制。</li></ul><h3 id="七：进程状态"><a href="#七：进程状态" class="headerlink" title="七：进程状态"></a>七：进程状态</h3><ul><li>  可运行态：运行态和就绪态。</li><li>  浅度睡眠：可被信号和时钟中断唤醒的状态。</li><li>  深度睡眠：不可被信号和时钟中断唤醒的状态。</li><li>  暂停状态：进程暂停，接受类似于调试程序的处理。</li><li>  僵死状态：进程执行结束，大部分系统资源被释放，但进程pcb并未被释放。</li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FUSE</title>
      <link href="/2014/04/24/fuse/"/>
      <url>/2014/04/24/fuse/</url>
      
        <content type="html"><![CDATA[<h3 id="一、FUSE简介"><a href="#一、FUSE简介" class="headerlink" title="一、FUSE简介"></a><strong>一、FUSE简介</strong></h3><p>FUSE（用户空间文件系统）是这样一个框架，它使得FUSE用户在用户态下编写文件系统成为可能，而不必和内核打交道。FUSE由三个部分组成，linux内核模块、FUSE库以及mount 工具。用户关心的只是FUSE库和mount工具，内核模块仅仅提供kernel的接入口，给了文件系统一个框架，而文件系统本身的主要实现代码位于用户空间中。 FUSE库给用户提供了编程的接口，而mount工具则用于挂在用户编写的文件系统。</p><p>FUSE起初是为了研究AVFS(A Virtual Filesystem)而设计的，而现在已经成为SourceForge的一个独立项目，目前适用的平台有Linux, FreeBSD, NetBSD, OpenSolaris和Mac OS X。官方的linux kernel版本到2.6.14才添加了FUSE模块，因此2.4的内核模块下，用户如果要在FUSE中创建一个文件系统，需要先安装一个FUSE内核模块，然后使用FUSE库和API来创建。</p><h3 id="二、FUSE特性"><a href="#二、FUSE特性" class="headerlink" title="二、FUSE特性"></a><strong>二、FUSE特性</strong></h3><ul><li>  库文件和 API简单，极大地方便了用户的使用</li><li>  安装简便，不需要加补丁或者重新编译 kernel</li><li>  执行安全，使用稳定</li><li>  高效，相对于其它用户态文件系统实例</li><li>  非特权用户可以使用</li><li>  基于 linux2.4.x 和 2.6.x 内核，现在可以支持JavaTM 绑定，不必限定使用C和C++来编 写文件系统</li></ul><h3 id="三、源代码目录"><a href="#三、源代码目录" class="headerlink" title="三、源代码目录"></a><strong>三、源代码目录</strong></h3><ul><li>  ./doc 包含FUSE相关文档</li><li>  ./include 包含了FUSE API头，对创建文件系统有用，主要用fuse.h</li><li>  ./lib 存放FUSE库的源代码</li><li>  ./util 包含了FUSE工具库的源代码</li><li>  ./example 参考的例子</li></ul><h3 id="四、安装"><a href="#四、安装" class="headerlink" title="四、安装"></a><strong>四、安装</strong></h3><p>FUSE的源码安装类似于其他软件，只需要在FUSE的源码目录下执行如下命令即可：</p><pre><code>./configuremakemake install（以root身份执行）</code></pre><h3 id="五、FUSE-operations"><a href="#五、FUSE-operations" class="headerlink" title="五、FUSE operations"></a><strong>五、FUSE operations</strong></h3><p>FUSE使用fuse_operations来给用户提供编程结构，让用户通过注册自己编写的函数到该结构体来实现自己的文件系统。</p><pre><code>struct fuse_operations &#123;    int (*getattr) (const char *, struct stat *);    int (*readlink) (const char *, char *, size_t);    int (*mknod) (const char *, mode_t, dev_t);    int (*mkdir) (const char *, mode_t);    int (*unlink) (const char *);    int (*rmdir) (const char *);    int (*symlink) (const char *, const char *);    int (*rename) (const char *, const char *);    int (*link) (const char *, const char *);    int (*chmod) (const char *, mode_t);    int (*chown) (const char *, uid_t, gid_t);    int (*truncate) (const char *, off_t);    int (*utime) (const char *, struct utimbuf *);    int (*open) (const char *, struct fuse_file_info *);    int (*read) (const char *, char *, size_t, off_t, struct fuse_file_info *);    int (*write) (const char *, const char *, size_t, off_t, struct fuse_file_info *);    int (*statfs) (const char *, struct statvfs *);    int (*flush) (const char *, struct fuse_file_info *);    int (*release) (const char *, struct fuse_file_info *);    int (*fsync) (const char *, int, struct fuse_file_info *);    int (*setxattr) (const char *, const char *, const char *, size_t, int);    int (*getxattr) (const char *, const char *, char *, size_t);    int (*listxattr) (const char *, char *, size_t);    int (*removexattr) (const char *, const char *);    int (*opendir) (const char *, struct fuse_file_info *);    int (*readdir) (const char *, void *, fuse_fill_dir_t, off_t, struct fuse_file_info *);    int (*releasedir) (const char *, struct fuse_file_info *);    int (*fsyncdir) (const char *, int, struct fuse_file_info *);    void *(*init) (struct fuse_conn_info *conn);    void (*destroy) (void *);    int (*access) (const char *, int);    int (*create) (const char *, mode_t, struct fuse_file_info *);    int (*ftruncate) (const char *, off_t, struct fuse_file_info *);    int (*fgetattr) (const char *, struct stat *, struct fuse_file_info *);    int (*lock) (const char *, struct fuse_file_info *, int cmd, struct flock *);    int (*utimens) (const char *, const struct timespec tv[2]);    int (*bmap) (const char *, size_t blocksize, uint64_t *idx);&#125;;</code></pre><h3 id="六、hello示例文件系统源码分析"><a href="#六、hello示例文件系统源码分析" class="headerlink" title="六、hello示例文件系统源码分析"></a><strong>六、hello示例文件系统源码分析</strong></h3><p>FUSE在源码目录example下有一些示例文件系统，通过阅读这些示例文件系统可以掌握FUSE用户态文件系统的编写规范。下面以hello.c为例分析FUSE的编写规范：</p><pre><code>#define FUSE_USE_VERSION 26#include &lt;fuse.h&gt;#include &lt;stdio.h&gt;#include &lt;string.h&gt;#include &lt;errno.h&gt;#include &lt;fcntl.h&gt;static const char *hello_str = &quot;Hello World!\n&quot;;static const char *hello_path = &quot;/hello&quot;;</code></pre><p>/<em>该函数与stat()类似，用于得到文件的属性，将其存入到结构体struct stat中</em>/</p><pre><code>static int hello_getattr(const char *path, struct stat *stbuf)&#123;    int res = 0;    memset(stbuf, 0, sizeof(struct stat));     //用于初始化结构体stat    if (strcmp(path, &quot;/&quot;) == 0) &#123;    stbuf-&gt;st_mode = S_IFDIR | 0755;     //S_IFDIR 用于说明/为目录，详见S_IFDIR定义    stbuf-&gt;st_nlink = 2;     //文件链接数&#125; else if (strcmp(path, hello_path) == 0) &#123;    stbuf-&gt;st_mode = S_IFREG | 0444;    //S_IFREG用于说明/hello为常规文件    stbuf-&gt;st_nlink = 1;    stbuf-&gt;st_size = strlen(hello_str);     //设置文件长度为hello_str的长度&#125; else    res = -ENOENT;     //返回错误信息，没有该文件或目录    return res;     //执行成功返回0&#125;</code></pre><p>/<em>该函数用于读取/目录中的内容，并在/目录下增加了. .. hello三个目录项</em>/</p><pre><code>static int hello_readdir(const char *path, void *buf, fuse_fill_dir_t filler,  off_t offset, struct fuse_file_info *fi)    &#123;        (void) offset;            (void) fi;            if (strcmp(path, &quot;/&quot;) != 0)             return -ENOENT;/*fill的定义：typedef int (*fuse_fill_dir_t) (void *buf, const char *name,const struct stat *stbuf, off_t off);其作用是在readdir函数中增加一个目录项*/    filler(buf, &quot;.&quot;, NULL, 0);    //在/目录下增加. 这个目录项    filler(buf, &quot;..&quot;, NULL, 0);    // 增加.. 目录项    filler(buf, hello_path + 1, NULL, 0);    //增加hello目录项    return 0;&#125;</code></pre><p>/<em>用于打开hello文件</em>/</p><pre><code>static int hello_open(const char *path, struct fuse_file_info *fi)&#123;    if (strcmp(path, hello_path) != 0)         return -ENOENT;    if ((fi-&gt;flags &amp; 3) != O_RDONLY)        return -EACCES;    return 0;&#125;</code></pre><p>/<em>读取hello文件时的操作，它实际上读取的是字符串hello_str的内容</em>/</p><pre><code>static int hello_read(const char *path, char *buf, size_t size, off_t offset, struct fuse_file_info *fi)&#123;    size_t len;    (void) fi;    if(strcmp(path, hello_path) != 0)        return -ENOENT;    len = strlen(hello_str);    if (offset &lt; len) &#123;        if (offset + size &gt; len)            size = len - offset;        memcpy(buf, hello_str + offset, size);    &#125; else    size = 0;    return size;&#125;</code></pre><p>/<em>注册上面定义的函数</em>/</p><pre><code>static struct fuse_operations hello_oper = &#123;    .getattr = hello_getattr,    .readdir = hello_readdir,    .open = hello_open,    .read = hello_read,&#125;;</code></pre><p>/<em>用户只需要调用fuse_main()，剩下的事就交给FUSE了</em>/</p><pre><code>int main(int argc, char *argv[])&#123;    return fuse_main(argc, argv, &amp;hello_oper, NULL);&#125;</code></pre><p>终端运行：</p><pre><code>~/fuse/example$ mkdir /tmp/fuse     //在/tmp下建立fuse目录，用于挂载hello文件系统~/fuse/example$ ./hello /tmp/fuse     //挂载hello文件系统~/fuse/example$ ls -l /tmp/fuse    //执行ls时，会调用到readdir函数，该函数会添加一个hello     文件总用量 0-r--r--r-- 1 root root 13 1970-01-01 07:00 hello~/fuse/example$ cat /tmp/fuse/hello    //执行cat hello时，会调用open以及read函数，将Hello World!     字符串hello_str中的内容读出~/fuse/example$ fusermount -u /tmp/fuse //卸载hello文件系统</code></pre><p>通过上述的分析可以知道，使用FUSE必须要自己实现对文件或目录的操作，系统调用也会最终调用到用户自己实现的函数。用户实现的函数需要在结构体fuse_operations中注册。而在main()函数中，用户只需要调用fuse_main()函数就可以了，剩下的复杂工作可以交给FUSE。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fuse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux用户管理</title>
      <link href="/2014/04/24/Linux%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/"/>
      <url>/2014/04/24/Linux%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h3 id="一、用户管理："><a href="#一、用户管理：" class="headerlink" title="一、用户管理："></a><strong>一、用户管理：</strong></h3><p>Linux系统用户分为三类：超级用户、普通用户和伪用户。其具体区别如下：</p><ul><li>  超级用户：具有管理系统的一切权限。UID为０。</li><li>  普通用户：具有有限的权限。UID从500到6000。</li><li>  伪用户：在/etc/passwd中有记录，但因记录中shell为空，所以不能登录系统。其作用是为了方便管理系统，满足相应的系统进程对文件属主的需要。</li></ul><p>用户帐号的配置文件是/etc/passwd，可用sudo gedit /etc/passwd命令查看和修改。文件内容格式如下：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    <span class="symbol">root:</span><span class="symbol">x:</span>0<span class="symbol">:</span>0<span class="symbol">:root</span><span class="symbol">:/root</span><span class="symbol">:/bin/bash</span></span><br><span class="line">    <span class="symbol">daemon:</span><span class="symbol">x:</span><span class="number">1</span><span class="symbol">:</span><span class="number">1</span><span class="symbol">:daemon</span><span class="symbol">:/usr/sbin</span><span class="symbol">:/bin/sh</span></span><br><span class="line">    <span class="symbol">bin:</span><span class="symbol">x:</span><span class="number">2</span><span class="symbol">:</span><span class="number">2</span><span class="symbol">:bin</span><span class="symbol">:/bin</span><span class="symbol">:/bin/sh</span></span><br><span class="line">    <span class="symbol">sys:</span><span class="symbol">x:</span><span class="number">3</span><span class="symbol">:</span><span class="number">3</span><span class="symbol">:sys</span><span class="symbol">:/dev</span><span class="symbol">:/bin/sh</span></span><br><span class="line">    <span class="symbol">sync:</span><span class="symbol">x:</span><span class="number">4</span><span class="symbol">:</span><span class="number">65534</span><span class="symbol">:sync</span><span class="symbol">:/bin</span><span class="symbol">:/bin/sync</span></span><br><span class="line">    <span class="symbol">games:</span><span class="symbol">x:</span><span class="number">5</span><span class="symbol">:</span><span class="number">60</span><span class="symbol">:games</span><span class="symbol">:/usr/games</span><span class="symbol">:/bin/sh</span></span><br><span class="line">    <span class="symbol">man:</span><span class="symbol">x:</span><span class="number">6</span><span class="symbol">:</span><span class="number">12</span><span class="symbol">:man</span><span class="symbol">:/var/cache/man</span><span class="symbol">:/bin/sh</span></span><br><span class="line">    <span class="symbol">lp:</span><span class="symbol">x:</span><span class="number">7</span><span class="symbol">:</span><span class="number">7</span><span class="symbol">:lp</span><span class="symbol">:/var/spool/lpd</span><span class="symbol">:/bin/sh</span></span><br><span class="line">    <span class="symbol">mail:</span><span class="symbol">x:</span><span class="number">8</span><span class="symbol">:</span><span class="number">8</span><span class="symbol">:mail</span><span class="symbol">:/var/mail</span><span class="symbol">:/bin/sh</span></span><br><span class="line">    <span class="symbol">news:</span><span class="symbol">x:</span><span class="number">9</span><span class="symbol">:</span><span class="number">9</span><span class="symbol">:news</span><span class="symbol">:/var/spool/news</span><span class="symbol">:/bin/sh</span></span><br><span class="line">    <span class="symbol">uucp:</span><span class="symbol">x:</span><span class="number">10</span><span class="symbol">:</span><span class="number">10</span><span class="symbol">:uucp</span><span class="symbol">:/var/spool/uucp</span><span class="symbol">:/bin/sh</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">……</span><br></pre></td></tr></table></figure><p>其含义为：</p><p>用户名：用户密码：用户id：组id:用户相关信息：用户家目录：用户shell</p><p>用户密码的配置文件为/etc/shadow，同样用sudo gedit /etc/shadow命令查看。</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">        root:!:<span class="number">14866:0</span>:<span class="number">99999:7</span>:::</span><br><span class="line">        daemon:*:<span class="number">14728:0</span>:<span class="number">99999:7</span>:::</span><br><span class="line">        bin:*:<span class="number">14728:0</span>:<span class="number">99999:7</span>:::</span><br><span class="line">        sys:*:<span class="number">14728:0</span>:<span class="number">99999:7</span>:::</span><br><span class="line">        sync:*:<span class="number">14728:0</span>:<span class="number">99999:7</span>:::</span><br><span class="line">        ……</span><br><span class="line">        hplip:*:<span class="number">14728:0</span>:<span class="number">99999:7</span>:::</span><br><span class="line">        gdm:*:<span class="number">14728:0</span>:<span class="number">99999:7</span>:::</span><br><span class="line">        kelvin:$<span class="number">6</span>$CILudWuh$Dv6cGVZlLBKoCXUubKYeo3W4s9GmBegBJPgiIRzlRZ7O1uYO6mEzLtv</span><br><span class="line">        rfFEozeSjHB56R7.Qt/rRgADFjyPda<span class="number">1:14866:0</span>:<span class="number">99999:7</span>:::</span><br><span class="line">        sshd:*:<span class="number">14867:0</span>:<span class="number">99999:7</span>:::</span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line">任何用户都可查看passwd文件，但只有root才能查看shadow文件。shadow文件内容的含义为：</span><br><span class="line"></span><br><span class="line">用户名：加密口令（！表示不能登录）：密码最后修改时间：密码最大时间间隔：最小时间间隔：警告时间：不活动时间：失效时间</span><br><span class="line"></span><br><span class="line">创建一个帐号有如下方法：</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>.  在passwd中增加一条记录；创建用户家目录；设置用户家目录的配置文件；设置用户口令；</span><br><span class="line"><span class="number">2</span>.  useradd 命令或adduser命令；用userdel或deluser命令删除用户，注意加-r选项才能删除用户家目录和所有用户信息。</span><br><span class="line"></span><br><span class="line">### **二、用户组管理：**</span><br><span class="line"></span><br><span class="line">用户组分为：</span><br><span class="line"></span><br><span class="line">*   私有组：当创建一个新的用户，没有指定该用户所属组时，系统则建立一个和该用户同名的私有组。</span><br><span class="line">*   标准组：除开私有组以外的所有组。</span><br><span class="line"></span><br><span class="line">用户组的配置文件为/etc/group，用sudo gedit /etc/group命令查看该文件，其内容形式如下：</span><br></pre></td></tr></table></figure><pre><code>    root:x:0:    daemon:x:1:    bin:x:2:    sys:x:3:    adm:x:4:kelvin    tty:x:5:    disk:x:6:    lp:x:7:    mail:x:8:    news:x:9:    uucp:x:10:    man:x:12:    proxy:x:13:    ……</code></pre><p>```    </p><p>其含义为：</p><p>组名：口令：组id：成员</p><p>添加或删除组的命令：groupadd、addgroup、delgroup、groupdel。具体用法和adduser类似。</p><p>添加用户到组de命令：gpasswd -a 用户名 组名。</p><p>将用户从组中删除：gpasswd -d 用户名 组名。</p><p>groups 用户名：查看用户的组状态。即用户属于哪些组。</p><p>finger 用户名：查看用户信息。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux权限管理</title>
      <link href="/2014/04/24/Linux%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/"/>
      <url>/2014/04/24/Linux%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>Linux权限管理是其一大特色，优秀的权限管理机制为Linux安全性提供了可靠的保障。</p><h3 id="一、用户权限管理："><a href="#一、用户权限管理：" class="headerlink" title="一、用户权限管理："></a><strong>一、用户权限管理：</strong></h3><p>root用户是系统的超级用户，是Linux系统的CEO,它具有最高的管理权限，所以一般不用该用户登录系统进行日常的操作与维护，root可将某些权限赋予其他用户来管理系统的某些资源。</p><p>su命令用来切换用户，用该命令切换用户时，用户身份和环境变量都发生改变。例如：</p><pre><code>kelvin@kelvin-laptop:~$ lsexamples.desktop  workplace  公共的  模板  视频  图片  文档  下载  音乐  桌面kelvin@kelvin-laptop:~$ su ws密码： ws@kelvin-laptop:/home/kelvin$ </code></pre><p>在ubuntu系统中，有些动作需要管理员的权限才能执行，可用sudo来提升权限。若在/etc/目录下建立nologin文件，则只允许root用户登录。相反，删除该文件则所有用户都可以登录系统。</p><h3 id="二、文件权限管理："><a href="#二、文件权限管理：" class="headerlink" title="二、文件权限管理："></a><strong>二、文件权限管理：</strong></h3><p>使用ls -l命令可以以长格式显示该目录下文件和子目录信息。如：</p><pre><code>kelvin@kelvin-laptop:~$ ls -l总用量 40-rw-r--r-- 1 kelvin kelvin  179 2010-09-14 09:39 examples.desktoplrwxrwxrwx 1 kelvin kelvin   37 2010-09-15 21:49 linux -&gt; /home/kelvin/workplace/linux-2.6.35.4drwxr-xr-x 3 kelvin kelvin 4096 2010-09-15 17:13 workplacedrwxr-xr-x 2 kelvin kelvin 4096 2010-09-14 09:49 公共的drwxr-xr-x 2 kelvin kelvin 4096 2010-09-14 09:49 模板drwxr-xr-x 2 kelvin kelvin 4096 2010-09-14 09:49 视频drwxr-xr-x 2 kelvin kelvin 4096 2010-09-14 09:49 图片drwxr-xr-x 2 kelvin kelvin 4096 2010-09-14 15:09 文档drwxr-xr-x 2 kelvin kelvin 4096 2010-09-14 14:57 下载drwxr-xr-x 2 kelvin kelvin 4096 2010-09-14 09:49 音乐drwxr-xr-x 2 kelvin kelvin 4096 2010-09-15 17:18 桌面</code></pre><p>第一部分给出了文件或目录的相关权限信息：</p><pre><code>drwxr-xr-x：总共有十个位。</code></pre><p>第1位给出了该项的属性，即是文件还是目录，或者是链接文件等。</p><pre><code>-：表示是文件，如上面的examples.desktop就是一个文件；d：表示是目录，如上面的workplace;l：表示是链接文件；</code></pre><p>第2、3、4位给出了文件或目录所有者的权限，第5、6、7位给出了文件或目录所属用户组的权限，第8、9、10位给出了其他用户权限。</p><pre><code>r：为读权限。w：为写权限。x：为执行权限。目录的执行权限的意思是可以用cd命令进入该目录。</code></pre><p>chmod命令：该命令用来修改文件或目录的访问权限。一般有两种使用方式：</p><p>第一种方式为：chmod a+r 文件或目录名</p><p>其中a可用u、g、o替换，+可用=、-替换，r可用w、x替换。</p><pre><code>a：表示修改所有用户的权限。包括u、g、r。u：表示只给文件或目录所有者修改权限。g：表示给文件所有组修改权限。o：表示给其他用户修改权限。+：表示增加某种权限。-：表示减去某种权限。=：表示赋予某种权限。</code></pre><p>第二种方式为：</p><p>用数字表示权限：</p><p>r：用4表示 w：用2表示 x：用1表示。</p><p>则1：–x 2:-w- 3:-wx 4:r– 5:r-x 6:rw- 7:rwx</p><p>于是可用“chmod 777 文件或目录名”命令来修改权限。三个7中第一个代表所有者权限，第二个代表所有组权限，第三个代表其他用户权限。当然，也可用类似于“chmod u+2 文件目录名”的方式来修改权限。</p><p>-R选项表示包括子目录的权限也改变。</p><p>chown命令：改变文件或目录所有者。-R选项同样表示包含子目录。</p><p>格式：chown 用户 文件或目录</p><p>chgrp:改变所属组，用法类似于chown。</p><p>chown group.user 文件或目录名，可同时改变所有者和所属组。</p><p>umask：用于设定文件或目录刚创建是的权限。目录为755+umask值=777，文件644+umask值=777。</p><p>粘着位t：对于权限值为777的目录可设置粘着位t，即：drwxrwxrwt。其含义为，任何用户的可在该目录中创建和修改自己的文件，也可以查看别人的文件，但不能删除或修改其他用户的文件。</p><p>s：对于可执行文件，若将该文件用户或组权限的x用s替换，则相应用户便具有了该执行文件拥有者或拥有组的身份。设置s位的作用可用如下的例子阐明：</p><p>保存用户密码的文件存放于/etc/shadow中，其权限为：</p><pre><code>-rw-r----- 1 root shadow 1067 2010-09-15 21:33 /etc/shadow</code></pre><p>即：只有该文件的所有者root用户才能具有读写该文件的权利，那么为什么普通用户可以通过passwd命令修改自己的密码呢？我们看一下passwd命令这个可执行文件的权限：</p><pre><code>-rwsr-xr-x 1 root root 37140 2010-01-27 01:09 /usr/bin/passwd</code></pre><p>该命令有s位，所以当普通用户执行该命令时，他便有了passwd所有者root的身份，自然可以修改属于 root用户的文件shadow。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Make</title>
      <link href="/2014/04/24/make/"/>
      <url>/2014/04/24/make/</url>
      
        <content type="html"><![CDATA[<h3 id="一、make的功能："><a href="#一、make的功能：" class="headerlink" title="一、make的功能："></a><strong>一、make的功能：</strong></h3><p>make是一个用来维护程序模块关系和生产可执行文件的工具，他可以根据程序修改的情况重新编译链接生成的中间代码或最终的可执行文件。执行make命令需要一个Makefile文件，来定义整个项目的编译规则。makefile定义了模块间的依赖关系，指定文件的编译顺序，以及编译所使用的命令。有了make和Makefile文件，整个项目的源程序可以自动编译，极大的提高了软件开发效率。</p><h3 id="二、Make的一般使用："><a href="#二、Make的一般使用：" class="headerlink" title="二、Make的一般使用："></a><strong>二、Make的一般使用：</strong></h3><p>1、Makefile的基本构成：</p><p>Makefile由规则构成，一条规则生成一个或多个目标文件，其格式如下：</p><pre><code>目标文件列表 分隔符 依赖文件列表 [；命令]  //[]中的内容可选    [命令]    [命令]</code></pre><p>例如：</p><pre><code>main:main.o module1.o module2.o    gcc main.o module1.o module2.o -o main</code></pre><p>第二行是命令必须以Tab键开头，第一行是说明模块间的依赖关系，所以不加Tab，若加Tab,make就认为这是一条命令。以#开头的行为注释行，makefile中若用到#，可用#；同样，$应该用$$。在依赖列表后加上分号后，可直接跟上命令。</p><p>命令之间可以插入多个空行，但每行必须有Tab键，如果一行过长，可以在行末输入一个\，用反斜杠连接的行都被看成一行来处理，反斜杠和新行之间不能有空格。Makefile也可以命名为makefile,若命名为其他文件名，则需要用-f或–file选项来告知make哪一个是makefile文件。</p><p>2、Makefile文件的构成：</p><p>一个完整的makefile文件由5个部分构成：显式规则、隐含规则、变量、文件指示和注释。</p><p>显式规则：一条显式规则指名了目标文件、目标文件的依赖关系、命令。有些规则没有命令，只是说明文件之间的依赖关系。</p><p>隐含规则：由make根据目标文件而自动推导出的规则。例如：module2.o:head1.h,实际上等价于module2.o:module2.c head1.h; gcc -c module2.c -o module2.o</p><p>变量：类似于c语言中的宏。</p><p>文件指示：包括三个部分，一个类似于c语言中的include语句，可以将另一个makefile文件包含进来；二是根据情况指定makefile中的有效部分，就像c语言中的预编译#if一样；三是定义一个多行的命令。</p><p>3、makefile的基本语法：</p><ul><li>|的作用:  foo:foo.c | somelib<pre><code>  gcc -o foo foo.c somelib</code></pre></li></ul><p>当somelib文件的时间戳比foo晚时，不用重新编译foo。</p><ul><li>命令行属性：</li></ul><p>可在命令前、Tab键后加上如下符号：</p><pre><code>-：执行本命令行如果遇到错误，继续执行而不退出make。+：总是执行该命令，即使执行make时使用了-n,-q,-t选项。@：执行命令时不在屏幕上输出该命令的内容。</code></pre><ul><li>  伪目标：</li></ul><p>先看以下代码：</p><pre><code>clean:    -rm -rf *.o</code></pre><p>因为clean后没有依赖文件，所以clean被认为是最新，不会执行rm命令，若要执行rm，需要执行make clean命令。但如果当前目录下已经有一个名叫clean的文件，则make clean也不能使得rm命令执行。这时需要引入伪目标才能搞定。</p><pre><code>.PHONY:cleanclean:    -rm -rf *.o</code></pre><p>.PHONY的依赖文件为伪目标，作用是伪目标的命令即使在当前目录下存在与伪目标同名的文件时也执行该命令。</p><ul><li>  特殊目标：</li></ul><p>.PHONY：伪目标，如上</p><p>.IGNORE：对于该目标后的依赖文件，生成时如遇到错误则可跳过错误继续执行，不会中断make。</p><p>.SUFFIXES：该目标的依赖被认为是一个后缀列表，在检查后缀规则时使用。</p><p>.SILENT：生成该目标文件的依赖文件所执行的命令都不被打印，如果其后无依赖文件，则所有的命令都不会被打印。</p><p>.PRECIOUS：该目标的依赖文件将不会被删除。</p><p>.INTERMEDIATE：该目标的依赖文件被当作是中间文件对待。</p><ul><li>  多个目标：</li></ul><p>一个规则中可以有多个目标，这些目标有相同的依赖文件</p><ul><li>  搜索目录：</li></ul><p>通常在一个大的项目中，会把头文件、源文件、库文件放在不同的目录下。当目录发生改变后，只需改变依赖文件的搜索目录。 make定义了一个叫VPATH的变量，在当前目录中搜索不到依赖文件时，便到VPATH定义的目录中去寻找。也可用关键字vpath 定义搜索位置：</p><pre><code>vpath &lt;pattern&gt; &lt;directories&gt;vpath :清除所有已被设置好的文件搜索目录。</code></pre><p>如：vpath %.h ../headers表示在../headers目录下搜索所有.h结尾的头文件。</p><ul><li>  变量：</li></ul><p>makefile中通常可定义变量，make在执行时会把变量名出现的地方用变量值代替。</p><p>引用变量：$()或者${}</p><p>定义变量：</p><pre><code>= ：定义的变量在执行命令时才展开；:=：定义的变量立即展开；?=：在此之前没有给该变量赋值才会给该变量赋值+=：追加变量值，与原变量值之间用空格隔开</code></pre><p>预定义变量：</p><p>makefile 中预定义了许多变量,在隐含规则中通常会用到这些变量：</p><pre><code>宏名        初始值        说明CC            cc            默认使用的编译器CFLAGS        -o            编译器使用的选项MAKE        make        make命令MAKEFLAGS    空             make命令的选项SHELL                    默认使用的shell名PWD                    运行make时的当前路径AR            ar            库管理命令ARFLAGS       -ruv        库管理选项LIBSUFFIXE    .a            库的后缀A            a            库的扩展名</code></pre><p>自动变量：</p><p>它们的值在make运行过程中动态的改变，是隐含规则所必需的变量。</p><pre><code>$@：表示一个规则中的目标文件名。$%：当规则中的目标文件是一个静态库文件时，$%就代表静态库的一个成员名。如果目标不是静态库文件，则该变量    值为空。$&lt;：规则中的第一个依赖文件名。$&gt;：当规则是一个静态库文件时，该变量表示静态库名。$?：所有比目标文件新的依赖文件列表，以空格分隔。如果目标是静态库文件，该变量代表的是    库成员。$^：规则的所有依赖文件列表，以空格分割。如果目标是静态库文件，代表的是库成员。$+：和$^类似，不同的是该变量不除去重复的文件。$*：去掉后缀的目标文件名。</code></pre><ul><li>条件语句：  ifeq ($(CC),gcc)<br>  libs=$(libs_for_gcc)<br>  else<br>  libs=$(normal_libs)<br>  endif<br>  foo:foo.c<pre><code>  $(CC) -o foo foo.c $(libs)</code></pre></li></ul><p>此外，还有ifneq,ifdef,ifndef</p><ul><li>  使用库：</li></ul><p>建立和维护库时，把库名作为目标文件，需要加入库中的文件作为依赖文件。如：</p><pre><code>mylib.a:mylib.a(file1.o) mylib.a(file2.o)或mylib.a:mylib.a(file1.o file2.o)</code></pre><p>接着输入命令：</p><pre><code>ar -ruv 库名 目标文件名</code></pre><p>三、make命令的常用选项：</p><pre><code>-C dir或--directory=DIR：在读取Makefile文件之前，先切换到dir目录下，即把dir目录作为当前目录。-d：输出所有的调试信息。-e或--environment-overrides：不允许makefile对系统环境变量进行重新赋值。-f filename或者--file=FILE或者--makefile=FILE：使用指定文件作为makefile文件。-i或者--ignore-errors：忽略执行make时产生的错误，不退出make。-h或者--help：打印出帮助信息。-n或者--just-print：只打印出要执行的命令，但不执行命令。-o filename或者--old-file=FILE：不重建filename及依赖于filename的文件。-p：执行命令之前，打印出make读取的makefile的所有数据，同时打印出make的版本信息。如果只打印信息而    不执行命令，可使用make -qp ，查看make执行前的隐含规则和预定义变量，使用make -p-f /dev/null。-q：不执行任何命令，返回0表示没有重建目标，返回1表示存在重建目标，返回2表示有错误发生。-r：忽略隐含规则。-R：取消预定义变量。同时打开-r选项。-s：执行但不显示所执行的命令。-t：把所有目标文件的最后修改时间设置为当前系统时间。-v：打印make版本信息。</code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> make </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>perf ，比较好的一个程序性能测试工具</title>
      <link href="/2014/04/24/perf%E6%AF%94%E8%BE%83%E5%A5%BD%E7%9A%84%E4%B8%80%E4%B8%AA%E7%A8%8B%E5%BA%8F%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/"/>
      <url>/2014/04/24/perf%E6%AF%94%E8%BE%83%E5%A5%BD%E7%9A%84%E4%B8%80%E4%B8%AA%E7%A8%8B%E5%BA%8F%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<p>面对一个问题程序，最好采用自顶向下的策略。先整体看看该程序运行时各种统计事件的大概，再针对某些方向深入细节。而不要一下子扎进琐碎细节，会一叶障目的。</p><p>对于优化自己写的代码，cpu bound 型 和 IO bound 型是不一样的：</p><ul><li>  cpu bound 型：所谓cpu bound型指的是程序大部分时间都在使用CPU。</li><li>  IO bound 型：由cpu bound型的定义就不难推出了。</li></ul><h3 id="perf-stat-命令用于统计进程总体的信息"><a href="#perf-stat-命令用于统计进程总体的信息" class="headerlink" title="perf stat 命令用于统计进程总体的信息"></a><strong>perf stat 命令用于统计进程总体的信息</strong></h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/<span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**<span class="emphasis">*/</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">$ perf stat ./Joseph_ring</span></span></span><br><span class="line"><span class="emphasis"><span class="strong"> Performance counter stats for &#x27;./Joseph_ring&#x27;:</span></span></span><br><span class="line"><span class="emphasis"><span class="strong"></span></span></span><br><span class="line"><span class="emphasis"><span class="strong">         19.755435 task-clock                #    0.000 CPUs utilized          </span></span></span><br><span class="line"><span class="emphasis"><span class="strong">               429 context-switches          #    0.022 M/sec                  </span></span></span><br><span class="line"><span class="emphasis"><span class="strong">                 5 CPU-migrations            #    0.000 M/sec                  </span></span></span><br><span class="line"><span class="emphasis"><span class="strong">               137 page-faults               #    0.007 M/sec                  </span></span></span><br><span class="line"><span class="emphasis"><span class="strong">        27,255,530 cycles                    #    1.380 GHz                    </span></span></span><br><span class="line"><span class="emphasis"><span class="strong">     <span class="xml"><span class="tag">&lt;<span class="name">not</span> <span class="attr">counted</span>&gt;</span></span> stalled-cycles-frontend </span></span></span><br><span class="line"><span class="emphasis"><span class="strong">     <span class="xml"><span class="tag">&lt;<span class="name">not</span> <span class="attr">counted</span>&gt;</span></span> stalled-cycles-backend  </span></span></span><br><span class="line"><span class="emphasis"><span class="strong">         6,521,404 instructions              #    0.24  insns per cycle        </span></span></span><br><span class="line"><span class="emphasis"><span class="strong">         1,157,604 branches                  #   58.597 M/sec                  </span></span></span><br><span class="line"><span class="emphasis"><span class="strong">           161,429 branch-misses             #   13.95% of all branches        </span></span></span><br><span class="line"><span class="emphasis"><span class="strong"></span></span></span><br><span class="line"><span class="emphasis"><span class="strong">     439.901478124 seconds time elapsed</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">/<span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**<span class="emphasis">*/</span></span></span></span></span><br></pre></td></tr></table></figure><p>task-clock：CPU 利用率，该值高，说明程序的多数时间花费在 CPU 计算上而非 IO。</p><p>Context-switches：进程切换次数，记录了程序运行过程中发生了多少次进程切换，频繁的进程切换是应该避免的。</p><p>Cache-misses：程序运行过程中总体的 cache 利用情况，如果该值过高，说明程序的 cache 利用不好</p><p>CPU-migrations：表示进程 t1 运行过程中发生了多少次 CPU 迁移，即被调度器从一个 CPU 转移到另外一个 CPU 上运行。</p><p>Cycles：处理器时钟，一条机器指令可能需要多个 cycles</p><p>Instructions: 机器指令数目。</p><p>IPC：是 Instructions/Cycles 的比值，该值越大越好，说明程序充分利用了处理器的特性。</p><p>branches：待查</p><p>branch misses：待查</p><h3 id="perf-top-命令可查看系统的实时信息"><a href="#perf-top-命令可查看系统的实时信息" class="headerlink" title="perf top 命令可查看系统的实时信息"></a><strong>perf top 命令可查看系统的实时信息</strong></h3><p>例如系统中最耗时的内核函数或某个用户进程：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">/<span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**<span class="emphasis">*/</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">        $perf top</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">        </span></span></span><br><span class="line"><span class="emphasis"><span class="strong">                     samples  pcnt function                       DSO</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">        </span></span></span><br><span class="line"><span class="emphasis"><span class="strong">                     <span class="strong">____</span><span class="strong">__<span class="emphasis">_ <span class="strong">____</span>_</span> __</span><span class="strong">____</span><span class="strong">____</span><span class="strong">____</span><span class="strong">____</span><span class="strong">____</span><span class="strong">____</span><span class="strong">____</span> <span class="strong">____</span><span class="strong">____</span><span class="strong">____</span><span class="strong">____</span><span class="strong">__</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">        </span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">        </span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">        </span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">                      133.00  9.4% system<span class="emphasis">_call                    [kernel.kallsyms] </span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">        </span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">                      126.00  8.9% <span class="strong">__ticket<span class="emphasis">_spin_</span>lock             [kernel.kallsyms] </span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">        </span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">                       49.00  3.5% schedule                       [kernel.kallsyms] </span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">        </span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">                       49.00  3.5% __</span>ticket_</span>spin<span class="emphasis">_unlock           [kernel.kallsyms] </span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">        </span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">                       43.00  3.0% pthread_</span>mutex<span class="emphasis">_lock             libpthread-2.13.so</span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">        </span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">                       40.00  2.8% _</span>nv027676rm                    [nvidia]          </span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">        </span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">                       40.00  2.8% __</span>pthread_mutex_unlock_usercnt libpthread-2.13.so</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">        </span></span></span><br><span class="line"><span class="emphasis"><span class="strong">                       38.00  2.7% <span class="strong">__memset<span class="emphasis">_sse2                  libc-2.13.so      </span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">        </span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">                       32.00  2.3% unix_</span>poll                      [kernel.kallsyms] </span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">        </span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">                       25.00  1.8% __</span>sincos                       libm-2.13.so      </span></span></span><br><span class="line"><span class="emphasis"><span class="strong">        </span></span></span><br><span class="line"><span class="emphasis"><span class="strong">                       24.00  1.7% update_curr                    [kernel.kallsyms] </span></span></span><br><span class="line"><span class="emphasis"><span class="strong">        </span></span></span><br><span class="line"><span class="emphasis"><span class="strong">                       24.00  1.7% sched_clock_local              [kernel.kallsyms] </span></span></span><br><span class="line"><span class="emphasis"><span class="strong">        </span></span></span><br><span class="line"><span class="emphasis"><span class="strong">        /<span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**/</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">```   </span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">### **</span>perf record<span class="strong">** </span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">    </span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">记录单个函数级别的统计信息，并使用 perf report 来显示统计结果，以此可以找到热点：</span></span></span></span><br></pre></td></tr></table></figure><pre><code>    /**********************************************************************************/    # Events: 46  cpu-clock        #        # Overhead      Command      Shared Object                  Symbol        # ........  ...........  .................  ......................        #            63.04%  Joseph_ring  [kernel.kallsyms]  [k] 0xc10e7ef2             6.52%  Joseph_ring  libc-2.13.so       [.] __GI_vfprintf             4.35%  Joseph_ring  libc-2.13.so       [.] __printf             4.35%  Joseph_ring  libc-2.13.so       [.] _IO_new_file_xsputn             2.17%  Joseph_ring  libc-2.13.so       [.] _itoa_word        /**********************************************************************************/</code></pre><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">perf <span class="keyword">record</span> -e cpu-clock -g 给出函数的调用关系，以便于找到次级热点：</span><br></pre></td></tr></table></figure><pre><code>    /**********************************************************************************/        # Events: 47  cpu-clock        #        # Overhead      Command      Shared Object                  Symbol        # ........  ...........  .................  ......................        #            72.34%  Joseph_ring  [kernel.kallsyms]  [k] 0xc11017a7                    |                    --- 0xc150a125                       |                                 |--33.33%-- 0xc105e3a7                       |          0xc105e4f6            /**********************************************************************************/</code></pre><p>```</p>]]></content>
      
      
      <categories>
          
          <category> 开发工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> perf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux shell 程序设计5——shell中一些特殊符号的用法总结</title>
      <link href="/2014/04/24/Linuxshell%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A15shell%E4%B8%AD%E4%B8%80%E4%BA%9B%E7%89%B9%E6%AE%8A%E7%AC%A6%E5%8F%B7%E7%9A%84%E7%94%A8%E6%B3%95%E6%80%BB%E7%BB%93/"/>
      <url>/2014/04/24/Linuxshell%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A15shell%E4%B8%AD%E4%B8%80%E4%BA%9B%E7%89%B9%E6%AE%8A%E7%AC%A6%E5%8F%B7%E7%9A%84%E7%94%A8%E6%B3%95%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>1、{} 大括号：</p><pre><code>eg: ls my_&#123;finger,toe&#125;s</code></pre><p>这条命令相当于如下两个命令的组合：</p><pre><code>ls my_fingers ; ls my_toeseg: mkdir &#123;userA,userB,userC&#125;-&#123;home,bin,data&#125;</code></pre><p>我们得到 userA-home, userA-bin, userA-data, userB-home, userB-bin, userB-data, userC-home, userC-bin, userC-data，这几个目录</p><p>大括号也可用于语句块的构造，命令之间可用回车隔开</p><p>2、[] 中括号：允许匹配方括号中任何一个单个字符</p><p>eg: ls /[eh][to][cm]*</p><p>相当于执行 ls /etc 和 ls /home。</p><p>常出现在流程控制中，其作用是括住判断式。注意：[、] 与表达式之间有空格。</p><p>eg:</p><pre><code>if [ &quot;$?&quot; != 0 ]then echo &quot;Executes error&quot;fi</code></pre><p>3、<code>command</code> 反引号：反引号中的指令将会被执行</p><pre><code>eg: fdv=`date +%F`</code></pre><p>在倒引号内的 date +%F 会被视为指令，执行的结果会带入 fdv 变量中</p><p>4、’string’ 单引号 和 “string” 双引号：如果想在定义的变量中加入空格，就必须使用单引号或双引号，单、双引号的区别在于双引号转义特殊字符，而单引号不转义特殊字符。</p><pre><code>eg: heyyou=home    echo &#39;$heyyou&#39;    # We get $heyyoueg: heyyou=home    echo &quot;$heyyou&quot;    # We get home</code></pre><p>5、$#：它的作用是告诉你引用变量的总数量是多少</p><p>6、$$：它的作用是告诉你shell脚本的进程号</p><p>7、$1、$2、$3……${10}、${11}、${12}…… ：表示脚本的各个参数</p><p>8、$@:列出所有的参数，各参数用空格隔开</p><p>9、AND列表 statement1 &amp;&amp; statement2 &amp;&amp; statement3 &amp;&amp; ……:只有在前面所有的命令都执行成功的情况下才执行后一条命令</p><p>10、OR列表 statement1 || statement2 || statement3 || ……:允许执行一系列命令直到有一条命令成功为止，其后所有命令将不再被执行。</p><p>11、［ condition ] &amp;&amp; command for true || command for false:当条件为真时，执行command for true ,当条件为假时，执行command for false</p><p>12、: 冒号：内建指令，但返回值为0</p><pre><code>eg: :    echo $?    #We get 0while:实现一个无限循环</code></pre><p>13、; 分号:在 shell 中，担任”连续指令”功能的符号就是”分号”</p><pre><code>eg:cd ~/backup ; mkdir startup ; cp ~/.* startup/.</code></pre><p>14、~:代表使用者的 home 目录</p><p>15、# 井号：表示符号后面的是注解文字，不会被执行</p><p>16、\ 倒斜线：放在指令前，有取消 aliases 的作用；放在特殊符号前，则该特殊符号的作用消失；放在指令的最末端，表示指令连接下一行</p><p>17、! 惊叹号：通常它代表反逻辑的作用，譬如条件侦测中，用 != 来代表”不等于”</p><p>18、* 星号：在文件名扩展上，她用来代表任何字元</p><p>19、** 次方运算：两个星号在运算时代表 “次方” 的意思</p><pre><code>eg:let &quot;sus=2**3&quot;    echo &quot;sus = $sus&quot;    # sus = 8</code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux shell 程序设计4——shell变量</title>
      <link href="/2014/04/24/Linuxshell%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A14shell%E5%8F%98%E9%87%8F/"/>
      <url>/2014/04/24/Linuxshell%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A14shell%E5%8F%98%E9%87%8F/</url>
      
        <content type="html"><![CDATA[<p>1、shell变量没有类型，所有变量都被当作字符串来处理。</p><p>2、shell变量的命名和c语言相同。</p><p>3、shell变量赋值和c语言略有不同，shell赋值要求等号的两边不能出现空格，而在linux C 中，一般为了增强代码的可读性，等号的两边都加一个空格。如果shell变量的赋值为字符串，而且字符串中含有空格，则必须给该字符串加单引号或双引号。</p><p>4、shell变量不同于c语言，无需定义可直接赋值使用。例如：</p><pre><code>#!/bin/bash#This is an example to show how to use variablesversion=&quot;2.6.24&quot;name=&quot;linux-headers-2.6.24&quot;echo -e &quot;name:$name\nversion:$version&quot;</code></pre><p>执行结果：</p><pre><code>name:linux-headers-2.6.24version:2.6.24</code></pre><p>5、shell变量的作用范围是本shell环境。例如：</p><p>我们编写如下脚本：</p><pre><code>#!/bin/bash#script name: exam.sh#This is a example to show the action range of a variableos_name=linuxecho $os_name</code></pre><p>当我们使用./exam.sh执行脚本结果为：</p><pre><code>linux</code></pre><p>然后我们在命令行中执行:</p><pre><code>echo $os_name 结果为空</code></pre><p>而如果使用 source exam.sh 执行脚本或者是 .空格exam.sh命令执行脚本后键入echo $os_name 命令，我们会得到：</p><pre><code>linux</code></pre><p>6、有一种能继承给子shell的变量，称之为环境变量。让一个变量变身为环境变量的方法为：</p><pre><code>export 变量名</code></pre><p>例如：在终端中我们敲入如下命令：</p><p>执行脚本：</p><pre><code>#!/bin/bashecho $a</code></pre><p>我们什么也不能得到。而如果在终端中使用命令：</p><pre><code>export a=linux</code></pre><p>然后执行上述脚本，我们的到结果：</p><pre><code>linux</code></pre><p>7、shell内置变量：bash设置了许多内置变量，在进行shell程序设计的时候可能需要用到。详见：</p><pre><code>$?：最后一次执行的命令的返回码$$：shell进程自己的PID$!：shell进程最近启动的后台进程PID$#：shell脚本参数个数，不含脚本名$0：脚本文件本身的名字$1、$2...：第一个参数、第二个参数...$*：代表所有的参数（不含脚本名）组成的字符串$@：命令行参数组成的多个字符串，每个参数对应一个</code></pre><p>8、设置shell变量属性：</p><p>readonly：使用readonly命令可以</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux shell 程序设计3——命令行程序</title>
      <link href="/2014/04/24/Linuxshell%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A13%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%A8%8B%E5%BA%8F/"/>
      <url>/2014/04/24/Linuxshell%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A13%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%A8%8B%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<p>1、date：显示、设置系统的日期和时间。</p><pre><code>$date2011年 01月 30日 星期日 14:43:35 CST$date 012309232011执行结果：设置主机的时间日期为：2011/01/23 09：23$date  +&#39;%d %H %M&#39;</code></pre><p>以一定的格式显示时间或日期信息，常见有如下的格式：</p><pre><code>%d   ：显示日$date +&#39;%d&#39;30%D  ：显示日期$date +&#39;%D&#39;01/30/11%e  ：不足二位数的部分不用0补而是用空格补%m ：显示月份%Y  ：显示公元年$date +&#39;%Y&#39;2011%m  ：显示月%M  ：显示分钟%S   ：显示秒%s   ：显示自1970年1月1日 00：00：00开始到现在的秒数$date +&#39;%s&#39;1296371799$date -R ：产生与RFC-2822兼容的时间字符串$date -RSun, 30 Jan 2011 15:20:17 +0800</code></pre><p>2、cat：连接文件并显示</p><pre><code>cat file1显示file1文件的内容cat file1 file2将file1 和 file2并将结果显示cat file1 file2&gt;result.txt将file1和file2连接并将结果重定向到result.txt</code></pre><p>3、wc：计算文件内含的总字数或行数</p><pre><code>wc -l file  ：显示文件file的行数wc -c file ：显示文件file的字符wc -w file ：显示文件file的单词个数</code></pre><p>4、find ：在分层目录中寻找文件。</p><p>find 路径 样式 操作</p><p>例如：</p><pre><code>find /  -name  *.txt -print</code></pre><p>/为路径，-name *.txt是样式 ，-print是操作， 表示将结果打印到标准输出。</p><pre><code>find / -name *.txt -exec rm-f &#123;&#125; \;</code></pre><p>-exec的操作表示找到所有的.txt文件之后 执行 rm -f命令，{}表示找到的所有结果，;是-exec的终止符，由于;是shell的特殊符号，所有要用\将其转义。</p><pre><code>find /etc -cnewer /etc/passwd</code></pre><p>在/etc 目录中寻找比/etc/passwd文件异动时间新的文件</p><pre><code>find /etc -type d -print</code></pre><p>将/etc目录中所有类型为d（也就是目录）的文件打印出来</p><p>其他的类型还有：</p><p>b：块设备文件 c：字符设备文件 d：目录 p：管道 f：一般文件 l：链接文件 s：socket</p><p>5、basename：取得路径名称中最后的文件名部分</p><p>如：</p><pre><code>basename /etc/configure.sh</code></pre><p>执行结果：configure.sh</p><p>6、dirname：取得路径中目录部分</p><p>如：</p><pre><code>dirname /etc/configure.sh</code></pre><p>执行结果：/etc</p><p>7、sort：按ascii码的行首字母对文件的行做排序</p><pre><code>sort file1  ：按ascii码值增大的顺序sort -r file1：按ascii码值减少的顺序sort -n file1：按字符串比较sort -k 2 file1：按字符串比较每行的第二个字段sort -nk 2 file1：按数值比较每行的第二个字段sort -nr +2 -t: /etc/passwd ：+2表示跳过前两个字段，-t: 表示该:为字段分隔符</code></pre><p>8、uniq：删除重复行，若重复行没相邻，则无作用</p><p>uniq -d： 挑出重复行 uniq -c： 计算每一行的重复次数</p><p>如：</p><p>编辑文件q，文件内容如下：</p><pre><code>baaaaaaaaaabaaaaaaaaaabaaaaaaaaaabaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaadddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd</code></pre><p>执行命令uniq -d q结果为：</p><pre><code>baaaaaaaaaaaaaaaaaaaaadddddddddd</code></pre><p>执行命令uniq -c q结果为：</p><pre><code>4 baaaaaaaaaa2 aaaaaaaaaaa6 dddddddddd</code></pre><p>该命令和sort命令一样，都不改变原文件内容，若要保存结果，可通过重定向和管道。</p><p>9、cut ：从文件中抽出某一部分</p><p>如：</p><pre><code>cut -c2 q ：从文件q中抽出每一行的第2个字符cut -c2-10 q：从文件中抽出每一行的第2到第10个字符cut -c2- q：从q中抽出每一行第2个及其以后的字符cut -d: -f3,4 passwd：从文件passwd中抽出每一行的第3个和第4个字段，-d：表明:为分割符</code></pre><p>10、paste：把两个文件按行合并，默认以Tab分割</p><pre><code>paste -d&#39;#&#39; file1 file2：以#分割paste -s file：file的每一行和自己的每一行合并</code></pre><p>11、tr：转换和删除字符。</p><p>如：</p><pre><code>$tr k K &lt; file1</code></pre><p>将file1中所有的k换成K</p><pre><code>$tr -d k &lt;file1</code></pre><p>将file1中所有的k删除</p><pre><code>$tr &#39;[A-Z]&#39; &#39;[a-z]&#39; &lt;file1</code></pre><p>将file1中所有的大写字母换成小写字母</p><pre><code>$cut -d: -f1-6 /etc/passwd |tr ：‘+’</code></pre><p>将passwd文件中前六个字段中的分隔符用+代替</p><p>12、grep：显示符合样式的行</p><pre><code>grep A * ：将含有A这个字符的文件及行打印出来grep -i A * ：-i 表示不区分大小写，A或a都行grep -v A file ：将file中所有不包含A的行打印出来grep -l teacher *：只显示含有teacher的文件的文件名而不显示具体的行grep -n teacher *：显示文件名和行号grep -q teacher filename ：若filename文件中含有teacher关键字则返回0，否则返回非0grep -A 200 -e &#39;wadfadfdf&#39; filename ：表示在filename 中查找wadfadfdf行并显示其后的200行 </code></pre><p>13、 tee：从标准输入读取数据，显示在标准输出上，并将内容写在指定的文件中。</p><pre><code>$tee filename</code></pre><p>若filename已经存在，则清空其内容，否则新建一个文件。按ctrl+D组合键，输入的数据就存储在filename中。</p><pre><code>$tee -a filename 以追加的方式写入文件</code></pre><p>14、diff：比较两个文件之间的差异</p><p>15、comm：以列和列的方式比较两个已排序好的文件</p><p>如：</p><p>file1 文件的内容如下：</p><pre><code>1 2 36 5 49 8 7a b c file2：2 4 56 5 48 0 9 x y z</code></pre><p>执行comm file1 file2后的结果：</p><pre><code>1 2 32 4 56 5 48 0 9   9 8 7a b cx y z</code></pre><p>第1列为file1与file2不同的内容，第2列为file2与file1不同的内容，第3列为file1和file2相同的内容。</p><p>16、xargs：安排标准输入给要执行命令的参数</p><p>如：</p><pre><code>$find . -name *.txt | xargs -n 2 diff</code></pre><p>将找到的.txt文件以两个一组的方式交给diff进行比较</p><p>17、按以下格式可执行多个命令：</p><pre><code>A、命令1；命令2；命令3...     执行一组命令，不能保证每个命令都成功执行B、命令1&amp;&amp;命令2&amp;&amp;命令3...       依次执行命令1、命令2...直到执行失败C、命令1||命令2||命令3...       依次执行命令1、命令2...直到执行成功D、（命令1；命令2；...）  开启一个子shell去执行该组命令 E、&#123;  命令1；命令2；...  &#125; 在现行的shell中执行该组命令，&#123;右和&#125;左有至少一个空格</code></pre><p>18、script:：记录命令执行内容。</p><pre><code>$script com.log$ls $exit</code></pre><p>ls命令的执行结果会被被保存在com.log中</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux shell 程序设计2——bash的内置命令</title>
      <link href="/2014/04/24/Linuxshell%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A12bash%E7%9A%84%E5%86%85%E7%BD%AE%E5%91%BD%E4%BB%A4/"/>
      <url>/2014/04/24/Linuxshell%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A12bash%E7%9A%84%E5%86%85%E7%BD%AE%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<p>常用的内置命令忽略，来看看shell编程中其他一些重要的内置命令：</p><p>1、help：显示所有内置命令列表，或显示一个具体命令的用法。</p><p>-s： 表示列出命令的语法格式</p><p>例子：</p><p>help -s help help: help [-dms] [pattern …]</p><p>2、echo：用来显示一行文字。默认自动换行。</p><pre><code>-n：取消自动换行。-e：让字符串中的特殊字符起作用，即使字符串在单引号中。</code></pre><p>例子： echo hello world 或 echo ‘hello world’ 或 echo “hello world” 输出结果为：hello world $echo -e “hello \n world” hello world $ echo -e ‘hello \n world’ hello world</p><p>3、printf：显示格式字符串，类似于c中的printf函数</p><p>格式：printf “格式字符串” 参数</p><pre><code>-v ：不显示到标准输出，而是赋值给-v选项后面的变量</code></pre><p>例子：</p><pre><code>str= &quot;hello world&quot;printf &quot;%s\n&quot; &quot;$str&quot;     执行结果：hello worldprintf -v str &quot;hello world&quot; echo $str                      执行结果：hello worldprintf &quot;%q&quot; &quot;hello world \n&quot; 执行结果：hello\ world\\n 无换行</code></pre><p>%q这个选项我想了很久才弄明白它的含义：</p><p>将字符串或变量中的转义字符 用 源码格式替换。于是，上面的例子中，空格变成了\空格，\变成了\，而且\n没有了换行的作用</p><p>printf详细用法请参考博客：</p><p><a href="http://bbs.chinaunix.net/thread-845520-1-1.html">http://bbs.chinaunix.net/thread-845520-1-1.html</a></p><p>4、: 什么也不做，返回0</p><p>例子：</p><pre><code>:echo $?                    运行结果：0</code></pre><p>5、. 或 source ：在现行shell中执行shell程序</p><p>例子：</p><p>编辑脚本文件a_var.sh：</p><pre><code>#!/bin/basha=31</code></pre><p>保存退出后回到终端，修改a_var.sh的权限并输入命令：</p><pre><code>./a_var.sh</code></pre><p>执行，然后在终端执行：</p><pre><code>echo $a</code></pre><p>输出结果为一个空行，意味着变量a的值为空，我们再以命令.空格a_var.sh 或source a_var.sh 执行，然后输入：</p><pre><code>echo $a                     其输出结果为：  31</code></pre><p>第一种方式执行a_var.sh，bash会创建一个shell去执行，当子shell执行完成后，它的变量a会被系统收回。</p><p>6、alias：显示或设定程序别名</p><p>例子：</p><pre><code>alias          执行结果：列出所有的别名alias ll=&#39;ls -al&#39;  ll               执行结果：等价于执行了  ls -al</code></pre><p>7、unalias：取消别名</p><pre><code>alias ll</code></pre><p>8、exit ：离开脚本或登录shell，可带返回值</p><p>exit 1</p><p>9、history：显示过去曾经执行过的shell指令，与history命令相关的有三个重要的变量：</p><p>HISTFILE ：记录存放历史命令文件的路径，如：</p><pre><code>echo $HISTFILE                    结果为：/home/kelvin/.bash_history</code></pre><p>HISTFILESIZE：设置历史命令文件命令的最大个数，超过这个个数，序号在前的命令记录就会被删除</p><p>HISTSIZE：设置终端中交互式命令的历史记录个数。它和HISTFILESIZE相比的最小值起作用。</p><p>10、fc：列出登录主机后最近执行过的命令。一般和选项 -l 配合使用。</p><p>例子：</p><pre><code>$fc -l      结果：363     cat /etc/profile364     echo $HISTORY365     echo $HISTORYFILE366     echo $HISTFILE367     ehco $HISTFILESIZE368     echo $HISTFILESIZE369     echo $HISTSIZE370     history 371     history372     echo $HISTFILE373     lw374     ls375     fc -l376     fc -l 368377     fc -l echo l378     fc -lfc -l 375     列出375行以后的命令                输出结果：375     fc -l376     fc -l 368377     fc -l echo l378     fc -lfc -l 375 377 列出375到377之间的命令          输出结果：375     fc -l376     fc -l 368377     fc -l echo lfc -l echo  l    列出从 关键字 echo 到 l之间的内容     输出结果：372     echo $HISTFILE373     lw374     ls</code></pre><p>11、type：对一个命令的类型进行说明(包含命令行程序)。</p><p>例子：</p><pre><code>$type lsls 已被别名为“ls --color=auto”$type cpcp 是 /bin/cp$type fcfc 是一个 shell 内部命令</code></pre><p>12、set：列出所有变量和函数的内容，加入选项可以设置bash的某个属性是否打开</p><p>例子：</p><pre><code>$set -o 查看所有属性，或打开某个属性allexport          offbraceexpand        onemacs              onerrexit            offerrtrace           offfunctrace          offhashall            onhistexpand         onhistory            onignoreeof          offinteractive-comments    onkeyword            offmonitor            onnoclobber          offnoexec             offnoglob             offnolog              offnotify             offnounset            offonecmd             offphysical           offpipefail           offposix              offprivileged         offverbose            offvi                 offxtrace             off$set -o notifyset -o              打开notify属性后显示所有属性状态，输出结果：allexport          offbraceexpand        on    emacs              onerrexit            offerrtrace           offunctrace          offhashall            onhistexpand         onhistory            onignoreeof          offinteractive-comments    onkeyword            offmonitor            onnoclobber          offnoexec             offnoglob             offnolog              offnotify             onnounset            offonecmd             offphysical           offpipef    ail           offposix              offprivileged         off    verbose            offvi                 offxtrace             offset  +o notify set -o         关闭notify属性，并显示所有属性状态：allexport          offbraceexpand        onemacs              onerrexit            offerrtrace           offfunctrace          offhashall            onhistexpand         onhistory            onignoreeof          offinteractive-comments    onkeyword            offmonitor            onnoclobber          offnoexec             offnoglob             offnolog              offnotify             offnounset            offonecmd             offphysical           offpipefail           offposix              offprivileged         offverbose            offvi                 offxtrace             off</code></pre><p>set -C 或 set -o noclobber ：保护已存在文件，不让重定向覆盖文件内容，只能追加。</p><p>例如：</p><pre><code>set -C touch a.cecho adfad &gt;  a.c  提示出错：bash: a.c：无法覆盖已经存在的文件</code></pre><p>但当我们追加内容时不会提示出错：</p><pre><code>echo adfasf &gt;&gt; a.c</code></pre><p>可用set +C 取消</p><p>set -u：用于测试变量是否存在</p><p>例如：</p><pre><code>: $i</code></pre><p>echo $? 这儿的返回值应该为1，因为变量i不存在</p><pre><code>i=1: $i</code></pre><p>echo $? 这儿的输出结果应该是0。同样，可以用set +u取消作用</p><p>set -v：显示当前shell的每一个执行命令，换句话说，就是把执行的命令打印出来</p><p>例如：</p><pre><code>kelvin@kelvin-Founder:~$ set -vkelvin@kelvin-Founder:~$ lslsa.c  Linux material  project_files  record  shell  software  桌面</code></pre><p>可用于对shell脚本的排错，该属性可用set +v取消作用</p><p>13、shopt：很多方面都和set命令一样，但它增加了很多选项。</p><pre><code>-s：开启选项-u：关闭选项-o：set -o-q：以返回值的形式表示开关状态，非0表示关，0表示开</code></pre><p>set和shopt 的细节参见：</p><p><a href="http://blogold.chinaunix.net/u3/94271/showart.php?id=2195391">http://blogold.chinaunix.net/u3/94271/showart.php?id=2195391</a></p><p>14、read：从标准输入读取一行数据</p><p>例子：</p><pre><code>#!/bin/bashecho &quot;please input your name &quot;read your_name                             //如果不输入your_name，读取结果会默认存入变量ERPLYecho &quot;your name is :&quot;  $your_name   </code></pre><p>执行结果：</p><pre><code>please in put your name kelvinyour name is : kelvin</code></pre><p>read -p “提示信息” ；所以上述sh脚本也可写成：</p><pre><code>#!/bin/bashread -p &quot;please input your name&quot; your_nameecho &quot;your name is:&quot; $your_name</code></pre><p>read -a arr：将一行数据存入数组arr</p><p>例如：</p><pre><code>read -a arr &lt;&lt;(echo 1 2 343 23) </code></pre><p>这样，echo ${arr[2]} 的输出结果就是343</p><p>read还可以读值给多个变量：</p><pre><code>IFS=&#39;:&#39;read f1 f2 f3 f4 f5 f6 f7 &lt; /etc/passwd</code></pre><p>因为passwd中7个字段是由:分割开的，所以令IFS=’:’</p><p>15、time：打印设置命令执行的real user sys时间，real 表示命令真正运行时间，cpu使用时间由两部分表示： user表示用户态程序执行时间， sys 表示系统调用时间。</p><p>例如：</p><pre><code>time lstime lsadf.sh  a_var.sh  name.shreal    0m0.004suser    0m0.000ssys    0m0.000s</code></pre><p>16、exec：后接命令或程序，执行命令或程序，并取代原来的shell执行环境；执行重定向生效，例如：</p><p>exec &lt; file 那么凡是由标准输入读入数据的操作都改为由file读入数据</p><p>17、eval：读取变量，并将变量的内容作为命令执行</p><p>例如：</p><pre><code>listlog=&quot;ls -al /var/log/*.log&quot;eval $listlog</code></pre><p>执行结果：ls -al /var/log/*.log将被执行。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux shell 程序设计1——安装及入门</title>
      <link href="/2014/04/24/Linuxshell%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A11%E5%AE%89%E8%A3%85%E5%8F%8A%E5%85%A5%E9%97%A8/"/>
      <url>/2014/04/24/Linuxshell%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A11%E5%AE%89%E8%A3%85%E5%8F%8A%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<p>1、什么是shell？</p><p>shell是linux内核的“壳”，是用户和内核的桥梁。它类似于windows下的命令提示符，将用户输入的命令解释给内核执行，并返回给用户结果。与windows命令提示符不同的是，shell还是一种脚本语言，可以按一定的流程将命令组合在一起使用，方便了用户。</p><p>2、shell的安装：</p><p>在ftp.gnu.org/gnu/bash可下载到bash的源码包：</p><p>bash-4.1.tar.gz</p><p>用 tar xzvf bash-4.1.tar.gz 解压，生成bash-4.1目录</p><p>使用cd 命令进入该目录，在该目录下执行./configure命令生成配置文件，再使用make命令编译，使用make install命令安装。</p><p>在/etc/shells文件中列出的shell才是合法的shell，所以要使用安装的shell必须把它加到该文件中。加入之后就可以通过chsh命令来切换shell。</p><p>3、shell中的特殊符号：</p><p><a href="http://blogold.chinaunix.net/u2/75431/showart_1110962.html">http://blogold.chinaunix.net/u2/75431/showart_1110962.html</a></p><p>4、shell的程序结构：</p><p>以#!开头，指名要解释、执行该脚本的shell，如：</p><pre><code>#! /bin/bash</code></pre><p>其余以#开头的行为注释。除此之外，一个shell脚本还包括变量设定、内置命令、函数、以及流程控制语句。</p><p>下面是一个简单的shell脚本：</p><pre><code>      1 #/bin/bash      2 #This is a test shell script      3 #It&#39;s function is show how to use the function of a shell script             4 /*定义了一个函数，其中$1,$2,$3是传递给该函数的参数*/      5 function show()&#123;      6     echo &quot;Today is $1.Your name is $2,and your ip address is $3.&quot;             7 &#125;            8 /*定义了三个变量*/      9 name=&quot;$1&quot;     10 date=`date +%F`     11 ip=&quot;222.24.19.12&quot;          12 /*$#为执行shell脚本时传递给该脚本的参数的个数，脚本名不计*/      13 if [ $# != 1 ]; then     14     echo &quot;input error!&quot;     15     exit     16 fi         17 /*调用上面定义的函数*/     18 show &quot;$date&quot; &quot;$name&quot; &quot;$ip&quot;     19      20 sleep 5     21 echo     //输出一个空行     22 echo &quot;exited!&quot;</code></pre><p>5、shell脚本排错：</p><p>在执行shell脚本之前，需要修改该脚本的权限：</p><pre><code>chmod 755  脚本名</code></pre><p>可以用两种方式执行该脚本：</p><ul><li>./脚本名 参数 或 bash 脚本名 参数 以这种方式执行一个shell脚本，bash会创建一个子shell来执行，所用的环境是子shell的执行环境，当执行结束后又会回到父shell的执行环境。</li><li>. /脚本名 参数 或 source 脚本名 参数 以这种方式执行的shell脚本，bash不会创建子shell，而是在自己的环境中执行，执行完成后，若脚本中有修改环境的地方，则bash的环境就会改变。</li></ul><p>shell脚本由于是脚本程序，无需编译，所以排错只能依靠阅读源码排错或者是使用 bash -x 脚本名 参数 的执行方式追踪脚本的执行过程</p><p>6、shell脚本执行原理：</p><p>用户在登录之后，就会进入一个shell环境，称之为父shell，其他脚本执行时称之为子shell。每个用户都有一个默认的登录shell，保存在/etc/passwd文件中。用户可执行chsh修改默认的登录shell。子shell会继承父shell的环境变量。子shell也可以使用 bash命令再创建一个子shell，使用exit 退出一个shell。使用echo $SHLVL可以查看位于第几层shell中。</p><p>7、bash的启动配置文件：</p><p>用户登录时，login shell 会读取/etc/profile并执行，接着检查用户家目录中是否有.bash_profile，有则执行，然后检查是否有.bash_login ，有则执行，最后检查.profile，有则执行。注销的时候，bash会检查用户家目录中是否有.bash_logout，有则执行。 在执行一个新的shell时，若执行的是交互式shell，或者叫做命令，bash会检查并执行/etc/bash.bashrc以及家目录中的.bashrc。若执行的脚本，则检查BASH_ENV变量，并执行该变量所指向的文件。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shell常用命令小结</title>
      <link href="/2014/04/24/Shell%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%B0%8F%E7%BB%93/"/>
      <url>/2014/04/24/Shell%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%B0%8F%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>１、ls:这是linux里最常用的命令，像数学里的１一样，简单但很重要。类似于dos里的dir命令，该命令的功能是列出目录下的文件或子目录。</p><pre><code>-a:显示所有文件和目录，包括以.开头的隐藏文件-l:以长格式的形式显示</code></pre><p>例如：</p><pre><code>kelvin@kelvin-laptop:~$ lsexamples.desktop  公共的  模板  视频  图片  文档  下载  音乐  桌面kelvin@kelvin-laptop:~$ ls -a.                 .gconfd          .pulse-cookie..                .gksu.lock       .recently-used.xbel.bash_history     .gnash           .sudo_as_admin_successful.bash_logout      .gnome2          .themes.bashrc           .gnome2_private  .thumbnails.bogofilter       .gstreamer-0.10  .update-notifier.cache            .gtk-bookmarks   .xsession-errors.compiz           .gvfs            .xsession-errors.old.config           .ICEauthority    公共的.dbus             .icons           模板.dmrc             .local           视频.esd_auth         .mozilla         图片.evolution        .nautilus        文档examples.desktop  .openoffice.org  下载.fontconfig       .profile         音乐.gconf            .pulse           桌面kelvin@kelvin-laptop:~$ ls -l总用量 36-rw-r--r-- 1 kelvin kelvin  179 2010-09-14 09:39 examples.desktopdrwxr-xr-x 2 kelvin kelvin 4096 2010-09-14 09:49 公共的drwxr-xr-x 2 kelvin kelvin 4096 2010-09-14 09:49 模板drwxr-xr-x 2 kelvin kelvin 4096 2010-09-14 09:49 视频drwxr-xr-x 2 kelvin kelvin 4096 2010-09-14 09:49 图片drwxr-xr-x 2 kelvin kelvin 4096 2010-09-14 15:09 文档drwxr-xr-x 2 kelvin kelvin 4096 2010-09-14 14:57 下载drwxr-xr-x 2 kelvin kelvin 4096 2010-09-14 09:49 音乐drwxr-xr-x 2 kelvin kelvin 4096 2010-09-14 09:49 桌面</code></pre><p>2、cd:选择当前工作目录。例如：</p><p>cd .. :回到上级目录。 cd 或 cd ~:返回家目录。 cd -:返回操作前目录</p><p>cd !$ :把上个命令的参数作为输入。</p><p>3、touch：创建一个或多个空文件。</p><p>4、pwd:显示当前工作目录。</p><p>5、cp:复制文件或目录</p><p>格式：cp 源 目的</p><pre><code>-r:复制目录-f:如遇同名文件或目录，强制覆盖目的文件或目录-p:保留文件或目录创建日期。</code></pre><p>6、rm:删除文件或目录</p><pre><code>-r:如果是删除目录，需要加该选项。-f:强制删除</code></pre><p>7、mv:移动文件或目录，一般用于重命名。</p><p>8、cat:显示全部的文件内容。</p><p>9、more:也是显示文件内容，一次只显示一屏幕，按空格显示下一页，按回车显示下一行，按q键退出。</p><p>10、less:显示文件内容，和more类似，区别在于less命令显示的文件可用方向键或pgup或pgdown控制。</p><p>11、head:显示文件头几行。如：head -3:显示头三行，默认为10行。</p><p>12、tail：显示文件后几行，与head类似。</p><p>13、ln:创建文件或目录的链接。源与目的都要使用绝对路径，且硬链接不能跨越磁盘分区。-s:创建软链接</p><p>14、mkdir:创建空目录。-p:可创建子目录。rmdir:删除空目录。-p:强制删除非空目录。</p><p>15、whereis:查看命令以及手册的位置。如：</p><pre><code>kelvin@kelvin-laptop:~$ whereis lsls: /bin/ls /usr/share/man/man1/ls.1.gz</code></pre><p>16、whatis:查看命令功能。</p><p>17、man：查看命令手册</p><p>18、find:查找文件或目录。例如：find /etc -name f*</p><p>19、locate:查找文件或目录。无需路径。需要注意的是，对于新创建的文件或目录，用updatedb更新数据库后才能用locate命令找到。</p><p>20、grep:查找文件中的内容。格式：grep 关键字 文件名</p><p>21、gzip:压缩文件。</p><p>-1:快速压缩 -9：最佳压缩</p><p>22、gunzip:解压文件。=gzip -d</p><p>23、tar:打包文件。</p><pre><code>  -c:创建一个包。-v:显示详细过程。 -f：指定包名  -x:解包</code></pre><p>可用该命令压缩打包，或解压缩解包：</p><pre><code>tar -zcvf file.tar.gz filename1 filename2 ……   tar -zxvf file.tar.gz</code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>插入法排序</title>
      <link href="/2014/04/24/%E6%8F%92%E5%85%A5%E6%B3%95%E6%8E%92%E5%BA%8F/"/>
      <url>/2014/04/24/%E6%8F%92%E5%85%A5%E6%B3%95%E6%8E%92%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<p>何谓算法？算法就是计算机解决问题的方法和步骤。之所以强调计算机三个字，是因为计算机处理问题的方式和我们人类解决问题的方式有所不同。比如，在电视剧《宫》里看到一个智力题：把一头大象放进骄子里需要哪几个步骤？答案是：第一步，掀开轿帘；第二步，把大象放进去；第三步，放下轿帘。当然，可行性我们暂时不去考虑。然而，对于计算机来说，它没法去掀开轿帘，或者把大象放进轿子里。它只能通过计算机系统特有的指令去处理数据，以此来解决问题。</p><p>知道了什么是算法，那么如何去描述问题和算法呢？</p><p>以排序问题为例，描述一个问题可以用以下的方式：</p><p>输入：n个整数，存放于一个数组a之中。</p><p>输出：这n个数在数组a之中按从小到大的顺序存放。</p><p>给出了一个问题的输入和要求的输出，这个问题就确定了。描述一种算法，可以用伪代码或者是计算机语言。</p><p>对于排序问题，有多种算法。下面谈谈Insertion sort——插入法排序:</p><p>插入法排序的大概思想和摸扑克牌类似：当然，我们要求只有一个人摸牌，初始的数组就是放在桌上的一堆牌，而拿到手上的牌是排好序的。当我们摸起一张牌时，会按大小插入到已排好序的手牌之中。下面是基于linux系统，用C语言对改算法的实现：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX 10</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sort</span><span class="params">(<span class="keyword">int</span>*)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> input_array[MAX];</span><br><span class="line">    <span class="keyword">int</span> ret,i;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please input the numbers :\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; MAX; i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;input_array[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;The numbers before being sorted :\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; MAX; i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, input_array[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    ret = sort(input_array);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;The sorted numbers :\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; MAX; i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, input_array[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sort</span><span class="params">(<span class="keyword">int</span>* p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i,j,temp;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">1</span>; i &lt; MAX; i++)&#123;</span><br><span class="line">        temp = p[i];</span><br><span class="line">        <span class="keyword">for</span>(j = i<span class="number">-1</span>; j &gt;= <span class="number">0</span> &amp;&amp; p[j] &gt; temp; j--)&#123;</span><br><span class="line">            p[j+<span class="number">1</span>] = p[j];</span><br><span class="line">        &#125;</span><br><span class="line">        p[j+<span class="number">1</span>] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kobject浅析</title>
      <link href="/2014/04/24/Kobject%E6%B5%85%E6%9E%90/"/>
      <url>/2014/04/24/Kobject%E6%B5%85%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>面向对象的思想的确在应用软件的开发中颇具优势，它让一个个纯逻辑的函数和数据变成了一个个有生命的个体。鉴于性能的考虑，系统软件的实现（例如linux kernel）并没有采用面向对象的语言（如C++、Java）。但这丝毫没有影响到用小c找对象。</p><p>简单来说，一个对象包含数据以及对这些数据的操作。如果把银行比作一个对象的话，银行里的RMB就是数据、而银行的工作人员就相当于对象中方法（即操作数据的结构）。如果，我们想打劫银行的话，我们只需要拿着枪指着工作人员说，“亲，给我拿500万出来”。当然，如果你是一个比较牛逼的劫匪你可能要1000万，或者更多。这没有关系，因为无论你要多少钱，你都不必亲自动手去取，工作人员会帮你办好这一切。当你拎着一袋子钱溜走的时候，你可能会想说，“自从有了面向对象，腰不酸了、腿不疼了，打劫也更有效率了”。</p><p>这个例子只是想说明面向对象的一个显而易见的优点——给劫匪，哦不，给用户提供了可直接使用的接口。当然，面向对象的优点可不只这一点。</p><p>kobject是Linux设备驱动模型的核心部分，它的作用是简单点说就是嵌入到设备和驱动相关的结构体之中。既可以将这些设备和驱动组织成树形结构，又可以让用户通过sysfs直接控制驱动和设备。让我们来搭讪一下kobject，从她那儿看看有对象的好处。</p><p>我们哲学老师在提问一个学生之前都会先问学生的家乡在哪儿。据他的逻辑应该是一方水土养一方人，从一个人的家乡可以大致推断出他的性格等。 不管这个理论对不对，我们先看看kobject的家乡——include/linux/kobject.h，kobject在这里定义：</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">struct</span> kobject &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">char</span> *name;</span><br><span class="line">        <span class="keyword">struct</span> list_head entry;</span><br><span class="line">        <span class="keyword">struct</span> kobject *parent;</span><br><span class="line">        <span class="keyword">struct</span> kset *kset;</span><br><span class="line">        <span class="keyword">struct</span> kobj_type *ktype;</span><br><span class="line">        <span class="keyword">struct</span> sysfs_dirent *sd;</span><br><span class="line">        <span class="keyword">struct</span> kref kref;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> state_initialized:<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> state_in_sysfs:<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> state_add_uevent_sent:<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> state_remove_uevent_sent:<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> uevent_suppress:<span class="number">1</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">每一个kobject实例都有一个名字name，用于标识这个实例。还有一个母亲parent，用于建立kobject的家族树。还有一个比较熟悉的面孔<span class="keyword">struct</span> list_head entry，不用说，它的作用是把我们的kobject组织成双向链表。sd这个成员的作用和sysfs相关，kobject是组成sysfs树形结构的结点。kref是该结构体的引用计数，实质是一个原子型的整形量。下面几个<span class="keyword">unsigned</span> <span class="keyword">int</span>型的表示kobject的状态，kobject过得好还是不好，是不是党员，都在这里记录着。每一个kobject的结构体都有一个ktype，用来决定kobject被创建或销毁时应该如何处理：</span><br></pre></td></tr></table></figure><pre><code>struct kobj_type &#123;    void (*release)(struct kobject *kobj);    const struct sysfs_ops *sysfs_ops;    struct attribute **default_attrs;    const struct kobj_ns_type_operations *(*child_ns_type)(struct kobject *kobj);    const void *(*namespace)(struct kobject *kobj);&#125;;</code></pre><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">release是个回调函数，当kobject的引用计数为<span class="number">0</span>时会被调用。当然，这个函数是需要我们自己完成的。其作用通常是释放kobject守护的结构体。每一类kobject都有自己的默认的属性，它放在结构体数组<span class="keyword">default</span>\<span class="variable">_attrs</span>中。每一个属性都应该在sysfs中对应一个文件。而sysfs\<span class="variable">_ops</span>则存放着读写这些文件时的处理。</span><br><span class="line"></span><br><span class="line">每一个kobject都可以属于某一个kset，一个kset就是一群kobject的集合。当然，物以类聚，人以群分，这些kobject要走到一起，当然是要有些共同特点的：</span><br></pre></td></tr></table></figure><pre><code>struct kset &#123;    struct list_head list;    spinlock_t list_lock;    struct kobject kobj;    const struct kset_uevent_ops *uevent_ops;&#125;;</code></pre><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">kset是kobject的容器，也就是说，它把kobject又封装了一下。没一个kset结构体里面存放一个kobject，kset通过<span class="built_in">list</span>连接起来，从而属于这一集合的所有kobj也连接起来了。uevent_ops这个结构体存放了对这一组<span class="keyword">object</span>的操作。具体什么操作，咱下回分解。</span><br><span class="line"></span><br><span class="line">kobject就好比每个人的守护天使，她通常不单独存在，而是作为其他结构体的成员出现，类似于<span class="keyword">struct</span> list_head。在一个结构体中，找到嵌入于其中的kobject是很easy的事，就像领导找下属，随叫随到的那种。但是kobject要找到嵌入它的结构体的指针却没那么容易了。幸好，kernel给我们提供了一个可以做这件事的宏：</span><br><span class="line"></span><br><span class="line">    contarner<span class="constructor">_of(<span class="params">pointer</span>, <span class="params">type</span>, <span class="params">member</span>)</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">这个宏具体怎么用咱就不说了。google上百度一下，或者看下源码很容易就明白的。</span><br><span class="line"></span><br><span class="line">有了这个宏，kobject守护的对象（设备和驱动）和kobject之间的联系就完全的建立起来了，kobject它妈叫它回家吃饭的时候就可以先找到设备和驱动，kobject要去打酱油的时候也可以叫上设备和驱动。</span><br><span class="line"></span><br><span class="line">有了这个联系，系统里所有的设备和驱动就可以通过kobject给管理起来了。kobject和sysfs勾搭在一起就给用户层提供了修改设备和驱动参数的一种方式。</span><br><span class="line"></span><br><span class="line">以下代码展示了如何利用kobject使用sysfs。</span><br></pre></td></tr></table></figure><pre><code>/** * This is a simple module for kobject test.And it is licensed under the terms * of GNU/GPL v3 or later. * Wang Sen (C) &lt;wangsen@linux.vnet.ibm.com&gt; * 2012.3.23 */#include &lt;linux/module.h&gt;#include &lt;linux/init.h&gt;#include &lt;linux/kobject.h&gt;#include &lt;linux/sysfs.h&gt;#include &lt;linux/list.h&gt;#include &lt;linux/stat.h&gt;#include &lt;linux/string.h&gt;#define BUF_SIZE 128MODULE_LICENSE(&quot;GPL&quot;);static char asset[BUF_SIZE] = &quot;Hello Kitty&quot;;static void test_release(struct kobject *kobj);static ssize_t test_show(struct kobject *, struct attribute *, char *);static ssize_t test_store(struct kobject *, struct attribute *, const char *, size_t);static void test_release(struct kobject *kobj)&#123;    if (kobj == NULL) &#123;        return;    &#125;        printk(&quot;------[kobject_test]Hello,test_release is dancing\n&quot;);&#125;static ssize_t test_show(struct kobject *kobj, struct attribute *attr, char *buf) &#123;    sprintf(buf, &quot;asset:%s\nkobject_name:%s\n&quot;, asset,kobj-&gt;name);    return strlen(buf);&#125;static ssize_t test_store(struct kobject *kobj, struct attribute *attr, const char *buf, size_t size) &#123;    if (strlen(buf) &gt; BUF_SIZE) &#123;        return E2BIG;    &#125;    memset(asset, 0, BUF_SIZE);    sprintf(asset, &quot;%s&quot;, buf);    return strlen(buf);&#125;struct attribute test_attr = &#123;    .name = &quot;info&quot;,    .mode = S_IRWXUGO,&#125;; struct attribute test_attr_1 = &#123;    .name = &quot;addr&quot;,    .mode = S_IRWXUGO,&#125;; struct attribute *attr_array[] = &#123;    &amp;test_attr,    &amp;test_attr_1,    NULL&#125;;struct sysfs_ops test_sysfs_ops = &#123;    .show = test_show,    .store = test_store,&#125;;struct kobject test_kobject;struct kobj_type test_kobj_type= &#123;    .release = test_release,    .sysfs_ops = &amp;test_sysfs_ops,    .default_attrs = attr_array,&#125;;static int __init kobj_test_init(void)&#123;    printk(&quot;------kobject init...&quot;);    kobject_init_and_add(&amp;test_kobject, &amp;test_kobj_type, NULL, &quot;test_object_of_kelvin&quot;);    return 0;&#125;static void __exit kobj_test_exit(void)&#123;    kobject_put(&amp;test_kobject);    printk(&quot;------See you&quot;);&#125;module_init(kobj_test_init);module_exit(kobj_test_exit);MODULE_AUTHOR(&quot;Wang Sen &lt;senwang@linux.vnet.ibm.com&gt;&quot;);</code></pre><p>```</p><p>参考文献：</p><ul><li>《LINUX设备驱动程序》 第三版 Jonathan Corbet,Alessandro Rubini,Greg Kroah-hartman </li><li><a href="http://linux.chinaunix.net/techdoc/system/2008/07/19/1018480.shtml">http://linux.chinaunix.net/techdoc/system/2008/07/19/1018480.shtml</a> </li><li><a href="http://blog.21ic.com/user1/5593/archives/2010/69112.html">http://blog.21ic.com/user1/5593/archives/2010/69112.html</a> </li><li><a href="http://blog.csdn.net/yili_xie/article/details/5835935">http://blog.csdn.net/yili_xie/article/details/5835935</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kobject </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>为虚拟机vCPU绑定物理CPU</title>
      <link href="/2014/03/24/%E4%B8%BA%E8%99%9A%E6%8B%9F%E6%9C%BAvCPU%E7%BB%91%E5%AE%9A%E7%89%A9%E7%90%86CPU/"/>
      <url>/2014/03/24/%E4%B8%BA%E8%99%9A%E6%8B%9F%E6%9C%BAvCPU%E7%BB%91%E5%AE%9A%E7%89%A9%E7%90%86CPU/</url>
      
        <content type="html"><![CDATA[<p>为了提高缓存命中率，提高虚拟机性能，可以将vCPU绑定到指定的物理CPU去执行。具体设置步骤如下：</p><p>在宿主机操作系统启动时将用于虚拟机的CPU独立出来，使其上只运行vCPU线程，QEMU进程和少数的管理进程。设置方法即是在内核启动参数中加入： isolcpus=0,1 例如在grub.cfg下面的配置如下：</p><pre><code>menuentry &#39;Fedora (3.13.6-200.fc20.x86_64) 20 (Heisenbug)&#39; --class fedora --class gnu-linux --class gnu --class os $menuentry_id_option &#39;gnulinux-3.13.4-200.fc20.x86_64-advanced-5bcef32f-430b-4d74-beaa-4fcfccc438f9&#39; &#123;        ......    linux    /vmlinuz-3.13.6-200.fc20.x86_64 root=UUID=5bcef32f-430b-4d74-beaa-4fcfccc438f9 ro vconsole.font=latarcyrheb-sun16  rhgb quiet LANG=zh_CN.UTF-8 isolcpus=0,1    initrd /initramfs-3.13.6-200.fc20.x86_64.img&#125;</code></pre><p>使用taskset命令将vCPU线程绑定到指定的物理CPU。例如，某虚拟机的qemu进程及两个vCPU线程如下：</p><pre><code>​[root@kelvin ~]# ps -eLo ruser,pid,ppid,lwp,psr,args | grep qemu | grep -v greproot      4706  3629  4706   1 qemu-system-x86_64 -m 2G -smp 2 /var/lib/libvirt/images/fedora.img -enable-kvmroot      4706  3629  4708   1 qemu-system-x86_64 -m 2G -smp 2 /var/lib/libvirt/images/fedora.img -enable-kvmroot      4706  3629  4709   0 qemu-system-x86_64 -m 2G -smp 2 /var/lib/libvirt/images/fedora.img -enable-kvm</code></pre><p>若要将线程ID为4709的vCPU从CPU0绑定到CPU2上执行，可使用如下命令： #taskset -p 0x4 4709 -p后面接的是物理CPU的掩码，其二进制表示从最低位到最高位分别表示第0个物理CPU到最后一个物理CPU，若二进制表示为1，则表示某线程可以在该物理CPU上运行，若为0，则不能。上面的命令的含义就是，线程ID为4709的线程(vCPU)只能在第2个(从0开始编号)物理CPU上运行。执行上述命令的结果如下：</p><pre><code>[root@kelvin ~]# taskset -p 0x4 4709pid 4709&#39;s current affinity mask: fpid 4709&#39;s new affinity mask: 4[root@kelvin ~]# ps -eLo ruser,pid,ppid,lwp,psr,args | grep qemu | grep -v greproot      4706  3629  4706   3 qemu-system-x86_64 -m 2G -smp 2 /var/lib/libvirt/images/fedora.img -enable-kvmroot      4706  3629  4708   0 qemu-system-x86_64 -m 2G -smp 2 /var/lib/libvirt/images/fedora.img -enable-kvmroot      4706  3629  4709   2 qemu-system-x86_64 -m 2G -smp 2 /var/lib/libvirt/images/fedora.img -enable-kvm</code></pre><p>线程ID为4709的vCPU已经在编号为2的物理CPU上运行了。</p>]]></content>
      
      
      <categories>
          
          <category> 云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kvm </tag>
            
            <tag> qemu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bash配置文件的执行顺序</title>
      <link href="/2014/03/19/bash%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/"/>
      <url>/2014/03/19/bash%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<p>Linux用户在登陆系统之后会启动shell，并按照一定顺序读取shell的配置文件。以bash为例，配置文件的读取顺序如下：</p><ol><li>/etc/profile</li><li>如果是图形界面登陆系统，读取~/.profile，bash配置完毕。</li><li>如果是命令行或者ssh登陆系统，读取~/.bash_profile，bash配置完毕。</li><li>如果是命令行或者ssh登陆系统，且<del>/.bash_profile不存在，读取</del>/.bash_login，bash配置完毕。</li><li>如果是命令行或者ssh登陆系统，且<del>/.bash_profile,</del>/.bash_login不存在，读取~/.profile，bash配置完毕。</li></ol><p>图形界面启动后，用户可能会再启动一个shell，该shell的配置文件是~/.bashrc，用户自定义的配置一般会放到这里。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用mock来编译和管理RPM软件包</title>
      <link href="/2014/02/13/%E4%BD%BF%E7%94%A8mock%E6%9D%A5%E7%BC%96%E8%AF%91%E5%92%8C%E7%AE%A1%E7%90%86RPM%E8%BD%AF%E4%BB%B6%E5%8C%85/"/>
      <url>/2014/02/13/%E4%BD%BF%E7%94%A8mock%E6%9D%A5%E7%BC%96%E8%AF%91%E5%92%8C%E7%AE%A1%E7%90%86RPM%E8%BD%AF%E4%BB%B6%E5%8C%85/</url>
      
        <content type="html"><![CDATA[<p><strong>buildroot</strong></p><p>在打包时用到的spec文件中包含一些tag，这些对大小写不敏感的tag用冒号来定义。BuildRoot就是其中的一个tag。例如，在libvirt的spec文件中BuildRoot的定义如下：</p><p><code>BuildRoot: %&#123;_tmppath&#125;/%&#123;name&#125;-%&#123;version&#125;-%&#123;release&#125;-root</code></p><p>BuildRoot设置的目录会被当作临时的根目录，%install部分安装的文件都会被临时安装到这里。之所以引入BuildRoot是为了在打包过程中不影响现在的系统。 RPM宏设定的BuildRoot默认值是~/rpmbuild/BUILDROOT, 可以在spec文件中设置该tag，或者在rpmbuild命令执行时使用- -buildroot选项来指定。</p><p><strong>mock的功能</strong></p><p>mock不只是将文件安装到Buildroot指定的根目录，而是创建一个打包的沙盒(sandbox)，挂载一些必要的文件系统(proc，sys等)，将打包过程所用到的软件包(BuildRequires指定)都安装到沙盒中，然后将指定的SRPM包进行编译，生成最终的RPM包。mock不仅可以使打包过程变得整洁，更能够测试BuildRequires是否完整。除了打包之外，mock也可以用来制作沙盒来测试软件包。</p><p><strong>安装mock</strong></p><p>使用YUM安装fedora维护者工具fedora-packager后，mock和koji作为依赖也被安装到系统中了。执行以下命令即可：</p><p><code>sudo yum install fedora-packager</code></p><p><strong>简单的配置mock</strong></p><p>在使用mock之前需要将当前用户加入到mock用户组，并使用户登陆到该用户组：</p><p><code>sudo usermod -a -G mock [User name] &amp;&amp; newgrp mock</code></p><p><strong>使用mock来打包</strong></p><p>使用mock打包需要配置文件来指定安装软件包所用到的YUM仓库，/etc/mock目录下有许多这样的配置文件。配置文件可以通过-r选项来指定，如果没有指定，则使用默认的配置文件/etc/mock/default.cfg。</p><p><code>mock libvirt-1.2.2-1.fc20.src.rpm</code></p><p>将会在BUILDROOT目录下挂载一些必要的文件必要的文件系统，并安装打包过程需要用到的软件包，最终生成RPM包。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RPM软件包管理机制之旅</title>
      <link href="/2013/11/04/RPM%E8%BD%AF%E4%BB%B6%E5%8C%85%E7%AE%A1%E7%90%86%E6%9C%BA%E5%88%B6%E4%B9%8B%E6%97%85/"/>
      <url>/2013/11/04/RPM%E8%BD%AF%E4%BB%B6%E5%8C%85%E7%AE%A1%E7%90%86%E6%9C%BA%E5%88%B6%E4%B9%8B%E6%97%85/</url>
      
        <content type="html"><![CDATA[<p>Linux下的man命令十分实用，可以查看Linux命令的手册。但这些手册只适用于忘记命令的选项时查询之用，如果用来学习Linux下类似于Git, RPM这样庞大的工具就有点吃力了，可谓事倍功半。我在学习Git的时候读过一篇文档——gittutorial，使用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$man</span> gittutorial</span><br></pre></td></tr></table></figure><p>命令可以调出该文档。这篇文档并不涵盖git的方方面面，只是介绍了Git管理项目的常规用法，非常适合初学者快速入门。所以本文试图仿照该文档的写法，并不会详细地介绍RPM包的方方面面，而是介绍RPM包最常用的一些功能，这些功能将会在我们对红帽系列发行版系统的日常管理中非常重要。</p><h3 id="软件包管理机制与RPM"><a href="#软件包管理机制与RPM" class="headerlink" title="软件包管理机制与RPM"></a>软件包管理机制与RPM</h3><p>开源软件可以用Tarball的方式来从源代码安装软件(1)，这样的安装方式对普通用户来说很麻烦。比如要升级软件，还需要先更新源代码，再重新编译、安装。Linux采用了RPM和DPKG等软件包管理机制来管理软件，直接给用户提供二进制软件包，并且将整个系统的软件包信息建立成数据库，以便于软件的升级、验证和卸载。RedHat、Fedora、SUSE、CentOS等发行版采用RPM包管理机制，而Debian、Ubuntu等发行版采用DPKG方式来管理软件包。</p><p>所谓RPM软件包或者平时叫的RPM包指的是包含软件运行所需的二进制文件、文档、函数库等内容的RPM格式的文件，以rpm作为文件的后缀名。如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qemu-img-1.4.2-3.fc19.i686.rpm</span><br></pre></td></tr></table></figure><p>qemu-img是包的名字；1.4.2是软件版本号；3是release号，指的是同一版本第3次构建的软件包(或称为打包)；fc19指的是Linux发行版为Fedora 19；i686是软件运行的平台架构，可以是i386、i686、x86_64、ppc64、s390x、noarch(与平台无关的软件包)等，RPM要求打包的环境要与安装软件包的环境(平台架构、发行版、发行版的版本等)一致或相当。</p><h3 id="RPM软件包的增删改查及验证"><a href="#RPM软件包的增删改查及验证" class="headerlink" title="RPM软件包的增删改查及验证"></a>RPM软件包的增删改查及验证</h3><h4 id="安装RPM软件包到系统"><a href="#安装RPM软件包到系统" class="headerlink" title="安装RPM软件包到系统"></a>安装RPM软件包到系统</h4><p>现在的系统很少用到直接使用RPM包来安装软件，而是采用YUM(后面介绍)来安装。使用RPM包来安装软件首先需要获得适合当前系统的RPM包，各个发行版通常会提供这些包的下载，如可以在i686平台、fedora19上安装的软件包可以在这里找到：</p><p><a href="http://mirrors.ustc.edu.cn/fedora/linux/releases/19/Fedora/i386/os/Packages/">http://mirrors.ustc.edu.cn/fedora/linux/releases/19/Fedora/i386/os/Packages/</a></p><p>安装软件包可以使用rpm命令，加上-i选项即可。例如，安装qemu-img软件包可以采用如下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh qemu-img-1.4.2-3.fc19.i686.rpm</span><br></pre></td></tr></table></figure><p>-i选项表示rpm命令将安装qemu-img软件包；-v选项可以显示更详细的安装信息；-h显示安装进度。采用rpm -i命令来安装软件包并不会去解决软件包之间的依赖问题。如果说软件包B依赖于软件包A，那么在安装B之前A必须已经在系统中安装。rpm -i如果遇到依赖关系的问题，只会提示需要依赖哪些包，而不会去自动地将这些包都安装上。qemu-img依赖于glib库，如果我们将系统上的glib包删掉，再执行rpm -i来安装qemu-img就会产生如下的提示信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root[@localhost](https://my.oschina.net/u/570656) 下载]<span class="comment"># rpm -e glib2-2.36.3-3.fc19.i686 --nodeps </span></span><br><span class="line">[root[@localhost](https://my.oschina.net/u/570656) 下载]<span class="comment"># rpm -q glib2-2.36.3-3.fc19.i686</span></span><br><span class="line">未安装软件包 glib2-2.36.3-3.fc19.i686 </span><br><span class="line">[root[@localhost](https://my.oschina.net/u/570656) 下载]<span class="comment"># rpm -ivh qemu-img-1.4.2-3.fc19.i686.rpm </span></span><br><span class="line">错误：依赖检测失败：</span><br><span class="line">libglib-2.0.so.0 被 qemu-img-2:1.4.2-3.fc19.i686 需要</span><br><span class="line">libgthread-2.0.so.0 被 qemu-img-2:1.4.2-3.fc19.i686 需要</span><br></pre></td></tr></table></figure><p>如果要安装qemu-img岂不是要手动地将所有依赖的包安装上去才行？而且，qemu-img所依赖的包可能又会依赖另外的包。如此一来，安装RPM包岂不是非常复杂？聪明的Linux hacker们当然不会让Linux的世界乱套。YUM就是为了解决软件包之间的依赖性而生，我们稍后会对YUM做进一步介绍，现在先抛开包的依赖性不说，看看如何在红帽系列发行版上来删除RPM软件包。</p><h4 id="删除RPM软件包"><a href="#删除RPM软件包" class="headerlink" title="删除RPM软件包"></a>删除RPM软件包</h4><p>删除RPM软件包的命令和安装命令同样简单，只需要在rpm命令之上使用-e选项即可，同样值得一提的是删除软件包也需要注意软件包之间的依赖性，比如说，如果软件包A依赖于软件包B，那么应该先卸载软件包A，再卸载B，否则会导致软件A不可用。再用qemu-img的软件包为例，qemu-img会被libvirt-deamon所依赖，所以在删除qemu-img的时候会提示错误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root[@localhost](https://my.oschina.net/u/570656) 下载]<span class="comment"># rpm -e qemu-img </span></span><br><span class="line">错误：依赖检测失败：</span><br><span class="line">/usr/bin/qemu-img 被 (已安裝) libvirt-daemon-1.0.5.6-3.fc19.i686 需要</span><br></pre></td></tr></table></figure><h4 id="升级RPM软件包"><a href="#升级RPM软件包" class="headerlink" title="升级RPM软件包"></a>升级RPM软件包</h4><p>如果系统上已经安装了glib2-2.36.3-2.fc19.i686这个包，现在发现在fedora的官网上提供了更新包glib2-2.36.3-3.fc19.i686，那该如何升级呢？使用rpm -Uvh或者rpm -Fvh即可。-U和-F的区别在于，-U允许系统未安装将要升级的包，在升级的时候执行安装动作，而-F则不能升级未安装的包。我们使用下面的命令可以将glib2升级：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root[@localhost](https://my.oschina.net/u/570656) 下载]<span class="comment"># rpm -q glib2-2.36.3-2.fc19.i686</span></span><br><span class="line">glib2-2.36.3-2.fc19.i686</span><br><span class="line">[root@localhost 下载]<span class="comment"># rpm -Uvh http://mirrors.ustc.edu.cn/fedora/linux/updates/19/i386/glib2-2.36.3-3.fc19.i686.rpm</span></span><br><span class="line">[root@localhost 下载]<span class="comment"># rpm --rebuilddb </span></span><br><span class="line">[root@localhost 下载]<span class="comment"># rpm -q glib2-2.36.3-2.fc19.i686</span></span><br><span class="line">未安装软件包 glib2-2.36.3-2.fc19.i686 </span><br><span class="line">[root@localhost 下载]<span class="comment"># rpm -q glib2-2.36.3-3.fc19.i686</span></span><br><span class="line">glib2-2.36.3-3.fc19.i686</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"><span class="comment">#### 查看RPM软件包信息</span></span><br><span class="line"></span><br><span class="line">有时候，我们需要查询软件包的信息，rpm -q选项提供了查询RPM包信息的一些功能。</span><br><span class="line"></span><br><span class="line">例如：</span><br><span class="line"></span><br><span class="line">查询软件包qemu-img-1.4.2-3.fc19.i686.rpm是否安装到系统：</span><br><span class="line">``` bash</span><br><span class="line">[kelvin@localhost 下载]$ rpm -qp qemu-img-1.4.2-3.fc19.i686.rpm </span><br><span class="line">qemu-img-1.4.2-3.fc19.i686</span><br></pre></td></tr></table></figure><p>-qp后面指定具体的包名，用于查询某具体的RPM包的信息，而不是已经安装到系统的RPM包的信息，如果想要查询已经安装到系统的包的信息，可以去掉-p选项。</p><p>在安装一个RPM包之前，我们通常想知道它安装了哪些文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[kelvin@localhost 下载]$ rpm -qpl qemu-img-1.4.2-3.fc19.i686.rpm </span><br><span class="line">/usr/bin/qemu-img</span><br><span class="line">/usr/bin/qemu-io</span><br><span class="line">/usr/bin/qemu-nbd</span><br><span class="line">/usr/share/man/man1/qemu-img.1.gz</span><br><span class="line">/usr/share/man/man8/qemu-nbd.8.gz</span><br></pre></td></tr></table></figure><p>-q选项也可以被用来查询软件包的依赖关系：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[kelvin@localhost 下载]$ rpm -qpR qemu-img-1.4.2-3.fc19.i686.rpm </span><br><span class="line">libaio.so.1</span><br><span class="line">libaio.so.1(LIBAIO_0.1)</span><br><span class="line">libaio.so.1(LIBAIO_0.4)</span><br><span class="line">libc.so.6</span><br><span class="line">......</span><br><span class="line">rtld(GNU_HASH)</span><br><span class="line">rpmlib(PayloadIsXz) &lt;= 5.2-1</span><br></pre></td></tr></table></figure><p>如果想知道一个文件是属于哪个文件包的，可以通过下面的命令来实现：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[kelvin@localhost 下载]$ rpm -qf /usr/bin/qemu-img</span><br><span class="line">qemu-img-1.4.2-12.fc19.i686</span><br></pre></td></tr></table></figure><h4 id="验证软件包中的文件是否被修改过"><a href="#验证软件包中的文件是否被修改过" class="headerlink" title="验证软件包中的文件是否被修改过"></a>验证软件包中的文件是否被修改过</h4><p>RPM机制提供了一种非常实用的功能，可以让我们查看到系统中哪些软件包的文件被修改过，从而可以看出是否有病毒或者是恶意软件。我们可以使用rpm -Va来查看系统中所有被更该过的文件，如果有二进制文件被改动过，我们应该特别留意这些文件。下面的例子演示了被修改过的/usr/bin/qemu-img文件通过强制重新安装来还原的过程：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost 下载]<span class="comment"># rpm -qf /usr/bin/qemu-img </span></span><br><span class="line">qemu-img-1.4.2-12.fc19.i686</span><br><span class="line">[root@localhost 下载]<span class="comment"># echo &quot;abc&quot; &gt;&gt; /usr/bin/qemu-img </span></span><br><span class="line">[root@localhost 下载]<span class="comment"># rpm -Va | grep .*qemu.*</span></span><br><span class="line">S.5....T.    /usr/bin/qemu-img</span><br><span class="line">[root@localhost 下载]<span class="comment"># rpm -ivh qemu-img-1.4.2-3.fc19.i686.rpm --force</span></span><br><span class="line">准备中...                          <span class="comment">################################# [100%]</span></span><br><span class="line">正在升级/安装...</span><br><span class="line">    1:qemu-img-2:1.4.2-3.fc19          <span class="comment">################################# [100%]</span></span><br><span class="line">[root@localhost 下载]<span class="comment"># rpm -Va | grep .*qemu.*</span></span><br><span class="line">.........    /usr/bin/qemu-img (已被替换)</span><br><span class="line">.........    /usr/bin/qemu-io (已被替换)</span><br><span class="line">.........    /usr/bin/qemu-nbd (已被替换)</span><br><span class="line">.........  d /usr/share/man/man1/qemu-img.1.gz (已被替换)</span><br><span class="line">.........  d /usr/share/man/man8/qemu-nbd.8.gz (已被替换)</span><br></pre></td></tr></table></figure><h4 id="使用YUM来解决RPM包的依赖问题"><a href="#使用YUM来解决RPM包的依赖问题" class="headerlink" title="使用YUM来解决RPM包的依赖问题"></a>使用YUM来解决RPM包的依赖问题</h4><p>前面提到过，使用rpm命令来安装和卸载软件，处理RPM包之间的依赖关系非常复杂。YUM(Yellow dog Updater, Modified, YUM)很好地解决了软件包之间依赖关系地问题，在安装、升级、卸载RPM包的时候可以自动地将依赖包也一并安装或卸载。一般来说，在系统装好之后就可以直接使用yum命令了，不用进行额外地配置。如果想了解如何去创建和配置YUM，请参考YUM的文档(2)。</p><p>使用YUM来安装qemu-img：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># yum install qemu-img</span></span><br><span class="line">已加载插件：fastestmirror, ibm-repository, langpacks, refresh-packagekit</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line">    * fedora: mirrors.yun-idc.com</span><br><span class="line">    * openclient: ocfedora.hursley.ibm.com</span><br><span class="line">    * rpmfusion-free: mirror.bjtu.edu.cn</span><br><span class="line">    * rpmfusion-free-updates: mirror.bjtu.edu.cn</span><br><span class="line">    * rpmfusion-nonfree: mirror.bjtu.edu.cn</span><br><span class="line">    * rpmfusion-nonfree-updates: mirror.bjtu.edu.cn</span><br><span class="line">    * updates: mirrors.yun-idc.com</span><br><span class="line">正在解决依赖关系</span><br><span class="line">--&gt; 正在检查事务</span><br><span class="line">---&gt; 软件包 qemu-img.i686.2.1.4.2-12.fc19 将被 安装</span><br><span class="line">--&gt; 解决依赖关系完成</span><br><span class="line"></span><br><span class="line">依赖关系解决</span><br><span class="line">    </span><br><span class="line">    ========================================================================================================================================</span><br><span class="line">        Package                        架构                       版本                                     源                             大小</span><br><span class="line">    ========================================================================================================================================</span><br><span class="line">    正在安装:</span><br><span class="line">        qemu-img                       i686                       2:1.4.2-12.fc19                          updates                       454 k</span><br><span class="line">    </span><br><span class="line">    事务概要</span><br><span class="line">    ========================================================================================================================================</span><br><span class="line">    安装  1 软件包</span><br><span class="line">    </span><br><span class="line">    总下载量：454 k</span><br><span class="line">    安装大小：2.0 M</span><br><span class="line">    Is this ok [y/d/N]: y</span><br><span class="line">    Downloading packages:</span><br><span class="line">    Not downloading Presto metadata <span class="keyword">for</span> updates</span><br><span class="line">    qemu-img-1.4.2-12.fc19.i686.rpm                                                                                  | 454 kB  00:00:00     </span><br><span class="line">    Running transaction check</span><br><span class="line">    Running transaction <span class="built_in">test</span></span><br><span class="line">    Transaction <span class="built_in">test</span> succeeded</span><br><span class="line">    Running transaction</span><br><span class="line">        正在安装    : 2:qemu-img-1.4.2-12.fc19.i686                                                                                       1/1 </span><br><span class="line">        验证中      : 2:qemu-img-1.4.2-12.fc19.i686                                                                                       1/1 </span><br><span class="line">    </span><br><span class="line">    已安装:</span><br><span class="line">        qemu-img.i686 2:1.4.2-12.fc19                                                                                                         </span><br><span class="line">    </span><br><span class="line">    完毕！</span><br></pre></td></tr></table></figure><p>可以看到，在安装qemu-img的时候，yum install 后面只需要接包名即可，无需完整的RPM文件名，而且YUM也会自动的解决安装包的依赖关系。</p><p>使用YUM来删除qemu-img：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># yum remove qemu-img</span></span><br><span class="line">已加载插件：fastestmirror, ibm-repository, langpacks, refresh-packagekit</span><br><span class="line">正在解决依赖关系</span><br><span class="line">--&gt; 正在检查事务</span><br><span class="line">---&gt; 软件包 qemu-img.i686.2.1.4.2-12.fc19 将被 删除</span><br><span class="line">--&gt; 正在处理依赖关系 /usr/bin/qemu-img，它被软件包 libvirt-daemon-1.0.5.6-3.fc19.i686 需要</span><br><span class="line">--&gt; 正在使用新的信息重新解决依赖关系</span><br><span class="line">--&gt; 正在检查事务</span><br><span class="line">---&gt; 软件包 libvirt-daemon.i686.0.1.0.5.6-3.fc19 将被 删除</span><br><span class="line">--&gt; 正在处理依赖关系 libvirt-daemon = 1.0.5.6-3.fc19，它被软件包 libvirt-daemon-driver-interface-1.0.5.6-3.fc19.i686 需要</span><br><span class="line">--&gt; 正在处理依赖关系 libvirt-daemon = 1.0.5.6-3.fc19，它被软件包 libvirt-daemon-driver-nodedev-1.0.5.6-3.fc19.i686 需要</span><br><span class="line">--&gt; 正在处理依赖关系 libvirt-daemon = 1.0.5.6-3.fc19，它被软件包 libvirt-daemon-driver-uml-1.0.5.6-3.fc19.i686 需要</span><br><span class="line">--&gt; 正在处理依赖关系 libvirt-daemon = 1.0.5.6-3.fc19，它被软件包 libvirt-daemon-driver-nwfilter-1.0.5.6-3.fc19.i686 需要</span><br><span class="line">--&gt; 正在处理依赖关系 libvirt-daemon = 1.0.5.6-3.fc19，它被软件包 libvirt-1.0.5.6-3.fc19.i686 需要</span><br><span class="line">--&gt; 正在处理依赖关系 libvirt-daemon = 1.0.5.6-3.fc19，它被软件包 libvirt-daemon-driver-secret-1.0.5.6-3.fc19.i686 需要</span><br><span class="line">--&gt; 正在处理依赖关系 libvirt-daemon = 1.0.5.6-3.fc19，它被软件包 libvirt-daemon-driver-network-1.0.5.6-3.fc19.i686 需要</span><br><span class="line">--&gt; 正在处理依赖关系 libvirt-daemon = 1.0.5.6-3.fc19，它被软件包 libvirt-daemon-driver-lxc-1.0.5.6-3.fc19.i686 需要</span><br><span class="line">--&gt; 正在处理依赖关系 libvirt-daemon = 1.0.5.6-3.fc19，它被软件包 libvirt-daemon-config-nwfilter-1.0.5.6-3.fc19.i686 需要</span><br><span class="line">--&gt; 正在处理依赖关系 libvirt-daemon = 1.0.5.6-3.fc19，它被软件包 libvirt-daemon-driver-storage-1.0.5.6-3.fc19.i686 需要</span><br><span class="line">--&gt; 正在处理依赖关系 libvirt-daemon = 1.0.5.6-3.fc19，它被软件包 libvirt-daemon-driver-libxl-1.0.5.6-3.fc19.i686 需要</span><br><span class="line">--&gt; 正在处理依赖关系 libvirt-daemon = 1.0.5.6-3.fc19，它被软件包 libvirt-daemon-config-network-1.0.5.6-3.fc19.i686 需要</span><br><span class="line">--&gt; 正在处理依赖关系 libvirt-daemon = 1.0.5.6-3.fc19，它被软件包 libvirt-daemon-driver-qemu-1.0.5.6-3.fc19.i686 需要</span><br><span class="line">--&gt; 正在处理依赖关系 libvirt-daemon = 1.0.5.6-3.fc19，它被软件包 libvirt-daemon-driver-xen-1.0.5.6-3.fc19.i686 需要</span><br><span class="line">--&gt; 正在检查事务</span><br><span class="line">---&gt; 软件包 libvirt.i686.0.1.0.5.6-3.fc19 将被 删除</span><br><span class="line">---&gt; 软件包 libvirt-daemon-config-network.i686.0.1.0.5.6-3.fc19 将被 删除</span><br><span class="line">---&gt; 软件包 libvirt-daemon-config-nwfilter.i686.0.1.0.5.6-3.fc19 将被 删除</span><br><span class="line">---&gt; 软件包 libvirt-daemon-driver-interface.i686.0.1.0.5.6-3.fc19 将被 删除</span><br><span class="line">---&gt; 软件包 libvirt-daemon-driver-libxl.i686.0.1.0.5.6-3.fc19 将被 删除</span><br><span class="line">---&gt; 软件包 libvirt-daemon-driver-lxc.i686.0.1.0.5.6-3.fc19 将被 删除</span><br><span class="line">---&gt; 软件包 libvirt-daemon-driver-network.i686.0.1.0.5.6-3.fc19 将被 删除</span><br><span class="line">---&gt; 软件包 libvirt-daemon-driver-nodedev.i686.0.1.0.5.6-3.fc19 将被 删除</span><br><span class="line">---&gt; 软件包 libvirt-daemon-driver-nwfilter.i686.0.1.0.5.6-3.fc19 将被 删除</span><br><span class="line">---&gt; 软件包 libvirt-daemon-driver-qemu.i686.0.1.0.5.6-3.fc19 将被 删除</span><br><span class="line">......</span><br><span class="line">0:1.0.5.6-3.fc19              </span><br><span class="line">        libvirt-daemon-driver-interface.i686 0:1.0.5.6-3.fc19               libvirt-daemon-driver-libxl.i686 0:1.0.5.6-3.fc19                 </span><br><span class="line">        libvirt-daemon-driver-lxc.i686 0:1.0.5.6-3.fc19                     libvirt-daemon-driver-network.i686 0:1.0.5.6-3.fc19               </span><br><span class="line">        libvirt-daemon-driver-nodedev.i686 0:1.0.5.6-3.fc19                 libvirt-daemon-driver-nwfilter.i686 0:1.0.5.6-3.fc19              </span><br><span class="line">        libvirt-daemon-driver-qemu.i686 0:1.0.5.6-3.fc19                    libvirt-daemon-driver-secret.i686 0:1.0.5.6-3.fc19                </span><br><span class="line">        libvirt-daemon-driver-storage.i686 0:1.0.5.6-3.fc19                 libvirt-daemon-driver-uml.i686 0:1.0.5.6-3.fc19                   </span><br><span class="line">        libvirt-daemon-driver-xen.i686 0:1.0.5.6-3.fc19                    </span><br><span class="line"></span><br><span class="line">完毕！</span><br></pre></td></tr></table></figure><p>YUM在删除qemu-img的同时，也会将依赖于qemu-img的libvirt删除掉，这样便不会引起因依赖包的缺失而导致的软件无法使用的问题。</p><p>使用YUM来升级qemu-img：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># yum update qemu-img</span></span><br><span class="line">已加载插件：fastestmirror, ibm-repository, langpacks, refresh-packagekit</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line">    * fedora: mirrors.yun-idc.com</span><br><span class="line">    * openclient: ocfedora.hursley.ibm.com</span><br><span class="line">    * rpmfusion-free: mirror.bjtu.edu.cn</span><br><span class="line">    * rpmfusion-free-updates: mirror.bjtu.edu.cn</span><br><span class="line">    * rpmfusion-nonfree: mirror.bjtu.edu.cn</span><br><span class="line">    * rpmfusion-nonfree-updates: mirror.bjtu.edu.cn</span><br><span class="line">    * updates: mirrors.yun-idc.com</span><br><span class="line">No packages marked <span class="keyword">for</span> update</span><br></pre></td></tr></table></figure><p>qemu-img已经是最新版本。</p><p>使用YUM来查看qemu-img的信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># yum info qemu-img</span></span><br><span class="line">已加载插件：fastestmirror, ibm-repository, langpacks, refresh-packagekit</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line">    * fedora: mirrors.yun-idc.com</span><br><span class="line">    * openclient: ocfedora.hursley.ibm.com</span><br><span class="line">    * rpmfusion-free: mirror.bjtu.edu.cn</span><br><span class="line">    * rpmfusion-free-updates: mirror.bjtu.edu.cn</span><br><span class="line">    * rpmfusion-nonfree: mirror.bjtu.edu.cn</span><br><span class="line">    * rpmfusion-nonfree-updates: mirror.bjtu.edu.cn</span><br><span class="line">    * updates: mirrors.yun-idc.com</span><br><span class="line">可安装的软件包</span><br><span class="line">名称    ：qemu-img</span><br><span class="line">架构    ：i686</span><br><span class="line">时期       ：2</span><br><span class="line">版本    ：1.4.2</span><br><span class="line">发布    ：12.fc19</span><br><span class="line">大小    ：454 k</span><br><span class="line">源    ：updates/19/i386</span><br><span class="line">简介    ： QEMU <span class="built_in">command</span> line tool <span class="keyword">for</span> manipulating disk images</span><br><span class="line">网址    ：http://www.qemu.org/</span><br><span class="line">协议    ： GPLv2+ and LGPLv2+ and BSD</span><br><span class="line">描述    ： This package provides a <span class="built_in">command</span> line tool <span class="keyword">for</span> manipulating disk images</span><br></pre></td></tr></table></figure><p>YUM虽然好用，但毕竟是建立在RPM机制之上的，所以rpm命令也至关重要。</p><h3 id="制作自己的rpm包"><a href="#制作自己的rpm包" class="headerlink" title="制作自己的rpm包"></a>制作自己的rpm包</h3><p>既然使用RPM包管理机制能够很便捷地安装、升级以及卸载软件，那么该如何把自己的软件制作成RPM包呢？其实步骤很简单，只需要编辑自己的spec文件，然后使用rpmbuild命令来打包即可。spec文件告诉了rpmbuild究竟要制作什么样的软件包(包名，版本，作者等)，从哪获源代码，如何编译等。rpmbuild根据spec来制作满足需求的RPM包。所以，对于RPM打包来说，编写spec文件非常重要。如果想要很全面地学习spec文件的语法，可以阅读参考文献(3)和(4)，本文只是以制作开源项目HLFS(5)的RPM包为例，来说明如何打包。读者并不需要深入的了解HLFS，只需要知道HLFS是用c语言所写，依赖于glib、log4c等函数库，编译用到cmake即可。</p><h4 id="获取HLFS源代码"><a href="#获取HLFS源代码" class="headerlink" title="获取HLFS源代码"></a>获取HLFS源代码</h4><p>在安装rpmbuild之后，通常会在家目录下产生rpmbuild目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[kelvin@localhost ~]$ ls -r ~/rpmbuild</span><br><span class="line">SRPMS  SPECS  SOURCES  RPMS  BUILD</span><br></pre></td></tr></table></figure><p>这几个子目录中，SPECS目录用来放置spec文件，SOURCES目录用来放置软件的源代码，RPMS放置打包生成的RPM包，SRPMS放置生成的SRPM包(包的内容是源代码和spec文件)，BUILD用来存放rpmbuild打包过程中临时用到的数据。</p><p>在打包之前，需要把源代码先放到SOURCES目录下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[kelvin@localhost ~]$ <span class="built_in">cd</span> ~/rpmbuild/SOURCES/</span><br><span class="line">[kelvin@localhost SOURCES]$ wget http://cloudxy.googlecode.com/files/hlfs.tar.gz</span><br></pre></td></tr></table></figure><p>源码拷贝之后需要在系统上安装编译HLFS所需要的工具cmake, glib等：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">[kelvin@localhost ~]$ sudo yum install cmake glib2-devel log4c-devel snappy-devel java-1.8.0-openjdk-devel hadoop-0.20-libhdfs </span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line"><span class="comment">#### 编辑hlfs.spec</span></span><br><span class="line"></span><br><span class="line">在SPECS目录下创建hlfs.spec并写入以下内容：</span><br><span class="line">``` bash</span><br><span class="line">%define version 1.0</span><br><span class="line"></span><br><span class="line">Name: hlfs</span><br><span class="line">Version: %&#123;version&#125;</span><br><span class="line">Release:1</span><br><span class="line">Summary: A distribuited and log-structured file system based on HDFS.</span><br><span class="line"></span><br><span class="line">Group: Development/Libraries</span><br><span class="line">License: GPLv2</span><br><span class="line">URL: https://code.google.com/p/cloudxy</span><br><span class="line">Source0: hlfs-%&#123;version&#125;.tar.gz</span><br><span class="line"></span><br><span class="line">Buildroot: /tmp/hlfs</span><br><span class="line">Requires: glib2 &gt;= 2.0</span><br><span class="line">Requires: log4c &gt;= 1.2.3</span><br><span class="line">Requires: snappy &gt;= 1.1.0</span><br><span class="line">Requires: java-1.8.0-openjdk-devel &gt;= 1.8.0.0</span><br><span class="line">Requires: hadoop-0.20-libhdfs &gt;= 0.20.2</span><br><span class="line">BuildRequires: cmake</span><br><span class="line">BuildRequires: glib2-devel &gt;= 2.0</span><br><span class="line">BuildRequires: log4c-devel &gt;= 1.2.3</span><br><span class="line">BuildRequires: snappy-devel &gt;= 1.1.0</span><br><span class="line">BuildRequires: java-1.8.0-openjdk-devel &gt;= 1.8.0.0</span><br><span class="line">BuildRequires: hadoop-0.20-libhdfs &gt;= 0.20.2</span><br><span class="line"></span><br><span class="line">%description</span><br><span class="line"></span><br><span class="line">HLFS(actually, Block level Storage System seems more proper than File System) </span><br><span class="line">is a distributed VM image storage system <span class="keyword">for</span> ECMS,<span class="built_in">which</span> provides highly availab-</span><br><span class="line">le block level storage volumes that can be attached to XEN virtual machines by </span><br><span class="line">its tapdisk driver.Similar project related to KVM is sheepdog，but they are <span class="keyword">in</span> </span><br><span class="line">different architectures.</span><br><span class="line"></span><br><span class="line">Compared with sheepdog, HLFS has greater scalability and reliability than sheep-</span><br><span class="line">dog by now,as we are on the shoulder of hadoop distribute file system (HDFS).Me-</span><br><span class="line">anwhile,HLFS also supports advanced volume management features such as snapshot(</span><br><span class="line">HLFS can also support snapshot tree)、cloning、thin provisioning and cache.</span><br><span class="line"></span><br><span class="line">The main idea of HLFS is:</span><br><span class="line"></span><br><span class="line">Take advantage of Log-structured File System<span class="string">&#x27;s ideology to build an on-line ima-</span></span><br><span class="line"><span class="string">ge storage system on HDFS which can guarantee the reliability and scalability </span></span><br><span class="line"><span class="string">for our storage system</span></span><br><span class="line"><span class="string">The ideology of LFS makes our storage system support random access to online im-</span></span><br><span class="line"><span class="string">ages.The ideology of LFS also makes our storage system more efficient and easily</span></span><br><span class="line"><span class="string">take snapshot.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">%prep</span></span><br><span class="line"><span class="string">%setup -q</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">%build</span></span><br><span class="line"><span class="string">cd ./build</span></span><br><span class="line"><span class="string">cmake ../src</span></span><br><span class="line"><span class="string">make</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">%install</span></span><br><span class="line"><span class="string">cd build</span></span><br><span class="line"><span class="string">make install DESTDIR=%&#123;buildroot&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">%files</span></span><br><span class="line"><span class="string">%dir /usr/local/hlfs/bin</span></span><br><span class="line"><span class="string">%dir /usr/local/hlfs/include</span></span><br><span class="line"><span class="string">%dir /usr/local/hlfs/lib</span></span><br><span class="line"><span class="string">%dir /usr/local/hlfs</span></span><br><span class="line"><span class="string">/usr/local/hlfs/bin/clone.hlfs</span></span><br><span class="line"><span class="string">/usr/local/hlfs/bin/log4crc</span></span><br><span class="line"><span class="string">/usr/local/hlfs/bin/mkfs.hlfs</span></span><br><span class="line"><span class="string">/usr/local/hlfs/bin/nbd_ops</span></span><br><span class="line"><span class="string">/usr/local/hlfs/bin/rmfs.hlfs</span></span><br><span class="line"><span class="string">/usr/local/hlfs/bin/segcalc.hlfs</span></span><br><span class="line"><span class="string">/usr/local/hlfs/bin/segclean.hlfs</span></span><br><span class="line"><span class="string">/usr/local/hlfs/bin/snapshot.hlfs</span></span><br><span class="line"><span class="string">/usr/local/hlfs/bin/stat.hlfs</span></span><br><span class="line"><span class="string">/usr/local/hlfs/bin/tapdisk_ops</span></span><br><span class="line"><span class="string">/usr/local/hlfs/include/address.h</span></span><br><span class="line"><span class="string">/usr/local/hlfs/include/api/hlfs.h</span></span><br><span class="line"><span class="string">/usr/local/hlfs/include/base_ops.h</span></span><br><span class="line"><span class="string">/usr/local/hlfs/include/bs_hdfs.h</span></span><br><span class="line"><span class="string">/usr/local/hlfs/include/bs_local.h</span></span><br><span class="line"><span class="string">/usr/local/hlfs/include/cache.h</span></span><br><span class="line"><span class="string">/usr/local/hlfs/include/cache_helper.h</span></span><br><span class="line"><span class="string">/usr/local/hlfs/include/clone.h</span></span><br><span class="line"><span class="string">/usr/local/hlfs/include/cmd_define.h</span></span><br><span class="line"><span class="string">/usr/local/hlfs/include/comm_define.h</span></span><br><span class="line"><span class="string">/usr/local/hlfs/include/ctrl_region.h</span></span><br><span class="line"><span class="string">/usr/local/hlfs/include/hlfs_ctrl.h</span></span><br><span class="line"><span class="string">/usr/local/hlfs/include/hlfs_log.h</span></span><br><span class="line"><span class="string">/usr/local/hlfs/include/icache.h</span></span><br><span class="line"><span class="string">/usr/local/hlfs/include/logger.h</span></span><br><span class="line"><span class="string">/usr/local/hlfs/include/misc.h</span></span><br><span class="line"><span class="string">/usr/local/hlfs/include/seg_clean.h</span></span><br><span class="line"><span class="string">/usr/local/hlfs/include/seg_clean_helper.h</span></span><br><span class="line"><span class="string">/usr/local/hlfs/include/snapshot.h</span></span><br><span class="line"><span class="string">/usr/local/hlfs/include/snapshot_helper.h</span></span><br><span class="line"><span class="string">/usr/local/hlfs/include/storage.h</span></span><br><span class="line"><span class="string">/usr/local/hlfs/include/storage_helper.h</span></span><br><span class="line"><span class="string">/usr/local/hlfs/lib/libhlfs.so</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">%clean</span></span><br><span class="line"><span class="string">rm -rf $RPM_BUILD_ROOT</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">%changelog</span></span><br><span class="line"><span class="string">* Sat Aug 10 2013 Wang Sen&lt;wangsen@linux.vnet.ibm.com&gt; 1.0-1</span></span><br><span class="line"><span class="string">- First build.</span></span><br></pre></td></tr></table></figure><p>spec文件可以使用%define来定义宏，并且用%{name}来展开宏。文件开头将HLFS的版本号用宏来定义以方便以后的升级。从结构上来看，hlfs.spec大致分为以下几个部分：</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line">%description及包信息</span><br><span class="line">%prep</span><br><span class="line">%build</span><br><span class="line">%install</span><br><span class="line">%files</span><br><span class="line">%clean</span><br><span class="line">%changelog</span><br><span class="line">```   </span><br><span class="line"></span><br><span class="line">第一部分给出了HLFS软件包的一些基本信息，比如说包名、版本号、release号、项目的URL、源代码等信息。一般来说，对于同一版本的代码，每打包一次release号加1。Group指定了该软件的类型，rpm所有可用的类型可以在/usr/share/doc/rpm-(rpm版本)/GROUPS文件中查到。summary和description给出了软件包的介绍，这些内容可以通过rpm -qi或者yum info来查看到。Requires指定了HLFS需要依赖的包及其版本号，BuildRequires指出了打包需要的软件包及其版本号。</span><br><span class="line"></span><br><span class="line">%prep部分的主要作用是将源代码解压缩解包以提供给编译过程，一般是通过%setup宏来实现。当然也可以不用这个宏，自己手动的实现。rpmbuild常用的宏是在以下几个文件中定义的，需要时可以查看：</span><br><span class="line">``` bash</span><br><span class="line">/usr/lib/rpm/macros</span><br><span class="line">/usr/lib/rpm/redhat/macros</span><br><span class="line">/etc/rpm/macros</span><br><span class="line">~/.rpmmacros</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">%build部分是将上面准备好的源代码通过<span class="keyword">shell</span>命令来编译成二进制可执行文件。</span><br><span class="line"></span><br><span class="line">%install将编译好的二进制文件安装到rpmbuild所用的临时表示最终安装根目录的buildroot里。</span><br><span class="line"></span><br><span class="line">%files指定HLFS的RPM包所要包含的文件和目录，可以通过rpm -qpl来查看到这些文件列表。</span><br><span class="line"></span><br><span class="line">%clean部分用来删除打包过程中产生的临时文件。</span><br><span class="line"></span><br><span class="line">%changelog用来记录spec文件的改动，在vim的命令模式下可以输入`\\c`来快速地插入作者信息及时间戳。</span><br><span class="line"></span><br><span class="line">#### 使用rpmbuild打包</span><br><span class="line"></span><br><span class="line">编写完spec文件之后就可以使用rpmbuild命令来打包了。选项-bb用来产生二进制包；-<span class="keyword">bs</span>用来产生SRPM包；-ba生成两种类型地包。我们使用rpmbuild -ba来生成二进制包和源码包：</span><br><span class="line">``` bash</span><br><span class="line">[kelvin@localhost SPECS]$ rpmbuild -ba hlfs.spec </span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">结果生成地二进制包会放到RPMS/<span class="variable">$&#123;arch&#125;</span>目录下，源码包会放到SRPMS目录下。打包完成后可以通过rpm命令来检验所产生地RPM包：</span><br><span class="line">``` bash</span><br><span class="line">[kelvin@localhost ~]$ <span class="keyword">cd</span> ~/rpmbuild/RPMS/i386/</span><br><span class="line">[kelvin@localhost i386]$ <span class="keyword">ls</span></span><br><span class="line">hlfs-1.0-1.i386.rpm</span><br><span class="line">[kelvin@localhost i386]$ rpm -qpl hlfs-1.0-1.i386.rpm </span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs</span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/bin</span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/bin/clone.hlfs</span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/bin/log4crc</span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/bin/mkfs.hlfs</span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/bin/nbd_ops</span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/bin/rmfs.hlfs</span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/bin/segcalc.hlfs</span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/bin/segclean.hlfs</span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/bin/snapshot.hlfs</span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/bin/stat.hlfs</span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/bin/tapdisk_ops</span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/<span class="keyword">include</span></span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/<span class="keyword">include</span>/address.<span class="keyword">h</span></span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/<span class="keyword">include</span>/api/hlfs.<span class="keyword">h</span></span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/<span class="keyword">include</span>/base_ops.<span class="keyword">h</span></span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/<span class="keyword">include</span>/bs_hdfs.<span class="keyword">h</span></span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/<span class="keyword">include</span>/bs_local.<span class="keyword">h</span></span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/<span class="keyword">include</span>/cache.<span class="keyword">h</span></span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/<span class="keyword">include</span>/cache_helper.<span class="keyword">h</span></span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/<span class="keyword">include</span>/clone.<span class="keyword">h</span></span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/<span class="keyword">include</span>/cmd_define.<span class="keyword">h</span></span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/<span class="keyword">include</span>/comm_define.<span class="keyword">h</span></span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/<span class="keyword">include</span>/ctrl_region.<span class="keyword">h</span></span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/<span class="keyword">include</span>/hlfs_ctrl.<span class="keyword">h</span></span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/<span class="keyword">include</span>/hlfs_log.<span class="keyword">h</span></span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/<span class="keyword">include</span>/icache.<span class="keyword">h</span></span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/<span class="keyword">include</span>/logger.<span class="keyword">h</span></span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/<span class="keyword">include</span>/misc.<span class="keyword">h</span></span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/<span class="keyword">include</span>/seg_clean.<span class="keyword">h</span></span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/<span class="keyword">include</span>/seg_clean_helper.<span class="keyword">h</span></span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/<span class="keyword">include</span>/snapshot.<span class="keyword">h</span></span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/<span class="keyword">include</span>/snapshot_helper.<span class="keyword">h</span></span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/<span class="keyword">include</span>/storage.<span class="keyword">h</span></span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/<span class="keyword">include</span>/storage_helper.<span class="keyword">h</span></span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/lib</span><br><span class="line">/usr/<span class="keyword">local</span>/hlfs/lib/libhlfs.<span class="keyword">so</span></span><br><span class="line">[kelvin@localhost i386]$ rpm -qpi hlfs-1.0-1.i386.rpm </span><br><span class="line">Name        : hlfs</span><br><span class="line"><span class="keyword">Version</span>     : 1.0</span><br><span class="line">Release     : 1</span><br><span class="line">Architecture: i386</span><br><span class="line">Install Date: (not installed)</span><br><span class="line">Group       : Development/Libraries</span><br><span class="line">Size        : 851341</span><br><span class="line">License     : GPLv2</span><br><span class="line">Signature   : (none)</span><br><span class="line">Source RPM  : hlfs-1.0-1.src.rpm</span><br><span class="line">Build Date  : 2013年11月04日 星期一 17时26分34秒</span><br><span class="line">Build Host  : localhost.localdomain</span><br><span class="line">Relocations : (not relocatable)</span><br><span class="line">URL         : https:<span class="comment">//code.google.com/p/cloudxy</span></span><br><span class="line">Summary     : A distribuited and <span class="keyword">log</span>-structured <span class="keyword">file</span> system based <span class="keyword">on</span> HDFS.</span><br><span class="line">Description :</span><br><span class="line"></span><br><span class="line">HLFS(actually, Block level Storage System seems <span class="keyword">more</span> proper than <span class="keyword">File</span> System)</span><br><span class="line">is a distributed VM image storage system <span class="keyword">for</span> ECMS,<span class="keyword">which</span> provides highly availab-</span><br><span class="line">le block level storage volumes that can be attached to XEN virtual machines <span class="keyword">by</span></span><br><span class="line">its tapdisk driver.Similar project related to KVM is sheepdog，but they are <span class="keyword">in</span></span><br><span class="line">different architectures.</span><br><span class="line"></span><br><span class="line">Compared with sheepdog, HLFS has greater scalability and reliability than sheep-</span><br><span class="line">dog <span class="keyword">by</span> now,<span class="keyword">as</span> we are <span class="keyword">on</span> the shoulder of hadoop distribute <span class="keyword">file</span> system (HDFS).Me-</span><br><span class="line">anwhile,HLFS also supports advanced volume management features such <span class="keyword">as</span> snapshot(</span><br><span class="line">HLFS can also support snapshot tree)、cloning、thin provisioning and cache.</span><br><span class="line"></span><br><span class="line">The main idea of HLFS is:</span><br><span class="line"></span><br><span class="line">Take advantage of <span class="keyword">Log</span>-structured <span class="keyword">File</span> System&#x27;s ideology to build <span class="keyword">an</span> <span class="keyword">on</span>-<span class="keyword">line</span> ima-</span><br><span class="line"><span class="keyword">ge</span> storage system <span class="keyword">on</span> HDFS <span class="keyword">which</span> can guarantee the reliability and scalability</span><br><span class="line"><span class="keyword">for</span> our storage system</span><br><span class="line">The ideology of LFS makes our storage system support random access to online im-</span><br><span class="line">ages.The ideology of LFS also makes our storage system <span class="keyword">more</span> efficient and easily</span><br><span class="line">take snapshot.</span><br><span class="line">[kelvin@localhost i386]$ rpm -qpR hlfs-1.0-1.i386.rpm </span><br><span class="line">glib2 &gt;= 2.0</span><br><span class="line">hadoop-0.20-libhdfs &gt;= 0.20.2</span><br><span class="line">java-1.8.0-openjdk-devel &gt;= 1.8.0.0</span><br><span class="line">libc.<span class="keyword">so</span>.6</span><br><span class="line">libc.<span class="keyword">so</span>.6(GLIBC_2.0)</span><br><span class="line">libc.<span class="keyword">so</span>.6(GLIBC_2.1)</span><br><span class="line">libc.<span class="keyword">so</span>.6(GLIBC_2.1.3)</span><br><span class="line">libglib-2.0.<span class="keyword">so</span>.0</span><br><span class="line">libgthread-2.0.<span class="keyword">so</span>.0</span><br><span class="line">libhdfs.<span class="keyword">so</span>.0</span><br><span class="line">libjvm.<span class="keyword">so</span></span><br><span class="line">liblog4c.<span class="keyword">so</span>.3</span><br><span class="line">librt.<span class="keyword">so</span>.1</span><br><span class="line">libsnappy.<span class="keyword">so</span>.1</span><br><span class="line">log4c &gt;= 1.2.3</span><br><span class="line">rpmlib(CompressedFileNames) &lt;= 3.0.4-1</span><br><span class="line">rpmlib(PayloadFilesHavePrefix) &lt;= 4.0-1</span><br><span class="line">rtld(GNU_HASH)</span><br><span class="line">snappy &gt;= 1.1.0</span><br></pre></td></tr></table></figure><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>本文通过实例介绍了RPM包的使用以及打包方法，适合初学者快速地掌握RPM软件包机制，如果需要更加详细地了解RPM软件包机制，请阅读参考文献(4)和(5)。</p><h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><ul><li>鸟哥的Linux私房菜——基础学习篇，第三版，22章。  </li><li>YUM文档：<a href="http://yum.baseurl.org/wiki/Guides">http://yum.baseurl.org/wiki/Guides</a>  </li><li>Fedora RPM Guide：<a href="http://docs.fedoraproject.org/en-US/Fedora_Draft_Documentation/0.1/html/RPM_Guide/index.html">http://docs.fedoraproject.org/en-US/Fedora_Draft_Documentation/0.1/html/RPM_Guide/index.html</a>  </li><li>Maximum RPM：<a href="http://ishare.iask.sina.com.cn/f/37848528.html">http://ishare.iask.sina.com.cn/f/37848528.html</a>  </li><li>HLFS Project Home：<a href="http://code.google.com/p/cloudxy/">http://code.google.com/p/cloudxy/</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rmp </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
